(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"+wab":function(e,t,r){"use strict";r.r(t);var n,i=r("mK0O"),a=r("eijD"),s=r("hisu"),o=r("yBJb"),u=r("CHlC"),c=r("kMo5"),l=r("P+uj"),f=r("NthX"),p=r.n(f),h=r("dQW7"),d=r("4VMI"),y=r("xAIp"),b=r("J4Pc"),v=(r("wckI"),r("TM+E")),O=r("iaHD");function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var i=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(c.a)(this,r)}}var g=n=function(e){Object(u.a)(r,e);var t=j(r);function r(){var e;return Object(s.a)(this,r),(e=t.apply(this,arguments)).isAggregate=!0,e}return Object(o.a)(r,[{key:"getEffectivePopupTemplate",value:function(){if(this.popupTemplate)return this.popupTemplate;var e=this.sourceLayer&&this.sourceLayer.featureReduction;return e&&"popupTemplate"in e&&e.popupEnabled?e.popupTemplate:null}},{key:"getObjectId",value:function(){return this.objectId}},{key:"clone",value:function(){return new n(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({objectId:this.objectId},this.cloneProperties()))}}]),r}(d.a);Object(h.a)([Object(y.b)({type:Boolean})],g.prototype,"isAggregate",void 0),Object(h.a)([Object(y.b)({type:Number,json:{read:!0}})],g.prototype,"objectId",void 0);var x=g=n=Object(h.a)([Object(O.a)("esri.AggregateGraphic")],g),_=(r("ZTBZ"),r("X6u8")),k=r("kDog"),w=r("Mp7X"),R=r("0fJP"),S=r("7im+"),I=r("IH5m"),F=r("j56I"),E=r("/BCw"),P=r("aIyS"),T=r("kJId"),C=r("hdDo"),q=r("PmOk"),U=r("55C+"),A=r("1n4m");function M(e,t){return N.apply(this,arguments)}function N(){return(N=Object(a.a)(p.a.mark((function e(t,n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:e.t0=t.type,e.next="class-breaks"===e.t0||"simple"===e.t0||"unique-value"===e.t0||"dot-density"===e.t0||"dictionary"===e.t0?5:"heatmap"===e.t0?10:15;break;case 5:return e.next=7,Promise.all([r.e(0),r.e(1),r.e(60)]).then(r.bind(null,"O3nI"));case 7:return e.t1=e.sent.default,e.t2=n,e.abrupt("return",new e.t1(e.t2));case 10:return e.next=12,Promise.all([r.e(0),r.e(1),r.e(171)]).then(r.bind(null,"v0Nq"));case 12:return e.t3=e.sent.default,e.t4=n,e.abrupt("return",new e.t3(e.t4));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var V=r("Kjqp"),D=r("s13b"),L=r("6CzD"),J=(r("QDHd"),r("hZBP")),H=r("CNVc");function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var i=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(c.a)(this,r)}}function B(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return G(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return G(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Q(e){return e.some((function(e){return e.globalId}))}function W(e){return e.filter((function(e){return!e.error})).map((function(e){var t;return null!=(t=e.objectId)?t:e.globalId}))}function K(e,t){var r,n=new Set(e),i=B(t.values());try{for(i.s();!(r=i.n()).done;){var a=r.value;n.add(a)}}catch(s){i.e(s)}finally{i.f()}return n}function Z(e,t){var r,n=new Set(e),i=B(t.values());try{for(i.s();!(r=i.n()).done;){var a=r.value;n.delete(a)}}catch(s){i.e(s)}finally{i.f()}return n}var X=function(e){Object(u.a)(r,e);var t=z(r);function r(e){var n;return Object(s.a)(this,r),(n=t.call(this))._hasGlobalIds=!1,n._queueProcessor=new H.a({concurrency:1,process:e.process}),n}return Object(o.a)(r,[{key:"destroy",value:function(){this._queueProcessor.clear()}},{key:"updating",get:function(){return this._queueProcessor.length>0}},{key:"push",value:function(e){var t=this,r=this._queueProcessor,n=r.last();switch(e.type){case"update":case"refresh":if((null==n?void 0:n.type)===e.type)return;r.push(e).finally((function(){return t.notifyChange("updating")}));break;case"edit":var i="processed-edit"===(null==n?void 0:n.type)?n:null;i&&r.popLast();var a,s=B(this._mergeEdits(i,e));try{for(s.s();!(a=s.n()).done;){var o=a.value;r.push(o).finally((function(){return t.notifyChange("updating")}))}}catch(u){s.e(u)}finally{s.f()}}this.notifyChange("updating")}},{key:"_mergeEdits",value:function(e,t){var r,n,i=t.edits,a=i.addedFeatures,s=i.deletedFeatures,o=i.updatedFeatures;if(this._hasGlobalIds=this._hasGlobalIds||Q(a)||Q(o)||Q(s),this._hasGlobalIds)return[e,{type:"processed-edit",edits:{addOrModified:[].concat(Object(L.a)(a),Object(L.a)(o)),removed:s}}];var u=new Set(W(null!=(r=null==e?void 0:e.edits.addOrModified)?r:[])),c=new Set(W(null!=(n=null==e?void 0:e.edits.removed)?n:[])),l=new Set([].concat(Object(L.a)(W(a)),Object(L.a)(W(o)))),f=new Set(W(s));return[{type:"processed-edit",edits:{addOrModified:Array.from(K(Z(u,f),l)).map((function(e){return{objectId:e}})),removed:Array.from(K(Z(c,l),f)).map((function(e){return{objectId:e}}))}}]}}]),r}(J.a);Object(h.a)([Object(y.b)({readOnly:!0})],X.prototype,"updating",null);var $=X=Object(h.a)([Object(O.a)("esri.views.2d.layers.support.FeatureCommandQueue")],X),Y=r("t4nU"),ee=r("Akvs");function te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var i=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(c.a)(this,r)}}function re(e){return Array.isArray(e)}var ne=function(e){Object(u.a)(E,e);var t,r,n,i,c,l,f,h,d,y,b,v,O,m,j,g,x,_,k,w,R,S,F=te(E);function E(e){var t;return Object(s.a)(this,E),(t=F.call(this,e))._startupResolver=Object(I.g)(),t.isReady=!1,t}return Object(o.a)(E,[{key:"initialize",value:function(){this._controller=Object(I.d)(),this.addResolvingPromise(this._startWorker(this._controller.signal))}},{key:"destroy",value:function(){this._controller.abort(),this._connection&&this._connection.close()}},{key:"tileRenderer",set:function(e){this.client.tileRenderer=e}},{key:"closed",get:function(){return this._connection.closed}},{key:"startup",value:(S=Object(a.a)(p.a.mark((function e(t,r,n,i){var a,s,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.when();case 2:return a=this._controller.signal,s=re(n.source)?{transferList:n.source,signal:a}:void 0,o={service:n,config:r,tileInfo:t.tileInfo.toJSON(),tiles:i},e.next=5,this._connection.invoke("startup",o,s);case 5:this._startupResolver.resolve(),this._set("isReady",!0);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return S.apply(this,arguments)})},{key:"updateTiles",value:(R=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(I.l)(this._connection.invoke("updateTiles",t)));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"update",value:(w=Object(a.a)(p.a.mark((function e(t){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={config:t},e.next=3,this._startupResolver.promise;case 3:return e.abrupt("return",this._connection.invoke("update",r));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"applyUpdate",value:(k=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("applyUpdate",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"setHighlight",value:(_=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(I.l)(this._connection.invoke("controller.setHighlight",t)));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"refresh",value:(x=Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(I.l)(this._connection.invoke("controller.refresh")));case 3:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"querySummaryStatistics",value:(g=Object(a.a)(p.a.mark((function e(t,r,n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.querySummaryStatistics",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return g.apply(this,arguments)})},{key:"queryFeatures",value:(j=Object(a.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryFeatures",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return j.apply(this,arguments)})},{key:"queryObjectIds",value:(m=Object(a.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryObjectIds",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"queryFeatureCount",value:(O=Object(a.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryFeatureCount",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return O.apply(this,arguments)})},{key:"queryExtent",value:(v=Object(a.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._connection.invoke("controller.queryExtent",t.toJSON(),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"queryLatestObservations",value:(b=Object(a.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryLatestObservations",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"queryStatistics",value:(y=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryStatistics",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getObjectId",value:(d=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getObjectId",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getDisplayId",value:(h=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getDisplayId",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getFeature",value:(f=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getFeature",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"getAggregate",value:(l=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getAggregate",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"getAggregateValueRanges",value:(c=Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getAggregateValueRanges"));case 3:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"mapValidDisplayIds",value:(i=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.mapValidDisplayIds",t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"onEdits",value:(n=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(I.l)(this._connection.invoke("controller.onEdits",t)));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"enableEvent",value:(r=Object(a.a)(p.a.mark((function e(t,r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(I.l)(this._connection.invoke("controller.enableEvent",{name:t,value:r})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"_startWorker",value:(t=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(ee.b)("Pipeline",{client:this.client,strategy:"dedicated",signal:t});case 3:this._connection=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),Object(I.w)(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return t.apply(this,arguments)})}]),E}(Y.a);Object(h.a)([Object(y.b)()],ne.prototype,"isReady",void 0),Object(h.a)([Object(y.b)()],ne.prototype,"client",void 0),Object(h.a)([Object(y.b)()],ne.prototype,"tileRenderer",null);var ie=ne=Object(h.a)([Object(O.a)("esri.views.2d.layers.support.FeatureLayerProxy")],ne),ae=r("V3XU"),se=r("EGWc"),oe=r("60x+");function ue(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ce(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ce(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var le,fe=function(){function e(t){Object(s.a)(this,e),this._tiles=new Map,this.buffer=0,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this.buffer=t.buffer}return Object(o.a)(e,[{key:"destroy",value:function(){}},{key:"clear",value:function(){var e=this;this._tiles.forEach((function(t){return e._releaseTile(t)}))}},{key:"tileKeys",value:function(){var e=[];return this._tiles.forEach((function(t,r){return e.push(r)})),e}},{key:"update",value:function(e){var t,r=this,n=this.tileInfoView.getTileCoverage(e.state,this.buffer,"closest"),i=n.spans,a=n.lodInfo,s=a.level,o=[],u=[],c=new Set,l=new Set,f=ue(i);try{for(f.s();!(t=f.n()).done;)for(var p=t.value,h=p.row,d=p.colFrom,y=p.colTo,b=d;b<=y;b++){var v=oe.a.getId(s,h,a.normalizeCol(b),a.getWorldForColumn(b)),O=this._getOrAcquireTile(o,v);c.add(v),O.isReady?O.visible=!0:l.add(O.key)}}catch(m){f.e(m)}finally{f.f()}return l.forEach((function(e){return r._addPlaceholders(c,e)})),this._tiles.forEach((function(e){c.has(e.key.id)||(u.push(e.key.id),r._releaseTile(e))})),se.a.pool.release(n),{hasMissingTiles:l.size>0,added:o,removed:u}}},{key:"_getOrAcquireTile",value:function(e,t){if(!this._tiles.has(t)){var r=this.acquireTile(new oe.a(t));e.push(t),this._tiles.set(t,r),r.visible=!1}return this._tiles.get(t)}},{key:"_getTile",value:function(e){return this._tiles.get(e)}},{key:"_releaseTile",value:function(e){this._tiles.delete(e.key.id),this.releaseTile(e)}},{key:"_addPlaceholders",value:function(e,t){var r=this._addPlaceholderChildren(e,t);Math.abs(1-r)<1e-6||this._addPlaceholderParent(e,t)||(this._getTile(t.id).visible=!0)}},{key:"_addPlaceholderChildren",value:function(e,t){var r=this,n=0;return this._tiles.forEach((function(i){n+=r._addPlaceholderChild(e,i,t)})),n}},{key:"_addPlaceholderChild",value:function(e,t,r){return t.key.level<=r.level||!t.hasData||!r.contains(t.key)?0:(t.visible=!0,e.add(t.key.id),1/(1<<2*(t.key.level-r.level)))}},{key:"_addPlaceholderParent",value:function(e,t){for(var r=t.getParentKey(),n=0,i=null;Object(S.i)(r);){if(e.has(r.id))return!0;var a=this._getTile(r.id);if(null!=a&&a.isReady)return a.visible=!0,e.add(a.key.id),!0;null!=a&&a.hasData&&a.patchCount>n&&(n=a.patchCount,i=a),r=r.getParentKey()}return!!i&&(i.visible=!0,e.add(i.key.id),!0)}}]),e}(),pe=r("4Mpa"),he=r("NRoO"),de=r("DuP7"),ye=r("DE4D"),be=r("0n+b"),ve=r("x9kL");function Oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var i=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(c.a)(this,r)}}var me=le=function(e){Object(u.a)(r,e);var t=Oe(r);function r(){var e;return Object(s.a)(this,r),(e=t.apply(this,arguments)).filter=null,e.includedEffect=null,e.excludedEffect=null,e.excludedLabelsVisible=!1,e}return Object(o.a)(r,[{key:"clone",value:function(){return new le({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}}]),r}(be.a);Object(h.a)([Object(y.b)({type:ve.a,json:{write:!0}})],me.prototype,"filter",void 0),Object(h.a)([Object(y.b)({json:{write:!0}})],me.prototype,"includedEffect",void 0),Object(h.a)([Object(y.b)({json:{write:!0}})],me.prototype,"excludedEffect",void 0),Object(h.a)([Object(y.b)({type:Boolean,json:{write:!0}})],me.prototype,"excludedLabelsVisible",void 0);var je=me=le=Object(h.a)([Object(O.a)("esri.views.layers.support.FeatureEffect")],me),ge=r("eTpk");function xe(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return _e(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _e(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var i=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(c.a)(this,r)}}var we=v.a.getLogger("esri.views.layers.FeatureLayerView"),Re=function(e){var t=function(e){Object(u.a)(c,e);var t,r,n,i=ke(c);function c(){var e;Object(s.a)(this,c);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=i.call.apply(i,[this].concat(r)))._updatingRequiredFieldsPromise=null,e.effect=null,e.filter=null,e.timeExtent=null,e.layer=null,e.requiredFields=[],e.view=null,e}return Object(o.a)(c,[{key:"initialize",value:function(){var e=this;Object(F.a)(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","effect","layer.timeInfo","layer.floorInfo","timeExtent"],(function(){return e._handleRequiredFieldsChange()}),!0),Object(F.b)(this,"view.floors","change",(function(){return e._handleRequiredFieldsChange()})),Object(F.b)(this,"layer.sublayer","change",(function(){return e._handleRequiredFieldsChange()}))}},{key:"availableFields",get:function(){var e=this.layer,t=this.layer.fieldsIndex,r=this.requiredFields;return"outFields"in e&&e.outFields?Object(de.i)(t,[].concat(Object(L.a)(Object(de.t)(t,e.outFields)),Object(L.a)(r))):Object(de.i)(t,r)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(e){we.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"highlight",value:function(e){throw new Error("missing implementation")}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=Object(S.i)(this.filter)?this.filter.createQuery(e):new C.a(e);return Object(S.i)(this.timeExtent)&&(t.timeExtent=Object(S.i)(t.timeExtent)?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}},{key:"queryFeatures",value:function(e,t){throw new Error("missing implementation")}},{key:"queryObjectIds",value:function(e,t){throw new Error("missing implementation")}},{key:"queryFeatureCount",value:function(e,t){throw new Error("missing implementation")}},{key:"queryExtent",value:function(e,t){throw new Error("missing implementation")}},{key:"_loadArcadeModules",value:function(e){if(e.get("expressionInfos.length"))return Object(ye.e)()}},{key:"_handleRequiredFieldsChange",value:function(){var e=this,t=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t),t.then((function(){e._updatingRequiredFieldsPromise===t&&e._set("_updatingRequiredFieldsPromise",null)}))}},{key:"_updateRequiredFields",value:(n=Object(a.a)(p.a.mark((function e(){var t,r,n,i,a,s,o,u,c,l,f,h,d,y;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layer&&this.view){e.next=2;break}return e.abrupt("return");case 2:return t="3d"===this.view.type,r=this.layer,n=this.layer,i=n.fieldsIndex,a=n.objectIdField,s="renderer"in r&&r.renderer,o=r.featureReduction,u=new Set,e.next=12,Object(I.j)([s?s.collectRequiredFields(u,i):null,Object(de.g)(u,r),t?Object(de.b)(u,r):null,Object(S.i)(this.filter)?Object(de.f)(u,r,this.filter):null,this.effect?Object(de.f)(u,r,this.effect.filter):null,o?Object(de.c)(u,r,o):null]);case 12:if(c=e.sent,r.timeInfo&&this.timeExtent&&Object(de.e)(u,r.fieldsIndex,[r.timeInfo.startField,r.timeInfo.endField]),"feature"===r.type&&r.floorInfo&&Object(de.e)(u,r.fieldsIndex,[r.floorInfo.floorField]),"subtype-group"!==r.type){e.next=18;break}return Object(de.d)(u,i,r.subtypeField),l=r.sublayers.map((function(e){var t;return Promise.all([null==(t=e.renderer)?void 0:t.collectRequiredFields(u,i),Object(de.g)(u,e)])})),e.next=18,Object(I.j)(l);case 18:f=xe(c);try{for(f.s();!(h=f.n()).done;)(d=h.value).error&&we.error(d.error)}catch(p){f.e(p)}finally{f.f()}Object(de.d)(u,i,a),t&&"displayField"in r&&r.displayField&&Object(de.d)(u,i,r.displayField),y=Array.from(u).sort(),this._set("requiredFields",y);case 23:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"validateFetchPopupFeatures",value:function(e){if(Object(S.h)(e))return null;var t,r=xe(e.clientGraphics);try{for(r.s();!(t=r.n()).done;){var n=t.value.layer;if("popupEnabled"in n&&!n.popupEnabled)return new w.a("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:n});if("popupTemplate"in n&&!Object(ge.a)(n,e))return new w.a("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:n})}}catch(i){r.e(i)}finally{r.f()}}},{key:"fetchClientPopupFeatures",value:(r=Object(a.a)(p.a.mark((function e(t){var r,n,i,a,s,o,u,c,l,f,h,d=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Object(S.i)(t)?t.clientGraphics:null)&&0!==r.length){e.next=3;break}return e.abrupt("return",Promise.resolve([]));case 3:return n=[],i=[],e.next=7,this.createPopupQuery(t);case 7:a=e.sent,s=xe(r),e.prev=9,s.s();case 11:if((o=s.n()).done){e.next=25;break}if(u=o.value,"popupEnabled"in(c=u.layer)){e.next=16;break}return e.abrupt("continue",23);case 16:if(l=Object(de.t)(this.layer.fieldsIndex,a.outFields),f=Object(ge.a)(c,t),Object(S.i)(f)){e.next=19;break}return e.abrupt("continue",23);case 19:return e.next=21,this._loadArcadeModules(f);case 21:(h=e.sent)&&h.arcadeUtils.hasGeometryOperations(f)||!Object(de.h)(l,u)?i.push(u):n.push(u);case 23:e.next=11;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(9),s.e(e.t0);case 30:return e.prev=30,s.f(),e.finish(30);case 33:return e.abrupt("return","stream"===this.layer.type||0===i.length?Promise.resolve(n):(a.objectIds=i.map((function(e){return e.attributes[d.layer.objectIdField]})),this.layer.queryFeatures(a).then((function(e){return n.concat(e.features)})).catch((function(){return i}))));case 34:case"end":return e.stop()}}),e,this,[[9,27,30,33]])}))),function(e){return r.apply(this,arguments)})},{key:"createPopupQuery",value:(t=Object(a.a)(p.a.mark((function e(t){var r,n,i,a,s,o,u,c,l,f,h,d,y,b;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.layer.createQuery(),n=new Set,i=!1,a=Object(S.i)(t)&&t.clientGraphics?t.clientGraphics.map((function(e){return e.layer})):[this.layer],s=xe(a),e.prev=4,s.s();case 6:if((o=s.n()).done){e.next=25;break}if("popupEnabled"in(u=o.value)){e.next=10;break}return e.abrupt("continue",23);case 10:if(c=Object(ge.a)(u,t),Object(S.i)(c)){e.next=13;break}return e.abrupt("continue",23);case 13:return e.next=15,this._loadArcadeModules(c);case 15:return l=e.sent,f=l&&l.arcadeUtils.hasGeometryOperations(c),i=!("point"!==this.layer.geometryType&&!f),e.next=20,Object(ge.b)(this.layer,c);case 20:h=e.sent,d=xe(h);try{for(d.s();!(y=d.n()).done;)b=y.value,n.add(b)}catch(p){d.e(p)}finally{d.f()}case 23:e.next=6;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(4),s.e(e.t0);case 30:return e.prev=30,s.f(),e.finish(30);case 33:return e.abrupt("return",(r.returnGeometry=i,r.returnZ=i,r.returnM=i,r.outFields=Array.from(n),r.outSpatialReference=this.view.spatialReference,r));case 34:case"end":return e.stop()}}),e,this,[[4,27,30,33]])}))),function(e){return t.apply(this,arguments)})},{key:"canResume",value:function(){return!(!Object(pe.a)(Object(l.a)(c.prototype),"canResume",this).call(this)||Object(S.i)(this.timeExtent)&&this.timeExtent.isEmpty)}}]),c}(e);return Object(h.a)([Object(y.b)()],t.prototype,"_updatingRequiredFieldsPromise",void 0),Object(h.a)([Object(y.b)({readOnly:!0})],t.prototype,"availableFields",null),Object(h.a)([Object(y.b)({type:je})],t.prototype,"effect",void 0),Object(h.a)([Object(y.b)({type:ve.a})],t.prototype,"filter",void 0),Object(h.a)([Object(y.b)(he.a)],t.prototype,"timeExtent",void 0),Object(h.a)([Object(y.b)()],t.prototype,"layer",void 0),Object(h.a)([Object(y.b)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),Object(h.a)([Object(y.b)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),Object(h.a)([Object(y.b)({readOnly:!0})],t.prototype,"requiredFields",void 0),Object(h.a)([Object(y.b)()],t.prototype,"suspended",void 0),Object(h.a)([Object(y.b)()],t.prototype,"view",void 0),t=Object(h.a)([Object(O.a)("esri.views.layers.FeatureLayerView")],t),t},Se=r("bPf0"),Ie=r("TRFF"),Fe=r("S6/K"),Ee=r("VLTM"),Pe=r("9PpZ"),Te=r("nd5+");function Ce(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return qe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qe(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(r),!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(l.a)(e);if(t){var i=Object(l.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(c.a)(this,r)}}var Ne=function(e){return(2147483648&e)>>>31==1};function Ve(e){return e&&"openPorts"in e}var De=v.a.getLogger("esri.views.2d.layers.FeatureLayerView2D"),Le=function(e){Object(u.a)(H,e);var t,r,n,i,c,l,f,h,y,v,O,m,j,g,U,N,L,J=Me(H);function H(){var e;return Object(s.a)(this,H),(e=J.apply(this,arguments))._pipelineIsUpdating=!0,e._commandsQueue=new $({process:function(t){switch(t.type){case"processed-edit":return e._doEdit(t);case"refresh":return e._doRefresh();case"update":return e._doUpdate()}}}),e._visibilityOverrides=new Set,e._effect=null,e._highlightIds=new Map,e._lastPixelBuffer=0,e._updateHighlight=Object(I.i)(Object(a.a)(p.a.mark((function t(){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._proxy.setHighlight(Array.from(e._highlightIds.keys())));case 1:case"end":return t.stop()}}),t)})))),e._uploadsLocked=!1,e._needsClusterSizeUpdate=!1,e.filter=null,e.effectLists={included:new Fe.a,excluded:new Fe.a},e}return Object(o.a)(H,[{key:"destroy",value:function(){var e,t;Object(S.a)(this._updateClusterSizeTask,(function(e){return e.remove()})),null==(e=this._proxy)||e.destroy(),null==(t=this.tileRenderer)||t.destroy(),this._commandsQueue.destroy()}},{key:"initialize",value:function(){var e=this;this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.handles.add([this.on("valueRangesChanged",(function(t){e._set("_aggregateValueRanges",t.valueRanges)})),Object(F.a)(this,"effect",(function(t){e.effectLists.included.effect=null==t?void 0:t.includedEffect})),Object(F.a)(this,"effect",(function(t){e.effectLists.excluded.effect=null==t?void 0:t.excludedEffect}))])}},{key:"_initProxy",value:(L=Object(a.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("isTable"in this.layer)||!this.layer.isTable){e.next=2;break}throw new w.a("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});case 2:return this._proxy&&this._proxy.destroy(),t=this._createClientOptions(),e.abrupt("return",(this._set("_proxy",new ie({client:t})),this._proxy.when()));case 5:case"end":return e.stop()}}),e,this)}))),function(){return L.apply(this,arguments)})},{key:"_initServiceOptions",value:(N=Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._createServiceOptions();case 3:e.t1=e.sent,e.t0._set.call(e.t0,"_serviceOptions",e.t1);case 5:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"labelsVisible",get:function(){var e="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&e.some((function(e){return e.labelingInfo&&e.labelsVisible}))}},{key:"effect",get:function(){return Object(S.q)(this._effect,null)},set:function(e){var t=this._effect;Object(S.i)(t)&&Object(S.i)(t.filter)&&t.filter.enabled&&Object(S.i)(e)&&Object(S.i)(e.filter)&&e.filter.enable(),this._effect=e,this.notifyChange("effect")}},{key:"effects",get:function(){return this.effect&&[this.effect]||[]}},{key:"queryMode",get:function(){return this._serviceOptions.type}},{key:"renderingConfigHash",get:function(){if(!this.layer)return null;var e=this.availableFields,t=this.layer,r=this.view.floors,n=t.definitionExpression,i="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,a="renderer"in t&&t.renderer,s="feature"===t.type?t.gdbVersion:void 0,o="feature"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,u=this.timeExtent,c="stream"===t.type?"".concat(JSON.stringify(t.geometryDefinition)).concat(t.definitionExpression):null,l=JSON.stringify(this.clips),f=t.featureReduction&&t.featureReduction.toJSON(),p="sublayers"in this.layer&&this.layer.sublayers.items.reduce((function(e,t){return e+"".concat(t.visible?1:0,".").concat(JSON.stringify(t.renderer),".").concat(t.labelsVisible,"\n.").concat(JSON.stringify(t.labelingInfo))}),"");return JSON.stringify({sublayerHash:p,filterHash:Object(S.i)(this.filter)&&this.filter.toJSON(),effectHash:Object(S.i)(this.effect)&&this.effect.toJSON(),streamFilter:c,gdbVersion:s,definitionExpression:n,historicMoment:o,availableFields:e,renderer:a,labelingInfo:i,timeExtent:u,floors:r,clipsHash:l,featureReduction:f})}},{key:"hasEffects",get:function(){return this.effectLists.included.hasEffects||this.effectLists.excluded.hasEffects}},{key:"highlight",value:function(e){var t,r=this;return e instanceof d.a?t=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?t=[e]:k.a.isCollection(e)?t=e.map((function(e){return e&&e.getAttribute(r.layer.objectIdField)})).toArray():Array.isArray(e)&&e.length>0&&(t="number"==typeof e[0]||"string"==typeof e[0]?e:e.map((function(e){return e&&e.getAttribute(r.layer.objectIdField)}))),t&&t.length?(t=t.filter((function(e){return null!=e})),this._addHighlight(t),{remove:function(){return r._removeHighlight(t)}}):{remove:function(){}}}},{key:"hasHighlight",value:function(){return!!this._highlightIds.size}},{key:"hitTest",value:function(e,t){return this._hitTest(e,t)}},{key:"queryStatistics",value:function(){return this._proxy.queryStatistics()}},{key:"querySummaryStatistics",value:(U=Object(a.a)(p.a.mark((function e(t,r,n){var i,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Ae({},r),r.valueExpression&&(i.viewInfoParams={viewingMode:"map",scale:this.view.scale,spatialReference:null==(a=this.view.spatialReference)?void 0:a.toJSON()}),e.abrupt("return",this._proxy.querySummaryStatistics(this._cleanUpQuery(t),i,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return U.apply(this,arguments)})},{key:"queryFeatures",value:function(e,t){var r=this;return this.queryFeaturesJSON(e,t).then((function(e){var t=T.default.fromJSON(e);return t.features.forEach((function(e){return r._setLayersForFeature(e)})),t}))}},{key:"queryFeaturesJSON",value:function(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}},{key:"queryObjectIds",value:function(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}},{key:"queryFeatureCount",value:function(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}},{key:"queryExtent",value:function(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then((function(e){return{count:e.count,extent:Te.a.fromJSON(e.extent)}}))}},{key:"setVisibility",value:function(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}},{key:"update",value:function(e){if(this._tileStrategy&&this.tileRenderer){var t=this._tileStrategy.update(e),r=t.hasMissingTiles,n=t.added,i=t.removed;(n.length||i.length)&&this._proxy.updateTiles({added:n,removed:i}),r&&this.requestUpdate(),this.notifyChange("updating")}}},{key:"attach",value:function(){var e=this;this.view.timeline.record("".concat(this.layer.title," (FeatureLayer) Attach")),this._tileStrategy=new fe({acquireTile:function(t){return e._acquireTile(t)},releaseTile:function(t){return e._releaseTile(t)},tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add(Object(F.a)(this,"renderingConfigHash",(function(){return e._update()})),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",(function(t){return e._edit(t)})),"attach")}},{key:"detach",value:function(){this.container.removeAllChildren(),this.handles.remove("attach"),this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"fetchPopupFeatures",value:(g=Object(a.a)(p.a.mark((function e(t,r){var n,i,a,s,o=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(S.i)(r)||!r.clientGraphics.length){e.next=5;break}if(!((n=r.clientGraphics[0])instanceof x)){e.next=4;break}return e.abrupt("return",[n]);case 4:r.clientGraphics=r.clientGraphics.filter((function(e){var t=e.layer,r="popupEnabled"in t&&t.popupEnabled,n="popupTemplate"in t&&t.popupTemplate,i=o.view.popup.defaultPopupTemplateEnabled;return r&&(n||i)}));case 5:if(!(i=this.validateFetchPopupFeatures(r))){e.next=8;break}throw i;case 8:if(!Object(S.i)(r)||0!==r.clientGraphics.length){e.next=10;break}return e.abrupt("return",[]);case 10:if(a=this.fetchClientPopupFeatures(r),t){e.next=13;break}return e.abrupt("return",a);case 13:return s=this._fetchServicePopupFeatures(t,r),e.abrupt("return",Object(I.k)([a,s]).then(_.d));case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"_fetchServicePopupFeatures",value:(j=Object(a.a)(p.a.mark((function e(t,r){var n,i,a,s,o,u,c,l,f,h,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stream"!==this.layer.type&&"ogc-feature"!==this.layer.type){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.createPopupQuery(r);case 4:if(n=e.sent,i=this.layer,a="renderer"in i&&i.renderer,s=Object(S.i)(r)?r.event:null,o=Object(P.a)({renderer:a,event:s}),n.geometry=this.createFetchPopupFeaturesQueryGeometry(t,o),u=new Set,c=i.objectIdField,l=Object(S.i)(r)?r.clientGraphics:null){f=Ce(l);try{for(f.s();!(h=f.n()).done;)d=h.value,u.add(d.attributes[c])}catch(p){f.e(p)}finally{f.f()}}return e.abrupt("return",i.queryFeatures(n).then((function(e){return e.features.filter((function(e){return!u.has(e.attributes[c])}))})));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return j.apply(this,arguments)})},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return Object(Ee.a)(e,t,this.view)}},{key:"isUpdating",value:function(){var e,t="renderer"in this.layer&&null!=this.layer.renderer,r=this._commandsQueue.updating,n=null!=this._updatingRequiredFieldsPromise,i=!this._proxy||!this._proxy.isReady,a=this._pipelineIsUpdating,s=null===this.tileRenderer||(null==(e=this.tileRenderer)?void 0:e.updating),o=t&&(r||n||i||a||s);return Object(b.a)("esri-2d-log-updating")&&console.log("Updating FLV2D: ".concat(o,"\n  -> hasRenderer ").concat(t,"\n  -> hasPendingCommand ").concat(r,"\n  -> updatingRequiredFields ").concat(n,"\n  -> updatingProxy ").concat(i,"\n  -> updatingPipeline ").concat(a,"\n  -> updatingTileRenderer ").concat(s,"\n")),o}},{key:"_createClientOptions",value:function(){var e=this;return{setUpdating:function(t){e._set("_pipelineIsUpdating",t)},emitEvent:function(t){e.emit(t.name,t.event)}}}},{key:"_detectQueryMode",value:(m=Object(a.a)(p.a.mark((function e(t){var r,n,i,a,s,o,u,c,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("path"in t)||!Object(E.c)(t.path)||"feature"!==this.layer.type&&"subtype-group"!==this.layer.type||"point"!==this.layer.geometryType||this.layer.capabilities.operations.supportsEditing||!Object(b.a)("featurelayer-snapshot-enabled")){e.next=15;break}return e.prev=1,e.next=4,this.layer.queryFeatureCount();case 4:if(!((r=e.sent)<=Object(b.a)("featurelayer-snapshot-point-min-threshold"))){e.next=7;break}return e.abrupt("return",{mode:"snapshot",featureCount:r});case 7:if(n=Object(b.a)("featurelayer-snapshot-point-max-threshold"),i=Object(b.a)("featurelayer-snapshot-point-coverage"),a=this.view.extent,s=this.layer.fullExtent,o=null==s?void 0:s.clone().intersection(a),u=(null==o?void 0:o.width)*(null==o?void 0:o.height),c=(null==s?void 0:s.width)*(null==s?void 0:s.height),l=0===c?0:u/c,!(r<=n&&l>=i)){e.next=10;break}return e.abrupt("return",{mode:"snapshot",featureCount:r});case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),De.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:e.t0});case 15:return e.abrupt("return",{mode:"on-demand"});case 16:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e){return m.apply(this,arguments)})},{key:"_createServiceOptions",value:(O=Object(a.a)(p.a.mark((function e(){var t,r,n,i,a,s,o,u,c,l,f,h,d,y,b,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stream"!==(r=this.layer).type){e.next=3;break}return e.abrupt("return",null);case 3:if(n=r.capabilities,i=r.objectIdField,a=r.fields.map((function(e){return e.toJSON()})),s=r.fullExtent&&r.fullExtent.toJSON(),o=Object(ae.a)(r.geometryType),u=r.timeInfo&&r.timeInfo.toJSON()||null,c=r.spatialReference?r.spatialReference.toJSON():null,l=Ae(Ae({},"customParameters"in r?r.customParameters:void 0),{},{token:"apiKey"in r?r.apiKey:void 0}),f="feature"===r.type?r.globalIdField:null,"ogc-feature"!==r.type){e.next=8;break}h=r.source.getFeatureDefinition(),e.next=15;break;case 8:if(!Ve(r.source)){e.next=14;break}return e.next=11,r.source.openPorts();case 11:h=e.sent,e.next=15;break;case 14:r.parsedUrl&&(h=Object(R.a)(r.parsedUrl),"dynamicDataSource"in r&&r.dynamicDataSource&&(h.query={layer:JSON.stringify({source:r.dynamicDataSource})}));case 15:return d=null!=(t="subtypeField"in this.layer&&this.layer.subtypeField)?t:null,e.next=18,this._detectQueryMode(h);case 18:return y=e.sent,b=y.mode,v=y.featureCount,e.abrupt("return",{type:b,subtypeField:d,featureCount:v,globalIdField:f,maxRecordCount:n.query.maxRecordCount,tileMaxRecordCount:n.query.tileMaxRecordCount,capabilities:n,fields:a,fullExtent:s,geometryType:o,objectIdField:i,source:h,timeInfo:u,spatialReference:c,customParameters:l});case 22:case"end":return e.stop()}}),e,this)}))),function(){return O.apply(this,arguments)})},{key:"_createMemoryServiceOptions",value:(v=Object(a.a)(p.a.mark((function e(t){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.openPorts();case 2:return r=e.sent,e.abrupt("return",Ae(Ae({},this._createServiceOptions()),{},{type:"memory",source:r}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"_cleanUpQuery",value:function(e){var t=C.a.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}},{key:"_update",value:(y=Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._commandsQueue.push({type:"update"}));case 1:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"_edit",value:(h=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validateEdit(t)){e.next=2;break}return e.abrupt("return",this._commandsQueue.push({type:"edit",edits:t}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"doRefresh",value:(f=Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._commandsQueue.push({type:"refresh"}));case 1:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"_validateEdit",value:function(e){var t="globalIdField"in this.layer&&this.layer.globalIdField,r=e.deletedFeatures.some((function(e){return-1===e.objectId||!e.objectId})),n=t&&this.availableFields.includes(t);return r&&!n?(De.error(new w.a("mapview-apply-edits","Editing the specified service requires the layer's globalIdField, ".concat(t," to be included the layer's outFields for updates to be reflected on the map"))),null):e}},{key:"_doUpdate",value:(l=Object(a.a)(p.a.mark((function e(){var t,r,n,i,a,s,o,u,c,l,f,h,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.destroyed&&this._hasRequiredSupport(this.layer)&&this._tileStrategy){e.next=3;break}return e.abrupt("return");case 3:return t=this.effect,r=this.filter,e.next=6,this._updateRequiredFields();case 6:return n=this._getEffectiveRenderer(),i=n.renderer,this._set("_effectiveRenderer",i),a=this._createSchemaConfig(),s=Object(ae.a)(this.layer.geometryType),e.next=12,Object(V.a)(i,s,this.layer.featureReduction);case 12:if(o=e.sent,u=this._createConfiguration(a,r,t),this._lastPixelBuffer=0===o?0:Math.max(o,this._lastPixelBuffer),u.schema.source.pixelBuffer=this._lastPixelBuffer,(c=this._createTileRendererHash(i))===this._tileRendererHash){e.next=38;break}return e.next=19,this._initTileRenderer(i);case 19:if(l=this._serviceOptions,this.effects.forEach((function(e){return Object(S.i)(e)&&Object(S.i)(e.filter)&&e.filter.enable()})),this.tileRenderer.onConfigUpdate(i),f={added:this._tileStrategy.tileKeys(),removed:[]},h=this.layer,e.t0="stream"!==h.type&&Ve(h.source),!e.t0){e.next=27;break}return e.next=26,h.source.openPorts();case 26:l.source=e.sent;case 27:return e.next=29,this._proxy.startup(this.view.featuresTilingScheme,u,l,f);case 29:if(e.t1=this.hasHighlight(),!e.t1){e.next=33;break}return e.next=33,this._proxy.setHighlight(Array.from(this._highlightIds.keys()));case 33:return e.next=35,this._onceTilesUpdated();case 35:this.tileRenderer.onConfigUpdate(i),e.next=51;break;case 38:return e.next=40,this._proxy.update(u);case 40:return((d=e.sent).mesh||d.targets.aggregate)&&this._lockGPUUploads(),e.prev=42,e.next=45,this._proxy.applyUpdate(d);case 45:e.next=50;break;case 47:e.prev=47,e.t2=e.catch(42),Object(I.m)(e.t2)||De.error(e.t2);case 50:(d.mesh||d.targets.aggregate)&&this._unlockGPUUploads(),this.effects.forEach((function(e){return Object(S.i)(e)&&Object(S.i)(e.filter)&&e.filter.enable()})),this.tileRenderer.onConfigUpdate(i),this._updateClusterSizeVariable(),this._forceAttributeTextureUpload();case 51:this._tileRendererHash=c,this.tileRenderer.invalidateLabels(),this.requestUpdate(),e.next=56;break;case 54:e.prev=54,e.t3=e.catch(0);case 56:case"end":return e.stop()}}),e,this,[[0,54],[42,47]])}))),function(){return l.apply(this,arguments)})},{key:"_doEdit",value:(c=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._proxy.onEdits(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Object(I.m)(e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(e){return c.apply(this,arguments)})},{key:"_doRefresh",value:(i=Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._lockGPUUploads(),e.prev=1,e.next=4,this._proxy.refresh();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Object(I.m)(e.t0);case 9:this._unlockGPUUploads();case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return i.apply(this,arguments)})},{key:"_updateClusterSizeVariable",value:function(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)}},{key:"_createUpdateClusterSizeTask",value:function(e,t){var r=this;return this.watch("_aggregateValueRanges",function(){var n=Object(a.a)(p.a.mark((function n(i){return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r._updateClusterEffectiveRendererSizeVariable(e,t,i),r._needsClusterSizeUpdate=!0,r._uploadsLocked||r._updateClusterSizeVariable();case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"_updateClusterEffectiveRendererSizeVariable",value:(n=Object(a.a)(p.a.mark((function e(t,r,n){var i,a,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.dynamicClusterSize&&"visualVariables"in t&&t.visualVariables&&(i=Object(D.c)(t.visualVariables),Object(S.i)(i)&&"cluster_count"===i.field&&(a=t.visualVariables.indexOf(i),t.visualVariables[a]=Object(D.a)(r,n),(s=t.clone()).dynamicClusterSize=!0,this._set("_effectiveRenderer",s)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"_getEffectiveRenderer",value:function(){var e="renderer"in this.layer&&this.layer.renderer,t=this.layer.featureReduction;if(Object(S.i)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&"cluster"===t.type&&Object(D.d)(e)){var r=t,n=[],i=Object(D.b)(n,e,r,this._aggregateValueRanges);return Object(S.a)(this._updateClusterSizeTask,(function(e){return e.remove()})),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(i,r),{renderer:i,aggregateFields:n,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}}},{key:"_acquireTile",value:function(e){var t=this,r=this.tileRenderer.acquireTile(e);return r.once("attach",(function(){t.requestUpdate()})),r}},{key:"_releaseTile",value:function(e){this.tileRenderer.releaseTile(e)}},{key:"_initTileRenderer",value:(r=Object(a.a)(p.a.mark((function e(t){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});case 2:return r=e.sent,e.abrupt("return",(this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null),this.destroyed?null:(this._proxy.tileRenderer=r,this._set("tileRenderer",r),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(t),this.requestUpdate(),this.tileRenderer)));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_createTileRendererHash",value:function(e){return"".concat("heatmap"===e.type?"heatmap":"symbol",".").concat("dot-density"===e.type)}},{key:"_createFeatureDataHash",value:function(e,t,r){var n=e.getAttributeHash(),i=JSON.stringify(t),a=Object(S.i)(r)&&JSON.stringify(r.filter),s=JSON.stringify(this.timeExtent),o="";return this._visibilityOverrides.forEach((function(e){return o+=e})),"".concat(n,".").concat(i,".").concat(a,".").concat(s,".").concat(o)}},{key:"hasFilter",get:function(){var e=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||e||!!this._visibilityOverrides.size||!!this.timeExtent}},{key:"_injectOverrides",value:function(e){var t=Object(S.i)(e)?e.timeExtent:null,r=Object(S.i)(this.timeExtent)&&Object(S.i)(t)?this.timeExtent.intersection(t):this.timeExtent||t,n=null,i="floorInfo"in this.layer&&this.layer.floorInfo;if(i){var a=Object(S.i)(e)&&e.where;n=this._addFloorFilterClause(a)}if(!this._visibilityOverrides.size&&!r&&!i)return e;var s=Object(S.i)(e)&&e.clone()||new ve.a;return s.hiddenIds=this._visibilityOverrides,s.timeExtent=r,n&&(s.where=n),s}},{key:"_addFloorFilterClause",value:function(e){var t=this.layer,r=e||"";if("floorInfo"in t&&t.floorInfo){var n,i=this.view.floors;if(!i||!i.length)return r;null!=(n=t.floorInfo.viewAllLevelIds)&&n.length&&(i=t.floorInfo.viewAllLevelIds);var a=i.filter((function(e){return""!==e})).map((function(e){return"'"+e+"'"}));a.push("''");var s=t.floorInfo.floorField,o="("+s+" IN ({ids}) OR "+s+" IS NULL)";if(o=o.replace("{ids}",a.join(", ")),Object(S.i)(r)&&r.includes(s)){var u=new RegExp("AND \\("+s+".*NULL\\)","g");r=r.replace(u,""),u=new RegExp("\\("+s+".*NULL\\)","g"),r=(r=r.replace(u,"")).replace(/\s+/g," ").trim()}r=""!==r?"("+r+") AND "+o:o}return""!==r?r:null}},{key:"_createConfiguration",value:function(e,t,r){var n="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,i="feature"===this.layer.type?this.layer.gdbVersion:void 0,a=new Array(q.l),s=this._injectOverrides(t);a[0]=Object(S.i)(s)?s.toJSON():null,a[1]=Object(S.i)(r)&&r.filter?r.filter.toJSON():null;var o=Object(A.b)(e);if(Object(S.h)(o))return null;var u=Object(Pe.a)();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:i,historicMoment:n,devicePixelRatio:window.devicePixelRatio||1,filters:a,schema:o,supportsTextureFloat:u.supportsTextureFloat,maxTextureSize:u.maxTextureSize}}},{key:"_hasRequiredSupport",value:function(e){var t;return!("renderer"in e&&"dot-density"===(null==(t=e.renderer)?void 0:t.type)&&!Object(Pe.a)().supportsTextureFloat&&(De.error(new w.a("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))}},{key:"_onceTilesUpdated",value:function(){return this.requestUpdate(),Object(F.g)(this,"_pipelineIsUpdating",!1)}},{key:"_lockGPUUploads",value:function(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())}},{key:"_unlockGPUUploads",value:function(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())}},{key:"_forceAttributeTextureUpload",value:function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}},{key:"_createSchemaConfig",value:function(){var e="feature"===this.layer.type?this.layer.historicMoment:null,t="feature"===this.layer.type?this.layer.gdbVersion:null;return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:e,labelsVisible:"labelsVisible"in this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,effect:this.effect,filter:this.filter,gdbVersion:t,pixelBuffer:0}}},{key:"_addHighlight",value:function(e){var t,r=Ce(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this._highlightIds.has(n)){var i=this._highlightIds.get(n);this._highlightIds.set(n,i+1)}else this._highlightIds.set(n,1)}}catch(a){r.e(a)}finally{r.f()}this._updateHighlight().catch((function(e){Object(I.m)(e)||De.error(e)}))}},{key:"_removeHighlight",value:function(e){var t,r=Ce(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this._highlightIds.has(n)){var i=this._highlightIds.get(n)-1;0===i?this._highlightIds.delete(n):this._highlightIds.set(n,i)}}}catch(a){r.e(a)}finally{r.f()}this._updateHighlight().catch((function(e){Object(I.m)(e)||De.error(e)}))}},{key:"_setLayersForFeature",value:function(e){var t=this.layer;e.layer=t,e.sourceLayer=t}},{key:"_createHittestResult",value:function(e){return this._setLayersForFeature(e),Object(S.i)(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}},{key:"_hitTest",value:(t=Object(a.a)(p.a.mark((function e(t,r){var n,i,a,s,o,u=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended&&this.tileRenderer){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.tileRenderer.hitTest(t,r);case 4:if(0!==(n=e.sent).length){e.next=9;break}return e.next=8,Object(I.a)(1);case 8:return e.abrupt("return",null);case 9:if(i=n[0],Ne(i)){e.next=15;break}return e.next=13,this._proxy.getFeature(i);case 13:return a=e.sent,e.abrupt("return",Object(S.a)(a,(function(e){return u._createHittestResult(d.a.fromJSON(e))})));case 15:return e.next=17,this._proxy.getAggregate(i);case 17:if(s=e.sent,!Object(S.h)(s)){e.next=20;break}return e.abrupt("return",null);case 20:if(!Object(S.i)(s.referenceId)){e.next=25;break}return e.next=23,this._proxy.getFeature(s.referenceId);case 23:return o=e.sent,e.abrupt("return",Object(S.a)(o,(function(e){return u._createHittestResult(d.a.fromJSON(e))})));case 25:return e.abrupt("return",this._createHittestResult(x.fromJSON(s)));case 26:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),H}(Re(Object(Ie.a)(Object(U.a)(Se.a))));Object(h.a)([Object(y.b)()],Le.prototype,"_serviceOptions",void 0),Object(h.a)([Object(y.b)()],Le.prototype,"_proxy",void 0),Object(h.a)([Object(y.b)()],Le.prototype,"_pipelineIsUpdating",void 0),Object(h.a)([Object(y.b)()],Le.prototype,"_effectiveRenderer",void 0),Object(h.a)([Object(y.b)()],Le.prototype,"_aggregateValueRanges",void 0),Object(h.a)([Object(y.b)()],Le.prototype,"_commandsQueue",void 0),Object(h.a)([Object(y.b)()],Le.prototype,"labelsVisible",null),Object(h.a)([Object(y.b)({type:ve.a})],Le.prototype,"filter",void 0),Object(h.a)([Object(y.b)({type:je})],Le.prototype,"effect",null),Object(h.a)([Object(y.b)({readOnly:!0})],Le.prototype,"effects",null),Object(h.a)([Object(y.b)({readOnly:!0})],Le.prototype,"queryMode",null),Object(h.a)([Object(y.b)()],Le.prototype,"renderingConfigHash",null),Object(h.a)([Object(y.b)()],Le.prototype,"tileRenderer",void 0),Object(h.a)([Object(y.b)()],Le.prototype,"updating",void 0);var Je=Le=Object(h.a)([Object(O.a)("esri.views.2d.layers.FeatureLayerView2D")],Le);t.default=Je},dnRo:function(e,t,r){"use strict";var n=r("eijD"),i=r("hisu"),a=r("yBJb"),s=r("CHlC"),o=r("kMo5"),u=r("P+uj"),c=r("NthX"),l=r.n(c),f=r("dQW7"),p=r("hZBP"),h=r("IH5m"),d=r("xAIp"),y=(r("J4Pc"),r("wckI"),r("TM+E"),r("iaHD")),b=r("nd5+"),v=r("+MdM"),O=r("12QT"),m=r("eDEE"),j=r("aNYv"),g=Math.PI/180;function x(e,t){var r=t.rotation*g,n=Math.abs(Math.cos(r)),i=Math.abs(Math.sin(r)),a=Object(j.a)(t.size,2),s=a[0],o=a[1];return e[0]=Math.round(o*i+s*n),e[1]=Math.round(o*n+s*i),e}function _(e,t,r,n){var i=Object(j.a)(t,2),a=i[0],s=i[1],o=Object(j.a)(n,2),u=o[0],c=o[1],l=.5*r;return e[0]=a-l*u,e[1]=s-l*c,e[2]=a+l*u,e[3]=s+l*c,e}var k=r("Jrv3"),w=r("xTsm"),R=r("60x+");function S(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(u.a)(e);if(t){var i=Object(u.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(o.a)(this,r)}}var E=Object(v.g)(),P=[0,0],T=new R.a(0,0,0,0),C=2048,q=2048,U=!1,A=!1,M=!1,N=function(e){Object(s.a)(u,e);var t,r,o=F(u);function u(e){var t;return Object(i.a)(this,u),(t=o.call(this,e))._imagePromise=null,t.bitmaps=[],t.hidpi=M,t.imageMaxWidth=C,t.imageMaxHeight=q,t.imageRotationSupported=U,t.imageNormalizationSupported=A,t.update=Object(h.i)(function(){var e=Object(n.a)(l.a.mark((function e(r,i){var a,s,o,u,c,f,p,h,d,y,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.stationary&&!t.destroyed){e.next=2;break}return e.abrupt("return",null);case 2:return a=r.state,s=Object(O.d)(a.spatialReference),o=t.hidpi?r.pixelRatio:1,(u=t.imageNormalizationSupported&&a.worldScreenWidth&&a.worldScreenWidth<a.size[0])?(P[0]=a.worldScreenWidth,P[1]=a.size[1]):t.imageRotationSupported?(P[0]=a.size[0],P[1]=a.size[1]):x(P,a),c=Math.floor(P[0]*o)>t.imageMaxWidth||Math.floor(P[1]*o)>t.imageMaxHeight,f=s&&(a.extent.xmin<s.valid[0]||a.extent.xmax>s.valid[1]),p=!t.imageNormalizationSupported&&f,h=!c&&!p,d=t.imageRotationSupported?a.rotation:0,h?(y=u?a.paddedViewState.center:a.center,t._imagePromise=t._singleExport(a,P,y,a.resolution,d,o,i)):(b=Math.min(t.imageMaxWidth,t.imageMaxHeight),p&&(b=Math.min(a.worldScreenWidth,b)),t._imagePromise=t._tiledExport(a,b,d,o,i)),e.abrupt("return",t._imagePromise.then(function(){var e=Object(n.a)(l.a.mark((function e(r){var n,i,a,s,o,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t._imagePromise=null,!t.destroyed){t.bitmaps=null!=r?r:[],n=S(t.container.children);try{for(a=function(){var e=i.value;r.includes(e)||e.fadeOut().then((function(){e.remove()}))},n.s();!(i=n.n()).done;)a()}catch(c){n.e(c)}finally{n.f()}s=S(r);try{for(s.s();!(o=s.n()).done;)u=o.value,t.container.addChild(u),u.fadeIn()}catch(c){s.e(c)}finally{s.f()}}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){throw t._imagePromise=null,e})));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),5e3),t}return Object(a.a)(u,[{key:"destroy",value:function(){this.bitmaps=[]}},{key:"updating",get:function(){return!this.destroyed&&null!==this._imagePromise}},{key:"updateExports",value:function(e){var t,r=S(this.container.children);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(!n.visible||!n.stage)return;e(n),n.invalidateTexture(),n.requestRender()}}catch(i){r.e(i)}finally{r.f()}}},{key:"_export",value:(r=Object(n.a)(l.a.mark((function e(t,r,n,i,a,s){var o,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchSource(t,Math.floor(r*a),Math.floor(n*a),{rotation:i,pixelRatio:a,signal:s});case 2:return o=e.sent,u=new k.a(o,"additive"),e.abrupt("return",(u.x=t.xmin,u.y=t.ymax,u.resolution=t.width/r,u.rotation=i,u.pixelRatio=a,u));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i,a,s){return r.apply(this,arguments)})},{key:"_singleExport",value:(t=Object(n.a)(l.a.mark((function e(t,r,n,i,a,s,o){var u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(E,n,i,r),u=new b.a(E[0],E[1],E[2],E[3],t.spatialReference),e.next=4,this._export(u,r[0],r[1],a,s,o);case 4:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 6:case"end":return e.stop()}}),e,this)}))),function(e,r,n,i,a,s,o){return t.apply(this,arguments)})},{key:"_tiledExport",value:function(e,t,r,n,i){var a=this,s=m.a.create({size:t,spatialReference:e.spatialReference,scales:[e.scale]}),o=new w.a(s),u=o.getTileCoverage(e);if(!u)return null;var c=[];return u.forEach((function(s,u,l,f){T.set(s,u,l,f),o.getTileBounds(E,T);var p=new b.a(E[0],E[1],E[2],E[3],e.spatialReference);c.push(a._export(p,t,t,r,n,i))})),Promise.all(c)}}]),u}(p.a);Object(f.a)([Object(d.b)()],N.prototype,"_imagePromise",void 0),Object(f.a)([Object(d.b)()],N.prototype,"bitmaps",void 0),Object(f.a)([Object(d.b)()],N.prototype,"container",void 0),Object(f.a)([Object(d.b)()],N.prototype,"fetchSource",void 0),Object(f.a)([Object(d.b)()],N.prototype,"hidpi",void 0),Object(f.a)([Object(d.b)()],N.prototype,"imageMaxWidth",void 0),Object(f.a)([Object(d.b)()],N.prototype,"imageMaxHeight",void 0),Object(f.a)([Object(d.b)()],N.prototype,"imageRotationSupported",void 0),Object(f.a)([Object(d.b)()],N.prototype,"imageNormalizationSupported",void 0),Object(f.a)([Object(d.b)()],N.prototype,"requestUpdate",void 0),Object(f.a)([Object(d.b)()],N.prototype,"updating",null);var V=N=Object(f.a)([Object(y.a)("esri.views.2d.layers.support.ExportStrategy")],N);t.a=V},x9kL:function(e,t,r){"use strict";var n,i=r("mK0O"),a=r("hisu"),s=r("yBJb"),o=r("CHlC"),u=r("kMo5"),c=r("P+uj"),l=r("dQW7"),f=r("ZTBZ"),p=r("NY4G"),h=r("7i+s"),d=r("0n+b"),y=r("0fJP"),b=r("xAIp"),v=(r("wckI"),r("J4Pc"),r("TM+E"),r("iaHD")),O=r("jr4m"),m=r("aic5"),j=r("hdDo");function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var i=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var k=new h.a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),w=new h.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),R=n=function(e){Object(o.a)(r,e);var t=_(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).where=null,n.geometry=null,n.spatialRelationship="intersects",n.hiddenIds=new Set,n.distance=void 0,n.objectIds=null,n.units=null,n.timeExtent=null,n.enabled=!1,n}return Object(s.a)(r,[{key:"writeWhere",value:function(e,t){t.where=e||"1=1"}},{key:"enable",value:function(){this._set("enabled",!0)}},{key:"createQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.where,r=this.geometry,n=this.spatialRelationship,i=this.timeExtent,a=this.objectIds,s=this.units,o=this.distance;return new j.a(x({geometry:Object(y.a)(r),objectIds:Object(y.a)(a),spatialRelationship:n,timeExtent:Object(y.a)(i),where:t,units:s,distance:o},e))}},{key:"clone",value:function(){var e=this.where,t=this.geometry,r=this.spatialRelationship,i=this.hiddenIds,a=this.timeExtent,s=this.objectIds,o=this.units,u=this.distance,c=new Set;return i.forEach((function(e){return c.add(e)})),new n({geometry:Object(y.a)(t),hiddenIds:c,objectIds:Object(y.a)(s),spatialRelationship:r,timeExtent:Object(y.a)(a),where:e,units:o,distance:u})}}]),r}(d.a);Object(l.a)([Object(b.b)({type:String})],R.prototype,"where",void 0),Object(l.a)([Object(O.a)("where")],R.prototype,"writeWhere",null),Object(l.a)([Object(b.b)({types:f.a,json:{read:m.a,write:!0}})],R.prototype,"geometry",void 0),Object(l.a)([Object(b.b)({type:String,json:{read:{source:"spatialRel",reader:k.read},write:{target:"spatialRel",writer:k.write}}})],R.prototype,"spatialRelationship",void 0),Object(l.a)([Object(b.b)({json:{write:function(e,t,r){return t[r]=Array.from(e)},read:function(e){return new Set(e)}}})],R.prototype,"hiddenIds",void 0),Object(l.a)([Object(b.b)({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],R.prototype,"distance",void 0),Object(l.a)([Object(b.b)({type:[Number],json:{write:!0}})],R.prototype,"objectIds",void 0),Object(l.a)([Object(b.b)({type:String,json:{read:w.read,write:{writer:w.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],R.prototype,"units",void 0),Object(l.a)([Object(b.b)({type:p.a,json:{write:!0}})],R.prototype,"timeExtent",void 0),Object(l.a)([Object(b.b)({readOnly:!0})],R.prototype,"enabled",void 0);var S=R=n=Object(l.a)([Object(v.a)("esri.views.layers.support.FeatureFilter")],R);t.a=S}}]);
//# sourceMappingURL=fb5f3c4b2cf12ed3f86bc58f57c51e33d6a7f152-6ad2bcc9a953dfa73177.js.map
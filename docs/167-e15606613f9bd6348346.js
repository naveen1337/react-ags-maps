(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{AsIF:function(e,t,r){"use strict";r.r(t);var a=r("mK0O"),i=r("eijD"),n=r("hisu"),o=r("yBJb"),c=r("CHlC"),s=r("kMo5"),u=r("P+uj"),p=r("NthX"),h=r.n(p),l=r("dQW7"),f=r("Mp7X"),y=r("TM+E"),m=r("IH5m"),b=r("xAIp"),d=(r("J4Pc"),r("wckI"),r("iaHD")),v=r("nd5+"),O=r("FXVW"),g=r("55C+"),j=r("dnRo"),w=r("bPf0"),x=r("TRFF"),P=r("NRoO"),k=r("XEiz");function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=Object(u.a)(e);if(t){var i=Object(u.a)(this).constructor;r=Reflect.construct(a,arguments,i)}else r=a.apply(this,arguments);return Object(s.a)(this,r)}}var I=function(e){var t=function(e){Object(c.a)(r,e);var t=R(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(o.a)(r,[{key:"initialize",value:function(){this.exportImageParameters=new k.a({layer:this.layer})}},{key:"destroy",value:function(){this.exportImageParameters.destroy(),this.exportImageParameters=null}},{key:"exportImageVersion",get:function(){var e;return null==(e=this.exportImageParameters)||e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}},{key:"fetchPopupFeatures",value:function(e){var t=this.layer;if(!e)return Promise.reject(new f.a("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t}));var r=t.popupEnabled;if(!r)return Promise.reject(new f.a("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:r}));var a=this.createFetchPopupFeaturesQuery(e);if(!a)return Promise.resolve([]);var i=a.extent,n=a.width,o=a.height,c=a.x,s=a.y;if(!(i&&n&&o))throw new f.a("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:i,width:n,height:o});var u=t.fetchFeatureInfo(i,n,o,c,s);return Promise.resolve(u?[u]:[])}}]),r}(e);return Object(l.a)([Object(b.b)()],t.prototype,"exportImageParameters",void 0),Object(l.a)([Object(b.b)({readOnly:!0})],t.prototype,"exportImageVersion",null),Object(l.a)([Object(b.b)()],t.prototype,"layer",void 0),Object(l.a)([Object(b.b)(P.a)],t.prototype,"timeExtent",void 0),t=Object(l.a)([Object(d.a)("esri.layers.mixins.WMSLayerView")],t)};function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=Object(u.a)(e);if(t){var i=Object(u.a)(this).constructor;r=Reflect.construct(a,arguments,i)}else r=a.apply(this,arguments);return Object(s.a)(this,r)}}var F=y.a.getLogger("esri.views.2d.layers.WMSLayerView2D"),E=function(e){Object(c.a)(s,e);var t,r=C(s);function s(){return Object(n.a)(this,s),r.apply(this,arguments)}return Object(o.a)(s,[{key:"initialize",value:function(){var e=this.layer,t=this.view;e.supportsSpatialReference(t.spatialReference)||this.addResolvingPromise(Promise.reject(new f.a("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view",{layer:e})))}},{key:"hitTest",value:function(){return null}},{key:"update",value:function(e){this.strategy.update(e).catch((function(e){Object(m.m)(e)||F.error(e)}))}},{key:"attach",value:function(){var e=this,t=this.layer,r=t.imageMaxHeight,a=t.imageMaxWidth;this._bitmapContainer=new O.a,this.container.addChild(this._bitmapContainer),this.strategy=new j.a({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:r,imageMaxWidth:a,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch("exportImageVersion",(function(){return e.requestUpdate()})),"exportImageVersion")}},{key:"detach",value:function(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"createFetchPopupFeaturesQuery",value:function(e){var t=this.view,r=this._bitmapContainer,a=e.x,i=e.y,n=t.spatialReference,o=null,c=0,s=0;if(r.children.some((function(e){var t=e.width,r=e.height,u=e.resolution,p=e.x,h=e.y,l=p+u*t,f=h-u*r;return a>=p&&a<=l&&i<=h&&i>=f&&(o=new v.a({xmin:p,ymin:f,xmax:l,ymax:h,spatialReference:n}),c=t,s=r,!0)})),!o)return null;var u=o.width/c,p=Math.round((a-o.xmin)/u),h=Math.round((o.ymax-i)/u);return{extent:o,width:c,height:s,x:p,y:h}}},{key:"doRefresh",value:(t=Object(i.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"fetchImage",value:function(e,t,r,i){return this.layer.fetchImage(e,t,r,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({timeExtent:this.timeExtent,timestamp:this.refreshTimestamp},i))}}]),s}(I(Object(x.a)(Object(g.a)(w.a))));Object(l.a)([Object(b.b)()],E.prototype,"strategy",void 0),Object(l.a)([Object(b.b)()],E.prototype,"updating",void 0);var S=E=Object(l.a)([Object(d.a)("esri.views.2d.layers.WMSLayerView2D")],E);t.default=S}}]);
//# sourceMappingURL=167-e15606613f9bd6348346.js.map
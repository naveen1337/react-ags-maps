(window.webpackJsonp=window.webpackJsonp||[]).push([[51,19,113],{"0yMr":function(e,t,n){"use strict";var r=n("hisu"),a=n("yBJb"),u=n("CHlC"),i=n("kMo5"),s=n("P+uj"),o=n("cWe4"),l=n("nBXx"),c=n("omx3"),f=n("IH5m");function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(i.a)(this,n)}}var p=function(e){Object(u.a)(n,e);var t=h(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).declaredClass="esri.layers.featureset.sources.Empty",a._maxProcessing=1e3,a._wset=new l.a([],[],!1,null),a._parent=e.parentfeatureset,a._databaseType=c.a.Standardised,a}return Object(a.a)(n,[{key:"_getSet",value:function(){return Object(f.t)(this._wset)}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"_isInFeatureSet",value:function(){return c.b.NotInFeatureSet}},{key:"_getFeature",value:function(){return Object(f.s)(new Error("No Feature Found in EmptySet"))}},{key:"queryAttachments",value:function(){return Object(f.t)([])}},{key:"_getFeatures",value:function(){return Object(f.t)("success")}},{key:"_featureFromCache",value:function(){return null}},{key:"_fetchAndRefineFeatures",value:function(){return Object(f.s)(new Error("Fetch and Refine should not be called in this featureset"))}},{key:"_getFilteredSet",value:function(){return Object(f.t)(new l.a([],[],!1,null))}},{key:"_stat",value:function(e,t,n,r,a,u,i){return this._manualStat(e,t,u,i)}},{key:"_canDoAggregates",value:function(){return Object(f.t)(!1)}}]),n}(o.a);t.a=p},"8Tf3":function(e,t,n){"use strict";n.r(t),n.d(t,"registerFunctions",(function(){return h}));var r=n("9r7x"),a=n("u6Q5"),u=n("Nt9s"),i=n("0yMr"),s=n("IH5m"),o=n("DjXQ"),l=n("Hj62");function c(e){return e instanceof o.a}function f(e,t,n,f,h){return h(e,t,(function(e,t,h){if(h.length<2)return f(new Error("Missing Parameters"));if(null===(h=Object(a.g)(h))[0]&&null===h[1])return Object(s.t)(!1);if(Object(a.K)(h[0]))return h[1]instanceof o.a?Object(s.t)(new u.a({parentfeatureset:h[0],relation:n,relationGeom:h[1]})):null===h[1]?Object(s.t)(new i.a({parentfeatureset:h[0]})):f("Spatial Relation cannot accept this parameter type");if(c(h[0])){if(c(h[1])){var p=null;switch(n){case"esriSpatialRelEnvelopeIntersects":p=Object(l.q)(Object(r.d)(h[0]),Object(r.d)(h[1]));break;case"esriSpatialRelIntersects":p=Object(l.q)(h[0],h[1]);break;case"esriSpatialRelContains":p=Object(l.c)(h[0],h[1]);break;case"esriSpatialRelOverlaps":p=Object(l.t)(h[0],h[1]);break;case"esriSpatialRelWithin":p=Object(l.C)(h[0],h[1]);break;case"esriSpatialRelTouches":p=Object(l.A)(h[0],h[1]);break;case"esriSpatialRelCrosses":p=Object(l.d)(h[0],h[1])}return null!==p?p:Object(s.s)(new Error("Unrecognised Relationship"))}return Object(a.K)(h[1])?Object(s.t)(new u.a({parentfeatureset:h[1],relation:n,relationGeom:h[0]})):null===h[1]?Object(s.t)(!1):f("Spatial Relation cannot accept this parameter type")}return null!==h[0]?f("Spatial Relation cannot accept this parameter type"):Object(a.K)(h[1])?Object(s.t)(new i.a({parentfeatureset:h[1]})):h[1]instanceof o.a||null===h[1]?Object(s.t)(!1):void 0}))}function h(e){"async"===e.mode&&(e.functions.intersects=function(t,n){return f(t,n,"esriSpatialRelIntersects",e.failDefferred,e.standardFunctionAsync)},e.functions.envelopeintersects=function(t,n){return f(t,n,"esriSpatialRelEnvelopeIntersects",e.failDefferred,e.standardFunctionAsync)},e.signatures.push({name:"envelopeintersects",min:"2",max:"2"}),e.functions.contains=function(t,n){return f(t,n,"esriSpatialRelContains",e.failDefferred,e.standardFunctionAsync)},e.functions.overlaps=function(t,n){return f(t,n,"esriSpatialRelOverlaps",e.failDefferred,e.standardFunctionAsync)},e.functions.within=function(t,n){return f(t,n,"esriSpatialRelWithin",e.failDefferred,e.standardFunctionAsync)},e.functions.touches=function(t,n){return f(t,n,"esriSpatialRelTouches",e.failDefferred,e.standardFunctionAsync)},e.functions.crosses=function(t,n){return f(t,n,"esriSpatialRelCrosses",e.failDefferred,e.standardFunctionAsync)},e.functions.relate=function(t,n){return e.standardFunctionAsync(t,n,(function(e,t,n){if(n=Object(a.g)(n),Object(a.J)(n,3,3),c(n[0])&&c(n[1]))return Object(l.w)(n[0],n[1],Object(a.x)(n[2]));if(n[0]instanceof o.a&&null===n[1])return!1;if(n[1]instanceof o.a&&null===n[0])return!1;if(Object(a.K)(n[0])&&null===n[1])return new i.a({parentfeatureset:n[0]});if(Object(a.K)(n[1])&&null===n[0])return new i.a({parentfeatureset:n[1]});if(Object(a.K)(n[0])&&n[1]instanceof o.a)return n[0].relate(n[1],Object(a.x)(n[2]));if(Object(a.K)(n[1])&&n[0]instanceof o.a)return n[1].relate(n[0],Object(a.x)(n[2]));if(null===n[0]&&null===n[1])return!1;throw new Error("Illegal Argument")}))})}},Hj62:function(e,t,n){"use strict";n.d(t,"a",(function(){return H})),n.d(t,"b",(function(){return y})),n.d(t,"c",(function(){return w})),n.d(t,"d",(function(){return S})),n.d(t,"e",(function(){return _})),n.d(t,"f",(function(){return X})),n.d(t,"g",(function(){return D})),n.d(t,"h",(function(){return E})),n.d(t,"i",(function(){return I})),n.d(t,"j",(function(){return O})),n.d(t,"k",(function(){return z})),n.d(t,"l",(function(){return ue})),n.d(t,"m",(function(){return W})),n.d(t,"n",(function(){return te})),n.d(t,"o",(function(){return ie})),n.d(t,"p",(function(){return L})),n.d(t,"q",(function(){return T})),n.d(t,"r",(function(){return F})),n.d(t,"s",(function(){return Y})),n.d(t,"t",(function(){return A})),n.d(t,"u",(function(){return re})),n.d(t,"v",(function(){return ae})),n.d(t,"w",(function(){return N})),n.d(t,"x",(function(){return Q})),n.d(t,"y",(function(){return j})),n.d(t,"z",(function(){return R})),n.d(t,"A",(function(){return k})),n.d(t,"B",(function(){return G})),n.d(t,"C",(function(){return x}));n("mK0O");var r,a=n("eijD"),u=n("NthX"),i=n.n(u),s=(n("ZTBZ"),n("Akvs")),o=(n("OTJA"),n("aic5"));function l(e){var t;return Array.isArray(e)?null==(t=e[0])?void 0:t.spatialReference:null==e?void 0:e.spatialReference}function c(e){return e?Array.isArray(e)?e.map(c):e.toJSON?e.toJSON():e:e}function f(e){return Array.isArray(e)?e.map((function(e){return Object(o.a)(e)})):Object(o.a)(e)}function h(e,t){var n;return Array.isArray(e)?n=e:((n=[]).push(e),null!=t&&n.push(t)),n}function p(){return d.apply(this,arguments)}function d(){return(d=Object(a.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(r||(r=Object(s.b)("geometryEngineWorker",{strategy:"distributed"})),r));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t){return g.apply(this,arguments)}function g(){return(g=Object(a.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p();case 2:return e.abrupt("return",e.sent.invoke("executeGEOperation",{operation:t,parameters:c(n)}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t){return m.apply(this,arguments)}function m(){return(m=Object(a.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,v("clip",[l(t),t,n]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t){return b.apply(this,arguments)}function b(){return(b=Object(a.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,v("cut",[l(t),t,n]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t){return v("contains",[l(e),e,t])}function S(e,t){return v("crosses",[l(e),e,t])}function I(e,t,n){return v("distance",[l(e),e,t,n])}function O(e,t){return v("equals",[l(e),e,t])}function T(e,t){return v("intersects",[l(e),e,t])}function k(e,t){return v("touches",[l(e),e,t])}function x(e,t){return v("within",[l(e),e,t])}function E(e,t){return v("disjoint",[l(e),e,t])}function A(e,t){return v("overlaps",[l(e),e,t])}function N(e,t,n){return v("relate",[l(e),e,t,n])}function F(e){return v("isSimple",[l(e),e])}function j(e){return C.apply(this,arguments)}function C(){return(C=Object(a.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,v("simplify",[l(t),t]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t){return P.apply(this,arguments)}function P(){return(P=Object(a.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,v("difference",[l(t),t,n]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t){return M.apply(this,arguments)}function M(){return(M=Object(a.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,v("symmetricDifference",[l(t),t,n]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){return U.apply(this,arguments)}function U(){return(U=Object(a.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,v("intersect",[l(t),t,n]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){return B.apply(this,arguments)}function B(){return(B=Object(a.a)(i.a.mark((function e(t){var n,r,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:null,r=h(t,n),e.t0=f,e.next=5,v("union",[l(r),r]);case 5:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t,n,r,a,u){return J.apply(this,arguments)}function J(){return(J=Object(a.a)(i.a.mark((function e(t,n,r,a,u,s){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,v("offset",[l(t),t,n,r,a,u,s]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t,n){return q.apply(this,arguments)}function q(){return(q=Object(a.a)(i.a.mark((function e(t,n,r){var a,u,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>3&&void 0!==s[3]&&s[3],u=[l(t),t,n,r,a],e.t0=f,e.next=5,v("buffer",u);case 5:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t,n,r,a,u){return K.apply(this,arguments)}function K(){return(K=Object(a.a)(i.a.mark((function e(t,n,r,a,u,s){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[l(t),t,n,r,a,u,s],e.t0=f,e.next=4,v("geodesicBuffer",o);case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){return"xmin"in e?e.center:"x"in e?e:e.extent.center}function Q(e,t,n){return $.apply(this,arguments)}function $(){return($=Object(a.a)(i.a.mark((function e(t,n,r){var a,u,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new Error("Illegal Argument Exception");case 2:return u=t.spatialReference,r=null!=(a=r)?a:V(t),e.t0=t.constructor,e.next=7,v("rotate",[u,t,n,r]);case 7:return e.t1=e.sent,s=e.t0.fromJSON.call(e.t0,e.t1),e.abrupt("return",(s.spatialReference=u,s));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t,n,r){return Z.apply(this,arguments)}function Z(){return(Z=Object(a.a)(i.a.mark((function e(t,n,r,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,v("generalize",[l(t),t,n,r,a]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t,n){return ee.apply(this,arguments)}function ee(){return(ee=Object(a.a)(i.a.mark((function e(t,n,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,v("densify",[l(t),t,n,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e,t,n){return ne.apply(this,arguments)}function ne(){return(ne=Object(a.a)(i.a.mark((function e(t,n,r){var a,u=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:0,e.t0=f,e.next=4,v("geodesicDensify",[l(t),t,n,r,a]);case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e,t){return v("planarArea",[l(e),e,t])}function ae(e,t){return v("planarLength",[l(e),e,t])}function ue(e,t,n){return v("geodesicArea",[l(e),e,t,n])}function ie(e,t,n){return v("geodesicLength",[l(e),e,t,n])}},JUpu:function(e,t,n){"use strict";var r=n("hisu"),a=n("yBJb"),u=function(){function e(){Object(r.a)(this,e),this._databaseTypeMetaData={},this._layerInfo={}}return Object(a.a)(e,[{key:"clearDatabaseType",value:function(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]}},{key:"getDatabaseType",value:function(e){return"MUSTBESET"===e||void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]}},{key:"setDatabaseType",value:function(e,t){this._databaseTypeMetaData[e]=t}},{key:"getLayerInfo",value:function(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]}},{key:"setLayerInfo",value:function(e,t){this._layerInfo[e]=t}},{key:"clearLayerInfo",value:function(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]}}]),e}();u.applicationCache=null,t.a=u},"K+fz":function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return I})),n.d(t,"e",(function(){return v})),n.d(t,"f",(function(){return g})),n.d(t,"g",(function(){return d})),n.d(t,"h",(function(){return m})),n.d(t,"i",(function(){return _})),n.d(t,"j",(function(){return y}));var r=n("u6Q5"),a=n("omx3"),u=n("x/s0"),i=n("IH5m");function s(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t/e.length}function o(e){for(var t=s(e),n=0,r=0;r<e.length;r++)n+=Math.pow(t-e[r],2);return n/e.length}function l(e){for(var t=s(e),n=0,r=0;r<e.length;r++)n+=Math.pow(t-e[r],2);return n/(e.length-1)}function c(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function f(e,t){for(var n=[],r={},u=[],i=0;i<e.length;i++){if(void 0!==e[i]&&null!==e[i]){var s=e[i];if(Object(a.j)(s)||Object(a.k)(s))void 0===r[s]&&(n.push(s),r[s]=1);else{for(var o=!1,l=0;l<u.length;l++)!0===Object(a.g)(u[l],s)&&(o=!0);!1===o&&(u.push(s),n.push(s))}}if(n.length>=t&&-1!==t)return n}return n}function h(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;switch(e.toLowerCase()){case"distinct":return f(t,n);case"avg":case"mean":return s(t);case"min":return Math.min.apply(Math,t);case"sum":return c(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(o(t));case"var":case"variance":return o(t);case"count":return t.length}return 0}function d(e,t,n){return w(e,t,n,!0).then((function(e){return 0===e.length?null:Math.min.apply(Math,e)}))}function v(e,t,n){return w(e,t,n,!0).then((function(e){return 0===e.length?null:Math.max.apply(Math,e)}))}function g(e,t,n){var r="";return!1===Object(u.c)(t)&&(r=Object(u.f)(t,e.fields,null)),w(e,t,n,!0).then((function(e){if(0===e.length)return null;var t=s(e);return null===t?t:"integer"===r?function(e){return e=+e,isFinite(e)?e-e%1||(e<0?-0:0===e?e:0):e}(t):t}))}function y(e,t,n){return w(e,t,n,!0).then((function(e){return 0===e.length?null:l(e)}))}function m(e,t,n){return w(e,t,n,!0).then((function(e){return 0===e.length?null:Math.sqrt(l(e))}))}function _(e,t,n){return w(e,t,n,!0).then((function(e){return 0===e.length?null:c(e)}))}function b(e,t){try{return e.iterator(t).count()}catch(n){return Object(i.s)(n)}}function w(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{var a=e.iterator(n);return Object(i.c)((function(e,n){S(a,[],t,r,e,n)}))}catch(u){return Object(i.s)(u)}}function S(e,t,n,a,u,i){Object(r.q)(e.next().then((function(r){try{if(null!==r){var s=n.calculateValue(r);return null===s?!1===a&&(t[t.length]=s):t[t.length]=s,S(e,t,n,a,u,i)}u(t)}catch(o){i(o)}}),i))}function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return O(e,t,n,r)}function O(e,t,n,r){try{return function e(t,n,r,a,u){return t.next().then((function(i){if(null!==i){var s=a.calculateValue(i);return null!=s&&void 0===n[s]&&(r.push(s),n[s]=1),r.length>=u&&-1!==u?r:e(t,n,r,a,u)}return r}))}(e.iterator(r),{},[],t,n)}catch(a){return Object(i.s)(a)}}},Nt9s:function(e,t,n){"use strict";var r=n("hisu"),a=n("yBJb"),u=n("CHlC"),i=n("kMo5"),s=n("P+uj"),o=n("0yMr"),l=n("cWe4"),c=n("nBXx"),f=n("omx3"),h=n("IH5m"),p=n("Hj62");function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(i.a)(this,n)}}var v=function(e){Object(u.a)(n,e);var t=d(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e))._relation="",a._relationGeom=null,a._relationString="",a.declaredClass="esri.arcade.featureset.actions.SpatialFilter",a._relationString=e.relationString,a._parent=e.parentfeatureset,a._maxProcessing=40,a._relation=e.relation,a._relationGeom=e.relationGeom,a}return Object(a.a)(n,[{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getFilteredSet("esriSpatialRelRelation"!==t._relation?t._relation:t._relation+":"+t._relationString,t._relationGeom,null,null,e)})).then((function(n){return t._checkCancelled(e),t._wset=new c.a(n._candidates.slice(0),n._known.slice(0),n._ordered,t._clonePageDefinition(n.pagesDefinition)),t._wset})):Object(h.t)(this._wset)}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);return t===f.b.NotInFeatureSet?t:void 0===(t=this._idstates[e])?f.b.Unknown:t}},{key:"_getFeature",value:function(e,t,n){return this._parent._getFeature(e,t,n)}},{key:"_getFeatures",value:function(e,t,n,r){return this._parent._getFeatures(e,t,n,r)}},{key:"_featureFromCache",value:function(e){return this._parent._featureFromCache(e)}},{key:"executeSpatialRelationTest",value:function(e){if(null===e.geometry)return Object(h.t)(!1);switch(this._relation){case"esriSpatialRelEnvelopeIntersects":var t=Object(f.p)(this._relationGeom),n=Object(f.p)(e.geometry);return Object(p.q)(t,n);case"esriSpatialRelIntersects":return Object(p.q)(this._relationGeom,e.geometry);case"esriSpatialRelContains":return Object(p.c)(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return Object(p.t)(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return Object(p.C)(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return Object(p.A)(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return Object(p.d)(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return Object(p.w)(this._relationGeom,e.geometry,this._relationString)}}},{key:"_fetchAndRefineFeatures",value:function(e,t,n){var r=this,a=new c.a([],e,!1,null),u=Math.min(t,e.length);return this._parent._getFeatures(a,-1,u,n).then((function(){r._checkCancelled(n);for(var t=[],a=0;a<u;a++){var i=r._parent._featureFromCache(e[a]);t.push(r.executeSpatialRelationTest(i))}return Object(h.b)(t)})).then((function(n){for(var a=0;a<t;a++)!0===n[a]?r._idstates[e[a]]=f.b.InFeatureSet:r._idstates[e[a]]=f.b.NotInFeatureSet;return"success"}))}},{key:"_getFilteredSet",value:function(e,t,n,r,a){var u=this;return this._ensureLoaded().then((function(){return u._parent._getFilteredSet("esriSpatialRelRelation"!==u._relation?u._relation:u._relation+":"+u._relationString,u._relationGeom,n,r,a)})).then((function(e){return u._checkCancelled(a),null!==t?new c.a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,u._clonePageDefinition(e.pagesDefinition)):new c.a(e._candidates.slice(0),e._known.slice(0),e._ordered,u._clonePageDefinition(e.pagesDefinition))}))}},{key:"_stat",value:function(e,t,n,r,a,u,i){var s=this;return""!==n?Object(h.t)({calculated:!1}):this._parent._stat(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,u,i).then((function(o){return!1===o.calculated?null===a&&""===n&&null===r?s._manualStat(e,t,u,i):{calculated:!1}:o}))}},{key:"_canDoAggregates",value:function(e,t,n,r,a){return""!==n||null!==r||null===this._parent?Object(h.t)(!1):this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a)}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,n,r,a,u,i){return null===this._parent?Object(h.s)(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,u,i)}}],[{key:"registerAction",value:function(){l.a._featuresetFunctions.intersects=function(e){return null==e?new o.a({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},l.a._featuresetFunctions.envelopeIntersects=function(e){return null==e?new o.a({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},l.a._featuresetFunctions.contains=function(e){return null==e?new o.a({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},l.a._featuresetFunctions.overlaps=function(e){return null==e?new o.a({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},l.a._featuresetFunctions.within=function(e){return null==e?new o.a({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},l.a._featuresetFunctions.touches=function(e){return null==e?new o.a({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},l.a._featuresetFunctions.crosses=function(e){return null==e?new o.a({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},l.a._featuresetFunctions.relate=function(e,t){return null==e?new o.a({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})}}}]),n}(l.a);t.a=v},cWe4:function(e,t,n){"use strict";var r=n("hisu"),a=n("yBJb"),u=n("IH5m"),i=function(){function e(t,n){Object(r.a)(this,e),this._lastId=-1,this._progress=n,this._parent=t}return Object(a.a)(e,[{key:"reset",value:function(){this._lastId=-1}},{key:"nextBatch",value:function(e){var t=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((function(n){return t.nextBatch(e)}),(function(n){return t.nextBatch(e)}));var n={returnpromise:null,hasset:!1},r=[];return n.returnpromise=Object(u.c)((function(a,u){t._parent._getSet(t._progress).then((function(i){var s=i._known.length-1;if("GETPAGES"===i._known[i._known.length-1]&&(s-=1),t._lastId+e>s&&i._known.length>0&&"GETPAGES"===i._known[i._known.length-1])t._parent._expandPagedSet(i,t._parent._maxQueryRate(),0,0,t._progress).then((function(r){n.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e).then(a,u)}),(function(e){n.hasset=!0,t._parent._mainSetInUse=null,u(e)}));else{if(s>=t._lastId+e||0===i._candidates.length){for(var o=0;o<e;o++){var l=o+t._lastId+1;if(l>=i._known.length)break;r[o]=i._known[l]}return t._lastId+=r.length,0===r.length&&(n.hasset=!0,t._parent._mainSetInUse=null,a([])),void t._parent._getFeatureBatch(r,t._progress).then((function(e){n.hasset=!0,t._parent._mainSetInUse=null,a(e)}),(function(e){n.hasset=!0,t._parent._mainSetInUse=null,u(e)}))}t._parent._refineSetBlock(i,t._parent._maxProcessingRate(),t._progress).then((function(){n.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e).then(a,u)}),(function(e){n.hasset=!0,t._parent._mainSetInUse=null,u(e)}))}}),(function(e){n.hasset=!0,t._parent._mainSetInUse=null,u(e)}))})),!1===n.hasset&&(this._parent._mainSetInUse=n.returnpromise,n.hasset=!0),n.returnpromise}},{key:"next",value:function(){var e=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((function(t){return e.next()}),(function(t){return e.next()}));var t={returnpromise:null,hasset:!1};return t.returnpromise=Object(u.c)((function(n,r){e._parent._getSet(e._progress).then((function(a){e._lastId<a._known.length-1?"GETPAGES"===a._known[e._lastId+1]?e._parent._expandPagedSet(a,e._parent._maxQueryRate(),0,0,e._progress).then((function(n){return t.hasset=!0,e._parent._mainSetInUse=null,e.next()})).then(n,r):(e._lastId+=1,e._parent._getFeature(a,a._known[e._lastId],e._progress).then((function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)}),(function(n){t.hasset=!0,e._parent._mainSetInUse=null,r(n)}))):a._candidates.length>0?e._parent._refineSetBlock(a,e._parent._maxProcessingRate(),e._progress).then((function(){t.hasset=!0,e._parent._mainSetInUse=null,e.next().then(n,r)}),(function(n){t.hasset=!0,e._parent._mainSetInUse=null,r(n)})):(t.hasset=!0,e._parent._mainSetInUse=null,n(null))}),(function(n){t.hasset=!0,e._parent._mainSetInUse=null,r(n)}))})),!1===t.hasset&&(this._parent._mainSetInUse=t.returnpromise,t.hasset=!0),t.returnpromise}},{key:"count",value:function(){var e=this;return-1!==this._parent._totalCount?Object(u.t)(this._parent._totalCount):this._parent._getSet(this._progress).then((function(t){return e._refineAllSets(t)})).then((function(t){return e._parent._totalCount=t._known.length,Object(u.t)(e._parent._totalCount)}))}},{key:"_refineAllSets",value:function(e){var t=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,1,this._progress).then((function(n){return t._refineAllSets(e)})).then((function(e){return Object(u.t)(e)})):e._candidates.length>0?"GETPAGES"===e._known[e._candidates.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,2,this._progress).then((function(n){return t._refineAllSets(e)})).then((function(e){return Object(u.t)(e)})):this._parent._refineSetBlock(e,this._parent._maxProcessingRate(),this._progress).then((function(e){return e._candidates.length>0?t._refineAllSets(e):Object(u.t)(e)})):Object(u.t)(e)}}]),e}(),s=n("nBXx"),o=n("omx3"),l=n("JUpu"),c=n("K+fz"),f=n("xnqp"),h=n("Hj62"),p=n("YHXj"),d=n("nyn0");function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,u=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw u}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var y=function(){function e(t){Object(r.a)(this,e),this.recentlyUsedQueries=null,this.featureSetQueryInterceptor=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=o.a.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.types=null,this.fields=null,this.geometryType="",this.objectIdField="",this.globalIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,t&&t.lrucache&&(this.recentlyUsedQueries=t.lrucache),t&&t.interceptor&&(this.featureSetQueryInterceptor=t.interceptor)}return Object(a.a)(e,[{key:"optimisePagingFeatureQueries",value:function(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)}},{key:"_hasMemorySource",value:function(){return!0}},{key:"prop",value:function(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)}},{key:"end",value:function(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent}},{key:"_ensureLoaded",value:function(){return this.load()}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(u.c)((function(t,n){if(!0===e._parent.loaded)return e._initialiseFeatureSet(),void t(e);e._parent.load().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(r){n(r)}}),n)}))),this._loadPromise}},{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new p.a({wkid:4326}),this.geometryType=o.m.point)}},{key:"getField",value:function(e,t){var n;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some((function(t){return t&&t.name.toLowerCase()===e&&(n=t),!!n}))),n}},{key:"getFieldsIndex",value:function(){return null===this._fieldsIndex&&(this._fieldsIndex=new d.a(this.fields)),this._fieldsIndex}},{key:"_maxProcessingRate",value:function(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())}},{key:"_maxQueryRate",value:function(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery}},{key:"_checkCancelled",value:function(e){if(null!==e&&e.aborted)throw new Error("Operation has been cancelled.")}},{key:"nativeCapabilities",value:function(){return this._parent.nativeCapabilities()}},{key:"_canDoAggregates",value:function(e,t,n,r,a){return null===this._parent?Object(u.t)(!1):this._parent._canDoAggregates(e,t,n,r,a)}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,n,r,a,i,s){return null===this._parent?Object(u.s)(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,n,r,a,i,s)}},{key:"_getAgregagtePhysicalPage",value:function(e,t,n){return null===this._parent?Object(u.s)(new Error("Should never be called")):this._parent._getAgregagtePhysicalPage(e,t,n)}},{key:"databaseType",value:function(){var e=this;if(this._databaseType===o.a.NotEvaluated){if(null!==l.a.applicationCache){var t=l.a.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==t)return t}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;var n=[{thetype:o.a.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:o.a.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:o.a.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}],r=Object(u.c)((function(t,r){e._getDatabaseTypeImpl(n,0).then((function(n){e._databaseType=n,t(e._databaseType)}),(function(e){r(e)}))}));return null!==l.a.applicationCache&&(l.a.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),r),r=r.catch((function(t){throw l.a.applicationCache.clearDatabaseType(e._cacheableFeatureSetSourceKey()),t}))),this._databaseTypeProbed=r,this._databaseTypeProbed}return Object(u.t)(this._databaseType)}},{key:"_cacheableFeatureSetSourceKey",value:function(){return"MUSTBESET"}},{key:"_getDatabaseTypeImpl",value:function(e,t){var n=this;return t>=e.length?Object(u.t)(o.a.StandardisedNoInterval):this._runDatabaseProbe(e[t].testwhere).then((function(r){return!0===r?e[t].thetype:n._getDatabaseTypeImpl(e,t+1)}))}},{key:"_runDatabaseProbe",value:function(e){return null!==this._parent?this._parent._runDatabaseProbe(e):Object(u.s)(new Error("Not Implemented"))}},{key:"isTable",value:function(){return this._parent.isTable()}},{key:"_featureFromCache",value:function(e){if(void 0!==this._featureCache[e])return this._featureCache[e]}},{key:"_isInFeatureSet",value:function(e){return o.b.Unknown}},{key:"_getSet",value:function(e){throw new Error("Not implemented in abstract class")}},{key:"_getFeature",value:function(e,t,n){var r=this;try{return this._checkCancelled(n),void 0!==this._featureFromCache(t)?Object(u.t)(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),n).then((function(){return r._checkCancelled(n),void 0!==r._featureFromCache(t)?r._featureFromCache(t):Object(u.s)(new Error("Feature Not Found"))}))}catch(a){return Object(u.s)(a)}}},{key:"_getFeatureBatch",value:function(e,t){var n=this;try{this._checkCancelled(t);var r=new s.a([],e,!1,null),a=[];return this._getFeatures(r,-1,e.length,t).then((function(){n._checkCancelled(t);var r,u=v(e);try{for(u.s();!(r=u.n()).done;){var i=r.value;void 0!==n._featureFromCache(i)&&a.push(n._featureFromCache(i))}}catch(s){u.e(s)}finally{u.f()}return a}))}catch(i){return Object(u.s)(i)}}},{key:"_getFeatures",value:function(e,t,n,r){return Object(u.t)("success")}},{key:"_getFilteredSet",value:function(e,t,n,r,a){throw new Error("Not implemented in abstract class")}},{key:"_refineSetBlock",value:function(e,t,n){var r=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate()))return this._expandPagedSet(e,this._maxQueryRate(),0,0,n).then((function(){return r._refineSetBlock(e,t,n)}));this._checkCancelled(n);var a=e._candidates.length;this._refineKnowns(e,t);var i=a-e._candidates.length;return 0===e._candidates.length||i>=t?Object(u.t)(e):this._refineIfParentKnown(e,t-i,n).then((function(){if(r._checkCancelled(n),r._refineKnowns(e,t-i),(i=a-e._candidates.length)<t&&e._candidates.length>0){var u=t-i,s=r._prepareFetchAndRefineSet(e._candidates);return r._fetchAndRefineFeatures(s,s.length>u?u:e._candidates.length,n).then((function(){return r._checkCancelled(n),r._refineKnowns(e,t-i),e}))}return e}))}catch(s){return Object(u.s)(s)}}},{key:"_fetchAndRefineFeatures",value:function(e,t,n){return null}},{key:"_prepareFetchAndRefineSet",value:function(e){for(var t=[],n=0;n<e.length;n++)this._isPhysicalFeature(e[n])&&t.push(e[n]);return t}},{key:"_isPhysicalFeature",value:function(e){return null===this._parent||this._parent._isPhysicalFeature(e)}},{key:"_refineKnowns",value:function(e,t){var n=0,r=null,a=[];t=this._maxQueryRate();for(var u=0;u<e._candidates.length&&"GETPAGES"!==e._candidates[u];u++){var i=!1,s=this._candidateIdTransform(e._candidates[u]);s!==e._candidates[u]&&(i=!0);var l=this._isInFeatureSet(s);if(l===o.b.InFeatureSet)!0===i?e._known.indexOf(s)<0&&(e._known.push(s),n+=1):(e._known.push(e._candidates[u]),n+=1),null===r?r={start:u,end:u}:r.end===u-1?r.end=u:(a.push(r),r={start:u,end:u});else if(l===o.b.NotInFeatureSet)null===r?r={start:u,end:u}:r.end===u-1?r.end=u:(a.push(r),r={start:u,end:u}),n+=1;else if(l===o.b.Unknown&&(n+=1,!0===e._ordered))break;if(n>=t)break}null!==r&&a.push(r);for(var c=a.length-1;c>=0;c--)e._candidates.splice(a[c].start,a[c].end-a[c].start+1)}},{key:"_refineIfParentKnown",value:function(e,t,n){var r=new s.a([],[],e._ordered,null);return r._candidates=e._candidates.slice(0),this._parent._refineSetBlock(r,t,n)}},{key:"_candidateIdTransform",value:function(e){return this._parent._candidateIdTransform(e)}},{key:"_checkIfNeedToExpandKnownPage",value:function(e,t){if(null===e.pagesDefinition)return!1;for(var n=0,r=e._lastFetchedIndex;r<e._known.length;r++){if("GETPAGES"===e._known[r])return!0;if(void 0===this._featureCache[e._known[r]]&&(n+=1)>=t)break}return!1}},{key:"_checkIfNeedToExpandCandidatePage",value:function(e,t){if(null===e.pagesDefinition)return!1;for(var n=0,r=0;r<e._candidates.length;r++){if("GETPAGES"===e._candidates[r])return!0;if((n+=1)>=t)break}return!1}},{key:"_expandPagedSet",value:function(e,t,n,r,a){return null===this._parent?Object(u.s)(new Error("Parent Paging not implemented")):this._parent._expandPagedSet(e,t,n,r,a)}},{key:"_expandPagedSetFeatureSet",value:function(e,t,n,r,a){var i=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]&&(r=1),0===r&&e._candidates.length>0&&"GETPAGES"===e._candidates[e._candidates.length-1]&&(r=2),0===r?Object(u.t)("finished"):this._getPage(e,r,a).then((function(r){return n+r<t?i._expandPagedSet(e,t,n+r,0,a):"success"}))}},{key:"_getPage",value:function(e,t,n){var r=this,a=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){a.length=a.length-1;for(var i=0,s=0;s<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+s>=e.pagesDefinition.internal.set.length);s++)a[a.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+s],i++;e.pagesDefinition.resultOffset+=i;var o=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(o=!0),!1===o&&a.push("GETPAGES"),Object(u.t)(i)}return this._getPhysicalPage(e,t,n).then((function(){return r._getPage(e,t,n)}))}},{key:"_getPhysicalPage",value:function(e,t,n){return null}},{key:"_clonePageDefinition",value:function(e){return null===this._parent?null:this._parent._clonePageDefinition(e)}},{key:"_first",value:function(e){return this.iterator(e).next()}},{key:"first",value:function(e){return this._first(e)}},{key:"calculateStatistic",value:function(e,t,n,r){var a=this;return this._ensureLoaded().then((function(){return a._stat(e,t,"",null,null,n,r).then((function(u){return!1===u.calculated?a._manualStat(e,t,n,r).then((function(e){return e.result})):u.result}))}))}},{key:"_manualStat",value:function(e,t,n,r){switch(e.toLowerCase()){case"count":return Object(c.b)(this,r).then((function(e){return{calculated:!0,result:e}}));case"distinct":return Object(c.d)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"avg":case"mean":return Object(c.f)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"stdev":return Object(c.h)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"variance":return Object(c.j)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"sum":return Object(c.i)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"min":return Object(c.g)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"max":return Object(c.e)(this,t,r).then((function(e){return{calculated:!0,result:e}}));default:return Object(u.t)({calculated:!0,result:0})}}},{key:"_stat",value:function(e,t,n,r,a,u,i){var s=this;return this._parent._stat(e,t,n,r,a,u,i).then((function(o){return!1===o.calculated?null===a&&""===n&&null===r?s._manualStat(e,t,u,i):{calculated:!1}:o}))}},{key:"_unionAllGeomSelf",value:function(e){var t=this,n=this.iterator(this._defaultTracker(e)),r=[];return Object(u.c)((function(e,a){t._unionShapeInBatches(r,n,e,a)}))}},{key:"_unionAllGeom",value:function(e){var t=this;return Object(u.c)((function(n,r){var a=t.iterator(t._defaultTracker(e));t._unionShapeInBatches([],a,n,r)}))}},{key:"_unionShapeInBatches",value:function(e,t,n,r){var a=this;t.next().then((function(u){try{null!==u&&null!==u.geometry&&e.push(u.geometry),e.length>30||null===u&&e.length>1?Object(h.B)(e).then((function(i){try{null===u?n(i):(e=[i],a._unionShapeInBatches(e,t,n,r))}catch(s){r(s)}}),r):null===u?1===e.length?n(e[0]):n(null):a._unionShapeInBatches(e,t,n,r)}catch(i){r(i)}}),r)}},{key:"iterator",value:function(e){return new i(this,e)}},{key:"intersection",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e._featuresetFunctions.intersection.bind(this)(t,n)}},{key:"difference",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._featuresetFunctions.difference.bind(this)(t,n,r)}},{key:"symmetricDifference",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._featuresetFunctions.symmetricDifference.bind(this)(t,n,r)}},{key:"morphShape",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return e._featuresetFunctions.morphShape.bind(this)(t,n,r,a)}},{key:"morphShapeAndAttributes",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown";return e._featuresetFunctions.morphShapeAndAttributes.bind(this)(t,n,r)}},{key:"union",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e._featuresetFunctions.union.bind(this)(t,n)}},{key:"intersects",value:function(t){return e._featuresetFunctions.intersects.bind(this)(t)}},{key:"envelopeIntersects",value:function(t){return e._featuresetFunctions.envelopeIntersects.bind(this)(t)}},{key:"contains",value:function(t){return e._featuresetFunctions.contains.bind(this)(t)}},{key:"overlaps",value:function(t){return e._featuresetFunctions.overlaps.bind(this)(t)}},{key:"relate",value:function(t,n){return e._featuresetFunctions.relate.bind(this)(t,n)}},{key:"within",value:function(t){return e._featuresetFunctions.within.bind(this)(t)}},{key:"touches",value:function(t){return e._featuresetFunctions.touches.bind(this)(t)}},{key:"top",value:function(t){return e._featuresetFunctions.top.bind(this)(t)}},{key:"crosses",value:function(t){return e._featuresetFunctions.crosses.bind(this)(t)}},{key:"buffer",value:function(t,n,r){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e._featuresetFunctions.buffer.bind(this)(t,n,r,a)}},{key:"filter",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e._featuresetFunctions.filter.bind(this)(t,n)}},{key:"orderBy",value:function(t){return e._featuresetFunctions.orderBy.bind(this)(t)}},{key:"dissolve",value:function(t,n){return e._featuresetFunctions.dissolve.bind(this)(t,n)}},{key:"groupby",value:function(t,n){return e._featuresetFunctions.groupby.bind(this)(t,n)}},{key:"reduce",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;return Object(u.c)((function(a,u){t._reduceImpl(t.iterator(t._defaultTracker(r)),e,n,0,a,u,0)}))}},{key:"_reduceImpl",value:function(e,t,n,r,a,i,s){var o=this;try{if(++s>1e3)return void setTimeout((function(){s=0,o._reduceImpl(e,t,n,r,a,i,s)}));e.next().then((function(l){try{if(null===l)a(n);else{var c=t(n,l,r,o);Object(u.p)(c)?c.then((function(n){o._reduceImpl(e,t,n,r+1,a,i,s)}),i):o._reduceImpl(e,t,c,r+1,a,i,s)}}catch(f){i(f)}}),i)}catch(l){i(l)}}},{key:"removeField",value:function(t){return e._featuresetFunctions.removeField.bind(this)(t)}},{key:"addField",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e._featuresetFunctions.addField.bind(this)(t,n,r)}},{key:"sumArea",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=Object(o.e)(e);return this.reduce((function(e,n){return null===n.geometry?0:t?Object(h.l)(n.geometry,r).then((function(t){return e+t})):Object(h.u)(n.geometry,r).then((function(t){return e+t}))}),0,n)}},{key:"sumLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=Object(o.d)(e);return this.reduce((function(e,n){return null===n.geometry?0:t?Object(h.o)(n.geometry,r).then((function(t){return e+t})):Object(h.v)(n.geometry,r).then((function(t){return e+t}))}),0,n)}},{key:"_substituteVars",value:function(e,t){if(null!==t){var n={};for(var r in t)n[r.toLowerCase()]=t[r];e.parameters=n}}},{key:"distinct",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0;return this.load().then((function(){var u=f.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(u,r),t.calculateStatistic("distinct",u,n,t._defaultTracker(a))}))}},{key:"min",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=f.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,n),t.calculateStatistic("min",a,-1,t._defaultTracker(r))}))}},{key:"max",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=f.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,n),t.calculateStatistic("max",a,-1,t._defaultTracker(r))}))}},{key:"avg",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=f.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,n),t.calculateStatistic("avg",a,-1,t._defaultTracker(r))}))}},{key:"sum",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=f.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,n),t.calculateStatistic("sum",a,-1,t._defaultTracker(r))}))}},{key:"stdev",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=f.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,n),t.calculateStatistic("stdev",a,-1,t._defaultTracker(r))}))}},{key:"variance",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=f.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,n),t.calculateStatistic("variance",a,-1,t._defaultTracker(r))}))}},{key:"count",value:function(e){var t=this;return this.load().then((function(){return t.calculateStatistic("count",f.WhereClause.create("1",t.getFieldsIndex()),-1,t._defaultTracker(e))}))}},{key:"_defaultTracker",value:function(e){return e||{aborted:!1}}},{key:"forEach",value:function(e,t){var n=this;return Object(u.c)((function(r,a){n._forEachImpl(n.iterator(n._defaultTracker(t)),e,n,r,a,0)}))}},{key:"_forEachImpl",value:function(e,t,n,r,a,i){var s=this;try{if(++i>1e3)return void setTimeout((function(){i=0,s._forEachImpl(e,t,n,r,a,i)}),0);e.next().then((function(o){try{if(null===o)r(n);else{var l=t(o);null==l?s._forEachImpl(e,t,n,r,a,i):Object(u.p)(l)?l.then((function(){try{s._forEachImpl(e,t,n,r,a,i)}catch(o){a(o)}}),a):s._forEachImpl(e,t,n,r,a,i)}}catch(c){a(c)}}),a)}catch(o){a(o)}}},{key:"convertToJSON",value:function(e){for(var t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}},n=0;n<this.fields.length;n++)t.layerDefinition.fields.push(Object(o.h)(this.fields[n]));return this.reduce((function(e,n){var r={geometry:n.geometry&&n.geometry.toJSON(),attributes:{}};for(var a in n.attributes)r.attributes[a]=n.attributes[a];return t.featureSet.features.push(r),1}),0,e).then((function(){return t}))}},{key:"castToText",value:function(){return"object, FeatureSet"}},{key:"queryAttachments",value:function(e,t,n,r){return this._parent.queryAttachments(e,t,n,r)}},{key:"serviceUrl",value:function(){return this._parent.serviceUrl()}},{key:"subtypes",value:function(){return this.typeIdField?{subtypeField:this.typeIdField,subtypes:this.types?this.types.map((function(e){return{name:e.name,code:e.id}})):[]}:null}},{key:"relationshipMetaData",value:function(){return this._parent.relationshipMetaData()}},{key:"gdbVersion",get:function(){return this._parent?this._parent.gdbVersion:""}},{key:"schema",value:function(){var e,t=[],n=v(this.fields);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(Object(o.h)(r))}}catch(a){n.e(a)}finally{n.f()}return{objectIdField:this.objectIdField,globalIdField:this.globalIdField,geometryType:void 0===o.n[this.geometryType]?"":o.n[this.geometryType],fields:t}}},{key:"convertToText",value:function(e,t){var n=this;return"schema"===e?this._ensureLoaded().then((function(){return JSON.stringify(n.schema())})):"featureset"===e?this._ensureLoaded().then((function(){var e=[];return n.reduce((function(t,n){var r={geometry:n.geometry?n.geometry.toJSON():null,attributes:n.attributes};return null!==r.geometry&&r.geometry.spatialReference&&delete r.geometry.spatialReference,e.push(r),1}),0,t).then((function(){var t=n.schema();return t.features=e,t.spatialReference=n.spatialReference.toJSON(),JSON.stringify(t)}))})):Object(u.t)(this.castToText())}},{key:"getFeatureByObjectId",value:function(e,t){return this._parent.getFeatureByObjectId(e,t)}},{key:"getOwningSystemUrl",value:function(){return this._parent.getOwningSystemUrl()}},{key:"getIdentityUser",value:function(){return this._parent.getIdentityUser()}}]),e}();y._featuresetFunctions={};t.a=y},nBXx:function(e,t,n){"use strict";var r=n("hisu");t.a=function e(t,n,a,u){Object(r.a)(this,e),this._candidates=null,this._known=null,this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=t,this._known=n,this._ordered=a,this.pagesDefinition=u}},"x/s0":function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return I})),n.d(t,"c",(function(){return w})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return v})),n.d(t,"f",(function(){return g})),n.d(t,"g",(function(){return c})),n.d(t,"h",(function(){return b})),n.d(t,"i",(function(){return o})),n.d(t,"j",(function(){return l})),n.d(t,"k",(function(){return p}));var r=n("u6Q5"),a=n("omx3"),u=n("xnqp");function i(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,u=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw u}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){return h(e.parseTree,t,e.parameters)}function l(e,t,n){return h(e,t,n)}function c(e,t,n,r){return u.WhereClause.create(h(e.parseTree,a.a.Standardised,e.parameters,t,n),r)}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"AND";return u.WhereClause.create("(("+o(e,a.a.Standardised)+")"+n+"("+o(t,a.a.Standardised)+"))",e.fieldsIndex)}function h(e,t,n){var r,a,u,s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;switch(e.type){case"interval":return I(h(e.value,t,n,o,l),e.qualifier,e.op);case"case_expression":var c=" CASE ";"simple"===e.format&&(c+=h(e.operand,t,n,o,l));for(var f=0;f<e.clauses.length;f++)c+=" WHEN "+h(e.clauses[f].operand,t,n,o,l)+" THEN "+h(e.clauses[f].value,t,n,o,l);return null!==e.else&&(c+=" ELSE "+h(e.else,t,n,o,l)),c+=" END ";case"param":var g=n[e.value.toLowerCase()];if("string"==typeof g)return"'"+n[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(g instanceof Date)return d(g,t);if(g instanceof Array){for(var y=[],m=0;m<g.length;m++)"string"==typeof g[m]?y.push("'"+g[m].toString().replace(/'/g,"''")+"'"):g[m]instanceof Date?y.push(d(g[m],t)):y.push(g[m].toString());return y}return g.toString();case"expr_list":a=[];var _,b=i(e.value);try{for(b.s();!(_=b.n()).done;){var w=_.value;a.push(h(w,t,n,o,l))}}catch(O){b.e(O)}finally{b.f()}return a;case"unary_expr":return" ( NOT "+h(e.expr,t,n,o,l)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+h(e.left,t,n,o,l)+" AND "+h(e.right,t,n,o,l)+") ";case"OR":return" ("+h(e.left,t,n,o,l)+" OR "+h(e.right,t,n,o,l)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+h(e.left,t,n,o,l)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+h(e.left,t,n,o,l)+" IS NOT NULL )";case"IN":return r=[],"expr_list"===e.right.type?(r=h(e.right,t,n,o,l)," ("+h(e.left,t,n,o,l)+" IN ("+r.join(",")+")) "):(s=h(e.right,t,n,o,l))instanceof Array?" ("+h(e.left,t,n,o,l)+" IN ("+s.join(",")+")) ":" ("+h(e.left,t,n,o,l)+" IN ("+s+")) ";case"NOT IN":return r=[],"expr_list"===e.right.type?(r=h(e.right,t,n,o,l)," ("+h(e.left,t,n,o,l)+" NOT IN ("+r.join(",")+")) "):(s=h(e.right,t,n,o,l))instanceof Array?" ("+h(e.left,t,n,o,l)+" NOT IN ("+s.join(",")+")) ":" ("+h(e.left,t,n,o,l)+" NOT IN ("+s+")) ";case"BETWEEN":return u=h(e.right,t,n,o,l)," ("+h(e.left,t,n,o,l)+" BETWEEN "+u[0]+" AND "+u[1]+" ) ";case"NOTBETWEEN":return u=h(e.right,t,n,o,l)," ("+h(e.left,t,n,o,l)+" NOT BETWEEN "+u[0]+" AND "+u[1]+" ) ";case"LIKE":return""!==e.escape?" ("+h(e.left,t,n,o,l)+" LIKE "+h(e.right,t,n,o,l)+" ESCAPE '"+e.escape+"') ":" ("+h(e.left,t,n,o,l)+" LIKE "+h(e.right,t,n,o,l)+") ";case"NOT LIKE":return""!==e.escape?" ("+h(e.left,t,n,o,l)+" NOT LIKE "+h(e.right,t,n,o,l)+" ESCAPE '"+e.escape+"') ":" ("+h(e.left,t,n,o,l)+" NOT LIKE "+h(e.right,t,n,o,l)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+h(e.left,t,n,o,l)+" "+e.operator+" "+h(e.right,t,n,o,l)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return d(e.value,t);case"number":return e.value.toString();case"current_time":return v("date"===e.mode,t);case"column_ref":return o&&o.toLowerCase()===e.column.toLowerCase()?"("+l+")":e.column;case"function":var S=h(e.args,t,n,o,l);return p(e.name,S,t)}throw new Error("Unsupported sql syntax "+e.type)}function p(e,t,n){switch(e.toLowerCase().trim()){case"abs":if(1!==t.length)throw new Error("Invalid Parameter for call to ABS");return"abs("+t[0]+")";case"ceiling":case"ceil":if(1!==t.length)throw new Error("Invalid Parameter for call to CEILING");switch(n){case a.a.Standardised:case a.a.StandardisedNoInterval:default:return"CEILING("+t[0]+")"}case"floor":if(1!==t.length)throw new Error("Invalid Parameter for call to Floor");return"FLOOR("+t[0]+")";case"log":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG");return"LOG("+t[0]+")";case"log10":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG10");return"LOG10("+t[0]+")";case"power":if(2!==t.length)throw new Error("Invalid Parameter for call to POWER");return"POWER("+t[0]+","+t[1]+")";case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new Error("Invalid Parameter for call to ROUND");case"truncate":if(t.length<1||t.length>2)throw new Error("Invalid Parameter for TRUNCATE function");switch(n){case a.a.SqlServer:return"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)";default:return"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")")}case"char_length":case"len":if(1!==t.length)throw new Error("Invalid Parameter for CHAR_LENGTH function");switch(n){case a.a.SqlServer:return"LEN("+t[0]+")";case a.a.Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"concat":if(t.length<1)throw new Error("Invalid Parameter for CONCAT function");for(var r="CONCAT(",u=0;u<t.length;u++)0!==u&&(r+=","),r+=t[u];return r+=")";case"lower":case"lcase":if(1!==t.length)throw new Error("Invalid Parameter for Lower function");return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new Error("Invalid Parameter for Upper function");return"UPPER("+t[0]+")";case"substring":var i="";switch(n){case a.a.Oracle:return i="SUBSTR("+t[0]+","+t[1],3===t.length&&(i+=","+t[2]),i+=")";case a.a.SqlServer:return i=3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")";default:return i="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(i+=" FOR "+t[2]),i+=")"}case"extract":return"EXTRACT("+t[0].replace(/\'/g,"")+" FROM "+t[1]+")"}throw new Error("Function Not Recognised")}function d(e,t){var n=r.m.Moment(e),u=0===n.minute()&&0===n.hour()&&0===n.second()&&0===n.millisecond();switch(t){case a.a.FILEGDB:case a.a.Standardised:case a.a.StandardisedNoInterval:return u?"date '"+n.format("YYYY-MM-DD")+"'":"date '"+n.format("YYYY-MM-DD HH:mm:ss")+"'";case a.a.Oracle:return u?"TO_DATE('"+n.format("YYYY-MM-DD")+"','YYYY-MM-DD')":"TO_DATE('"+n.format("YYYY-MM-DD HH:mm:ss")+"','YYYY-MM-DD HH24:MI:SS')";case a.a.SqlServer:return"'"+n.format(u?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";case a.a.PGDB:return"#"+n.format(u?"MM-DD-YYYY":"MM-DD-YYYY HH:mm:ss")+"#";case a.a.Postgres:return"TIMESTAMP '"+n.format(u?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";default:return"date '"+n.format("YYYY-MM-DD HH:mm:ss")+"'"}}function v(e,t){switch(t){case a.a.FILEGDB:case a.a.Standardised:case a.a.StandardisedNoInterval:case a.a.Oracle:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP";case a.a.SqlServer:return e?"CAST(GETDATE() AS DATE)":"GETDATE()";case a.a.PGDB:case a.a.Postgres:default:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP"}}function g(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={},u={},s={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",oid:"integer",long:"integer","small-integer":"integer",integer:"integer",single:"double",double:"double",date:"date",string:"string"},o=i(t);try{for(o.s();!(n=o.n()).done;){var l=n.value,c=s[l.type];a[l.name.toLowerCase()]=void 0===c?"":c}}catch(p){o.e(p)}finally{o.f()}for(var f in r){var h=s[r[f]];u[f.toLowerCase()]=void 0===h?"":h}switch(y(a,e.parseTree,e.parameters,u)){case"double":return"double";case"integer":return"integer";case"double":return"double";case"date":return"date";case"string":return"string"}return""}function y(e,t,n,r){var a;switch(t.type){case"interval":return"integer";case"case_expression":var u=[];if("simple"===t.format){for(var s=0;s<t.clauses.length;s++)u.push(y(e,t.clauses[s].value,n,r));null!==t.else&&u.push(y(e,t.else,n,r))}else{for(var o=0;o<t.clauses.length;o++)u.push(y(e,t.else,n,r));null!==t.else&&u.push(y(e,t.else,n,r))}return _(u);case"param":var l=r[t.value.toLowerCase()];if(void 0===l&&n){var c=n[t.value.toLowerCase()];if(void 0===c)return"";if(null===c)return"";if("string"==typeof c||c instanceof String)return"string";if("boolean"==typeof c)return"boolean";if(c instanceof Date)return"date";if("number"==typeof c)return c%1==0?"integer":"double"}return void 0===l?"":l;case"expr_list":var f,h=[],p=i(t.value);try{for(p.s();!(f=p.n()).done;){var d=f.value;h.push(y(e,d,n,r))}}catch(m){p.e(m)}finally{p.f()}return h;case"unary_expr":return"boolean";case"binary_expr":switch(t.operator){case"AND":case"OR":return"boolean";case"IS":case"ISNOT":if("null"!==t.right.type)throw new Error("Unsupported RHS for IS");return"boolean";case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":return"boolean";case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"*":case"-":case"+":case"/":return _([y(e,t.left,n,r),y(e,t.right,n,r)]);default:throw new Error("Not Supported Operator "+t.operator)}case"null":return"";case"bool":return"boolean";case"string":return"string";case"number":return null===t.value?"":t.value%1==0?"integer":"double";case"date":case"timestamp":case"current_time":return"date";case"column_ref":var v=e[t.column.toLowerCase()];return void 0===v?"":v;case"function":switch(t.name.toLowerCase()){case"position":case"extract":case"char_length":return"integer";case"round":return(a=y(e,t.args,n,r))instanceof Array?a.length>0?a[0]:"":a;case"sign":return(a=y(e,t.args,n,r))instanceof Array&&(a=_(a)),"integer"===a||"double"===a?a:"double";case"ceiling":case"floor":case"abs":var g=y(e,t.args,n,r);return g instanceof Array?_(g):g;case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"round":return(a=y(e,t.args,n,r))instanceof Array?a.length>0?a[0]:"":a}return""}throw new Error("Unsupported sql syntax "+t.type)}var m={boolean:1,string:2,integer:3,double:4,date:5};function _(e){if(e){var t,n="",r=i(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;""!==a&&(n=""===n||m[n]<m[a]?a:n)}}catch(u){r.e(u)}finally{r.f()}return n}return""}function b(e,t){return function e(t,n){if(null==t)return!1;switch(t.type){case"when_clause":return e(t.operand,n)||e(t.value,n);case"case_expression":var r,a=i(t.clauses);try{for(a.s();!(r=a.n()).done;){var u=r.value;if(e(u,n))return!0}}catch(c){a.e(c)}finally{a.f()}return!("simple"!==t.format||!e(t.operand,n))||!(null===t.else||!e(t.else,n));case"param":return!1;case"expr_list":var s,o=i(t.value);try{for(o.s();!(s=o.n()).done;){var l=s.value;if(e(l,n))return!0}}catch(c){o.e(c)}finally{o.f()}return!1;case"unary_expr":return e(t.expr,n);case"binary_expr":return e(t.left,n)||e(t.right,n);case"null":case"bool":case"date":case"timestamp":case"string":case"number":return!1;case"column_ref":return n.toLowerCase()===t.column.toLowerCase();case"function":return e(t.args,n)}return!1}(e.parseTree,t)}function w(e){return"column_ref"===e.parseTree.type}function S(e){var t="";return t+=e.period.toUpperCase()}function I(e,t,n){return"INTERVAL "+n+" "+e+" "+("interval-period"===t.type?S(t):S(t.start)+" TO "+S(t.end))}},xnqp:function(e,t,n){"use strict";n.r(t),n.d(t,"WhereClause",(function(){return F})),n.d(t,"defaultAttributeAdapter",(function(){return W}));var r=n("aNYv"),a=n("6CzD"),u=n("hisu"),i=n("yBJb"),s=n("J4Pc");function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,u=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw u}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c={min:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.min.apply(Math,e[0])}},max:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.max.apply(Math,e[0])}},avg:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:f(e[0])}},sum:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}(e[0])}},stddev:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sqrt(h(e[0]))}},count:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].length}},var:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:h(e[0])}}};function f(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t/e.length}function h(e){var t,n=f(e),r=e.length,a=0,u=o(e);try{for(u.s();!(t=u.n()).done;){var i=t.value;a+=Math.pow(i-n,2)}}catch(s){u.e(s)}finally{u.f()}return r>1?a/(r-1):0}var p=n("lZmO"),d=function(){function e(){Object(u.a)(this,e),this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}return Object(i.a)(e,[{key:"valueInMilliseconds",value:function(){return("-"===this.op?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}],[{key:"fixDefaults",value:function(e){if(null!==e.precision||null!==e.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}},{key:"createFromMilliseconds",value:function(t){var n=new e;return n.second=t/1e3,n}},{key:"createFromValueAndQualifer",value:function(t,n,r){var a=new e;if(a.op="-"===r?"-":"+","interval-period"===n.type){e.fixDefaults(n);var u=new RegExp("^[0-9]{1,}$");if("year"===n.period||"month"===n.period)throw new Error("Year-Month Intervals not supported");if(!u.test(t))throw new Error("Illegal Interval");a[n.period]=parseFloat(t)}else{if(e.fixDefaults(n.start),e.fixDefaults(n.end),"year"===n.start.period||"month"===n.start.period)throw new Error("Year-Month Intervals not supported");if("year"===n.end.period||"month"===n.end.period)throw new Error("Year-Month Intervals not supported");switch(n.start.period){case"day":switch(n.end.period){case"hour":if(!new RegExp("^[0-9]{1,} [0-9]{1,}$").test(t))throw new Error("Illegal Interval");a[n.start.period]=parseFloat(t.split(" ")[0]),a[n.end.period]=parseFloat(t.split(" ")[1]);break;case"minute":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$").test(t))throw new Error("Illegal Interval");a[n.start.period]=parseFloat(t.split(" ")[0]);var i=t.split(" ")[1].split(":");a.hour=parseFloat(i[0]),a.minute=parseFloat(i[1]);break;case"second":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");a[n.start.period]=parseFloat(t.split(" ")[0]);var s=t.split(" ")[1].split(":");a.hour=parseFloat(s[0]),a.minute=parseFloat(s[1]),a.second=parseFloat(s[2]);break;default:throw"Invalid Interval."}break;case"hour":switch(n.end.period){case"minute":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}$").test(t))throw new Error("Illegal Interval");a.hour=parseFloat(t.split(":")[0]),a.minute=parseFloat(t.split(":")[1]);break;case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");var o=t.split(":");a.hour=parseFloat(o[0]),a.minute=parseFloat(o[1]),a.second=parseFloat(o[2]);break;default:throw"Invalid Interval."}break;case"minute":switch(n.end.period){case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");var l=t.split(":");a.minute=parseFloat(l[0]),a.second=parseFloat(l[1]);break;default:throw"Invalid Interval."}break;default:throw"Invalid Interval."}}return a}}]),e}();function v(e,t){var n=m[e.toLowerCase()];if(null==n)throw new Error("Function Not Recognised");if(t.length<n.minParams||t.length>n.maxParams)throw new Error("Invalid Parameter count for call to ".concat(e.toUpperCase()));return n.evaluate(t)}var g,y,m={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1];if(null==a)return null;if(a instanceof Date)switch(n.toUpperCase()){case"SECOND":return a.getSeconds();case"MINUTE":return a.getMinutes();case"HOUR":return a.getHours();case"DAY":return a.getDate();case"MONTH":return a.getMonth()+1;case"YEAR":return a.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=Object(r.a)(e,2),n=t[0],a=t[1];return null==n||null==a?null:n.toString().substring(a-1)}if(3===e.length){var u=Object(r.a)(e,3),i=u[0],s=u[1],o=u[2];return null==i||null==s||null==o?null:o<=0?"":i.toString().substring(s-1,s+o-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1];return null==n||null==a?null:a.indexOf(n)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,n=t?e[1]:" ",r=t?e[2]:e[1];if(null==n||null==r)return null;var a="(".concat(Object(p.a)(n),")");switch(e[0]){case"BOTH":return r.replace(new RegExp("^".concat(a,"*|").concat(a,"*$"),"g"),"");case"LEADING":return r.replace(new RegExp("^".concat(a,"*"),"g"),"");case"TRAILING":return r.replace(new RegExp("".concat(a,"*$"),"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],n=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*n)/n}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",n=0;n<e.length;n++){if(null==e[n])return null;t+=e[n].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}},_=(n("zc/w"),{exports:{}});y=function(){function e(t,n,r,a){this.message=t,this.expected=n,this.found=r,this.location=a,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}function t(t,n){n=void 0!==n?n:{};var r,a={},u={start:qe},i=qe,s=function(e,t){var n={type:"expr_list"},r=function(e,t,n){return function(e,t){for(var n=[e],r=0;r<t.length;r++)n.push(t[r][3]);return n}(e,t)}(e,t);return n.value=r,n},o=function(e,t){return vn(e,t)},l=Ge("!",!1),c=Ge("=",!1),f=Ge(">=",!1),h=Ge(">",!1),p=Ge("<=",!1),d=Ge("<>",!1),v=Ge("<",!1),g=Ge("!=",!1),y=function(e){return e[0]+" "+e[2]},m=Ge("+",!1),_=Ge("-",!1),b=Ge("*",!1),w=Ge("/",!1),S=function(e,t){return e+t.join("")},I=/^[A-Za-z_\x80-\uFFFF]/,O=Be([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),T=/^[A-Za-z0-9_]/,k=Be([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),x=/^[A-Za-z0-9_.\x80-\uFFFF]/,E=Be([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),A=Ge("@",!1),N=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},F=function(e,t){return{type:"interval-period",period:"second",precision:e,secondary:t}},j=function(e){return parseFloat(e)},C=Ge("'",!1),D=Ge("N'",!1),P=Ge("''",!1),R=/^[^']/,M=Be(["'"],!0,!1),L=function(e,t){return{type:"when_clause",operand:e,value:t}},U=Ge(".",!1),G=/^[0-9]/,B=Be([["0","9"]],!1,!1),Y=/^[eE]/,J=Be(["e","E"],!1,!1),H=/^[+\-]/,q=Be(["+","-"],!1,!1),W=Ge("NULL",!0),K=Ge("TRUE",!0),V=Ge("FALSE",!0),Q=Ge("IN",!0),$=Ge("IS",!0),z=Ge("LIKE",!0),Z=Ge("ESCAPE",!0),X=Ge("NOT",!0),ee=Ge("AND",!0),te=Ge("OR",!0),ne=Ge("BETWEEN",!0),re=Ge("FROM",!0),ae=Ge("FOR",!0),ue=Ge("SUBSTRING",!0),ie=Ge("EXTRACT",!0),se=Ge("TRIM",!0),oe=Ge("POSITION",!0),le=Ge("TIMESTAMP",!0),ce=Ge("DATE",!0),fe=Ge("LEADING",!0),he=Ge("TRAILING",!0),pe=Ge("BOTH",!0),de=Ge("TO",!0),ve=Ge("INTERVAL",!0),ge=Ge("YEAR",!0),ye=Ge("MONTH",!0),me=Ge("DAY",!0),_e=Ge("HOUR",!0),be=Ge("MINUTE",!0),we=Ge("SECOND",!0),Se=Ge("CASE",!0),Ie=Ge("END",!0),Oe=Ge("WHEN",!0),Te=Ge("THEN",!0),ke=Ge("ELSE",!0),xe=Ge(",",!1),Ee=Ge("(",!1),Ae=Ge(")",!1),Ne=/^[ \t\n\r]/,Fe=Be([" ","\t","\n","\r"],!1,!1),je=Ge("`",!1),Ce=/^[^`]/,De=Be(["`"],!0,!1),Pe=0,Re=[{line:1,column:1}],Me=0,Le=[],Ue=0;if("startRule"in n){if(!(n.startRule in u))throw new Error("Can't start parsing from rule \""+n.startRule+'".');i=u[n.startRule]}function Ge(e,t){return{type:"literal",text:e,ignoreCase:t}}function Be(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function Ye(e){var n,r=Re[e];if(r)return r;for(n=e-1;!Re[n];)n--;for(r={line:(r=Re[n]).line,column:r.column};n<e;)10===t.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return Re[e]=r,r}function Je(e,t){var n=Ye(e),r=Ye(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:r.line,column:r.column}}}function He(e){Pe<Me||(Pe>Me&&(Me=Pe,Le=[]),Le.push(e))}function qe(){var e,t;return e=Pe,fn()!==a&&(t=Ke())!==a&&fn()!==a?e=t:(Pe=e,e=a),e}function We(){var e,t,n,r,u,i,o,l;if(e=Pe,(t=Ke())!==a){for(n=[],r=Pe,(u=fn())!==a&&(i=on())!==a&&(o=fn())!==a&&(l=Ke())!==a?r=u=[u,i,o,l]:(Pe=r,r=a);r!==a;)n.push(r),r=Pe,(u=fn())!==a&&(i=on())!==a&&(o=fn())!==a&&(l=Ke())!==a?r=u=[u,i,o,l]:(Pe=r,r=a);n!==a?e=t=s(t,n):(Pe=e,e=a)}else Pe=e,e=a;return e}function Ke(){var e,t,n,r,u,i,s,l;if(e=Pe,(t=Ve())!==a){for(n=[],r=Pe,(u=fn())!==a&&(i=Pt())!==a&&(s=fn())!==a&&(l=Ve())!==a?r=u=[u,i,s,l]:(Pe=r,r=a);r!==a;)n.push(r),r=Pe,(u=fn())!==a&&(i=Pt())!==a&&(s=fn())!==a&&(l=Ve())!==a?r=u=[u,i,s,l]:(Pe=r,r=a);n!==a?e=t=o(t,n):(Pe=e,e=a)}else Pe=e,e=a;return e}function Ve(){var e,t,n,r,u,i,s,l;if(e=Pe,(t=Qe())!==a){for(n=[],r=Pe,(u=fn())!==a&&(i=Dt())!==a&&(s=fn())!==a&&(l=Qe())!==a?r=u=[u,i,s,l]:(Pe=r,r=a);r!==a;)n.push(r),r=Pe,(u=fn())!==a&&(i=Dt())!==a&&(s=fn())!==a&&(l=Qe())!==a?r=u=[u,i,s,l]:(Pe=r,r=a);n!==a?e=t=o(t,n):(Pe=e,e=a)}else Pe=e,e=a;return e}function Qe(){var e,n,r,u,i;return e=Pe,(n=Ct())===a&&(n=Pe,33===t.charCodeAt(Pe)?(r="!",Pe++):(r=a,0===Ue&&He(l)),r!==a?(u=Pe,Ue++,61===t.charCodeAt(Pe)?(i="=",Pe++):(i=a,0===Ue&&He(c)),Ue--,i===a?u=void 0:(Pe=u,u=a),u!==a?n=r=[r,u]:(Pe=n,n=a)):(Pe=n,n=a)),n!==a&&(r=fn())!==a&&(u=Qe())!==a?e=n=function(e){return function(e,t){return{type:"unary_expr",operator:e,expr:t}}("NOT",e)}(u):(Pe=e,e=a),e===a&&(e=function(){var e,t,n;return e=Pe,(t=Xe())!==a&&fn()!==a?((n=function(){var e;return(e=function(){var e,t,n,r,u,i;if(e=[],t=Pe,(n=fn())!==a&&(r=$e())!==a&&(u=fn())!==a&&(i=Xe())!==a?t=n=[n,r,u,i]:(Pe=t,t=a),t!==a)for(;t!==a;)e.push(t),t=Pe,(n=fn())!==a&&(r=$e())!==a&&(u=fn())!==a&&(i=Xe())!==a?t=n=[n,r,u,i]:(Pe=t,t=a);else e=a;return e!==a&&(e=function(e){return{type:"arithmetic",tail:e}}(e)),e}())===a&&(e=function(){var e,t,n,r;return e=Pe,(t=Ze())!==a&&fn()!==a&&(n=ln())!==a&&fn()!==a&&(r=We())!==a&&fn()!==a&&cn()!==a?e=t=function(e,t){return{op:e,right:t}}(t,r):(Pe=e,e=a),e===a&&(e=Pe,(t=Ze())!==a&&fn()!==a&&(n=ln())!==a&&fn()!==a&&(r=cn())!==a?e=t=function(e){return{op:e,right:{type:"expr_list",value:[]}}}(t):(Pe=e,e=a),e===a&&(e=Pe,(t=Ze())!==a&&fn()!==a&&(n=ot())!==a?e=t=function(e,t){return{op:e,right:t}}(t,n):(Pe=e,e=a))),e}())===a&&(e=function(){var e,t,n,r,u,i;return e=Pe,(t=Ct())!==a&&fn()!==a&&(n=Rt())!==a&&fn()!==a&&(r=Xe())!==a&&fn()!==a&&(u=Dt())!==a&&fn()!==a&&(i=Xe())!==a?e=t=function(e,t,n){return{op:"NOT"+e,right:{type:"expr_list",value:[t,n]}}}(n,r,i):(Pe=e,e=a),e===a&&(e=Pe,(t=Rt())!==a&&fn()!==a&&(n=Xe())!==a&&fn()!==a&&(r=Dt())!==a&&fn()!==a&&(u=Xe())!==a?e=t=function(e,t,n){return{op:e,right:{type:"expr_list",value:[t,n]}}}(t,n,u):(Pe=e,e=a)),e}())===a&&(e=function(){var e,t,n,r;return e=Pe,(t=Nt())!==a&&fn()!==a&&(n=Ct())!==a&&fn()!==a&&(r=Xe())!==a?e=t=function(e,t){return{op:e+"NOT",right:t}}(t,r):(Pe=e,e=a),e===a&&(e=Pe,(t=Nt())!==a&&fn()!==a&&(n=Xe())!==a?e=t=function(e,t){return{op:e,right:t}}(t,n):(Pe=e,e=a)),e}())===a&&(e=function(){var e,t,n,r;return e=Pe,(t=ze())!==a&&fn()!==a&&(n=vt())!==a&&fn()!==a&&jt()!==a&&fn()!==a&&(r=gt())!==a?e=t=function(e,t,n){return{op:e,right:t,escape:n.value}}(t,n,r):(Pe=e,e=a),e===a&&(e=Pe,(t=ze())!==a&&fn()!==a&&(n=vt())!==a?e=t=function(e,t){return{op:e,right:t,escape:""}}(t,n):(Pe=e,e=a)),e}()),e}())===a&&(n=null),n!==a?e=t=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?vn(e,t.tail):dn(t.op,e,t.right,t.escape)}(t,n):(Pe=e,e=a)):(Pe=e,e=a),e}()),e}function $e(){var e;return">="===t.substr(Pe,2)?(e=">=",Pe+=2):(e=a,0===Ue&&He(f)),e===a&&(62===t.charCodeAt(Pe)?(e=">",Pe++):(e=a,0===Ue&&He(h)),e===a&&("<="===t.substr(Pe,2)?(e="<=",Pe+=2):(e=a,0===Ue&&He(p)),e===a&&("<>"===t.substr(Pe,2)?(e="<>",Pe+=2):(e=a,0===Ue&&He(d)),e===a&&(60===t.charCodeAt(Pe)?(e="<",Pe++):(e=a,0===Ue&&He(v)),e===a&&(61===t.charCodeAt(Pe)?(e="=",Pe++):(e=a,0===Ue&&He(c)),e===a&&("!="===t.substr(Pe,2)?(e="!=",Pe+=2):(e=a,0===Ue&&He(g)))))))),e}function ze(){var e,t,n,r,u;return e=Pe,t=Pe,(n=Ct())!==a&&(r=fn())!==a&&(u=Ft())!==a?t=n=[n,r,u]:(Pe=t,t=a),t!==a&&(t=y(t)),(e=t)===a&&(e=Ft()),e}function Ze(){var e,t,n,r,u;return e=Pe,t=Pe,(n=Ct())!==a&&(r=fn())!==a&&(u=At())!==a?t=n=[n,r,u]:(Pe=t,t=a),t!==a&&(t=y(t)),(e=t)===a&&(e=At()),e}function Xe(){var e,t,n,r,u,i,s,l;if(e=Pe,(t=tt())!==a){for(n=[],r=Pe,(u=fn())!==a&&(i=et())!==a&&(s=fn())!==a&&(l=tt())!==a?r=u=[u,i,s,l]:(Pe=r,r=a);r!==a;)n.push(r),r=Pe,(u=fn())!==a&&(i=et())!==a&&(s=fn())!==a&&(l=tt())!==a?r=u=[u,i,s,l]:(Pe=r,r=a);n!==a?e=t=o(t,n):(Pe=e,e=a)}else Pe=e,e=a;return e}function et(){var e;return 43===t.charCodeAt(Pe)?(e="+",Pe++):(e=a,0===Ue&&He(m)),e===a&&(45===t.charCodeAt(Pe)?(e="-",Pe++):(e=a,0===Ue&&He(_))),e}function tt(){var e,t,n,r,u,i,s,o;if(e=Pe,(t=rt())!==a){for(n=[],r=Pe,(u=fn())!==a&&(i=nt())!==a&&(s=fn())!==a&&(o=rt())!==a?r=u=[u,i,s,o]:(Pe=r,r=a);r!==a;)n.push(r),r=Pe,(u=fn())!==a&&(i=nt())!==a&&(s=fn())!==a&&(o=rt())!==a?r=u=[u,i,s,o]:(Pe=r,r=a);n!==a?e=t=function(e,t){return vn(e,t)}(t,n):(Pe=e,e=a)}else Pe=e,e=a;return e}function nt(){var e;return 42===t.charCodeAt(Pe)?(e="*",Pe++):(e=a,0===Ue&&He(b)),e===a&&(47===t.charCodeAt(Pe)?(e="/",Pe++):(e=a,0===Ue&&He(w))),e}function rt(){var e,t;return(e=function(){var e;return(e=gt())===a&&(e=function(){var e,t,n,r;return e=Pe,(t=function(){var e,t,n,r;return e=Pe,(t=bt())!==a&&(n=wt())!==a&&(r=St())!==a?e=t=function(e,t,n){return parseFloat(e+t+n)}(t,n,r):(Pe=e,e=a),e===a&&(e=Pe,(t=bt())!==a&&(n=wt())!==a?e=t=function(e,t){return parseFloat(e+t)}(t,n):(Pe=e,e=a),e===a&&(e=Pe,(t=bt())!==a&&(n=St())!==a?e=t=function(e,t){return parseFloat(e+t)}(t,n):(Pe=e,e=a),e===a&&(e=Pe,(t=bt())!==a&&(t=function(e){return parseFloat(e)}(t)),e=t))),e}())!==a?(n=Pe,Ue++,r=ut(),Ue--,r===a?n=void 0:(Pe=n,n=a),n!==a?e=t=function(e){return{type:"number",value:e}}(t):(Pe=e,e=a)):(Pe=e,e=a),e}())===a&&(e=function(){var e,t;return e=Pe,(t=xt())!==a&&(t={type:"bool",value:!0}),(e=t)===a&&(e=Pe,(t=Et())!==a&&(t={type:"bool",value:!1}),e=t),e}())===a&&(e=function(){var e;return(e=kt())!==a&&(e={type:"null",value:null}),e}())===a&&(e=function(){var e,t;return e=Pe,Ht()!==a&&fn()!==a&&(t=vt())!==a?e=function(e){return{type:"date",value:e.value}}(t):(Pe=e,e=a),e}())===a&&(e=function(){var e,t;return e=Pe,Jt()!==a&&fn()!==a&&(t=vt())!==a?e=function(e){return{type:"timestamp",value:e.value}}(t):(Pe=e,e=a),e}())===a&&(e=ct()),e}())===a&&(e=function(){var e,t,n;return e=Pe,Gt()!==a&&fn()!==a&&ln()!==a&&fn()!==a&&(t=function(){var e;return(e=$t())===a&&(e=zt())===a&&(e=Zt())===a&&(e=Xt())===a&&(e=en())===a&&(e=tn()),e}())!==a&&fn()!==a&&Mt()!==a&&fn()!==a&&(n=Ke())!==a&&fn()!==a&&cn()!==a?e=function(e,t){return{type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:e},t]}}}(t,n):(Pe=e,e=a),e}())===a&&(e=function(){var e,t,n,r,u,i,s,o;return e=Pe,Ut()!==a&&fn()!==a&&ln()!==a&&fn()!==a&&(t=Ke())!==a&&fn()!==a&&Mt()!==a&&fn()!==a&&(n=Ke())!==a&&fn()!==a?(r=Pe,(u=Lt())!==a&&(i=fn())!==a&&(s=Ke())!==a&&(o=fn())!==a?r=u=[u,i,s,o]:(Pe=r,r=a),r===a&&(r=null),r!==a&&(u=cn())!==a?e=function(e,t,n){return{type:"function",name:"substring",args:{type:"expr_list",value:n?[e,t,n[2]]:[e,t]}}}(t,n,r):(Pe=e,e=a)):(Pe=e,e=a),e}())===a&&(e=function(){var e,t,n,r;return e=Pe,Bt()!==a&&fn()!==a&&ln()!==a&&fn()!==a?((t=lt())===a&&(t=null),t!==a&&fn()!==a&&(n=Ke())!==a&&fn()!==a&&Mt()!==a&&fn()!==a&&(r=Ke())!==a&&fn()!==a&&cn()!==a?e=function(e,t,n){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t,n]}}}(t,n,r):(Pe=e,e=a)):(Pe=e,e=a),e===a&&(e=Pe,Bt()!==a&&fn()!==a&&ln()!==a&&fn()!==a?((t=lt())===a&&(t=null),t!==a&&fn()!==a&&(n=Ke())!==a&&fn()!==a&&cn()!==a?e=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}}(t,n):(Pe=e,e=a)):(Pe=e,e=a)),e}())===a&&(e=function(){var e,t,n;return e=Pe,Yt()!==a&&fn()!==a&&ln()!==a&&fn()!==a&&(t=Ke())!==a&&fn()!==a&&At()!==a&&fn()!==a&&(n=Ke())!==a&&fn()!==a&&cn()!==a?e=function(e,t){return{type:"function",name:"position",args:{type:"expr_list",value:[e,t]}}}(t,n):(Pe=e,e=a),e}())===a&&(e=function(){var e,t,n;return e=Pe,(t=pn())!==a&&fn()!==a&&ln()!==a&&fn()!==a?((n=We())===a&&(n=null),n!==a&&fn()!==a&&cn()!==a?e=t=function(e,t){return{type:"function",name:e,args:t||{type:"expr_list",value:[]}}}(t,n):(Pe=e,e=a)):(Pe=e,e=a),e}())===a&&(e=function(){var e;return(e=function(){var e,t,n,r,u;if(e=Pe,nn()!==a)if(fn()!==a)if((t=Ke())!==a)if(fn()!==a){for(n=[],r=mt();r!==a;)n.push(r),r=mt();n!==a&&(r=fn())!==a&&(u=rn())!==a?e=function(e,t){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:null}}(t,n):(Pe=e,e=a)}else Pe=e,e=a;else Pe=e,e=a;else Pe=e,e=a;else Pe=e,e=a;if(e===a)if(e=Pe,nn()!==a)if(fn()!==a)if((t=Ke())!==a)if(fn()!==a){for(n=[],r=mt();r!==a;)n.push(r),r=mt();n!==a&&(r=fn())!==a&&(u=_t())!==a&&fn()!==a&&rn()!==a?e=function(e,t,n){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:n.value}}(t,n,u):(Pe=e,e=a)}else Pe=e,e=a;else Pe=e,e=a;else Pe=e,e=a;else Pe=e,e=a;return e}())===a&&(e=function(){var e,t,n,r;if(e=Pe,nn()!==a)if(fn()!==a){for(t=[],n=yt();n!==a;)t.push(n),n=yt();t!==a&&(n=fn())!==a&&(r=rn())!==a?e=function(e){return{type:"case_expression",format:"searched",clauses:e,else:null}}(t):(Pe=e,e=a)}else Pe=e,e=a;else Pe=e,e=a;if(e===a)if(e=Pe,nn()!==a)if(fn()!==a){for(t=[],n=yt();n!==a;)t.push(n),n=yt();t!==a&&(n=fn())!==a&&(r=_t())!==a&&fn()!==a&&rn()!==a?e=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}}(t,r):(Pe=e,e=a)}else Pe=e,e=a;else Pe=e,e=a;return e}()),e}())===a&&(e=function(){var e;return(e=function(){var e;return(e=function(){var e,t,n,r;if(e=Pe,(t=ut())!==a){for(n=[],r=st();r!==a;)n.push(r),r=st();n!==a?e=t=S(t,n):(Pe=e,e=a)}else Pe=e,e=a;return e}())!==a&&(e=e),e}())!==a&&(e=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:e}}(e)),e}())===a&&(e=ot())===a&&(e=Pe,ln()!==a&&fn()!==a&&(t=Ke())!==a&&fn()!==a&&cn()!==a?e=function(e){return e.paren=!0,e}(t):(Pe=e,e=a)),e}function at(){var e,t,n,r;if(e=Pe,(t=ut())!==a){for(n=[],r=it();r!==a;)n.push(r),r=it();n!==a?e=t=S(t,n):(Pe=e,e=a)}else Pe=e,e=a;return e}function ut(){var e;return I.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===Ue&&He(O)),e}function it(){var e;return T.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===Ue&&He(k)),e}function st(){var e;return x.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===Ue&&He(E)),e}function ot(){var e,n,r;return e=Pe,64===t.charCodeAt(Pe)?(n="@",Pe++):(n=a,0===Ue&&He(A)),n!==a&&(r=at())!==a?e=n=[n,r]:(Pe=e,e=a),e!==a&&(e=function(e){return{type:"param",value:e[1]}}(e)),e}function lt(){var e;return(e=qt())===a&&(e=Wt())===a&&(e=Kt()),e}function ct(){var e,n,r,u;return e=Pe,Qt()!==a&&fn()!==a?(45===t.charCodeAt(Pe)?(n="-",Pe++):(n=a,0===Ue&&He(_)),n===a&&(43===t.charCodeAt(Pe)?(n="+",Pe++):(n=a,0===Ue&&He(m))),n!==a&&fn()!==a&&(r=vt())!==a&&fn()!==a&&(u=ft())!==a?e=function(e,t,n){return{type:"interval",value:t,qualifier:n,op:e}}(n,r,u):(Pe=e,e=a)):(Pe=e,e=a),e===a&&(e=Pe,Qt()!==a&&fn()!==a&&(n=vt())!==a&&fn()!==a&&(r=ft())!==a?e=function(e,t){return{type:"interval",value:e,qualifier:t,op:""}}(n,r):(Pe=e,e=a)),e}function ft(){var e,t,n;return e=Pe,(t=function(){var e,t,n;return e=Pe,(t=ht())!==a&&fn()!==a&&ln()!==a&&fn()!==a&&(n=dt())!==a&&fn()!==a&&cn()!==a?e=t=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}}(t,n):(Pe=e,e=a),e===a&&(e=Pe,(t=ht())!==a&&(t=N(t)),e=t),e}())!==a&&fn()!==a&&Vt()!==a&&fn()!==a&&(n=function(){var e,t,n,r;return e=Pe,(t=ht())!==a&&(t=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}}(t)),(e=t)===a&&(e=Pe,(t=tn())!==a&&fn()!==a&&ln()!==a&&fn()!==a&&(n=dt())!==a&&fn()!==a&&on()!==a&&fn()!==a&&(r=pt())!==a&&fn()!==a&&cn()!==a?e=t=F(n,r):(Pe=e,e=a),e===a&&(e=Pe,(t=tn())!==a&&fn()!==a&&ln()!==a&&fn()!==a&&(n=dt())!==a&&fn()!==a&&cn()!==a?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(n):(Pe=e,e=a),e===a&&(e=Pe,(t=tn())!==a&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t))),e}())!==a?e=t=function(e,t){return{type:"interval-qualifier",start:e,end:t}}(t,n):(Pe=e,e=a),e===a&&(e=function(){var e,t,n,r;return e=Pe,(t=ht())!==a&&fn()!==a&&ln()!==a&&fn()!==a&&(n=pt())!==a&&fn()!==a&&cn()!==a?e=t=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}}(t,n):(Pe=e,e=a),e===a&&(e=Pe,(t=ht())!==a&&(t=N(t)),(e=t)===a&&(e=Pe,(t=tn())!==a&&fn()!==a&&ln()!==a&&fn()!==a&&(n=dt())!==a&&fn()!==a&&on()!==a&&fn()!==a&&(r=pt())!==a&&fn()!==a&&cn()!==a?e=t=F(n,r):(Pe=e,e=a),e===a&&(e=Pe,(t=tn())!==a&&fn()!==a&&ln()!==a&&fn()!==a&&(n=pt())!==a&&fn()!==a&&cn()!==a?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(n):(Pe=e,e=a),e===a&&(e=Pe,(t=tn())!==a&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t)))),e}()),e}function ht(){var e,t;return e=Pe,(t=Zt())!==a&&(t={type:"string",value:"day"}),(e=t)===a&&(e=Pe,(t=Xt())!==a&&(t={type:"string",value:"hour"}),(e=t)===a&&(e=Pe,(t=en())!==a&&(t={type:"string",value:"minute"}),(e=t)===a&&(e=Pe,(t=zt())!==a&&(t={type:"string",value:"month"}),(e=t)===a&&(e=Pe,(t=$t())!==a&&(t={type:"string",value:"year"}),e=t)))),e}function pt(){var e;return(e=It())!==a&&(e=j(e)),e}function dt(){var e;return(e=It())!==a&&(e=j(e)),e}function vt(){var e;return(e=gt())===a&&(e=ot()),e}function gt(){var e,n,r,u,i;if(e=Pe,39===t.charCodeAt(Pe)?(n="'",Pe++):(n=a,0===Ue&&He(C)),n===a&&("N'"===t.substr(Pe,2)?(n="N'",Pe+=2):(n=a,0===Ue&&He(D))),n!==a){for(r=[],u=Pe,"''"===t.substr(Pe,2)?(i="''",Pe+=2):(i=a,0===Ue&&He(P)),i!==a&&(i="'"),(u=i)===a&&(R.test(t.charAt(Pe))?(u=t.charAt(Pe),Pe++):(u=a,0===Ue&&He(M)));u!==a;)r.push(u),u=Pe,"''"===t.substr(Pe,2)?(i="''",Pe+=2):(i=a,0===Ue&&He(P)),i!==a&&(i="'"),(u=i)===a&&(R.test(t.charAt(Pe))?(u=t.charAt(Pe),Pe++):(u=a,0===Ue&&He(M)));r!==a?(39===t.charCodeAt(Pe)?(u="'",Pe++):(u=a,0===Ue&&He(C)),u!==a?e=n=function(e){return{type:"string",value:e.join("")}}(r):(Pe=e,e=a)):(Pe=e,e=a)}else Pe=e,e=a;return e}function yt(){var e,t,n;return e=Pe,an()!==a&&fn()!==a&&(t=Ke())!==a&&fn()!==a&&un()!==a&&fn()!==a&&(n=Ke())!==a?e=L(t,n):(Pe=e,e=a),e}function mt(){var e,t,n;return e=Pe,an()!==a&&fn()!==a&&(t=Ke())!==a&&fn()!==a&&un()!==a&&fn()!==a&&(n=Ke())!==a?e=L(t,n):(Pe=e,e=a),e}function _t(){var e,t;return e=Pe,sn()!==a&&fn()!==a&&(t=Ke())!==a?e=function(e){return{type:"else_clause",value:e}}(t):(Pe=e,e=a),e}function bt(){var e,n,r;return(e=It())===a&&(e=Pe,45===t.charCodeAt(Pe)?(n="-",Pe++):(n=a,0===Ue&&He(_)),n===a&&(43===t.charCodeAt(Pe)?(n="+",Pe++):(n=a,0===Ue&&He(m))),n!==a&&(r=It())!==a?e=n=function(e,t){return e[0]+t}(n,r):(Pe=e,e=a)),e}function wt(){var e,n,r;return e=Pe,46===t.charCodeAt(Pe)?(n=".",Pe++):(n=a,0===Ue&&He(U)),n!==a?((r=It())===a&&(r=null),r!==a?e=n=function(e){return"."+(null!=e?e:"")}(r):(Pe=e,e=a)):(Pe=e,e=a),e}function St(){var e,t,n;return e=Pe,(t=Tt())!==a&&(n=It())!==a?e=t=function(e,t){return e+t}(t,n):(Pe=e,e=a),e}function It(){var e,t;if(e=[],(t=Ot())!==a)for(;t!==a;)e.push(t),t=Ot();else e=a;return e!==a&&(e=function(e){return e.join("")}(e)),e}function Ot(){var e;return G.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===Ue&&He(B)),e}function Tt(){var e,n,r;return e=Pe,Y.test(t.charAt(Pe))?(n=t.charAt(Pe),Pe++):(n=a,0===Ue&&He(J)),n!==a?(H.test(t.charAt(Pe))?(r=t.charAt(Pe),Pe++):(r=a,0===Ue&&He(q)),r===a&&(r=null),r!==a?e=n=function(e,t){return"e"+(null===t?"":t)}(0,r):(Pe=e,e=a)):(Pe=e,e=a),e}function kt(){var e,n,r,u;return e=Pe,"null"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(W)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n=[n,r]:(Pe=e,e=a)):(Pe=e,e=a),e}function xt(){var e,n,r,u;return e=Pe,"true"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(K)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n=[n,r]:(Pe=e,e=a)):(Pe=e,e=a),e}function Et(){var e,n,r,u;return e=Pe,"false"===t.substr(Pe,5).toLowerCase()?(n=t.substr(Pe,5),Pe+=5):(n=a,0===Ue&&He(V)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n=[n,r]:(Pe=e,e=a)):(Pe=e,e=a),e}function At(){var e,n,r,u;return e=Pe,"in"===t.substr(Pe,2).toLowerCase()?(n=t.substr(Pe,2),Pe+=2):(n=a,0===Ue&&He(Q)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="IN":(Pe=e,e=a)):(Pe=e,e=a),e}function Nt(){var e,n,r,u;return e=Pe,"is"===t.substr(Pe,2).toLowerCase()?(n=t.substr(Pe,2),Pe+=2):(n=a,0===Ue&&He($)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="IS":(Pe=e,e=a)):(Pe=e,e=a),e}function Ft(){var e,n,r,u;return e=Pe,"like"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(z)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="LIKE":(Pe=e,e=a)):(Pe=e,e=a),e}function jt(){var e,n,r,u;return e=Pe,"escape"===t.substr(Pe,6).toLowerCase()?(n=t.substr(Pe,6),Pe+=6):(n=a,0===Ue&&He(Z)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="ESCAPE":(Pe=e,e=a)):(Pe=e,e=a),e}function Ct(){var e,n,r,u;return e=Pe,"not"===t.substr(Pe,3).toLowerCase()?(n=t.substr(Pe,3),Pe+=3):(n=a,0===Ue&&He(X)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="NOT":(Pe=e,e=a)):(Pe=e,e=a),e}function Dt(){var e,n,r,u;return e=Pe,"and"===t.substr(Pe,3).toLowerCase()?(n=t.substr(Pe,3),Pe+=3):(n=a,0===Ue&&He(ee)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="AND":(Pe=e,e=a)):(Pe=e,e=a),e}function Pt(){var e,n,r,u;return e=Pe,"or"===t.substr(Pe,2).toLowerCase()?(n=t.substr(Pe,2),Pe+=2):(n=a,0===Ue&&He(te)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="OR":(Pe=e,e=a)):(Pe=e,e=a),e}function Rt(){var e,n,r,u;return e=Pe,"between"===t.substr(Pe,7).toLowerCase()?(n=t.substr(Pe,7),Pe+=7):(n=a,0===Ue&&He(ne)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="BETWEEN":(Pe=e,e=a)):(Pe=e,e=a),e}function Mt(){var e,n,r,u;return e=Pe,"from"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(re)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="FROM":(Pe=e,e=a)):(Pe=e,e=a),e}function Lt(){var e,n,r,u;return e=Pe,"for"===t.substr(Pe,3).toLowerCase()?(n=t.substr(Pe,3),Pe+=3):(n=a,0===Ue&&He(ae)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="FOR":(Pe=e,e=a)):(Pe=e,e=a),e}function Ut(){var e,n,r,u;return e=Pe,"substring"===t.substr(Pe,9).toLowerCase()?(n=t.substr(Pe,9),Pe+=9):(n=a,0===Ue&&He(ue)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="SUBSTRING":(Pe=e,e=a)):(Pe=e,e=a),e}function Gt(){var e,n,r,u;return e=Pe,"extract"===t.substr(Pe,7).toLowerCase()?(n=t.substr(Pe,7),Pe+=7):(n=a,0===Ue&&He(ie)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="EXTRACT":(Pe=e,e=a)):(Pe=e,e=a),e}function Bt(){var e,n,r,u;return e=Pe,"trim"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(se)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="TRIM":(Pe=e,e=a)):(Pe=e,e=a),e}function Yt(){var e,n,r,u;return e=Pe,"position"===t.substr(Pe,8).toLowerCase()?(n=t.substr(Pe,8),Pe+=8):(n=a,0===Ue&&He(oe)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="POSITION":(Pe=e,e=a)):(Pe=e,e=a),e}function Jt(){var e,n,r,u;return e=Pe,"timestamp"===t.substr(Pe,9).toLowerCase()?(n=t.substr(Pe,9),Pe+=9):(n=a,0===Ue&&He(le)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="TIMESTAMP":(Pe=e,e=a)):(Pe=e,e=a),e}function Ht(){var e,n,r,u;return e=Pe,"date"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(ce)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="DATE":(Pe=e,e=a)):(Pe=e,e=a),e}function qt(){var e,n,r,u;return e=Pe,"leading"===t.substr(Pe,7).toLowerCase()?(n=t.substr(Pe,7),Pe+=7):(n=a,0===Ue&&He(fe)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="LEADING":(Pe=e,e=a)):(Pe=e,e=a),e}function Wt(){var e,n,r,u;return e=Pe,"trailing"===t.substr(Pe,8).toLowerCase()?(n=t.substr(Pe,8),Pe+=8):(n=a,0===Ue&&He(he)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="TRAILING":(Pe=e,e=a)):(Pe=e,e=a),e}function Kt(){var e,n,r,u;return e=Pe,"both"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(pe)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="BOTH":(Pe=e,e=a)):(Pe=e,e=a),e}function Vt(){var e,n,r,u;return e=Pe,"to"===t.substr(Pe,2).toLowerCase()?(n=t.substr(Pe,2),Pe+=2):(n=a,0===Ue&&He(de)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="TO":(Pe=e,e=a)):(Pe=e,e=a),e}function Qt(){var e,n,r,u;return e=Pe,"interval"===t.substr(Pe,8).toLowerCase()?(n=t.substr(Pe,8),Pe+=8):(n=a,0===Ue&&He(ve)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="INTERVAL":(Pe=e,e=a)):(Pe=e,e=a),e}function $t(){var e,n,r,u;return e=Pe,"year"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(ge)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="YEAR":(Pe=e,e=a)):(Pe=e,e=a),e}function zt(){var e,n,r,u;return e=Pe,"month"===t.substr(Pe,5).toLowerCase()?(n=t.substr(Pe,5),Pe+=5):(n=a,0===Ue&&He(ye)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="MONTH":(Pe=e,e=a)):(Pe=e,e=a),e}function Zt(){var e,n,r,u;return e=Pe,"day"===t.substr(Pe,3).toLowerCase()?(n=t.substr(Pe,3),Pe+=3):(n=a,0===Ue&&He(me)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="DAY":(Pe=e,e=a)):(Pe=e,e=a),e}function Xt(){var e,n,r,u;return e=Pe,"hour"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(_e)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="HOUR":(Pe=e,e=a)):(Pe=e,e=a),e}function en(){var e,n,r,u;return e=Pe,"minute"===t.substr(Pe,6).toLowerCase()?(n=t.substr(Pe,6),Pe+=6):(n=a,0===Ue&&He(be)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="MINUTE":(Pe=e,e=a)):(Pe=e,e=a),e}function tn(){var e,n,r,u;return e=Pe,"second"===t.substr(Pe,6).toLowerCase()?(n=t.substr(Pe,6),Pe+=6):(n=a,0===Ue&&He(we)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="SECOND":(Pe=e,e=a)):(Pe=e,e=a),e}function nn(){var e,n,r,u;return e=Pe,"case"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(Se)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="CASE":(Pe=e,e=a)):(Pe=e,e=a),e}function rn(){var e,n,r,u;return e=Pe,"end"===t.substr(Pe,3).toLowerCase()?(n=t.substr(Pe,3),Pe+=3):(n=a,0===Ue&&He(Ie)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="END":(Pe=e,e=a)):(Pe=e,e=a),e}function an(){var e,n,r,u;return e=Pe,"when"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(Oe)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="WHEN":(Pe=e,e=a)):(Pe=e,e=a),e}function un(){var e,n,r,u;return e=Pe,"then"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(Te)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="THEN":(Pe=e,e=a)):(Pe=e,e=a),e}function sn(){var e,n,r,u;return e=Pe,"else"===t.substr(Pe,4).toLowerCase()?(n=t.substr(Pe,4),Pe+=4):(n=a,0===Ue&&He(ke)),n!==a?(r=Pe,Ue++,u=it(),Ue--,u===a?r=void 0:(Pe=r,r=a),r!==a?e=n="ELSE":(Pe=e,e=a)):(Pe=e,e=a),e}function on(){var e;return 44===t.charCodeAt(Pe)?(e=",",Pe++):(e=a,0===Ue&&He(xe)),e}function ln(){var e;return 40===t.charCodeAt(Pe)?(e="(",Pe++):(e=a,0===Ue&&He(Ee)),e}function cn(){var e;return 41===t.charCodeAt(Pe)?(e=")",Pe++):(e=a,0===Ue&&He(Ae)),e}function fn(){var e,t;for(e=[],t=hn();t!==a;)e.push(t),t=hn();return e}function hn(){var e;return Ne.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=a,0===Ue&&He(Fe)),e}function pn(){var e,n,r,u;if(e=Pe,(n=at())!==a&&(n=n),(e=n)===a)if(e=Pe,96===t.charCodeAt(Pe)?(n="`",Pe++):(n=a,0===Ue&&He(je)),n!==a){if(r=[],Ce.test(t.charAt(Pe))?(u=t.charAt(Pe),Pe++):(u=a,0===Ue&&He(De)),u!==a)for(;u!==a;)r.push(u),Ce.test(t.charAt(Pe))?(u=t.charAt(Pe),Pe++):(u=a,0===Ue&&He(De));else r=a;r!==a?(96===t.charCodeAt(Pe)?(u="`",Pe++):(u=a,0===Ue&&He(je)),u!==a?e=n=function(e){return e.join("")}(r):(Pe=e,e=a)):(Pe=e,e=a)}else Pe=e,e=a;return e}function dn(e,t,n,r){var a={type:"binary_expr",operator:e,left:t,right:n};return void 0!==r&&(a.escape=r),a}function vn(e,t){for(var n=e,r=0;r<t.length;r++)n=dn(t[r][1],n,t[r][3]);return n}if((r=i())!==a&&Pe===t.length)return r;throw r!==a&&Pe<t.length&&He({type:"end"}),function(t,n,r){return new e(e.buildMessage(t,n),t,n,r)}(Le,Me<t.length?t.charAt(Me):null,Me<t.length?Je(Me,Me+1):Je(Me,Me))}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),e.buildMessage=function(e,t){var n={literal:function(e){return'"'+a(e.text)+'"'},class:function(e){var t,n="";for(t=0;t<e.parts.length;t++)n+=e.parts[t]instanceof Array?u(e.parts[t][0])+"-"+u(e.parts[t][1]):u(e.parts[t]);return"["+(e.inverted?"^":"")+n+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function u(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function i(e){return n[e.type](e)}return"Expected "+function(e){var t,n,r=new Array(e.length);for(t=0;t<e.length;t++)r[t]=i(e[t]);if(r.sort(),r.length>0){for(t=1,n=1;t<r.length;t++)r[t-1]!==r[t]&&(r[n]=r[t],n++);r.length=n}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1]}}(e)+" but "+function(e){return e?'"'+a(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:t}},(g=_).exports&&(g.exports=y());var b=function(){function e(){Object(u.a)(this,e)}return Object(i.a)(e,null,[{key:"parse",value:function(e){return _.exports.parse(e)}}]),e}();function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,u=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw u}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var I=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,O=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,T=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,k=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,x=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function E(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function A(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"0",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0",u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"0",i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"0",o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"0";if("+"===i||"-"===i){var l="".concat(E(parseInt(e,10),4),"-").concat(E(parseInt(t,10),2),"-").concat(E(parseInt(n,10),2)),c="";parseFloat(u)<10&&(c="0");var f="".concat(E(parseInt(r,10),2),":").concat(E(parseInt(a,10),2),":").concat(c+parseFloat(u).toString()),h="".concat(i).concat(E(parseInt(s,10),2),":").concat(E(parseInt(o,10),2));return new Date(l+"T"+f+h)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(n,10),parseInt(r,10),parseInt(a,10),parseFloat(u))}var N=function(){function e(){Object(u.a)(this,e)}return Object(i.a)(e,null,[{key:"makeBool",value:function(e){return D(e)}},{key:"featureValue",value:function(e,t,n,r){return q(e,t,n,r)}},{key:"equalsNull",value:function(e){return null===e}},{key:"applyLike",value:function(e,t,n){return G(e,t,n)}},{key:"ensureArray",value:function(e){return P(e)}},{key:"applyIn",value:function(e,t){return U(e,t)}},{key:"currentDate",value:function(){var e=new Date;return e.setHours(0,0,0,0),e}},{key:"makeSqlInterval",value:function(e,t,n){return d.createFromValueAndQualifer(e,t,n)}},{key:"convertInterval",value:function(e){return e instanceof d?e.valueInMilliseconds():e}},{key:"currentTimestamp",value:function(){return new Date}},{key:"compare",value:function(e,t,n){return Y(e,t,n)}},{key:"calculate",value:function(e,t,n){return H(e,t,n)}},{key:"makeComparable",value:function(e){return B(e)}},{key:"evaluateFunction",value:function(e,t){return v(e,t)}},{key:"lookup",value:function(e,t){var n=t[e];return void 0===n?null:n}},{key:"between",value:function(e,t){return null==e||null==t[0]||null==t[1]?null:e>=t[0]&&e<=t[1]}},{key:"notbetween",value:function(e,t){return null==e||null==t[0]||null==t[1]?null:e<t[0]||e>t[1]}},{key:"ternaryNot",value:function(e){return R(e)}},{key:"ternaryAnd",value:function(e,t){return M(e,t)}},{key:"ternaryOr",value:function(e,t){return L(e,t)}}]),e}(),F=function(){function e(t,n){Object(u.a)(this,e),this.fieldsIndex=n,this.datefields={},this.parameters={},this.parseTree=b.parse(t);var r=this.extractExpressionInfo(n),a=r.isStandardized,i=r.isAggregate,s=r.referencedFieldNames;this.referencedFieldNames=s,this.isStandardized=a,this.isAggregate=i}return Object(i.a)(e,[{key:"fieldNames",get:function(){return this.referencedFieldNames}},{key:"testSet",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W,r={},a=w(this.fieldNames);try{var u=function(){var a=t.value;r[a]=e.map((function(e){return n.getAttribute(e,a)}))};for(a.s();!(t=a.n()).done;)u()}catch(i){a.e(i)}finally{a.f()}return!!this.evaluateNode(this.parseTree,{attributes:r},W)}},{key:"calculateValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W,n=this.evaluateNode(this.parseTree,e,t);return n instanceof d?n.valueInMilliseconds()/864e5:n}},{key:"calculateValueCompiled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W;return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(s.a)("csp-restrictions")?this.calculateValue(e,t):(this.compileMe(),this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}},{key:"testFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W;return!!this.evaluateNode(this.parseTree,e,t)}},{key:"testFeatureCompiled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W;return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(s.a)("csp-restrictions")?this.testFeature(e,t):(this.compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}},{key:"getFunctions",value:function(){var e=[];return this.visitAll(this.parseTree,(function(t){"function"===t.type&&e.push(t.name.toLowerCase())})),J(e)}},{key:"getExpressions",value:function(){var e=new Map;return this.visitAll(this.parseTree,(function(t){if("function"===t.type){var n=t.name.toLowerCase(),r=t.args.value[0];if("column_ref"===r.type){var a=r.column,u="".concat(n,"-").concat(a);e.has(u)||e.set(u,{aggregateType:n,field:a})}}})),Object(a.a)(e.values())}},{key:"getVariables",value:function(){var e=[];return this.visitAll(this.parseTree,(function(t){"param"===t.type&&e.push(t.value.toLowerCase())})),J(e)}},{key:"compileMe",value:function(){var e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",e).bind(N)}},{key:"extractExpressionInfo",value:function(e){var t=this,n=[],r=!0,a=!0;return this.visitAll(this.parseTree,(function(u){switch(u.type){case"column_ref":var i=e.get(u.column),s=i&&i.name;!i||"date"!==i.type&&"esriFieldTypeDate"!==i.type||(t.datefields[i.name]=1),void 0!==s?(n.push(s),u.column=s):n.push(u.column);break;case"function":var o=u.name,l=u.args.value.length;r&&(r=function(e,t){var n=m[e.toLowerCase()];return null!=n&&t>=n.minParams&&t<=n.maxParams}(o,l)),a&&(a=function(e,t){var n=c[e.toLowerCase()];return null!=n&&t>=n.minParams&&t<=n.maxParams}(o,l))}})),{referencedFieldNames:J(n),isStandardized:r,isAggregate:a}}},{key:"visitAll",value:function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":var n,r=w(e.clauses);try{for(r.s();!(n=r.n()).done;){var a=n.value;this.visitAll(a,t)}}catch(o){r.e(o)}finally{r.f()}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":var u,i=w(e.value);try{for(i.s();!(u=i.n()).done;){var s=u.value;this.visitAll(s,t)}}catch(o){i.e(o)}finally{i.f()}break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}}},{key:"evaluateNodeToJavaScript",value:function(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case_expression":var t="";if("simple"===e.format){var n="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";t="( ";for(var r=0;r<e.clauses.length;r++)t+=" ("+n+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[r].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[r].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(var a=0;a<e.clauses.length;a++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[a].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[a].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t;case"param":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expr_list":var u,i="[",s=w(e.value);try{for(s.s();!(u=s.n()).done;){var o=u.value;"["!==i&&(i+=","),i+=this.evaluateNodeToJavaScript(o)}}catch(l){s.e(l)}finally{s.f()}return i+="]";case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary_expr":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+C(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+j(e.value).getTime().toString()+"))";case"current_time":return"date"===e.mode?"this.currentDate()":"this.currentTimestamp()";case"column_ref":return"this.featureValue(feature,"+JSON.stringify(e.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)}},{key:"evaluateNode",value:function(e,t,n){switch(e.type){case"interval":var r=this.evaluateNode(e.value,t,n);return d.createFromValueAndQualifer(r,e.qualifier,e.op);case"case_expression":if("simple"===e.format){for(var a=B(this.evaluateNode(e.operand,t,n)),u=0;u<e.clauses.length;u++)if(a===B(this.evaluateNode(e.clauses[u].operand,t,n)))return this.evaluateNode(e.clauses[u].value,t,n);if(null!==e.else)return this.evaluateNode(e.else,t,n)}else{for(var i=0;i<e.clauses.length;i++)if(D(this.evaluateNode(e.clauses[i].operand,t,n)))return this.evaluateNode(e.clauses[i].value,t,n);if(null!==e.else)return this.evaluateNode(e.else,t,n)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":var s,o=[],l=w(e.value);try{for(l.s();!(s=l.n()).done;){var f=s.value;o.push(this.evaluateNode(f,t,n))}}catch(I){l.e(I)}finally{l.f()}return o;case"unary_expr":return R(this.evaluateNode(e.expr,t,n));case"binary_expr":switch(e.operator){case"AND":return M(this.evaluateNode(e.left,t,n),this.evaluateNode(e.right,t,n));case"OR":return L(this.evaluateNode(e.left,t,n),this.evaluateNode(e.right,t,n));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t,n);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t,n);case"IN":var h=P(this.evaluateNode(e.right,t,n));return U(this.evaluateNode(e.left,t,n),h);case"NOT IN":var p=P(this.evaluateNode(e.right,t,n));return R(U(this.evaluateNode(e.left,t,n),p));case"BETWEEN":var g=this.evaluateNode(e.left,t,n),y=this.evaluateNode(e.right,t,n);return null==g||null==y[0]||null==y[1]?null:g>=B(y[0])&&g<=B(y[1]);case"NOTBETWEEN":var m=this.evaluateNode(e.left,t,n),_=this.evaluateNode(e.right,t,n);return null==m||null==_[0]||null==_[1]?null:m<B(_[0])||m>B(_[1]);case"LIKE":return G(this.evaluateNode(e.left,t,n),this.evaluateNode(e.right,t,n),e.escape);case"NOT LIKE":return R(G(this.evaluateNode(e.left,t,n),this.evaluateNode(e.right,t,n),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return Y(e.operator,this.evaluateNode(e.left,t,n),this.evaluateNode(e.right,t,n));case"-":case"+":case"*":case"/":return H(e.operator,this.evaluateNode(e.left,t,n),this.evaluateNode(e.right,t,n))}case"null":case"bool":case"string":case"number":return e.value;case"date":return C(e.value);case"timestamp":return j(e.value);case"current_time":var b=new Date;return"date"===e.mode&&b.setHours(0,0,0,0),b;case"column_ref":return q(t,e.column,this.datefields,n);case"function":var S=this.evaluateNode(e.args,t,n);return this.isAggregate?function(e,t){var n=c[e.toLowerCase()];if(null==n)throw new Error("Function Not Recognised");if(t.length<n.minParams||t.length>n.maxParams)throw new Error("Invalid Parameter count for call to ".concat(e.toUpperCase()));return n.evaluate(t)}(e.name,S):v(e.name,S)}throw new Error("Unsupported sql syntax "+e.type)}}],[{key:"create",value:function(t,n){return new e(t,n)}}]),e}();function j(e){var t=O.exec(e);if(null!==t){var n=t,a=Object(r.a)(n,7);return A(a[1],a[2],a[3],a[4],a[5],a[6])}if(null!==(t=T.exec(e))){var u=t,i=Object(r.a)(u,10);return A(i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9])}if(null!==(t=k.exec(e))){var s=t,o=Object(r.a)(s,9);return A(o[1],o[2],o[3],o[4],o[5],"0",o[6],o[7],o[8])}if(null!==(t=x.exec(e))){var l=t,c=Object(r.a)(l,6);return A(c[1],c[2],c[3],c[4],c[5])}if(null!==(t=I.exec(e))){var f=t,h=Object(r.a)(f,4);return A(h[1],h[2],h[3])}throw new Error("SQL Invalid Timestamp")}function C(e){var t=I.exec(e);if(null===t)throw new Error("SQL Invalid Date");var n=Object(r.a)(t,4),a=n[1],u=n[2],i=n[3];return new Date(parseInt(a,10),parseInt(u,10)-1,parseInt(i,10))}function D(e){return!0===e}function P(e){return Array.isArray(e)?e:[e]}function R(e){return null!==e?!0!==e:null}function M(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function L(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function U(e,t){if(null==e)return null;var n,r=!1,a=w(t);try{for(a.s();!(n=a.n()).done;){var u=n.value;if(null==u)r=null;else if(e===u){r=!0;break}}}catch(i){a.e(i)}finally{a.f()}return r}function G(e,t,n){if(null==e)return null;for(var r=t,a=n,u="",i="-[]/{}()*+?.\\^$|",s=0,o=0;o<r.length;o++){var l=r.charAt(o);switch(s){case 0:l===a?s=1:i.indexOf(l)>=0?u+="\\"+l:u+="%"===l?".*":"_"===l?".":l;break;case 1:i.indexOf(l)>=0?u+="\\"+l:u+=l,s=0}}return new RegExp("^"+u+"$").test(e)}function B(e){return e instanceof Date?e.valueOf():e}function Y(e,t,n){if(null==t||null==n)return null;var r=B(t),a=B(n);switch(e){case"<>":return r!==a;case"=":return r===a;case">":return r>a;case"<":return r<a;case">=":return r>=a;case"<=":return r<=a}}function J(e){var t,n=[],r={},a=w(e);try{for(a.s();!(t=a.n()).done;){var u=t.value,i=u.toLowerCase();void 0===r[i]&&(n.push(u),r[i]=1)}}catch(s){a.e(s)}finally{a.f()}return n}function H(e,t,n){if(t instanceof d)if(n instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+n.getTime());case"-":return t.valueInMilliseconds()-n.getTime();case"*":return t.valueInMilliseconds()*n.getTime();case"/":return t.valueInMilliseconds()/n.getTime()}else if(n instanceof d)switch(e){case"+":return d.createFromMilliseconds(t.valueInMilliseconds()+n.valueInMilliseconds());case"-":return d.createFromMilliseconds(t.valueInMilliseconds()-n.valueInMilliseconds());case"*":return t.valueInMilliseconds()*n.valueInMilliseconds();case"/":return t.valueInMilliseconds()/n.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(n instanceof d)if(t instanceof Date)switch(e){case"+":return new Date(n.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-n.valueInMilliseconds());case"*":return t.getTime()*n.valueInMilliseconds();case"/":return t.getTime()/n.valueInMilliseconds()}else n=n.valueInMilliseconds();else if(t instanceof Date&&"number"==typeof n)switch(n=24*n*60*60*1e3,t=t.getTime(),e){case"+":return new Date(t+n);case"-":return new Date(t-n);case"*":return new Date(t*n);case"/":return new Date(t/n)}else if(n instanceof Date&&"number"==typeof t)switch(t=24*t*60*60*1e3,n=n.getTime(),e){case"+":return new Date(t+n);case"-":return new Date(t-n);case"*":return new Date(t*n);case"/":return new Date(t/n)}switch(e){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":return t/n}}function q(e,t,n,r){var a=r.getAttribute(e,t);return null!=a&&1===n[t]?new Date(a):a}var W={getAttribute:function(e,t){return(function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e)[t]}}}}]);
//# sourceMappingURL=51-22231981d3cc64c1a805.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{A5ju:function(e,t,i){"use strict";i.r(t);var n=i("6CzD"),a=i("mK0O"),r=i("eijD"),s=i("aNYv"),o=i("yBJb"),l=i("CHlC"),c=i("kMo5"),u=i("P+uj"),h=i("hisu"),p=i("NthX"),f=i.n(p),b=i("dQW7"),y=i("g+AA"),d=i("DGz/"),v=i("kDog"),w=i("UfAV"),m=i("7im+"),g=i("z9dv"),_=i("xAIp"),V=(i("J4Pc"),i("wckI"),i("TM+E"),i("iaHD")),O=i("nd5+"),k=i("B9Yk"),j=i("YHXj"),x=i("3p7a"),S=i("Ym0J"),P=i("/xo8"),I=i("KmCB"),C=i("Jrv3"),M=i("FXVW"),D=i("55C+"),A=i("F0Fd"),U=i("KA0i"),L=i("bPf0");function T(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function R(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?T(Object(i),!0).forEach((function(t){Object(a.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):T(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function E(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return F(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,r=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=Object(u.a)(e);if(t){var a=Object(u.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(c.a)(this,i)}}var J=function e(){Object(h.a)(this,e),this.allSublayers=new Map,this.allPoints=[],this.allPolylines=[],this.allPolygons=[],this.allMapImages=[]},W=function(e){Object(l.a)(c,e);var t,i,a=q(c);function c(){var e;return Object(h.a)(this,c),(e=a.apply(this,arguments))._handles=new w.a,e._bitmapIndex=new Map,e._mapImageContainer=new M.a,e._kmlVisualData=new J,e.allVisiblePoints=new I.a,e.allVisiblePolylines=new I.a,e.allVisiblePolygons=new I.a,e.allVisibleMapImages=new v.a,e}return Object(o.a)(c,[{key:"hitTest",value:function(e,t){var i=this;if(this.suspended||!this._pointsView&&!this._polylinesView&&!this._polygonsView)return Promise.resolve(null);var n=[this._pointsView.hitTest(e,t),this._polylinesView.hitTest(e,t),this._polygonsView.hitTest(e,t)];return Promise.all(n).then((function(e){return e.filter((function(e){return e&&(e.layer=i.layer,e.sourceLayer=i.layer),!!e}))[0]||null}))}},{key:"update",value:function(e){this._polygonsView&&this._polygonsView.processUpdate(e),this._polylinesView&&this._polylinesView.processUpdate(e),this._pointsView&&this._pointsView.processUpdate(e)}},{key:"attach",value:function(){var e=this;this._handles.add([this.allVisibleMapImages.on("change",(function(t){t.added.forEach((function(t){return e._addMapImage(t)})),t.removed.forEach((function(t){return e._removeMapImage(t)}))}))]),this.container.addChild(this._mapImageContainer),this._polygonsView=new U.a({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:function(){return e.requestUpdate()},container:new A.a(this.view.featuresTilingScheme)}),this.container.addChild(this._polygonsView.container),this._polylinesView=new U.a({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:function(){return e.requestUpdate()},container:new A.a(this.view.featuresTilingScheme)}),this.container.addChild(this._polylinesView.container),this._pointsView=new U.a({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:function(){return e.requestUpdate()},container:new A.a(this.view.featuresTilingScheme)}),this.container.addChild(this._pointsView.container),this.watch("layer.visibleSublayers",(function(t){var i,n=E(e._kmlVisualData.allSublayers);try{for(n.s();!(i=n.n()).done;){var a=Object(s.a)(i.value,2);a[0];a[1].visibility=0}}catch(u){n.e(u)}finally{n.f()}var r,o=E(t);try{for(o.s();!(r=o.n()).done;){var l=r.value,c=e._kmlVisualData.allSublayers.get(l.id);c&&(c.visibility=1)}}catch(u){o.e(u)}finally{o.f()}e._refreshCollections()})),this._fetchingPromise=this._fetchService().then((function(){e._fetchingPromise=null,e.notifyChange("updating")}))}},{key:"detach",value:function(){this._handles.removeAll(),this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView&&(this._polygonsView.destroy(),this._polygonsView=null),this._polylinesView&&(this._polylinesView.destroy(),this._polylinesView=null),this._pointsView&&(this._pointsView.destroy(),this._pointsView=null)}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()}},{key:"moveEnd",value:function(){}},{key:"isUpdating",value:function(){return null!=this._fetchingPromise||this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating}},{key:"_addMapImage",value:function(e){var t=this;(this.view.spatialReference.isWGS84||this.view.spatialReference.isWebMercator)&&Object(d.default)(e.href,{responseType:"image"}).then((function(i){var n=i.data,a=O.a.fromJSON(e.extent);Object(x.a)(a,t.view.spatialReference)&&(a=Object(x.d)(a,t.view.spatialReference));var r=new C.a(n,"standard");r.x=a.xmin,r.y=a.ymax,r.resolution=a.width/n.naturalWidth,r.rotation=e.rotation,t._mapImageContainer.addChild(r),t._bitmapIndex.set(e,r)}))}},{key:"_getViewDependentUrl",value:(i=Object(r.a)(f.a.mark((function e(t,i){var n,a,r,s,o,l,c,u,h,p,b,d,v,w,_,V,x,S;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.viewFormat,a=t.viewBoundScale,r=t.httpQuery,!Object(m.i)(n)){e.next=20;break}if(!Object(m.h)(i)){e.next=4;break}throw new Error("Loading this network link requires a view state.");case 4:return e.next=6,Object(k.h)();case 6:if(!Object(m.i)(a)||1===a){e.next=11;break}(o=new O.a(i.extent)).expand(a),s=o,e.next=12;break;case 11:s=i.extent;case 12:return s=Object(k.i)(s,j.a.WGS84),l=Object(k.i)(s,j.a.WebMercator),c=s.xmin,u=s.xmax,h=s.ymin,p=s.ymax,b=i.size[0]*i.pixelRatio,d=i.size[1]*i.pixelRatio,v=Math.max(l.width,l.height),w={"[bboxWest]":c.toString(),"[bboxEast]":u.toString(),"[bboxSouth]":h.toString(),"[bboxNorth]":p.toString(),"[lookatLon]":s.center.x.toString(),"[lookatLat]":s.center.y.toString(),"[lookatRange]":v.toString(),"[lookatTilt]":"0","[lookatHeading]":i.rotation.toString(),"[lookatTerrainLon]":s.center.x.toString(),"[lookatTerrainLat]":s.center.y.toString(),"[lookatTerrainAlt]":"0","[cameraLon]":s.center.x.toString(),"[cameraLat]":s.center.y.toString(),"[cameraAlt]":v.toString(),"[horizFov]":"60","[vertFov]":"60","[horizPixels]":b.toString(),"[vertPixels]":d.toString(),"[terrainEnabled]":"0","[clientVersion]":y.d,"[kmlVersion]":"2.2","[clientName]":"ArcGIS API for JavaScript","[language]":"en-US"},_=function(e){for(var t in e)for(var i in w)e[t]=e[t].replace(i,w[i])},V=Object(g.F)(n),_(V),x={},Object(m.i)(r)&&(x=Object(g.F)(r),_(x)),(S=Object(P.c)(t.href)).query=R(R(R({},S.query),V),x),e.abrupt("return","".concat(S.path,"?").concat(Object(g.E)(V)));case 20:return e.abrupt("return",t.href);case 21:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"_fetchService",value:(t=Object(r.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new J,e.next=3,this._loadVisualData(this.layer.url,t);case 3:this._kmlVisualData=t,this._refreshCollections();case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_refreshCollections",value:function(){var e=this;this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),this.allVisiblePoints.addMany(this._kmlVisualData.allPoints.filter((function(t){return e._isSublayerVisible(t.sublayerId)})).map((function(e){return e.item}))),this.allVisiblePolylines.addMany(this._kmlVisualData.allPolylines.filter((function(t){return e._isSublayerVisible(t.sublayerId)})).map((function(e){return e.item}))),this.allVisiblePolygons.addMany(this._kmlVisualData.allPolygons.filter((function(t){return e._isSublayerVisible(t.sublayerId)})).map((function(e){return e.item}))),this.allVisibleMapImages.addMany(this._kmlVisualData.allMapImages.filter((function(t){return e._isSublayerVisible(t.sublayerId)})).map((function(e){return e.item})))}},{key:"_isSublayerVisible",value:function(e){var t=this._kmlVisualData.allSublayers.get(e);return!!t.visibility&&(-1===t.parentFolderId||this._isSublayerVisible(t.parentFolderId))}},{key:"_loadVisualData",value:function(e,t){var i=this;return this._fetchParsedKML(e).then(function(){var e=Object(r.a)(f.a.mark((function e(a){var r,s,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=E(a.sublayers),e.prev=1,o=f.a.mark((function e(){var a,r,o,l,c,u,h,p,b,y;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=s.value,t.allSublayers.set(c.id,c),!c.points){e.next=8;break}return e.next=5,Object(S.c)(c.points);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=[];case 9:if(u=e.t0,!c.polylines){e.next=16;break}return e.next=13,Object(S.c)(c.polylines);case 13:e.t1=e.sent,e.next=17;break;case 16:e.t1=[];case 17:if(h=e.t1,!c.polygons){e.next=24;break}return e.next=21,Object(S.c)(c.polygons);case 21:e.t2=e.sent,e.next=25;break;case 24:e.t2=[];case 25:if(p=e.t2,b=c.mapImages||[],(a=t.allPoints).push.apply(a,Object(n.a)(u.map((function(e){return{item:e,sublayerId:c.id}})))),(r=t.allPolylines).push.apply(r,Object(n.a)(h.map((function(e){return{item:e,sublayerId:c.id}})))),(o=t.allPolygons).push.apply(o,Object(n.a)(p.map((function(e){return{item:e,sublayerId:c.id}})))),(l=t.allMapImages).push.apply(l,Object(n.a)(b.map((function(e){return{item:e,sublayerId:c.id}})))),!c.networkLink){e.next=33;break}return e.next=30,i._getViewDependentUrl(c.networkLink,i.view.state);case 30:return y=e.sent,e.next=33,i._loadVisualData(y,t);case 33:case"end":return e.stop()}}),e)})),r.s();case 4:if((s=r.n()).done){e.next=8;break}return e.delegateYield(o(),"t0",6);case 6:e.next=4;break;case 8:e.next=13;break;case 10:e.prev=10,e.t1=e.catch(1),r.e(e.t1);case 13:return e.prev=13,r.f(),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,10,13,16]])})));return function(t){return e.apply(this,arguments)}}())}},{key:"_fetchParsedKML",value:function(e){return Object(S.b)(e,this.view.spatialReference,this.layer.refreshInterval).then((function(e){return Object(S.d)(e.data)}))}},{key:"_removeMapImage",value:function(e){var t=this._bitmapIndex.get(e);t&&(this._mapImageContainer.removeChild(t),this._bitmapIndex.delete(e))}}]),c}(Object(D.a)(L.a));Object(b.a)([Object(_.b)()],W.prototype,"_pointsView",void 0),Object(b.a)([Object(_.b)()],W.prototype,"_polylinesView",void 0),Object(b.a)([Object(_.b)()],W.prototype,"_polygonsView",void 0),Object(b.a)([Object(_.b)()],W.prototype,"_fetchingPromise",void 0),Object(b.a)([Object(_.b)()],W.prototype,"updating",void 0);var z=W=Object(b.a)([Object(V.a)("esri.views.2d.layers.KMLLayerView2D")],W);t.default=z}}]);
//# sourceMappingURL=160-4ec7edc92c5e03e683d1.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{"7f4O":function(e,t,r){"use strict";r.d(t,"a",(function(){return J}));var a=r("eijD"),i=r("mK0O"),n=r("hisu"),l=r("yBJb"),o=r("CHlC"),c=r("kMo5"),s=r("P+uj"),u=r("NthX"),p=r.n(u),f=r("dQW7"),h=r("DGz/"),v=r("hZBP"),b=r("Mp7X"),y=r("UfAV"),d=r("TM+E"),O=r("tajk"),j=r("DVFM"),m=r("IH5m"),g=r("+JF/"),w=r("z9dv"),_=r("j56I"),k=r("xAIp"),S=(r("J4Pc"),r("gljZ")),P=r("iaHD"),T=r("X6u8"),D=r("0fJP");function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var z=function(){function e(){Object(n.a)(this,e),this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return Object(l.a)(e,[{key:"getAvailability",value:function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var r=(e-this.location.top)*this.location.width+(t-this.location.left),a=r%8,i=r>>3,n=this._tileAvailabilityBitSet;return i<0||i>n.length?"unknown":n[i]&1<<a?"available":"unavailable"}},{key:"_updateFromData",value:function(e){for(var t=this.location.width,r=this.location.height,a=!0,i=!0,n=Math.ceil(t*r/8),l=new Uint8Array(n),o=0,c=0;c<e.length;c++){var s=c%8;e[c]?(i=!1,l[o]|=1<<s):a=!1,7===s&&++o}i?this._allAvailability="unavailable":a?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=l,this.byteSize+=l.length)}}],[{key:"fromDefinition",value:function(t,r){var a=t.service.request||h.default,i=t.row,n=t.col,l=t.width,o=t.height,c={query:{f:"json"}};return r=r?R(R({},c),r):c,a(function(e){var t;if("vector-tile"===e.service.type)t="".concat(e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height);else{var r=e.service.tileServers;t="".concat(r&&r.length?r[e.row%r.length]:e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var a=e.service.query;return a&&(t="".concat(t,"?").concat(a)),t}(t),r).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:i,left:n,width:l,height:o},valid:!0,data:Object(T.b)(l*o,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==i||t.location.left!==n||t.location.width!==l||t.location.height!==o))throw new b.a("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:i,left:n,width:l,height:o}});return e.fromJSON(t)}))}},{key:"fromJSON",value:function(t){e.validateJSON(t);var r=new e;return r.location=Object.freeze(Object(D.a)(t.location)),r._updateFromData(t.data),Object.freeze(r)}},{key:"validateJSON",value:function(e){if(!e||!e.location)throw new b.a("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new b.a("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new b.a("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new b.a("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new b.a("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}]),e}();function L(e){return"".concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var C;function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=Object(s.a)(e);if(t){var i=Object(s.a)(this).constructor;r=Reflect.construct(a,arguments,i)}else r=a.apply(this,arguments);return Object(c.a)(this,r)}}var E=d.a.getLogger("esri.layers.support.TilemapCache"),J=C=function(e){Object(o.a)(i,e);var t,r=I(i);function i(e){var t;return Object(n.a)(this,i),(t=r.call(this,e))._handles=new y.a,t._pendingTilemapRequests={},t._availableLevels={},t.levels=5,t.cacheByteSize=2097152,t.request=h.default,t._prefetchingEnabled=!0,t}return Object(l.a)(i,[{key:"initialize",value:function(){var e=this;this._tilemapCache=new O.a(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(function(){return e._initializeTilemapDefinition()})),Object(_.a)(this,"layer.tileInfo.lods",(function(t){return e._initializeAvailableLevels(t)}),!0)]),this._initializeTilemapDefinition()}},{key:"destroy",value:function(){this._handles&&(this._handles.destroy(),this._handles=null)}},{key:"castLevels",value:function(e){return e<=2?(E.error("Minimum levels for Tilemap is 3, but got ",e),3):e}},{key:"size",get:function(){return 1<<this.levels}},{key:"fetchTilemap",value:function(e,t,r,a){var i=this;if(!this._availableLevels[e])return Promise.reject(new b.a("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")));var n=this._tmpTilemapDefinition,l=this._tilemapFromCache(e,t,r,n);if(l)return Promise.resolve(l);var o=a&&a.signal;return a=U(U({},a),{},{signal:null}),new Promise((function(e,t){Object(m.q)(o,(function(){return t(Object(m.e)())}));var r=L(n),l=i._pendingTilemapRequests[r];if(!l){l=z.fromDefinition(n,a).then((function(e){return i._tilemapCache.put(r,e,e.byteSize),e}));var c=function(){return delete i._pendingTilemapRequests[r]};i._pendingTilemapRequests[r]=l,l.then(c,c)}l.then(e,t)}))}},{key:"getAvailability",value:function(e,t,r){if(!this._availableLevels[e])return"unavailable";var a=this._tilemapFromCache(e,t,r,this._tmpTilemapDefinition);return a?a.getAvailability(t,r):"unknown"}},{key:"getAvailabilityUpsample",value:function(e,t,r,a){a.level=e,a.row=t,a.col=r;var i=this.layer.tileInfo;for(i.updateTileInfo(a);;){var n=this.getAvailability(a.level,a.row,a.col);if("unavailable"!==n)return n;if(!i.upsampleTile(a))return"unavailable"}}},{key:"fetchAvailability",value:function(e,t,r,a){return this._availableLevels[e]?this.fetchTilemap(e,t,r,a).catch((function(e){return e})).then((function(a){if(a instanceof z){var i=a.getAvailability(t,r);return"unavailable"===i?Promise.reject(new b.a("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:r})):i}if(Object(m.m)(a))throw a;return"unknown"})):Promise.reject(new b.a("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")))}},{key:"fetchAvailabilityUpsample",value:function(e,t,r,a,i){var n=this;a.level=e,a.row=t,a.col=r;var l=this.layer.tileInfo;l.updateTileInfo(a);var o=this.fetchAvailability(e,t,r,i).catch((function(e){if(Object(m.m)(e))throw e;if(l.upsampleTile(a))return n.fetchAvailabilityUpsample(a.level,a.row,a.col,a);throw e}));return this._fetchAvailabilityUpsamplePrefetch(a.id,e,t,r,i,o),o}},{key:"_fetchAvailabilityUpsamplePrefetch",value:(t=Object(a.a)(p.a.mark((function e(t,r,a,i,n,l){var o,c,s,u,f,h,v,b,y,d=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._prefetchingEnabled){e.next=2;break}return e.abrupt("return");case 2:if(o="prefetch-".concat(t),!this._handles.has(o)){e.next=5;break}return e.abrupt("return");case 5:return c=Object(m.d)(),l.then((function(){return c.abort()}),(function(){return c.abort()})),s=!1,u={remove:function(){s||(s=!0,c.abort())}},this._handles.add(u,o),e.next=12,Object(g.c)(10,c.signal).catch((function(){}));case 12:if(s||(s=!0,this._handles.remove(o)),!Object(m.n)(c)){e.next=15;break}return e.abrupt("return");case 15:for(f={id:t,level:r,row:a,col:i},h=U(U({},n),{},{signal:c.signal}),v=this.layer.tileInfo,b=function(e){var t=d.fetchAvailability(f.level,f.row,f.col,h);C._prefetches.push(t);var r=function(){C._prefetches.removeUnordered(t)};t.then(r,r)},y=0;C._prefetches.length<C._maxPrefetch&&v.upsampleTile(f);++y)b();case 18:case"end":return e.stop()}}),e,this)}))),function(e,r,a,i,n,l){return t.apply(this,arguments)})},{key:"_initializeTilemapDefinition",value:function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?Object(w.E)(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}}},{key:"_tilemapFromCache",value:function(e,t,r,a){a.level=e,a.row=t-t%this.size,a.col=r-r%this.size;var i=L(a);return this._tilemapCache.get(i)}},{key:"_initializeAvailableLevels",value:function(e){var t=this;this._availableLevels={},e&&e.forEach((function(e){return t._availableLevels[e.level]=!0}))}},{key:"test",get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,r,a){return!!e._tilemapFromCache(t,r,a,e._tmpTilemapDefinition)}}}}]),i}(v.a);J._maxPrefetch=4,J._prefetches=new j.a({initialSize:C._maxPrefetch}),Object(f.a)([Object(k.b)({constructOnly:!0,type:Number})],J.prototype,"levels",void 0),Object(f.a)([Object(S.a)("levels")],J.prototype,"castLevels",null),Object(f.a)([Object(k.b)({readOnly:!0,type:Number})],J.prototype,"size",null),Object(f.a)([Object(k.b)({constructOnly:!0,type:Number})],J.prototype,"cacheByteSize",void 0),Object(f.a)([Object(k.b)({constructOnly:!0})],J.prototype,"layer",void 0),Object(f.a)([Object(k.b)({constructOnly:!0})],J.prototype,"request",void 0),J=C=Object(f.a)([Object(P.a)("esri.layers.support.TilemapCache")],J)},Mcxe:function(e,t,r){"use strict";r.r(t);var a=r("mK0O"),i=r("hisu"),n=r("yBJb"),l=r("CHlC"),o=r("kMo5"),c=r("P+uj"),s=r("dQW7"),u=(r("ZTBZ"),r("DGz/")),p=r("Mp7X"),f=r("FYmP"),h=r("7im+"),v=r("d4jZ"),b=r("IH5m"),y=r("z9dv"),d=r("xAIp"),O=(r("J4Pc"),r("gljZ")),j=(r("TM+E"),r("mp5+")),m=r("iaHD"),g=r("jr4m"),w=r("QZQ7"),_=r("jZIy"),k=r("SDdS"),S=r("OhoG"),P=r("1eRv"),T=r("9P7x"),D=r("xuB6"),A=r("oTsO"),R=r("44so"),z=r("2eXi"),L=r("wJzb"),C=r("YgI4"),B=r("/BCw"),U=r("NRoO"),I=r("1XGP"),E=r("YHXj");function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=Object(c.a)(e);if(t){var i=Object(c.a)(this).constructor;r=Reflect.construct(a,arguments,i)}else r=a.apply(this,arguments);return Object(o.a)(this,r)}}var M=["Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Elevation/World_Hillshade","Elevation/World_Hillshade_Dark","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Ocean_Basemap","Reference/World_Boundaries_and_Places","Reference/World_Boundaries_and_Places_Alternate","Reference/World_Transportation","World_Imagery","World_Street_Map","World_Topo_Map"],x=function(e){Object(l.a)(r,e);var t=N(r);function r(){var e;Object(i.a)(this,r);for(var a=arguments.length,n=new Array(a),l=0;l<a;l++)n[l]=arguments[l];return(e=t.call.apply(t,[this].concat(n))).listMode="show",e.isReference=null,e.operationalLayerType="ArcGISTiledMapServiceLayer",e.resampling=!0,e.sourceJSON=null,e.spatialReference=null,e.path=null,e.sublayers=null,e.type="tile",e.url=null,e}return Object(n.a)(r,[{key:"normalizeCtorArgs",value:function(e,t){return"string"==typeof e?q({url:e},t):e}},{key:"load",value:function(e){var t=this,r=Object(h.i)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(b.u).then((function(){return t._fetchService(r)}))),Promise.resolve(this)}},{key:"attributionDataUrl",get:function(){var e,t=null==(e=this.parsedUrl)?void 0:e.path.toLowerCase();return t&&this._getDefaultAttribution(this._getMapName(t))}},{key:"readSpatialReference",value:function(e,t){return(e=e||t.tileInfo&&t.tileInfo.spatialReference)&&E.a.fromJSON(e)}},{key:"writeSublayers",value:function(e,t,r,a){if(this.loaded&&e){var i=e.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).toArray(),n=[],l=q({writeSublayerStructure:!1},a);i.forEach((function(e){var t=e.write({},l);n.push(t)})),n.some((function(e){return Object.keys(e).length>1}))&&(t.layers=n)}}},{key:"tileServers",get:function(){return this._getDefaultTileServers(this.parsedUrl.path)}},{key:"castTileServers",value:function(e){return Array.isArray(e)?e.map((function(e){return Object(y.K)(e).path})):null}},{key:"fetchTile",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=a.signal,n=a.timestamp,l=this.getTileUrl(e,t,r),o={responseType:"image",signal:i};return null!=n&&(o.query={_ts:a.timestamp}),Object(u.default)(l,o).then((function(e){return e.data}))}},{key:"getTileUrl",value:function(e,t,r){var a=!this.tilemapCache&&this.supportsBlankTile,i=Object(y.E)(q(q(q({},this.parsedUrl.query),{},{blankTile:!a&&null},this.customParameters),{},{token:this.apiKey})),n=this.tileServers;return"".concat(n&&n.length?n[t%n.length]:this.parsedUrl.path,"/tile/").concat(e,"/").concat(t,"/").concat(r).concat(i?"?"+i:"")}},{key:"_fetchService",value:function(e){var t=this;return new Promise((function(r,a){if(t.sourceJSON){if(null!=t.sourceJSON.bandCount&&null!=t.sourceJSON.pixelSizeX)throw new p.a("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");r({data:t.sourceJSON})}else{if(!t.parsedUrl)throw new p.a("tile-layer:undefined-url","layer's url is not defined");var i=Object(B.f)(t.parsedUrl.path);if(Object(h.i)(i)&&"ImageServer"===i.serverType)throw new p.a("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");Object(u.default)(t.parsedUrl.path,{query:q(q(q({f:"json"},t.parsedUrl.query),t.customParameters),{},{token:t.apiKey}),responseType:"json",signal:e}).then(r,a)}})).then((function(r){if(r.ssl&&(t.url=t.url.replace(/^http:/i,"https:")),t.sourceJSON=r.data,t.read(r.data,{origin:"service",url:t.parsedUrl}),10.1===t.version&&!Object(B.c)(t.url))return t._fetchServerVersion(t.url,e).then((function(e){t.read({currentVersion:e})})).catch((function(){}))}))}},{key:"_fetchServerVersion",value:function(e,t){if(!Object(B.b)(e))return Promise.reject();var r=e.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return Object(u.default)(r,{query:q(q({f:"json"},this.customParameters),{},{token:this.apiKey}),responseType:"json",signal:t}).then((function(e){if(e.data&&e.data.currentVersion)return e.data.currentVersion;throw new p.a("tile-layer:version-not-available")}))}},{key:"_getMapName",value:function(e){var t=e.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i);return t&&t[2]}},{key:"_getDefaultAttribution",value:function(e){if(e){var t;e=e.toLowerCase();for(var r=0,a=M.length;r<a;r++)if((t=M[r]).toLowerCase().indexOf(e)>-1)return Object(y.A)("//static.arcgis.com/attribution/"+t)}}},{key:"_getDefaultTileServers",value:function(e){var t=-1!==e.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),r=-1!==e.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return t||r?[e,e.replace(t?/server\.arcgisonline/i:/services\.arcgisonline/i,t?"services.arcgisonline":"server.arcgisonline")]:[]}},{key:"hasOverriddenFetchTile",get:function(){return!this.fetchTile.__isDefault__}}]),r}(Object(T.a)(Object(C.a)(Object(L.a)(Object(z.a)(Object(A.a)(Object(R.a)(Object(k.a)(Object(S.a)(Object(P.a)(Object(v.a)(Object(f.b)(Object(_.a)(Object(D.a)(w.a))))))))))))));Object(s.a)([Object(d.b)({readOnly:!0})],x.prototype,"attributionDataUrl",null),Object(s.a)([Object(d.b)({type:["show","hide","hide-children"]})],x.prototype,"listMode",void 0),Object(s.a)([Object(d.b)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],x.prototype,"isReference",void 0),Object(s.a)([Object(d.b)({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],x.prototype,"operationalLayerType",void 0),Object(s.a)([Object(d.b)({type:Boolean})],x.prototype,"resampling",void 0),Object(s.a)([Object(d.b)()],x.prototype,"sourceJSON",void 0),Object(s.a)([Object(d.b)({type:E.a})],x.prototype,"spatialReference",void 0),Object(s.a)([Object(j.a)("spatialReference",["spatialReference","tileInfo"])],x.prototype,"readSpatialReference",null),Object(s.a)([Object(d.b)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],x.prototype,"path",void 0),Object(s.a)([Object(d.b)({readOnly:!0})],x.prototype,"sublayers",void 0),Object(s.a)([Object(g.a)("sublayers",{layers:{type:[I.a]}})],x.prototype,"writeSublayers",null),Object(s.a)([Object(d.b)({json:{read:!1,write:!1}})],x.prototype,"popupEnabled",void 0),Object(s.a)([Object(d.b)()],x.prototype,"tileServers",null),Object(s.a)([Object(O.a)("tileServers")],x.prototype,"castTileServers",null),Object(s.a)([Object(d.b)({readOnly:!0,json:{read:!1}})],x.prototype,"type",void 0),Object(s.a)([Object(d.b)(U.n)],x.prototype,"url",void 0),(x=Object(s.a)([Object(m.a)("esri.layers.TileLayer")],x)).prototype.fetchTile.__isDefault__=!0;var W=x;t.default=W}}]);
//# sourceMappingURL=67-e89e2ff0623543528155.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{v8b1:function(e,t,r){"use strict";r.r(t),r.d(t,"Stage",(function(){return Mn})),r.d(t,"LabelManager",(function(){return Xn})),r.d(t,"GraphicsView2D",(function(){return Jn.a})),r.d(t,"GraphicContainer",(function(){return $n.a})),r.d(t,"MapViewNavigation",(function(){return Li})),r.d(t,"MagnifierView2D",(function(){return Ki}));var n=r("mK0O"),i=r("eijD"),a=r("hisu"),o=r("yBJb"),s=r("0942"),u=r("4Mpa"),c=r("CHlC"),l=r("kMo5"),h=r("P+uj"),f=r("NthX"),d=r.n(f),p=r("Mp7X"),v=r("A0wW"),m=r("J4Pc"),g=r("+JF/"),_=r("j56I"),y=r("p0eS"),b=r("NO3b"),w=r("fHEz"),x=r("EOw0"),O=r("MJqN"),k=r("a1c8"),j=r("iwTS"),C=(r("B2Uc"),r("cY28")),M=(r("IxxH"),r("j92Z")),S=r("0fR5"),T=r("H8zE"),R=r("1zU3"),P=r("x8wo"),F=r("FNqF"),I=r("7im+"),A=r("oBxC"),D=r("gj5F"),B=r("eHo5"),z=r("k0fz"),E={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = mod(v_accumulatedDistance / v_patternSize.x, 1.0);\nmediump float relativeTexY = 0.5 + (v_normal.y * v_lineHalfWidth / v_patternSize.y);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float lineHalfWidth = v_lineHalfWidth - 0.5 * u_antialiasing;\nmediump float lineWidthRatio = lineHalfWidth / sdfPatternHalfWidth;\nmediump float relativeTexX = mod((v_accumulatedDistance * 0.5) / (lineWidthRatio * v_patternSize.x), 1.0);\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * lineHalfWidth;\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}};var U=new z.a((function(e){var t=E;return e.split("/").forEach((function(e){t&&(t=t[e])})),t}));function L(e){return U.resolveIncludes(e)}var V=function(e){return Object(M.b)({ID:e.id,PATTERN:e.pattern})},N={shaders:function(e){return{vertexShader:V(e)+L("background/background.vert"),fragmentShader:V(e)+L("background/background.frag")}}},H=function(e){return Object(M.b)({ID:e.id})},q={shaders:function(e){return{vertexShader:H(e)+L("circle/circle.vert"),fragmentShader:H(e)+L("circle/circle.frag")}}},W=function(e){return Object(M.b)({ID:e.id,PATTERN:e.pattern})},G={shaders:function(e){return{vertexShader:W(e)+L("fill/fill.vert"),fragmentShader:W(e)+L("fill/fill.frag")}}},Z=function(e){return Object(M.b)({ID:e.id})},Y={shaders:function(e){return{vertexShader:Z(e)+L("outline/outline.vert"),fragmentShader:Z(e)+L("outline/outline.frag")}}},K=function(e){return Object(M.b)({ID:e.id,SDF:e.sdf})},X={shaders:function(e){return{vertexShader:K(e)+L("icon/icon.vert"),fragmentShader:K(e)+L("icon/icon.frag")}}},J=function(e){return Object(M.b)({ID:e.id,PATTERN:e.pattern,SDF:e.sdf})},$={shaders:function(e){return{vertexShader:J(e)+L("line/line.vert"),fragmentShader:J(e)+L("line/line.frag")}}},Q=function(e){return Object(M.b)({ID:e.id})},ee={shaders:function(e){return{vertexShader:Q(e)+L("text/text.vert"),fragmentShader:Q(e)+L("text/text.frag")}}},te=function(){function e(){Object(a.a)(this,e),this._programByKey=new Map}return Object(o.a)(e,[{key:"dispose",value:function(){this._programByKey.forEach((function(e){return e.dispose()})),this._programByKey.clear()}},{key:"getMaterialProgram",value:function(e,t,r){var n=t.key<<3|this._getMaterialOptionsValue(t.type,r);if(this._programByKey.has(n))return this._programByKey.get(n);var i=(0,this._getProgramTemplate(t.type).shaders)(r),a=i.vertexShader,o=i.fragmentShader,s=t.getShaderHeader(),u=t.getShaderMain(),c=a.replace("#pragma header",s).replace("#pragma main",u),l=new B.a(e,c,o,t.getAttributeLocations());return this._programByKey.set(n,l),l}},{key:"_getMaterialOptionsValue",value:function(e,t){switch(e){case 0:var r=t;return(r.pattern?1:0)<<1|(r.id?1:0);case 1:var n=t;return(n.pattern?1:0)<<1|(n.id?1:0);case 2:return t.id?1:0;case 3:var i=t;return(i.sdf?1:0)<<2|(i.pattern?1:0)<<1|(i.id?1:0);case 4:var a=t;return(a.sdf?1:0)<<1|(a.id?1:0);case 5:case 6:return t.id?1:0;default:return 0}}},{key:"_getProgramTemplate",value:function(e){switch(e){case 0:return N;case 5:return q;case 1:return G;case 4:return X;case 3:return $;case 2:return Y;case 6:return ee;default:return null}}}]),e}(),re=r("JrL/"),ne={shaders:{vertexShader:Object(re.a)("bitBlit/bitBlit.vert"),fragmentShader:Object(re.a)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])},ie=function(){function e(){Object(a.a)(this,e),this._initialized=!1}return Object(o.a)(e,[{key:"dispose",value:function(){this._program&&(this._program.dispose(),this._program=null),this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)}},{key:"render",value:function(e,t,r,n){e&&(this._initialized||this._initialize(e),e.setBlendFunctionSeparate(1,771,1,771),e.bindVAO(this._vertexArrayObject),e.useProgram(this._program),t.setSamplingMode(r),e.bindTexture(t,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",n),e.drawArrays(5,0,4),e.bindTexture(null,0),e.bindVAO())}},{key:"_initialize",value:function(e){if(this._initialized)return!0;var t=ne.attributes,r=Object(M.a)(e,ne);if(!r)return!1;var n=new Int8Array(16);n[0]=-1,n[1]=-1,n[2]=0,n[3]=0,n[4]=1,n[5]=-1,n[6]=1,n[7]=0,n[8]=-1,n[9]=1,n[10]=0,n[11]=1,n[12]=1,n[13]=1,n[14]=1,n[15]=1;var i=new T.a(e,t,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:k.a.createVertex(e,35044,n)});return this._program=r,this._vertexArrayObject=i,this._initialized=!0,!0}}]),e}(),ae=r("wCLu"),oe=function(e){var t="";t+=e[0].toUpperCase();for(var r=1;r<e.length;r++){var n=e[r];n===n.toUpperCase()?(t+="_",t+=n):t+=n.toUpperCase()}return t},se=function(e){var t={};for(var r in e)t[oe(r)]=e[r];return Object(M.b)(t)},ue=function(e,t,r){var n=e+e.substring(e.lastIndexOf("/")),i=t+t.substring(t.lastIndexOf("/"));return{attributes:r,shaders:function(e){return{vertexShader:se(e)+Object(re.a)("".concat(n,".vert")),fragmentShader:se(e)+Object(re.a)("".concat(i,".frag"))}}}};function ce(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return le(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return le(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function he(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?he(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):he(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var de=function(e){return e===F.c.HITTEST||e===F.c.LABEL_ALPHA},pe=function(e,t,r,n){var i,a=e.rendererInfo,o=e.drawPhase;return"".concat(t.getVariationHash(),"-").concat(n.join("."),"-").concat((i=o,(de(i)?1:0)|(i===F.c.HIGHLIGHT?2:0)),"-").concat(a.getVariationHash(),"-").concat(Object(I.i)(r)&&r.join("."))},ve=function(e,t,r,i){var a=i.reduce((function(t,r){return fe(fe({},t),{},Object(n.a)({},r,e.driverTestResult[r]))}),{}),o=fe(fe(fe({},t.getVariation()),e.rendererInfo.getVariation()),{},{highlight:e.drawPhase===F.c.HIGHLIGHT,id:de(e.drawPhase)},a);if(Object(I.i)(r)){var s,u=ce(r);try{for(u.s();!(s=u.n()).done;){o[s.value]=!0}}catch(c){u.e(c)}finally{u.f()}}return o},me=function(){function e(t){Object(a.a)(this,e),this._programByKey=new Map,this._programCache=new ae.a(t)}return Object(o.a)(e,[{key:"dispose",value:function(){this._programCache&&this._programCache.dispose()}},{key:"getProgram",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=t.vsPath+"."+t.fsPath+JSON.stringify(r)+i.join(".");if(this._programByKey.has(a))return this._programByKey.get(a);var o=i.reduce((function(t,r){return fe(fe({},t),{},Object(n.a)({},r,e.driverTestResult[r]))}),{}),s=fe(fe({},r.map((function(e){return"string"==typeof e?{name:e,value:!0}:e})).reduce((function(e,t){return fe(fe({},e),{},Object(n.a)({},t.name,t.value))}),{})),o),u=t.vsPath,c=t.fsPath,l=t.attributes,h=this._programCache.getProgram(ue(u,c,l),s);if(!h)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(a,h),h}},{key:"getMaterialProgram",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:["ignoresSamplerPrecision"],o=pe(e,t,i,a);if(this._programByKey.has(o))return this._programByKey.get(o);var s=ve(e,t,i,a),u=this._programCache.getProgram(ue(r,r,n),s);if(!u)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(o,u),u}}]),e}(),ge=r("sc0P"),_e=r("DGz/"),ye=r("TM+E"),be=r("IH5m"),we=r("frPA"),xe=r("0s7n"),Oe=r("mynk"),ke=r("PmOk");function je(e){var t=function(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}(e)+function(e){if(!e.style)return"";switch(e.style.toLowerCase()){case"italic":case"oblic":return"-italic"}return""}(e);return function(e){var t=e.toLowerCase().split(" ").join("-");switch(t){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return t}}(e.family)+(t.length>0?t:"-regular")}var Ce=r("hLiK"),Me=function(){function e(t,r){Object(a.a)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=r,this._free.push(new Ce.a(0,0,t,r))}return Object(o.a)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new Ce.a;for(var r=null,n=-1,i=0;i<this._free.length;++i){var a=this._free[i];e<=a.width&&t<=a.height&&(null===r||a.y<=r.y&&a.x<=r.x)&&(r=a,n=i)}return null===r?new Ce.a:(this._free.splice(n,1),r.width<r.height?(r.width>e&&this._free.push(new Ce.a(r.x+e,r.y,r.width-e,t)),r.height>t&&this._free.push(new Ce.a(r.x,r.y+t,r.width,r.height-t))):(r.width>e&&this._free.push(new Ce.a(r.x+e,r.y,r.width-e,r.height)),r.height>t&&this._free.push(new Ce.a(r.x,r.y+t,e,r.height-t))),new Ce.a(r.x,r.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var r=this._free[t];if(r.y===e.y&&r.height===e.height&&r.x+r.width===e.x)r.width+=e.width;else if(r.x===e.x&&r.width===e.width&&r.y+r.height===e.y)r.height+=e.height;else if(e.y===r.y&&e.height===r.height&&e.x+e.width===r.x)r.x=e.x,r.width+=e.width;else{if(e.x!==r.x||e.width!==r.width||e.y+e.height!==r.y)continue;r.y=e.y,r.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}();function Se(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Te(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Te(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Te(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Re=function(e){return Math.floor(e/256)};function Pe(e){var t,r=new Set,n=Se(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;r.add(Re(i))}}catch(a){n.e(a)}finally{n.f()}return r}function Fe(e,t,r){return e.has(t)||e.set(t,r().then((function(){e.delete(t)})).catch((function(r){e.delete(t),Object(be.w)(r)}))),e.get(t)}var Ie=function(){function e(t,r,n){Object(a.a)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=r,this._glyphSource=n,this._binPack=new Me(t-4,r-4),this._glyphData.push(new Uint8Array(t*r)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph()}var t,r,n;return Object(o.a)(e,[{key:"dispose",value:function(){this._binPack=null;var e,t=Se(this._textures);try{for(t.s();!(e=t.n()).done;){var r=e.value;r&&r.dispose()}}catch(n){t.e(n)}finally{t.f()}this._textures.length=0,this._glyphData.length=0}},{key:"_initDecorationGlyph",value:function(){for(var e=[117,149,181,207,207,181,149,117],t=[],r=0;r<e.length;r++)for(var n=e[r],i=0;i<11;i++)t.push(n);var a={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(t)};this._recordGlyph(a)}},{key:"getGlyphItems",value:(n=Object(i.a)(d.a.mark((function e(t,r,n){var i,a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this._getGlyphCache(t),e.next=3,this._fetchRanges(t,r,n);case 3:return e.abrupt("return",r.map((function(e){return a._getMosaicItem(i,t,e)})));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"bind",value:function(e,t,r,n){var i=this._getTexture(e,r);i.setSamplingMode(t),this._dirties[r]&&(i.setData(this._glyphData[r]),this._dirties[r]=!1),e.bindTexture(i,n)}},{key:"_getGlyphCache",value:function(e){return this._glyphCache[e]||(this._glyphCache[e]={}),this._glyphCache[e]}},{key:"_getTexture",value:function(e,t){return this._textures[t]||(this._textures[t]=new S.a(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height))),this._textures[t]}},{key:"_invalidate",value:function(){this._dirties[this._currentPage]=!0}},{key:"_fetchRanges",value:(r=Object(i.a)(d.a.mark((function e(t,r,n){var i,a,o=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Pe(r),a=[],i.forEach((function(e){a.push(o._fetchRange(t,e,n))})),e.next=4,Promise.all(a);case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"_fetchRange",value:(t=Object(i.a)(d.a.mark((function e(t,r,n){var i,a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r>256)){e.next=2;break}return e.abrupt("return",null);case 2:return i=t+r,e.abrupt("return",Fe(this._rangePromises,i,(function(){return a._glyphSource.getRange(t,r,n)})));case 4:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"_getMosaicItem",value:function(e,t,r){if(!e[r]){var n=this._glyphSource.getGlyph(t,r);if(!n||!n.metrics)return function(e){return{rect:new Ce.a(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:e,sdf:!0}}(r);var i=this._recordGlyph(n),a=this._currentPage,o=n.metrics;e[r]={rect:i,page:a,metrics:o,code:r,sdf:!0},this._invalidate()}return e[r]}},{key:"_recordGlyph",value:function(e){var t,r=e.metrics;if(0===r.width)t=new Ce.a(0,0,0,0);else{var n=r.width+6,i=r.height+6;(t=this._binPack.allocate(n,i)).isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new Me(this.width-4,this.height-4),t=this._binPack.allocate(n,i));var a,o,s=this._glyphData[this._currentPage],u=e.bitmap;if(u)for(var c=0;c<i;c++){a=n*c,o=this.width*(t.y+c)+t.x;for(var l=0;l<n;l++)s[o+l]=u[a+l]}Object(m.a)("esri-glyph-debug")&&this._showDebugPage(s)}return t}},{key:"_showDebugPage",value:function(e){var t=document.createElement("canvas"),r=t.getContext("2d"),n=new ImageData(this.width,this.height),i=n.data;t.width=this.width,t.height=this.height,t.style.border="1px solid black";for(var a=0;a<e.length;++a)i[4*a+0]=e[a],i[4*a+1]=0,i[4*a+2]=0,i[4*a+3]=255;r.putImageData(n,0,0),document.body.appendChild(t)}}]),e}(),Ae=r("4i+k");function De(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var Be=function(){function e(t){for(Object(a.a)(this,e),this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:for(var r=t.getMessage();r.next();)switch(r.tag()){case 3:for(var n=r.getMessage(),i=void 0,o=void 0,s=void 0,u=void 0,c=void 0,l=void 0,h=void 0;n.next();)switch(n.tag()){case 1:i=n.getUInt32();break;case 2:o=n.getBytes();break;case 3:s=n.getUInt32();break;case 4:u=n.getUInt32();break;case 5:c=n.getSInt32();break;case 6:l=n.getSInt32();break;case 7:h=n.getUInt32();break;default:n.skip()}n.release(),i&&(this._metrics[i]={width:s,height:u,left:c,top:l,advance:h},this._bitmaps[i]=o);break;default:r.skip()}r.release();break;default:t.skip()}}return Object(o.a)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),ze=function(){function e(){Object(a.a)(this,e),this._ranges=[]}return Object(o.a)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),Ee=function(){function e(t){Object(a.a)(this,e),this._glyphInfo={},this._baseURL=t}return Object(o.a)(e,[{key:"getRange",value:function(e,t,r){var i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();var a=256*t,o=a+255,s=this._baseURL.replace("{fontstack}",e).replace("{range}",a+"-"+o);return Object(_e.default)(s,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?De(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):De(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({responseType:"array-buffer"},r)).then((function(e){i.addRange(t,new Be(new Ae.a(new Uint8Array(e.data),new DataView(e.data))))}))}},{key:"getGlyph",value:function(e,t){var r=this._getFontStack(e);if(r){var n=Math.floor(t/256);if(!(n>256)){var i=r.getRange(n);return i?{metrics:i.getMetrics(t),bitmap:i.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new ze),t}}]),e}(),Ue=[1,256,65536,16777216],Le=[1/256,1/65536,1/16777216,1/4294967296],Ve=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0,n=0;n<4;n++)r+=e[t+n]*Le[n];return r}(new Uint8ClampedArray([255,255,255,255]));function Ne(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=He(e,0,Ve),i=0;i<4;i++)t[r+i]=Math.floor(256*qe(n*Ue[i]))}function He(e,t,r){return e<t?t:e>r?r:e}function qe(e){return e-Math.floor(e)}var We=1e20,Ge=function(){function e(t){Object(a.a)(this,e),this.size=t;var r=document.createElement("canvas");r.width=r.height=t,this._context=r.getContext("2d"),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t)}return Object(o.a)(e,[{key:"dispose",value:function(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}},{key:"draw",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:31;this._initSVG();var i=this._createSVGString(e);return new Promise((function(e,a){var o=new Image;o.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(i),o.onload=function(){o.onload=null,r._context.clearRect(0,0,r.size,r.size),r._context.drawImage(o,0,0,r.size,r.size);for(var t=r._context.getImageData(0,0,r.size,r.size),i=new Uint8Array(r.size*r.size*4),a=0;a<r.size*r.size;a++){var s=t.data[4*a+3]/255;r._gridOuter[a]=1===s?0:0===s?We:Math.pow(Math.max(0,.5-s),2),r._gridInner[a]=1===s?We:0===s?0:Math.pow(Math.max(0,s-.5),2)}r._edt(r._gridOuter,r.size,r.size),r._edt(r._gridInner,r.size,r.size);for(var u=0;u<r.size*r.size;u++){Ne(.5-(r._gridOuter[u]-r._gridInner[u])/(2*n),i,4*u)}e(i)};var s=t&&t.signal;s&&Object(be.q)(s,(function(){return a(Object(be.e)())}))}))}},{key:"_initSVG",value:function(){if(!this._svg){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("style","position: absolute;"),e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("aria-hidden","true"),e.setAttribute("role","presentation"),document.body.appendChild(e),this._svg=e}}},{key:"_createSVGString",value:function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",e),this._svg.appendChild(t);var r,n,i,a,o=t.getBBox(),s=o.width/o.height,u=this.size/2;if(s>1){n=r=u/o.width;var c=u*(1/s);i=this.size/4,a=u-c/2}else r=n=u/o.height,i=u-u*s/2,a=this.size/4;var l=-o.x*r+i,h=-o.y*n+a;t.setAttribute("style","transform: matrix(".concat(r,", 0, 0, ").concat(n,", ").concat(l,", ").concat(h,")"));var f='<svg style="fill:red;" height="'.concat(this.size,'" width="').concat(this.size,'" xmlns="http://www.w3.org/2000/svg">').concat(this._svg.innerHTML,"</svg>");return this._svg.removeChild(t),f}},{key:"_edt",value:function(e,t,r){for(var n=this._f,i=this._d,a=this._v,o=this._z,s=0;s<t;s++){for(var u=0;u<r;u++)n[u]=e[u*t+s];this._edt1d(n,i,a,o,r);for(var c=0;c<r;c++)e[c*t+s]=i[c]}for(var l=0;l<r;l++){for(var h=0;h<t;h++)n[h]=e[l*t+h];this._edt1d(n,i,a,o,t);for(var f=0;f<t;f++)e[l*t+f]=Math.sqrt(i[f])}}},{key:"_edt1d",value:function(e,t,r,n,i){r[0]=0,n[0]=-We,n[1]=+We;for(var a=1,o=0;a<i;a++){for(var s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);s<=n[o];)o--,s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);r[++o]=a,n[o]=s,n[o+1]=+We}for(var u=0,c=0;u<i;u++){for(;n[c+1]<u;)c++;t[u]=(u-r[c])*(u-r[c])+e[r[c]]}}}]),e}(),Ze=r("aNYv"),Ye=r("ghNS");function Ke(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Xe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xe(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Je(e){return e&&"static"===e.type}function $e(e,t,r){return Je(t)?new S.a(e,{pixelFormat:6408,dataType:5121,width:r[0],height:r[1]},new Uint8Array(t.data.buffer)):new S.a(e,{pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:r[0],height:r[1]},null)}for(var Qe=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(a.a)(this,e),this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(r<=0||n<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=r,this._pageHeight=n,this._requestRender=t,i>0&&(this._maxItemSize=i),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new Me(this._pageWidth,this._pageHeight);var o=Math.floor(this._pageWidth),s=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(o*s)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}return Object(o.a)(e,[{key:"getWidth",value:function(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[0]}},{key:"getHeight",value:function(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[1]}},{key:"getPageTexture",value:function(e){return e<this._mosaicPages.length?this._mosaicPages[e].texture:null}},{key:"has",value:function(e){return this._mosaicRects.has(e)}},{key:"itemCount",get:function(){return this._mosaicRects.size}},{key:"getSpriteItem",value:function(e){return this._mosaicRects.get(e)}},{key:"addSpriteItem",value:function(e,t,r,n,i,a){if(this._mosaicRects.has(e))return this._mosaicRects.get(e);var o,s,u;if(Je(r)){var c=this._allocateImage(t[0],t[1]),l=Object(Ze.a)(c,3);o=l[0],s=l[1],u=l[2]}else{o=new Ce.a(0,0,t[0],t[1]),s=this._mosaicPages.length;this._mosaicPages.push({mosaicsData:r,size:t,dirty:!0,texture:void 0})}if(o.width<=0||o.height<=0)return null;var h={rect:o,width:t[0],height:t[1],sdf:i,simplePattern:a,pixelRatio:1,page:s};return this._mosaicRects.set(e,h),Je(r)&&this._copy({rect:o,spriteSize:t,spriteData:r.data,page:s,pageSize:u,repeat:n,sdf:i}),h}},{key:"hasItemsToProcess",value:function(){return 0!==this._spriteCopyQueue.length}},{key:"processNextItem",value:function(){var e=this._spriteCopyQueue.pop();e&&this._copy(e)}},{key:"getSpriteItems",value:function(e){var t,r={},n=Ke(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;r[i]=this.getSpriteItem(i)}}catch(a){n.e(a)}finally{n.f()}return r}},{key:"getMosaicItemPosition",value:function(e){var t=this.getSpriteItem(e),r=t&&t.rect;if(!r)return null;r.width=t.width,r.height=t.height;var n=t.width,i=t.height,a=ke.q,o=this._mosaicPages[t.page];return{size:[t.width,t.height],tl:[(r.x+a)/o[0],(r.y+a)/o[1]],br:[(r.x+a+n)/o[0],(r.y+a+i)/o[1]],page:t.page}}},{key:"bind",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this._mosaicPages[r],a=i.mosaicsData,o=i.texture;if(o||(o=$e(e,a,i.size),i.texture=o),o.setSamplingMode(t),Je(a))e.bindTexture(o,n),i.dirty&&(o.setData(new Uint8Array(a.data.buffer)),o.generateMipmap());else{var s=a.data,u=s.bindFrame(e,o,n);Object(I.i)(this._requestRender)&&u&&s.frameCount>0&&this._requestRender.requestRender(),s.bindFrame(e,o,n)}i.dirty=!1}},{key:"_copy",value:function(t){if(!(t.page>=this._mosaicPages.length)){var r=this._mosaicPages[t.page],n=r.mosaicsData;if(!Je(r.mosaicsData))throw new p.a("mapview-invalid-resource","unsuitable data type!");var i=t.spriteData,a=n.data;a&&i||console.error("Source or target images are uninitialized!"),e._copyBits(i,t.spriteSize[0],0,0,a,t.pageSize[0],t.rect.x+ke.q,t.rect.y+ke.q,t.spriteSize[0],t.spriteSize[1],t.repeat),r.dirty=!0}}},{key:"_allocateImage",value:function(e,t){e+=2*ke.q,t+=2*ke.q;var r=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<r){var n=Math.pow(2,Math.ceil(Object(Ye.c)(e))),i=Math.pow(2,Math.ceil(Object(Ye.c)(t))),a=new Ce.a(0,0,e,t);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(n*i)},size:[n,i],dirty:!0,texture:void 0}),[a,this._mosaicPages.length-1,[n,i]]}var o=this._binPack.allocate(e,t);if(o.width<=0){var s=this._mosaicPages[this._currentPage];return!s.dirty&&Je(s.mosaicsData)&&(s.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new Me(this._pageWidth,this._pageHeight),this._allocateImage(e,t)}return[o,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"dispose",value:function(){this._binPack=null;var e,t=Ke(this._mosaicPages);try{for(t.s();!(e=t.n()).done;){var r=e.value,n=r.texture;n&&n.dispose();var i=r.mosaicsData;Je(i)||i.data.pause()}}catch(a){t.e(a)}finally{t.f()}this._mosaicPages=null,this._mosaicRects.clear()}}],[{key:"_copyBits",value:function(e,t,r,n,i,a,o,s,u,c,l){var h=n*t+r,f=s*a+o;if(l){f-=a;for(var d=-1;d<=c;h=((++d+c)%c+n)*t+r,f+=a)for(var p=-1;p<=u;p++)i[f+p]=e[h+(p+u)%u]}else for(var v=0;v<c;v++){for(var m=0;m<u;m++)i[f+m]=e[h+m];h+=t,f+=a}}}]),e}(),et=new Uint32Array(256),tt=0;tt<256;tt++){for(var rt=tt,nt=0;nt<8;nt++)rt=0!=(1&rt)?3988292384^rt>>>1:rt>>>1;et[tt]=rt}var it=new p.a("Not a PNG"),at=new p.a("Not an animated PNG"),ot=new Uint8Array([137,80,78,71,13,10,26,10]);function st(e){var t=e.constructor===Uint8Array?e:new Uint8Array(e);return!ot.some((function(e,r){return e!==t[r]}))}function ut(e){var t=new Uint8Array(e);if(!st(t))return!1;var r=!1;return dt(t,(function(e){return!(r="acTL"===e)})),r}var ct=function(){function e(){Object(a.a)(this,e),this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[],this.paused=!1,this.playing=!1,this.playSpeed=1,this.currentFrameNumber=0,this._lastUsedFrame=-1}var t,r;return Object(o.a)(e,[{key:"play",value:function(){this.playing||(this.paused=!1,this.playing=!0,this._play())}},{key:"pause",value:function(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}},{key:"togglePlay",value:function(){this.paused||!this.playing?this.play():this.pause()}},{key:"bindFrame",value:function(e,t,r){e.bindTexture(t,r);var n=this.frameChanged();if(!n)return!1;var i=this.currentFrame,a=i.frameData,o=t.descriptor;return(i.left||i.top||i.width!==o.width||i.height!==o.height)&&t.setData(null),t.updateData(0,i.left,i.top,i.width,i.height,a),this.updateUsedFrame(),n}},{key:"frameChanged",value:function(){return this._lastUsedFrame!==this.currentFrameNumber}},{key:"updateUsedFrame",value:function(){this._lastUsedFrame=this.currentFrameNumber}},{key:"_load",value:(r=Object(i.a)(d.a.mark((function e(t,r){var n,i=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(n=ft(this,t))===this){e.next=4;break}return e.abrupt("return",n);case 4:return this._resizeCanvas=document.createElement("canvas"),this._resizeCanvas.width=this.width,this._resizeCanvas.height=this.height,e.next=9,Promise.all(this.frames.map((function(e){return e.createImage(i._resizeCanvas)})));case 9:e.next=15;break;case 11:if(e.prev=11,e.t0=e.catch(0),Object(be.m)(e.t0)){e.next=15;break}return e.abrupt("return",new p.a("invalid-resource","Could not parse PNG"));case 15:this.play();case 16:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(e,t){return r.apply(this,arguments)})},{key:"_play",value:function(){var e,t,r=this;if(0!==this.playSpeed){this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),t=this.currentFrameNumber,(t-=1)<0&&(t=this.frames.length-1),e=1*-this.frames[t].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,e=1*this.frames[this.currentFrameNumber].delay/this.playSpeed);var n=this.frames[this.currentFrameNumber];this.currentFrame={frameData:n.imageData,top:n.top,left:n.left,width:n.width,height:n.height},this.timerID=window.setTimeout((function(){return r._play()}),e)}else this.pause()}}],[{key:"create",value:(t=Object(i.a)(d.a.mark((function t(r,n){var i;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=new e,t.prev=1,t.next=4,i._load(r,n);case 4:t.next=10;break;case 6:if(t.prev=6,t.t0=t.catch(1),Object(be.m)(t.t0)){t.next=10;break}return t.abrupt("return",new p.a("invalid-resource","Could not load PNG: ".concat(t.t0.message)));case 10:return t.abrupt("return",i);case 11:case"end":return t.stop()}}),t,null,[[1,6]])}))),function(e,r){return t.apply(this,arguments)})}]),e}(),lt=function(){function e(){Object(a.a)(this,e),this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.data=null,this.imageData=null}var t;return Object(o.a)(e,[{key:"createImage",value:(t=Object(i.a)(d.a.mark((function e(t){var r=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this.imageData){e.next=2;break}return e.abrupt("return",new Promise((function(e,n){var i=URL.createObjectURL(r.data),a=document.createElement("img");a.onload=function(){URL.revokeObjectURL(i),r.imageData=ht(a,t),e()},a.onerror=function(){URL.revokeObjectURL(i),r.imageData=null,n(new Error("Image creation error"))},a.src=i})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function ht(e,t){t.width=e.width,t.height=e.height;var r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);for(var n,i=r.getImageData(0,0,e.width,e.height),a=new Uint8Array(i.data),o=0;o<a.length;o+=4)n=a[o+3]/255,a[o]=a[o]*n,a[o+1]=a[o+1]*n,a[o+2]=a[o+2]*n;return new ImageData(new Uint8ClampedArray(a.buffer),e.width,e.height)}function ft(e,t){var r=new Uint8Array(t);if(ot.some((function(e,t){return e!==r[t]})))return it;var n=!1;if(dt(r,(function(e){return!(n="acTL"===e)})),!n)return at;var i=[],a=[],o=null,s=null,u=0;if(dt(r,(function(t,r,n,c){var l=new DataView(r.buffer);switch(t){case"IHDR":o=r.subarray(n+8,n+8+c),e.width=l.getUint32(n+8),e.height=l.getUint32(n+12);break;case"acTL":e.numPlays=l.getUint32(n+8+4);break;case"fcTL":s&&(e.frames.push(s),u++),(s=new lt).width=l.getUint32(n+8+4),s.height=l.getUint32(n+8+8),s.left=l.getUint32(n+8+12),s.top=l.getUint32(n+8+16);var h=l.getUint16(n+8+20),f=l.getUint16(n+8+22);0===f&&(f=100),s.delay=1e3*h/f,s.delay<=10&&(s.delay=100),e.playTime+=s.delay,s.disposeOp=l.getUint8(n+8+24),s.blendOp=l.getUint8(n+8+25),s.dataParts=[],0===u&&2===s.disposeOp&&(s.disposeOp=1);break;case"fdAT":s&&s.dataParts.push(r.subarray(n+8+4,n+8+c));break;case"IDAT":s&&s.dataParts.push(r.subarray(n+8,n+8+c));break;case"IEND":a.push(vt(r,n,12+c));break;default:i.push(vt(r,n,12+c))}})),0===e.frames.length)return at;e.frameCount=e.frames.length;var c=new Blob(i),l=new Blob(a);return e.frames.forEach((function(e){var t=[];t.push(ot),o.set(gt(e.width),0),o.set(gt(e.height),4),t.push(mt("IHDR",o)),t.push(c),e.dataParts.forEach((function(e){return t.push(mt("IDAT",e))})),t.push(l),e.data=new Blob(t,{type:"image/png"}),delete e.dataParts,t=null})),e}function dt(e,t){var r,n,i,a=new DataView(e.buffer),o=8;do{n=a.getUint32(o),i=t(r=pt(e,o+4,4),e,o,n),o+=12+n}while(!1!==i&&"IEND"!==r&&o<e.length)}function pt(e,t,r){var n=Array.prototype.slice.call(e.subarray(t,t+r));return String.fromCharCode.apply(String,n)}function vt(e,t,r){var n=new Uint8Array(r);return n.set(e.subarray(t,t+r)),n}function mt(e,t){var r=e.length+t.length,n=new Uint8Array(r+8),i=new DataView(n.buffer);i.setUint32(0,t.length),n.set(function(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e),4),n.set(t,8);var a=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length-t,n=-1,i=t,a=t+r;i<a;i++)n=n>>>8^et[255&(n^e[i])];return-1^n}(n,4,r);return i.setUint32(r+4,a),n}function gt(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}var _t=ct,yt=249,bt=254,wt=255,xt=1,Ot=44,kt=59;function jt(e){if(!e||0===e.byteLength)return!1;var t=e.constructor===Uint8Array?e:new Uint8Array(e);return 71===t[0]&&73===t[1]&&70===t[2]&&56===t[3]}function Ct(e){if(!e||0===e.byteLength)return!1;var t=new Uint8Array(e);if(!jt(t))return!1;for(var r=0,n=0,i=t.length-9;n<i&&(0!==t[n]||33!==t[n+1]||249!==t[n+2]||4!==t[n+3]||0!==t[n+8]||44!==t[n+9]&&33!==t[n+9]||!(++r>1));++n);return r>1}var Mt=function(){function e(){Object(a.a)(this,e),this.paused=!1,this.playing=!1,this.waitTillDone=!0,this.loading=!1,this.firstFrameOnly=!1,this.frames=[],this.comment="",this.length=0,this.currentFrameNumber=0,this.frameCount=0,this.playSpeed=1,this.lastFrame=null,this.playOnLoad=!0,this.complete=!1,this.interlaceOffsets=[0,4,2,1],this.interlaceSteps=[8,8,4,2],this._lastUsedFrame=-1}var t,r,n;return Object(o.a)(e,[{key:"play",value:function(){this.playing||(this.paused=!1,this.playing=!0,this._play())}},{key:"pause",value:function(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}},{key:"togglePlay",value:function(){this.paused||!this.playing?this.play():this.pause()}},{key:"bindFrame",value:function(e,t,r){e.bindTexture(t,r);var n=this.frameChanged();if(n){var i=this.currentFrame,a=i.frameData;t.updateData(0,0,0,i.width,i.height,a),this.updateUsedFrame()}return n}},{key:"seekFrame",value:function(e){clearTimeout(this.timerID),this.currentFrameNumber=e%this.frames.length,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}},{key:"seek",value:function(e){clearTimeout(this.timerID),e<0&&(e=0),e*=1e3,e%=this.length;for(var t=0;e>this.frames[t].time+this.frames[t].delay&&t<this.frames.length;)t+=1;this.currentFrameNumber=t,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}},{key:"frameChanged",value:function(){return this._lastUsedFrame!==this.currentFrameNumber}},{key:"updateUsedFrame",value:function(){this._lastUsedFrame=this.currentFrameNumber}},{key:"_load",value:(n=Object(i.a)(d.a.mark((function e(t,r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.loading=!0,e.next=4,this._parse(t,r);case 4:this.loading=!1,this.play(),e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(0),Object(be.m)(e.t0)){e.next=12;break}return e.abrupt("return",new p.a("invalid-resource","Could not parse gif!"));case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e,t){return n.apply(this,arguments)})},{key:"_parse",value:function(e,t){var r=this,n=new St(e);n.pos+=6,this.width=n.data[n.pos++]+(n.data[n.pos++]<<8),this.height=n.data[n.pos++]+(n.data[n.pos++]<<8);var i=n.data[n.pos++];return this.globalColourCount=1<<1+(7&i),n.pos++,n.pos++,128&i&&(this.globalColourTable=this._parseColourTable(this.globalColourCount,n)),new Promise((function(e,i){setTimeout((function(){return r._parseBlock(n,e,i,t)}),0)}))}},{key:"_parseBlock",value:(r=Object(i.a)(d.a.mark((function e(t,r,n,i){var a,o=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i&&i.signal&&Object(be.n)(i.signal))){e.next=2;break}return e.abrupt("return",void n(Object(be.e)()));case 2:if((a=t.data[t.pos++])!==Ot){e.next=8;break}if(this._parseImg(t),!this.firstFrameOnly){e.next=6;break}return e.abrupt("return",(this._finishedLoading(),void r()));case 6:e.next=11;break;case 8:if(a!==kt){e.next=10;break}return e.abrupt("return",(this._finishedLoading(),void r()));case 10:this._parseExt(t);case 11:"function"==typeof this.onprogress&&this.onprogress({bytesRead:t.pos,totalBytes:t.data.length,frame:this.frames.length}),setTimeout((function(){return o._parseBlock(t,r,n,i)}),0);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"_parseColourTable",value:function(e,t){for(var r=[],n=0;n<e;n++)r.push([t.data[t.pos++],t.data[t.pos++],t.data[t.pos++]]);return r}},{key:"_parseImg",value:function(e){var t=this,r={};this.frames.push(r),r.disposalMethod=this.disposalMethod,r.time=this.length,r.delay=10*this.delayTime,this.length+=r.delay,this.transparencyGiven?r.transparencyIndex=this.transparencyIndex:r.transparencyIndex=void 0,r.leftPos=e.data[e.pos++]+(e.data[e.pos++]<<8),r.topPos=e.data[e.pos++]+(e.data[e.pos++]<<8),r.width=e.data[e.pos++]+(e.data[e.pos++]<<8),r.height=e.data[e.pos++]+(e.data[e.pos++]<<8);var n=e.data[e.pos++];r.localColourTableFlag=!!(128&n),r.localColourTableFlag&&(r.localColourTable=this._parseColourTable(1<<1+(7&n),e)),this.pixelBufSize!==r.width*r.height&&(this.pixelBuf=new Uint8Array(r.width*r.height),this.pixelBufSize=r.width*r.height),this._lzwDecode(e.data[e.pos++],e.readSubBlocksB()),64&n?(r.interlaced=!0,function(e){var r=t.pixelBufSize/e;t.interlacedBufSize!==t.pixelBufSize&&(t.deinterlaceBuf=new Uint8Array(t.pixelBufSize),t.interlacedBufSize=t.pixelBufSize);for(var n=0,i=0;i<4;i++)for(var a=t.interlaceOffsets[i];a<r;a+=t.interlaceSteps[i])t.deinterlaceBuf.set(t.pixelBuf.subarray(n,n+e),a*e),n+=e}(r.width)):r.interlaced=!1,this._processFrame(r)}},{key:"_lzwDecode",value:function(e,t){var r,n,i,a,o,s,u,c,l;i=n=0;var h=[],f=1<<e,d=f+1;for(a=e+1,l=!1;!l;){for(s=o,o=0,r=0;r<a;r++)t[i>>3]&1<<(7&i)&&(o|=1<<r),i++;if(o===f){for(h=[],a=e+1,r=0;r<f;r++)h[r]=[r];h[f]=[],h[d]=null}else{if(o===d)return void(l=!0);for(o>=h.length?h.push(h[s].concat(h[s][0])):s!==f&&h.push(h[s].concat(h[o][0])),c=(u=h[o]).length,r=0;r<c;r++)this.pixelBuf[n++]=u[r];h.length===1<<a&&a<12&&a++}}}},{key:"_processFrame",value:function(e){e.image=document.createElement("canvas"),e.image.width=this.width,e.image.height=this.height,e.ctx=e.image.getContext("2d");var t=e.localColourTableFlag?e.localColourTable:this.globalColourTable;null===this.lastFrame&&(this.lastFrame=e);var r=2===this.lastFrame.disposalMethod||3===this.lastFrame.disposalMethod;r||e.ctx.drawImage(this.lastFrame.image,0,0,this.width,this.height);for(var n,i,a=e.ctx.getImageData(e.leftPos,e.topPos,e.width,e.height),o=e.transparencyIndex,s=a.data,u=e.interlaced?this.deinterlaceBuf:this.pixelBuf,c=u.length,l=0,h=0;h<c;h++)i=t[n=u[h]],o!==n?(s[l++]=i[0],s[l++]=i[1],s[l++]=i[2],s[l++]=255):r?(s[l+3]=0,l+=4):l+=4;e.ctx.putImageData(a,e.leftPos,e.topPos),this.lastFrame=e}},{key:"_parseExt",value:function(e){var t=e.data[e.pos++];t===yt?this._parseGCExt(e):t===bt?this.comment+=e.readSubBlocks():t===wt?this._parseAppExt(e):(t===xt&&(e.pos+=13),e.readSubBlocks())}},{key:"_parseAppExt",value:function(e){e.pos+=1,"NETSCAPE"===e.getString(8)?e.pos+=8:(e.pos+=3,e.readSubBlocks())}},{key:"_parseGCExt",value:function(e){e.pos++;var t=e.data[e.pos++];this.disposalMethod=(28&t)>>2,this.transparencyGiven=!!(1&t),this.delayTime=e.data[e.pos++]+(e.data[e.pos++]<<8),this.transparencyIndex=e.data[e.pos++],e.pos++}},{key:"_finishedLoading",value:function(){this.loading=!1,this.frameCount=this.frames.length,this.lastFrame=null,this.complete=!0,this.disposalMethod=void 0,this.transparencyGiven=void 0,this.delayTime=void 0,this.transparencyIndex=void 0,this.waitTillDone=void 0,this.pixelBuf=void 0,this.deinterlaceBuf=void 0,this.pixelBufSize=void 0,this.deinterlaceBuf=void 0,this.currentFrameNumber=0,this.frames.length>0&&this._setCurrentFrame(0),this.playOnLoad&&this.play()}},{key:"_play",value:function(){var e,t,r=this;0!==this.playSpeed?(this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),t=this.currentFrameNumber,(t-=1)<0&&(t=this.frames.length-1),e=1*-this.frames[t].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,e=1*this.frames[this.currentFrameNumber].delay/this.playSpeed),this._setCurrentFrame(this.currentFrameNumber),this.timerID=window.setTimeout((function(){return r._play()}),e)):this.pause()}},{key:"_setCurrentFrame",value:function(e){var t=this.frames[e];this.currentFrame={frameData:t.image,top:0,left:0,width:this.width,height:this.height}}}],[{key:"create",value:(t=Object(i.a)(d.a.mark((function t(r,n){var i;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=new e,t.prev=1,t.next=4,i._load(r,n);case 4:t.next=10;break;case 6:if(t.prev=6,t.t0=t.catch(1),Object(be.m)(t.t0)){t.next=10;break}return t.abrupt("return",new p.a("invalid-resource","Could not load PNG: ".concat(t.t0.message)));case 10:return t.abrupt("return",i);case 11:case"end":return t.stop()}}),t,null,[[1,6]])}))),function(e,r){return t.apply(this,arguments)})}]),e}(),St=function(){function e(t){Object(a.a)(this,e),this.pos=0,this.data=new Uint8ClampedArray(t),this.len=this.data.length}return Object(o.a)(e,[{key:"getString",value:function(e){for(var t="";e--;)t+=String.fromCharCode(this.data[this.pos++]);return t}},{key:"readSubBlocks",value:function(){var e,t,r="";do{for(t=e=this.data[this.pos++];t--;)r+=String.fromCharCode(this.data[this.pos++])}while(0!==e&&this.pos<this.len);return r}},{key:"readSubBlocksB",value:function(){var e,t,r=[];do{for(t=e=this.data[this.pos++];t--;)r.push(this.data[this.pos++])}while(0!==e&&this.pos<this.len);return r}}]),e}(),Tt=Mt,Rt=r("H0uR"),Pt=r("r3Pz");function Ft(e){switch(e.type){case"esriSMS":return"".concat(e.style,".").concat(e.path);case"esriSLS":return"".concat(e.style,".").concat(e.cap);case"esriSFS":return"".concat(e.style);case"esriPFS":case"esriPMS":return e.imageData?"".concat(e.imageData).concat(e.width).concat(e.height):"".concat(e.url).concat(e.width).concat(e.height);default:return e.mosaicHash?e.mosaicHash:JSON.stringify(e)}}var It=r("CNVc");function At(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Dt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?At(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):At(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Bt=Object(xe.a)(),zt=ye.a.getLogger("esri.views.2d.engine.webgl.TextureManager"),Et=function(e){return"esriSMS"===e.type&&e.path},Ut=function(e){return e.url||e.imageData},Lt=function(e){return e.url&&-1!==e.url.indexOf(".gif")||e.contentType&&"image/gif"===e.contentType||e.imageData&&-1!==e.imageData.indexOf("data:image/gif")},Vt=function(e){return e.url&&-1!==e.url.indexOf(".png")||e.contentType&&"image/png"===e.contentType||e.imageData&&-1!==e.imageData.indexOf("data:image/png")},Nt=function(e){return e.type&&-1!==e.type.toLowerCase().indexOf("3d")};function Ht(e){switch(e.type){case"CIMSolidStroke":case"CIMSolidFill":return!0;case"esriSFS":return"esriSFSSolid"===e.style||"esriSFSNull"===e.style;case"esriSLS":return"esriSLSSolid"===e.style||"esriSLSNull"===e.style;default:return!1}}var qt=function(e){return-1!==e.indexOf("data:image/svg+xml")};function Wt(e){switch(e.type){case"esriSMS":case"esriPMS":case"CIMPointSymbol":case"CIMVectorMarker":case"CIMPictureMarker":case"CIMCharacterMarker":return!1;default:return!0}}function Gt(e){for(var t=[],r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t}function Zt(e,t){return Yt.apply(this,arguments)}function Yt(){return(Yt=Object(i.a)(d.a.mark((function e(t,r){var n,i,a,o,s,u,c,l,h,f;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.imageData?"data:".concat(t.contentType,";base64,").concat(t.imageData):t.url,a=";base64,",-1===n.indexOf(a)){e.next=8;break}for(o=n.indexOf(a)+a.length,s=n.substring(o),u=atob(s),c=new Uint8Array(u.length),l=0;l<u.length;l++)c[l]=u.charCodeAt(l);i=c.buffer,e.next=20;break;case 8:return e.prev=8,e.next=11,Object(_e.default)(n,Dt({responseType:"array-buffer"},r));case 11:h=e.sent,f=h.data,i=f,e.next=20;break;case 16:if(e.prev=16,e.t0=e.catch(8),Object(be.m)(e.t0)){e.next=20;break}return e.abrupt("return",new p.a("mapview-invalid-resource","Could not fetch requested resource at ".concat(n)));case 20:return e.abrupt("return",i);case 21:case"end":return e.stop()}}),e,null,[[8,16]])})))).apply(this,arguments)}function Kt(e,t){var r=Math.round(Object(we.c)(t)*window.devicePixelRatio),n=r>=128?2:4;return Math.min(e,r*n)}var Xt=function(e,t,r){return zt.error(new p.a(e,t,r))},Jt=function(){function e(t,r,n){Object(a.a)(this,e),this.mosaicType=t,this.page=r,this.sdf=n}return Object(o.a)(e,null,[{key:"fromMosaic",value:function(t,r){return new e(t,r.page,r.sdf)}}]),e}(),$t=function(){function e(t){var r;Object(a.a)(this,e),this._invalidFontsMap=new Map,this._sdfConverter=new Ge(126),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._rasterizer=new Oe.a,this._ongoingRasterizations=new Map,this._imageRequestQueue=new It.a({concurrency:10,process:(r=Object(i.a)(d.a.mark((function e(t,r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(be.v)(r),e.prev=1,e.next=4,Object(_e.default)(t,{responseType:"image",signal:r});case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),Object(be.m)(e.t0)){e.next=11;break}throw new p.a("mapview-invalid-resource","Could not fetch requested resource at ".concat(t),e.t0);case 11:throw e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,7]])}))),function(e,t){return r.apply(this,arguments)})}),this._spriteMosaic=new Qe(t,2048,2048,500),this._glyphSource=new Ee("".concat(ge.a.fontsUrl,"/{fontstack}/{range}.pbf")),this._glyphMosaic=new Ie(1024,1024,this._glyphSource)}var t,r,n,s,u,c,l,h;return Object(o.a)(e,[{key:"dispose",value:function(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._rasterizer=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null}},{key:"sprites",get:function(){return this._spriteMosaic}},{key:"glyphs",get:function(){return this._glyphMosaic}},{key:"rasterizeItem",value:(h=Object(i.a)(d.a.mark((function e(t,r,n,i){var a,o,s=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(I.h)(t)){e.next=2;break}return e.abrupt("return",(Xt("mapview-null-resource","Unable to rasterize null resource"),null));case 2:e.t0=t.type,e.next="CIMTextSymbol"===e.t0||"esriTS"===e.t0?5:("esriSMS"===e.t0||"esriPMS"===e.t0||"esriSFS"===e.t0||"esriPFS"===e.t0||e.t0,9);break;case 5:return e.next=7,this._rasterizeText(t,n,i);case 7:return a=e.sent,e.abrupt("return",(a.forEach((function(e){return s._setTextureBinding(F.a.GLYPH,e)})),{glyphMosaicItems:a}));case 9:if(!Nt(t)){e.next=11;break}return e.abrupt("return",(Xt("mapview-invalid-type","MapView does not support symbol type: ".concat(t.type),t),null));case 11:return e.next=13,this._rasterizeSpriteSymbol(t,r,i);case 13:return o=e.sent,e.abrupt("return",(Object(Pt.a)(o)&&o&&this._setTextureBinding(F.a.SPRITE,o),{spriteMosaicItem:o}));case 15:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return h.apply(this,arguments)})},{key:"bindTextures",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0!==r.textureBinding){var i=this._bindingInfos[r.textureBinding-1],a=i.page,o=n?9987:9729;switch(i.mosaicType){case F.a.SPRITE:var s=this.sprites.getWidth(a),u=this.sprites.getHeight(a),c=Object(x.m)(Bt,s,u);return this._spriteMosaic.bind(e,o,a,ke.B),t.setUniform1i("u_texture",ke.B),void t.setUniform2fv("u_mosaicSize",c);case F.a.GLYPH:var l=this.glyphs.width,h=this.glyphs.height,f=Object(x.m)(Bt,l,h);return this._glyphMosaic.bind(e,o,a,ke.w),t.setUniform1i("u_texture",ke.w),void t.setUniform2fv("u_mosaicSize",f);default:zt.error("mapview-texture-manager","Cannot handle unknown type ".concat(i.mosaicType))}}}},{key:"_hashMosaic",value:function(e,t){return 1|e<<1|(t.sdf?1:0)<<2|t.page<<3}},{key:"_setTextureBinding",value:function(e,t){var r=this._hashMosaic(e,t);if(!this._hashToBindingIndex.has(r)){var n=Jt.fromMosaic(e,t),i=this._bindingInfos.length+1;this._hashToBindingIndex.set(r,i),this._bindingInfos.push(n)}t.textureBinding=this._hashToBindingIndex.get(r)}},{key:"_rasterizeText",value:(l=Object(i.a)(d.a.mark((function e(t,r,n){var i,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=je(t.font),a=this._invalidFontsMap.has(i),o=r||Gt(Object(Rt.a)(t.text)[0]),e.prev=1,e.next=4,this._glyphMosaic.getGlyphItems(a?"arial-unicode-ms-regular":i,o,n);case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",(Xt("mapview-invalid-resource","Couldn't find font ".concat(i,". Falling back to Arial Unicode MS Regular")),this._invalidFontsMap.set(i,!0),this._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",o,n)));case 10:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t,r){return l.apply(this,arguments)})},{key:"_rasterizeSpriteSymbol",value:(c=Object(i.a)(d.a.mark((function e(t,r,n){var i,a,o,s,u,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ht(t)){e.next=2;break}return e.abrupt("return",null);case 2:if(i=Ft(t),!this._spriteMosaic.has(i)){e.next=5;break}return e.abrupt("return",this._spriteMosaic.getSpriteItem(i));case 5:if(!Et(t)&&!Ut(t)){e.next=7;break}return e.abrupt("return",this._handleAsyncResource(i,t,n));case 7:if(!(a=this._rasterizer.rasterizeJSONResource(t,r))){e.next=11;break}return o=a.size,s=a.image,u=a.sdf,c=a.simplePattern,e.abrupt("return",this._addItemToMosaic(i,o,{type:"static",data:s},Wt(t),u,c));case 11:return e.abrupt("return",new p.a("TextureManager","unrecognized or null rasterized image"));case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return c.apply(this,arguments)})},{key:"_handleAsyncResource",value:(u=Object(i.a)(d.a.mark((function e(t,r,n){var i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._ongoingRasterizations.has(t)){e.next=2;break}return e.abrupt("return",this._ongoingRasterizations.get(t));case 2:return i=Et(r)?this._handleSVG(r,t,n):this._handleImage(r,t,n),this._ongoingRasterizations.set(t,i),e.prev=3,e.next=6,i;case 6:this._ongoingRasterizations.delete(t),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),this._ongoingRasterizations.delete(t);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e,t,r){return u.apply(this,arguments)})},{key:"_handleSVG",value:(s=Object(i.a)(d.a.mark((function e(t,r,n){var i,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[126,126],e.next=3,this._sdfConverter.draw(t.path,n);case 3:return a=e.sent,e.abrupt("return",this._addItemToMosaic(r,i,{type:"static",data:new Uint32Array(a.buffer)},!1,!0,!0));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return s.apply(this,arguments)})},{key:"_handleGIFOrPNG",value:(n=Object(i.a)(d.a.mark((function e(t,r,n){var i,a,o,s,u,c,l,h,f,v,m,g;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zt(t,n);case 2:if(i=e.sent,!Object(Pt.a)(i)){e.next=36;break}if(a=jt(i),o=st(i),a||o){e.next=7;break}return e.abrupt("return",new p.a("mapview-invalid-resource","Image data is neither GIF nor PNG!"));case 7:if(e.prev=7,!a||!Ct(i)){e.next=14;break}return e.next=11,Tt.create(i,n);case 11:s=e.sent,e.next=19;break;case 14:if(e.t0=o&&ut(i),!e.t0){e.next=19;break}return e.next=18,_t.create(i,n);case 18:s=e.sent;case 19:e.next=25;break;case 21:if(e.prev=21,e.t1=e.catch(7),Object(be.m)(e.t1)){e.next=25;break}return e.abrupt("return",new p.a("mapview-invalid-resource","Could not fetch requested resource!"));case 25:if(!s||!Object(Pt.a)(s)){e.next=27;break}return e.abrupt("return",this._addItemToMosaic(r,[s.width,s.height],{type:"animated",data:s},Wt(t),!1,!1));case 27:return u=new Blob([i],{type:a?"image/gif":"image/png"}),e.next=30,this._imageFromBlob(u);case 30:if(!((c=e.sent)&&c instanceof HTMLImageElement)){e.next=36;break}return l=c.width,h=c.height,"esriPMS"===t.type&&(l=Math.round(Kt(c.width,t.width)),h=Math.round(c.height*(l/c.width))),f=this._rasterizer.rasterizeImageResource(l,h,c,t.colorSubstitutions),v=f.size,m=f.sdf,g=f.image,e.abrupt("return",this._addItemToMosaic(r,v,{type:"static",data:g},Wt(t),m,!1));case 36:return e.abrupt("return",new p.a("mapview-invalid-resource","Could not handle resource!"));case 37:case"end":return e.stop()}}),e,this,[[7,21]])}))),function(e,t,r){return n.apply(this,arguments)})},{key:"_handleImage",value:(r=Object(i.a)(d.a.mark((function e(t,r,n){var i,a,o,s,u,c,l,h,f;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Lt(t)&&!Vt(t)){e.next=2;break}return e.abrupt("return",this._handleGIFOrPNG(t,r,n));case 2:return i=t.imageData?"data:".concat(t.contentType,";base64,").concat(t.imageData):t.url,e.prev=3,e.next=6,this._imageRequestQueue.push(i,Dt({},n));case 6:return a=e.sent,o=a.data,qt(i)&&(o.width=Object(we.c)(t.width),o.height=Object(we.c)(t.height)),s=o.width,u=o.height,"esriPMS"===t.type&&(s=Math.round(Kt(o.width,t.width)),u=Math.round(o.height*(s/o.width))),c=this._rasterizer.rasterizeImageResource(s,u,o,t.colorSubstitutions),l=c.size,h=c.sdf,f=c.image,e.abrupt("return",this._addItemToMosaic(r,l,{type:"static",data:f},Wt(t),h,!1));case 15:if(e.prev=15,e.t0=e.catch(3),Object(be.m)(e.t0)){e.next=19;break}return e.abrupt("return",new p.a("mapview-invalid-resource","Could not fetch requested resource at ".concat(i,". ").concat(e.t0.message)));case 19:case"end":return e.stop()}}),e,this,[[3,15]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"_imageFromBlob",value:(t=Object(i.a)(d.a.mark((function e(t){var r,n,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=window.URL.createObjectURL(t),e.prev=1,e.next=4,this._imageRequestQueue.push(r);case 4:return n=e.sent,i=n.data,e.abrupt("return",(window.URL.revokeObjectURL(r),i));case 9:if(e.prev=9,e.t0=e.catch(1),window.URL.revokeObjectURL(r),Object(be.m)(e.t0)){e.next=13;break}return e.abrupt("return",new p.a("mapview-invalid-resource","Could not fetch requested resource at ".concat(r)));case 13:throw e.t0;case 14:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return t.apply(this,arguments)})},{key:"_addItemToMosaic",value:function(e,t,r,n,i,a){return this._spriteMosaic.addSpriteItem(e,t,r,n,i,a)}}]),e}(),Qt=r("uX2s"),er=function e(){Object(a.a)(this,e),this.name=this.constructor.name};function tr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var rr=function(e){Object(c.a)(r,e);var t=tr(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).defines=[],e._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])},e}return Object(o.a)(r,[{key:"dispose",value:function(){this._quad&&this._quad.dispose()}},{key:"bind",value:function(){}},{key:"unbind",value:function(){}},{key:"draw",value:function(e,t){if(t.size){var r=e.context,n=e.renderingOptions;this._quad||(this._quad=new Qt.a(r,[0,0,1,0,0,1,1,1]));var i=r.getBoundFramebufferObject(),a=r.getViewport(),o=a.x,s=a.y,u=a.width,c=a.height;t.bindTextures(r);var l=t.getBlock(ke.a);if(!Object(I.h)(l)){var h=l.getFBO(r),f=l.getFBO(r,1);r.setViewport(0,0,t.size,t.size),this._computeDelta(e,f,n.labelsAnimationTime),this._updateAnimationState(e,f,h),r.bindFramebuffer(i),r.setViewport(o,s,u,c)}}}},{key:"_computeDelta",value:function(e,t,r){var n=e.context,i=e.painter,a=e.displayLevel,o=i.materialManager.getProgram(e,this._desc,["delta"]);n.bindFramebuffer(t),n.setClearColor(0,0,0,0),n.clear(n.gl.COLOR_BUFFER_BIT),n.useProgram(o),o.setUniform1i("u_maskTexture",ke.r),o.setUniform1i("u_sourceTexture",ke.s),o.setUniform1f("u_timeDelta",e.deltaTime),o.setUniform1f("u_animationTime",r),o.setUniform1f("u_zoomLevel",Math.round(10*a)),this._quad.draw()}},{key:"_updateAnimationState",value:function(e,t,r){var n=e.context,i=e.painter.materialManager.getProgram(e,this._desc,["update"]);n.bindTexture(t.colorTexture,1),n.useProgram(i),i.setUniform1i("u_sourceTexture",1),n.bindFramebuffer(r),n.setClearColor(0,0,0,0),n.clear(n.gl.COLOR_BUFFER_BIT),this._quad.draw()}}]),r}(er),nr=function(e){return"#define ".concat(function(e){return e.replace("-","_").toUpperCase()}(e),"\n")},ir={attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:function(e){return{vertexShader:nr(e)+Object(re.a)("blend/blend.vert"),fragmentShader:nr(e)+Object(re.a)("blend/blend.frag")}}},ar=ye.a.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect"),or=function(){function e(){Object(a.a)(this,e),this._size=[0,0]}return Object(o.a)(e,[{key:"dispose",value:function(e){this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null),this._programCache&&(this._programCache.dispose(),this._programCache=null),this._quad&&(this._quad.dispose(),this._quad=null)}},{key:"draw",value:function(e,t,r,n,i){var a=e.context,o=e.drawPhase;if(this._setupShader(a),n&&"normal"!==n&&o!==F.c.LABEL)this._drawBlended(e,t,r,n,i);else{var s=this._programCache.getProgram(ir,"normal");if(s){a.useProgram(s),t.setSamplingMode(r),a.bindTexture(t,0),s.setUniform1i("u_layerTexture",0),s.setUniform1f("u_opacity",i),a.setBlendingEnabled(!0),a.setBlendFunction(1,771);var u=this._quad;u.draw(),u.unbind()}else ar.error(new p.a("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'))}}},{key:"_drawBlended",value:function(e,t,r,n,i){var a,o,s=e.context,u=e.state,c=e.pixelRatio,l=e.inFadeTransition,h=u.size,f=s.getBoundFramebufferObject();if(Object(I.i)(f)){var d=f.descriptor;a=d.width,o=d.height}else a=Math.round(c*h[0]),o=Math.round(c*h[1]);this._createOrResizeTexture(e,a,o);var v=this._backBufferTexture;f.copyToTexture(0,0,a,o,0,0,v),s.setStencilTestEnabled(!1),s.setStencilWriteMask(0),s.setBlendingEnabled(!0),s.setDepthTestEnabled(!1),s.setDepthWriteEnabled(!1);var m=this._programCache.getProgram(ir,n);if(m){s.useProgram(m),v.setSamplingMode(r),s.bindTexture(v,0),m.setUniform1i("u_backbufferTexture",0),t.setSamplingMode(r),s.bindTexture(t,1),m.setUniform1i("u_layerTexture",1),m.setUniform1f("u_opacity",i),m.setUniform1f("u_inFadeOpacity",l?1:0),s.setBlendFunction(1,0);var g=this._quad;g.draw(),g.unbind(),s.setBlendFunction(1,771)}else ar.error(new p.a("mapview-BlendEffect","Error creating shader program for blend mode ".concat(n)))}},{key:"_setupShader",value:function(e){this._programCache||(this._programCache=new ae.a(e),this._quad||(this._quad=new Qt.a(e,[-1,-1,1,-1,-1,1,1,1])))}},{key:"_createOrResizeTexture",value:function(e,t,r){var n=e.context;null!==this._backBufferTexture&&t===this._size[0]&&r===this._size[1]||(this._backBufferTexture?this._backBufferTexture.resize(t,r):this._backBufferTexture=new S.a(n,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:t,height:r}),this._size[0]=t,this._size[1]=r)}}]),e}();function sr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ur(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ur(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ur(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function cr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var lr=function(e){Object(c.a)(r,e);var t=cr(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this)).name=n.constructor.name,n.defines=[e],n}return Object(o.a)(r,[{key:"dispose",value:function(){}},{key:"bind",value:function(e){var t=e.context,r=e.painter;this._prev=t.getBoundFramebufferObject();var n=t.getViewport(),i=n.width,a=n.height,o=r.getFbos(i,a).effect0;t.bindFramebuffer(o),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(){}},{key:"draw",value:function(e,t){var r=e.context,n=e.painter,i=e.state,a=e.deltaTime,o=n.getPostProcessingEffects(t.effects),s=r.getBoundFramebufferObject();o.length&&t.transitionStep(a,i.scale);var u,c=sr(o);try{for(c.s();!(u=c.n()).done;){var l=u.value,h=l.postProcessingEffect,f=l.effect;h.draw(e,s,f)}}catch(d){c.e(d)}finally{c.f()}r.bindFramebuffer(this._prev),r.setStencilTestEnabled(!1),n.blitTexture(r,s.colorTexture,9728),r.setStencilTestEnabled(!0)}}]),r}(er),hr=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],fr=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],dr=.7,pr=.7,vr=.7,mr=0,gr=ye.a.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");var _r=[0,0,0,0],yr=function(){function e(){Object(a.a)(this,e),this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:mr,outlineWidth:dr,innerHaloWidth:vr,outerHaloWidth:pr},this.shadeTexChanged=!0,this.texelData=new Uint8Array(1024),this.minMaxDistance=[0,0]}return Object(o.a)(e,[{key:"setHighlightOptions",value:function(e){var t=this._convertedHighlightOptions;!function(e,t){t.fillColor[0]=e.color.r/255,t.fillColor[1]=e.color.g/255,t.fillColor[2]=e.color.b/255,t.fillColor[3]=e.color.a,e.haloColor?(t.outlineColor[0]=e.haloColor.r/255,t.outlineColor[1]=e.haloColor.g/255,t.outlineColor[2]=e.haloColor.b/255,t.outlineColor[3]=e.haloColor.a):(t.outlineColor[0]=t.fillColor[0],t.outlineColor[1]=t.fillColor[1],t.outlineColor[2]=t.fillColor[2],t.outlineColor[3]=t.fillColor[3]),t.fillColor[3]*=e.fillOpacity,t.outlineColor[3]*=e.haloOpacity,t.fillColor[0]*=t.fillColor[3],t.fillColor[1]*=t.fillColor[3],t.fillColor[2]*=t.fillColor[3],t.outlineColor[0]*=t.outlineColor[3],t.outlineColor[1]*=t.outlineColor[3],t.outlineColor[2]*=t.outlineColor[3],t.outlineWidth=dr,t.outerHaloWidth=pr,t.innerHaloWidth=vr,t.outlinePosition=mr}(e,t);var r,n=t.outlinePosition-t.outlineWidth/2-t.outerHaloWidth,i=t.outlinePosition-t.outlineWidth/2,a=t.outlinePosition+t.outlineWidth/2,o=t.outlinePosition+t.outlineWidth/2+t.innerHaloWidth,s=1*Math.sqrt(Math.PI/2),u=Math.abs(n)>s?Math.round(10*(Math.abs(n)-s))/10:0,c=Math.abs(o)>s?Math.round(10*(Math.abs(o)-s))/10:0;u&&!c?gr.error("The outer rim of the highlight is "+u+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!u&&c?gr.error("The inner rim of the highlight is "+c+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):u&&c&&gr.error("The highlight is "+Math.max(u,c)+"px away from the edge of the feature; consider reducing some width values.");var l=[void 0,void 0,void 0,void 0];function h(e,t,r){l[0]=(1-r)*e[0]+r*t[0],l[1]=(1-r)*e[1]+r*t[1],l[2]=(1-r)*e[2]+r*t[2],l[3]=(1-r)*e[3]+r*t[3]}for(var f=this.texelData,d=0;d<256;++d){var p,v,m,g;(r=n+d/255*(o-n))<n?(l[4*d+0]=0,l[4*d+1]=0,l[4*d+2]=0,l[4*d+3]=0):r<i?h(_r,t.outlineColor,(r-n)/(i-n)):r<a?(p=t.outlineColor,v=Object(Ze.a)(p,4),l[0]=v[0],l[1]=v[1],l[2]=v[2],l[3]=v[3]):r<o?h(t.outlineColor,t.fillColor,(r-a)/(o-a)):(m=t.fillColor,g=Object(Ze.a)(m,4),l[4*d+0]=g[0],l[4*d+1]=g[1],l[4*d+2]=g[2],l[4*d+3]=g[3]),f[4*d+0]=255*l[0],f[4*d+1]=255*l[1],f[4*d+2]=255*l[2],f[4*d+3]=255*l[3]}this.minMaxDistance[0]=n,this.minMaxDistance[1]=o,this.shadeTexChanged=!0}},{key:"applyHighlightOptions",value:function(e,t){this.shadeTex||(this.shadeTex=new S.a(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:256,height:1,samplingMode:9729})),this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,256,1,this.texelData),this.shadeTexChanged=!1),e.bindTexture(this.shadeTex,ke.y),t.setUniform2fv("u_minMaxDistance",this.minMaxDistance)}},{key:"destroy",value:function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)}}]),e}(),br={shaders:{vertexShader:Object(re.a)("highlight/textured.vert"),fragmentShader:Object(re.a)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},wr={shaders:{vertexShader:Object(re.a)("highlight/textured.vert"),fragmentShader:Object(re.a)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},xr=function(){function e(){Object(a.a)(this,e),this._width=void 0,this._height=void 0,this._resources=null}return Object(o.a)(e,[{key:"dispose",value:function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}},{key:"preBlur",value:function(e,t){e.bindTexture(t,ke.x),e.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",hr),e.bindVAO(this._resources.quadVAO),e.drawArrays(5,0,4),e.bindVAO()}},{key:"finalBlur",value:function(e,t){e.bindTexture(t,ke.x),e.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",fr),e.bindVAO(this._resources.quadVAO),e.drawArrays(5,0,4),e.bindVAO()}},{key:"renderHighlight",value:function(e,t,r){e.bindTexture(t,ke.x),e.useProgram(this._resources.highlightProgram),r.applyHighlightOptions(e,this._resources.highlightProgram),e.bindVAO(this._resources.quadVAO),e.setBlendingEnabled(!0),e.setBlendFunction(1,771),e.drawArrays(5,0,4),e.bindVAO()}},{key:"_initialize",value:function(e,t,r){this._width=t,this._height=r;var n=k.a.createVertex(e,35044,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),i=new T.a(e,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:n}),a=Object(M.a)(e,br),o=Object(M.a)(e,wr);a.setUniform1i("u_texture",ke.x),a.setUniform1i("u_shade",ke.y),a.setUniform1f("u_sigma",1),o.setUniform1i("u_texture",ke.x),o.setUniform1f("u_sigma",1),this._resources={quadGeometry:n,quadVAO:i,highlightProgram:a,blurProgram:o}}},{key:"setup",value:function(e,t,r){this._resources?(this._width=t,this._height=r):this._initialize(e,t,r)}}]),e}();function Or(e,t,r){var n=new S.a(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:t,height:r,samplingMode:9729});return[n,new j.a(e,{colorTarget:0,depthStencilTarget:2},n)]}var kr=function(){function e(){Object(a.a)(this,e),this._width=void 0,this._height=void 0,this._resources=null}return Object(o.a)(e,[{key:"dispose",value:function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}},{key:"_initialize",value:function(e,t,r){this._width=t,this._height=r;var n=Or(e,t,r),i=Object(Ze.a)(n,2),a=i[0],o=i[1],s=Or(e,t,r),u=Object(Ze.a)(s,2),c=u[0],l=u[1];this._resources={sharedBlur1Tex:a,sharedBlur1Fbo:o,sharedBlur2Tex:c,sharedBlur2Fbo:l}}},{key:"setup",value:function(e,t,r){!this._resources||this._width===t&&this._height===r||this.dispose(),this._resources||this._initialize(e,t,r)}},{key:"sharedBlur1Tex",get:function(){return this._resources.sharedBlur1Tex}},{key:"sharedBlur1Fbo",get:function(){return this._resources.sharedBlur1Fbo}},{key:"sharedBlur2Tex",get:function(){return this._resources.sharedBlur2Tex}},{key:"sharedBlur2Fbo",get:function(){return this._resources.sharedBlur2Fbo}}]),e}();function jr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var Cr=function(e){Object(c.a)(r,e);var t=jr(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).defines=["highlight"],e._hlRenderer=new xr,e._hlGradient=new yr,e._width=void 0,e._height=void 0,e._hlSurfaces=new kr,e._adjustedWidth=void 0,e._adjustedHeight=void 0,e._blitRenderer=new ie,e}return Object(o.a)(r,[{key:"dispose",value:function(){this._hlSurfaces&&this._hlSurfaces.dispose(),this._hlRenderer&&this._hlRenderer.dispose(),this._hlGradient&&this._hlGradient.destroy(),this._boundFBO=null}},{key:"bind",value:function(e){var t=e.context,r=e.painter,n=t.getViewport(),i=n.width,a=n.height,o=r.getFbos(i,a).effect0;this.setup(e,i,a),t.bindFramebuffer(o),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(){}},{key:"setup",value:function(e,t,r){var n=e.context;this._width=t,this._height=r;var i=t%4,a=r%4;t+=i<2?-i:4-i,r+=a<2?-a:4-a,this._adjustedWidth=t,this._adjustedHeight=r,this._boundFBO=n.getBoundFramebufferObject();var o=Math.round(1*t),s=Math.round(1*r);this._hlRenderer.setup(n,o,s),this._hlSurfaces.setup(n,o,s)}},{key:"draw",value:function(e){var t=e.context,r=t.getBoundFramebufferObject();t.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setStencilTestEnabled(!1),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(t,r.colorTexture,9728,1),t.setStencilTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!0),t.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(t,this._hlSurfaces.sharedBlur1Tex),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(t,this._hlSurfaces.sharedBlur2Tex),t.bindFramebuffer(this._boundFBO),t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(t,this._hlSurfaces.sharedBlur1Tex,this._hlGradient),this._boundFBO=null}},{key:"setHighlightOptions",value:function(e){this._hlGradient.setHighlightOptions(e)}}]),r}(er);function Mr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var Sr=function(e){Object(c.a)(r,e);var t=Mr(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).name=e.constructor.name,e.defines=["id"],e._lastSize=0,e}return Object(o.a)(r,[{key:"dispose",value:function(){Object(I.i)(this._fbo)&&this._fbo.dispose()}},{key:"bind",value:function(e){var t=e.context,r=e.painter,n=t.getViewport(),i=n.width,a=n.height,o=r.getFbos(i,a).effect0;t.bindFramebuffer(o),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(){}},{key:"draw",value:function(e,t){var r=this,n=e.context,i=e.state,a=e.pixelRatio,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ke.j,s=n.getBoundFramebufferObject(),u=i.size[1]*a,c=Math.round(o*a),l=c/2,h=c/2;this._ensureBuffer(c),t.forEach((function(e,n){var i=new Map,o=Math.floor(n[0]*a-c/2),f=Math.floor(u-n[1]*a-c/2);s.readPixels(o,f,c,c,6408,5121,r._buf);for(var d=0;d<r._buf32.length;d++){var p=r._buf32[d];if(4294967295!==p&&0!==p){var v=d%c,m=c-Math.floor(d/c),g=(l-v)*(l-v)+(h-m)*(h-m),_=i.has(p)?i.get(p):4294967295;i.set(p,Math.min(g,_))}}var y=Array.from(i).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}));e.resolve(y),t.delete(n)}))}},{key:"_ensureBuffer",value:function(e){this._lastSize!==e&&(this._lastSize=e,this._buf=new Uint8Array(4*e*e),this._buf32=new Uint32Array(this._buf.buffer))}}]),r}(er);function Tr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Rr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Rr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Rr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Pr(e){switch(e){case"bloom":case"blur":case"opacity":case"drop-shadow":return e;default:return"colorize"}}var Fr,Ir,Ar,Dr,Br,zr={colorize:(Br=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(156).then(r.bind(null,"FdZX"));case 2:return e.t0=e.sent.Colorize,e.abrupt("return",new e.t0);case 4:case"end":return e.stop()}}),e)}))),function(){return Br.apply(this,arguments)}),blur:(Dr=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(155).then(r.bind(null,"C+mL"));case 2:return e.t0=e.sent.Blur,e.abrupt("return",new e.t0);case 4:case"end":return e.stop()}}),e)}))),function(){return Dr.apply(this,arguments)}),bloom:(Ar=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(154).then(r.bind(null,"Z0Xb"));case 2:return e.t0=e.sent.Bloom,e.abrupt("return",new e.t0);case 4:case"end":return e.stop()}}),e)}))),function(){return Ar.apply(this,arguments)}),opacity:(Ir=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(158).then(r.bind(null,"t2dW"));case 2:return e.t0=e.sent.Opacity,e.abrupt("return",new e.t0);case 4:case"end":return e.stop()}}),e)}))),function(){return Ir.apply(this,arguments)}),"drop-shadow":(Fr=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(157).then(r.bind(null,"8lCb"));case 2:return e.t0=e.sent.DropShadow,e.abrupt("return",new e.t0);case 4:case"end":return e.stop()}}),e)}))),function(){return Fr.apply(this,arguments)})},Er=function(){function e(t){Object(a.a)(this,e),this._requestRender=t,this._effectMap=new Map,this._effectPromiseMap=new Map}var t,r;return Object(o.a)(e,[{key:"dispose",value:function(){this._requestRender&&(this._requestRender=null),this._effectMap.forEach((function(e){return e.dispose()})),this._effectMap.clear(),this._effectPromiseMap.clear()}},{key:"getPostProcessingEffects",value:function(e){if(!e||0===e.length)return[];var t,r=[],n=Tr(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=Pr(i.type),o=this._effectMap.get(a);o?r.push({postProcessingEffect:o,effect:i}):this._enablePostProcessingEffect(a)}}catch(s){n.e(s)}finally{n.f()}return r}},{key:"_enablePostProcessingEffect",value:(r=Object(i.a)(d.a.mark((function e(t){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._loadPostProcessingEffect(t);case 2:r=e.sent,this._requestRender&&(this._effectMap.set(t,r),this._requestRender.requestRender());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_loadPostProcessingEffect",value:(t=Object(i.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this._effectPromiseMap.has(t)||this._effectPromiseMap.set(t,zr[t]()),this._effectPromiseMap.get(t)));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Ur=r("X6u8");function Lr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Vr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Vr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Nr=function(){function e(t,r){var n;Object(a.a)(this,e),this.brushes=t,this.name=r.name,this.drawPhase=r.drawPhase||F.c.MAP,this._targetFn=r.target,this.effects=r.effects||[],this.enableDefaultDraw=null!=(n=r.enableDefaultDraw)?n:function(){return!0}}return Object(o.a)(e,[{key:"render",value:function(e){var t=e.context,r=e.profiler,n=this._targetFn(),i=this.drawPhase&e.drawPhase;if(r.recordPassStart(this.name),i){this.enableDefaultDraw()&&this._doRender(e,n),r.recordPassEnd();var a,o=Lr(this.effects);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.enable()){var u=s.apply;r.recordPassStart(this.name+"."+u.name),r.recordBrushStart(u.name);var c=s.args&&s.args(),l=t.getViewport(),h=l.x,f=l.y,d=l.width,p=l.height,v=t.getBoundFramebufferObject();u.bind(e,c),this._doRender(e,n,u.defines),u.draw(e,c),u.unbind(e,c),t.bindFramebuffer(v),t.setViewport(h,f,d,p),r.recordBrushEnd(),r.recordPassEnd()}}}catch(m){o.e(m)}finally{o.f()}}}},{key:"_doRender",value:function(e,t,r){if(!Object(I.h)(t))if(Object(Ur.g)(t)){var n,i=Lr(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.visible){var o,s=Lr(this.brushes);try{for(s.s();!(o=s.n()).done;){var u=o.value;e.profiler.recordBrushStart(u.name),u.prepareState(e,a,r),u.draw(e,a,r),e.profiler.recordBrushEnd()}}catch(f){s.e(f)}finally{s.f()}}}}catch(f){i.e(f)}finally{i.f()}}else{var c,l=Lr(this.brushes);try{for(l.s();!(c=l.n()).done;){var h=c.value;e.profiler.recordBrushStart(h.name),h.prepareState(e,t,r),h.draw(e,t,r),e.profiler.recordBrushEnd()}}catch(f){l.e(f)}finally{l.f()}}}}]),e}();function Hr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return qr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function qr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Wr(e,t,r){return 1!==r||Object(I.i)(e)&&"normal"!==e||Object(I.i)(t)&&t.length>0}var Gr=function(){function e(t,r){Object(a.a)(this,e),this.context=t,this._blitRenderer=new ie,this._brushCache=new Map,this._vtlMaterialManager=new te,this._blendEffect=new or,this.effects={highlight:new Cr,hittest:new Sr,integrate:new rr,insideEffect:new lr("inside"),outsideEffect:new lr("outside")},this.materialManager=new me(t),this.textureManager=new $t(r),this._effectsManager=new Er(r)}return Object(o.a)(e,[{key:"vectorTilesMaterialManager",get:function(){return this._vtlMaterialManager}},{key:"getRenderTarget",value:function(){return this._renderTarget}},{key:"setRenderTarget",value:function(e){this._renderTarget=e}},{key:"getFbos",value:function(e,t){if(e!==this._lastWidth||t!==this._lastHeight){if(this._lastWidth=e,this._lastHeight=t,this._fbos){for(var r in this._fbos)this._fbos[r].resize(e,t);return this._fbos}var n={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:e,height:t},i={colorTarget:0,depthStencilTarget:3},a=new A.a(this.context,{width:e,height:t,internalFormat:34041});this._stencilBuf=a,this._fbos={output:new j.a(this.context,i,n,a),blend:new j.a(this.context,i,n,a),effect0:new j.a(this.context,i,n,a)}}return this._fbos}},{key:"getSharedStencilBuffer",value:function(){return this._stencilBuf}},{key:"beforeRenderLayers",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=e.getViewport(),n=r.width,i=r.height;this._prevFBO=e.getBoundFramebufferObject();var a=this.getFbos(n,i);if(e.bindFramebuffer(a.output),e.setColorMask(!0,!0,!0,!0),e.setDepthWriteEnabled(!0),Object(I.i)(t)){var o=t.color,s=o.r,u=o.g,c=o.b,l=o.a;e.setClearColor(l*s/255,l*u/255,l*c/255,l)}else e.setClearColor(0,0,0,0);e.setClearDepth(1),e.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT),e.setDepthWriteEnabled(!1)}},{key:"beforeRenderLayer",value:function(e,t,r){var n=e.context,i=e.blendMode,a=e.effects;if(e.requireFBO||Wr(i,a,r))n.bindFramebuffer(this._fbos.blend),n.setColorMask(!0,!0,!0,!0),n.setClearColor(0,0,0,0),n.setDepthWriteEnabled(!0),n.setClearDepth(1),n.clear(n.gl.COLOR_BUFFER_BIT|n.gl.DEPTH_BUFFER_BIT),n.setDepthWriteEnabled(!1);else{var o=this._getOutputFBO();n.bindFramebuffer(o)}n.setDepthWriteEnabled(!1),n.setDepthTestEnabled(!1),n.setStencilTestEnabled(!0),n.setClearStencil(t),n.setStencilWriteMask(255),n.clear(n.gl.STENCIL_BUFFER_BIT)}},{key:"compositeLayer",value:function(e,t){var r=e.context,n=e.blendMode,i=e.effects;if(e.requireFBO||Wr(n,i,t)){Object(I.i)(i)&&i.length>0&&e.drawPhase===F.c.MAP&&this._applyEffects(e,i);var a=this._getOutputFBO();r.bindFramebuffer(a),r.setStencilTestEnabled(!1),r.setStencilWriteMask(0),r.setBlendingEnabled(!0),r.setBlendFunctionSeparate(1,771,1,771),r.setColorMask(!0,!0,!0,!0);var o=Object(I.i)(n)?n:"normal";this._blendEffect.draw(e,this._fbos.blend.colorTexture,9728,o,t)}}},{key:"renderLayers",value:function(e){if(e.bindFramebuffer(this._prevFBO),this._fbos){var t=this._getOutputFBO();e.setStencilTestEnabled(!1),e.setStencilWriteMask(0),this.blitTexture(e,t.colorTexture,9728)}}},{key:"dispose",value:function(){if(this.materialManager.dispose(),this.textureManager.dispose(),this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null),this._brushCache&&(this._brushCache.forEach((function(e){return e.dispose()})),this._brushCache.clear(),this._brushCache=null),this._fbos)for(var e in this._fbos)this._fbos[e]&&this._fbos[e].dispose();if(this.effects)for(var t in this.effects)this.effects[t]&&this.effects[t].dispose();this._vtlMaterialManager&&(this._vtlMaterialManager.dispose(),this._vtlMaterialManager=null),this._prevFBO=null}},{key:"getGeometryBrush",value:function(e){var t,r=(t={},Object(n.a)(t,F.d.FILL,D.a.fill),Object(n.a)(t,F.d.LINE,D.a.line),Object(n.a)(t,F.d.MARKER,D.a.marker),Object(n.a)(t,F.d.TEXT,D.a.text),t)[e],i=this._brushCache.get(r);return void 0===i&&(i=new r,this._brushCache.set(r,i)),this._brushCache.get(r)}},{key:"renderObject",value:function(e,t,r,n){var i=D.a[r];if(!i)return null;var a=this._brushCache.get(i);void 0===a&&(a=new i,this._brushCache.set(i,a)),a.prepareState(e,t,n),a.draw(e,t,n)}},{key:"renderObjects",value:function(e,t,r,n){var i=D.a[r];if(!i)return null;var a=this._brushCache.get(i);void 0===a&&(a=new i,this._brushCache.set(i,a)),a.drawMany(e,t,n)}},{key:"registerRenderPass",value:function(e){var t=this,r=e.brushes.map((function(e){return t._brushCache.has(e)||t._brushCache.set(e,new e),t._brushCache.get(e)}));return new Nr(r,e)}},{key:"setHighlightOptions",value:function(e){this.effects.highlight.setHighlightOptions(e)}},{key:"blitTexture",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(e,t,r,n)}},{key:"getPostProcessingEffects",value:function(e){return this._effectsManager.getPostProcessingEffects(e)}},{key:"_getOutputFBO",value:function(){return null!=this._renderTarget?this._renderTarget:this._fbos.output}},{key:"_applyEffects",value:function(e,t){var r,n=e.context,i=Hr(this._effectsManager.getPostProcessingEffects(t));try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.postProcessingEffect,s=a.effect;n.bindFramebuffer(this._fbos.blend),o.draw(e,this._fbos.blend,s)}}catch(u){i.e(u)}finally{i.f()}}}]),e}(),Zr=r("pyQ+"),Yr=r("v3KF"),Kr=r("aBkb");function Xr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Jr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Jr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Jr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var $r=Object(m.a)("esri-2d-profiler"),Qr=function(){function e(t,r){var n=this;if(Object(a.a)(this,e),this._events=new Yr.a,this._entries=new Map,this._timings=new Zr.a(10),$r){this._ext=Object(Kr.a)(t.gl,{}),this._debugOutput=r;var i=t.gl;if(this.enableCommandLogging){var o=function(e){if("function"==typeof i[e]){var t=i[e],r=-1!==e.indexOf("draw");i[e]=function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return n._events.emit("command",{container:n._currentContainer,pass:n._currentPass,brush:n._currentBrush,method:e,args:o,isDrawCommand:r}),n._currentSummary&&(n._currentSummary.commands++,r&&n._currentSummary.drawCommands++),t.apply(i,o)}}};for(var s in i)o(s)}}}return Object(o.a)(e,[{key:"enableCommandLogging",get:function(){return!("object"==typeof $r&&$r.disableCommands)}},{key:"recordContainerStart",value:function(e){$r&&(this._currentContainer=e)}},{key:"recordContainerEnd",value:function(){$r&&(this._currentContainer=null)}},{key:"recordPassStart",value:function(e){$r&&(this._currentPass=e,this._initSummary())}},{key:"recordPassEnd",value:function(){$r&&(this._currentPass=null,this._emitSummary())}},{key:"recordBrushStart",value:function(e){$r&&(this._currentBrush=e)}},{key:"recordBrushEnd",value:function(){$r&&(this._currentBrush=null)}},{key:"recordStart",value:function(e){if($r&&Object(I.i)(this._ext)){if(this._entries.has(e)){var t=this._entries.get(e),r=this._ext.resultAvailable(t.query),n=this._ext.disjoint();if(r&&!n){var i=this._ext.getResult(t.query)/1e6,a=0;if(Object(I.i)(this._timings.enqueue(i))){var o,s=this._timings.entries,u=s.length,c=0,l=Xr(s);try{for(l.s();!(o=l.n()).done;){c+=o.value}}catch(m){l.e(m)}finally{l.f()}a=c/u}var h=i.toFixed(2),f=a?a.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed("Frame report for ".concat(e,", ").concat(h," ms (").concat(f," last 10 avg)\n").concat(t.commandsLen," Commands (").concat(t.drawCommands," draw)")),console.log("RenderPass breakdown: "),console.table(t.summaries),console.log("Commands: ",t.commands),console.groupEnd()):console.log("Frame report for ".concat(e,", ").concat(h," ms (").concat(f," last 10 avg)")),this._debugOutput.innerHTML="".concat(h," (").concat(f,")")}var d,p=Xr(t.handles);try{for(p.s();!(d=p.n()).done;){d.value.remove()}}catch(m){p.e(m)}finally{p.f()}this._entries.delete(e)}var v={name:e,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(v.handles.push(this._events.on("command",(function(e){v.commandsLen++,v.commands.push(e),e.isDrawCommand&&v.drawCommands++}))),v.handles.push(this._events.on("summary",(function(e){v.summaries.push(e)})))),this._ext.beginTimeElapsed(v.query),this._entries.set(e,v)}}},{key:"recordEnd",value:function(e){$r&&Object(I.i)(this._ext)&&this._entries.has(e)&&this._ext.endTimeElapsed()}},{key:"_initSummary",value:function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}},{key:"_emitSummary",value:function(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary)}}]),e}(),en=r("2P+X"),tn=ye.a.getLogger("esri.views.2d.engine.webgl.WebGLDriverTest"),rn=function(){function e(t){var r=this;Object(a.a)(this,e),this.svgAlwaysPremultipliesAlpha=!1,this._ignoresSamplerPrecision=null,this._context=t,Object(en.a)(t).then((function(e){r.svgAlwaysPremultipliesAlpha=!e}))}return Object(o.a)(e,[{key:"ignoresSamplerPrecision",get:function(){return Object(I.h)(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=nn(this._context)),this._ignoresSamplerPrecision}}]),e}(),nn=function(e){var t=new j.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),r=new Uint8Array(4),n=new Qt.a(e,[0,0,1,0,0,1,1,1]),i=new B.a(e,"\nprecision highp float;\n\nattribute vec2 a_pos;\n\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset = pow(2.0, float(bitIndex));\n\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value = texture2D(u_texture, vec2(0.0));\n\n  float bit = getBit(value.x * 255.0, 1);\n\n  v_color = bit * vec4(1.0);\n\n  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n","\nprecision highp float;\n\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}\n",new Map([["a_pos",0]])),a=new S.a(e,{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([2,255,0,0]));i.setUniform1i("u_texture",0),e.bindTexture(a,0);var o=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(i);var s=e.getViewport(),u=s.x,c=s.y,l=s.width,h=s.height;e.setViewport(0,0,1,1),n.draw(),e.setViewport(u,c,l,h),t.readPixels(0,0,1,1,6408,5121,r),i.dispose(),n.dispose(),t.dispose();var f=255!==r[0]||255!==r[1]||255!==r[2]||255!==r[3];return f&&tn.warn("A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [".concat(r[0],".").concat(r[1],".").concat(r[2],".").concat(r[3],"]")),e.bindFramebuffer(o),f},an=r("6CzD");function on(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return sn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sn(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function sn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var un=function(){function e(t,r,n,i,o){Object(a.a)(this,e),this.target=t,this.geometryType=r,this.materialKey=n,this.indexFrom=i,this.indexCount=o}return Object(o.a)(e,[{key:"indexEnd",get:function(){return this.indexFrom+this.indexCount}},{key:"extend",value:function(e){this.indexCount+=e}},{key:"draw",value:function(e,t,r){this.target.draw(e,t,r,this.indexFrom,this.indexCount)}}]),e}(),cn=function(){function e(t){Object(a.a)(this,e),this._infos=new Array,this._target=t}return Object(o.a)(e,[{key:"_last",get:function(){return this._infos[this._infos.length-1]}},{key:"add",value:function(e){var t=e.materialKey,r=e.indexFrom,n=e.indexCount;if(this._infos.length&&e.materialKey===this._last.materialKey&&e.indexFrom===this._last.indexEnd)this._last.extend(n);else{var i=new un(this._target,this.geometryType,t,r,n);this._infos.push(i)}}},{key:"forEach",value:function(e){var t,r=on(this._infos);try{for(r.s();!(t=r.n()).done;){e(t.value)}}catch(n){r.e(n)}finally{r.f()}}}],[{key:"from",value:function(t,r){for(var n=new e(t);r.next();)n.add(r);return n}}]),e}(),ln=function(){function e(t){if(Object(a.a)(this,e),Array.isArray(t)){this.data=t[0];for(var r=this,n=1;n<t.length;n++)r.next=new e([t[n]]),r=r.next}else this.data=t}return Object(o.a)(e,[{key:"find",value:function(e){var t;return e(this.data)?this:null==(t=this.next)?void 0:t.find(e)}},{key:"max",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,r=e(this.data)>e(t.data)?this:t;return this.next?this.next.max(e,r):r}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this===e?t?(t.next=this.next,t):this.next:this.next.remove(e,this)}},{key:"last",get:function(){return this.next?this.next.last:this}}]),e}(),hn=function(){function e(t){Object(a.a)(this,e),this._head=null,Object(I.h)(t)||(this._head=new ln(t))}return Object(o.a)(e,[{key:"head",get:function(){return this._head}},{key:"maxAvailableSpace",value:function(){if(Object(I.h)(this._head))return 0;var e=this._head.max((function(e){return e.end-e.start}));return e.data.end-e.data.start}},{key:"firstFit",value:function(e){if(Object(I.h)(this._head))return null;for(var t=null,r=this._head;r;){var n=r.data.end-r.data.start;if(n===e)return t?t.next=r.next:this._head=r.next,r.data.start;if(n>e){var i=r.data.start;return r.data.start+=e,i}t=r,r=r.next}return null}},{key:"free",value:function(e,t){var r=e+t;if(Object(I.h)(this._head)){var n=new ln({start:e,end:r});this._head=n}else{if(r<=this._head.data.start){if(r===this._head.data.start)return void(this._head.data.start-=t);var i=new ln({start:e,end:r});return i.next=this._head,void(this._head=i)}for(var a=this._head,o=a.next;o;){if(o.data.start>=r){if(a.data.end===e)return void(a.data.end+=t);if(o.data.start===r)return void(o.data.start-=t);var s=new ln({start:e,end:r});return s.next=a.next,void(a.next=s)}a=o,o=o.next}if(e!==a.data.end){var u=new ln({start:e,end:r});a.next=u}else a.data.end+=t}}}]),e}(),fn=function(){function e(t,r,n){Object(a.a)(this,e);var i=new Uint32Array(r*n);this.strideInt=n,this.bufferType=t,this.dirty={start:1/0,end:0},this.cpu=i,this.gpu=null,this.clear()}return Object(o.a)(e,[{key:"destroy",value:function(){Object(I.a)(this.gpu,(function(e){return e.dispose()}))}},{key:"clear",value:function(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new hn({start:0,end:this.cpu.length/this.strideInt}),this.fillPointer=0}},{key:"bufferSize",get:function(){return this.cpu.length/this.strideInt}},{key:"maxAvailableSpace",value:function(){return this.freeList.maxAvailableSpace()}},{key:"insert",value:function(e,t,r,n){var i=r*this.strideInt,a=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,o=new Uint32Array(e,a,i),s=Object(I.r)(this.freeList.firstFit(r),"First fit region must be defined"),u=s*this.strideInt,c=i*this.strideInt,l=s-t;if(0!==n)for(var h=0;h<o.length;h++)o[h]+=n;return this.cpu.set(o,u),this.dirty.start=Math.min(this.dirty.start,u),this.dirty.end=Math.max(this.dirty.end,u+c),this.fillPointer=Math.max(this.fillPointer,u+c),l}},{key:"free",value:function(e,t,r){var n=e*this.strideInt,i=(e+t)*this.strideInt;if(!0===r)for(var a=e;a!==e+t;a++)this.cpu[a*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,n),this.dirty.end=Math.max(this.dirty.end,i),this.freeList.free(e,t)}},{key:"upload",value:function(e){if(this.dirty.end){if(Object(I.h)(this.gpu))return this.gpu=this._createBuffer(e),this.dirty.start=1/0,void(this.dirty.end=0);this.gpu.setSubData(this.cpu,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}},{key:"_createBuffer",value:function(e){return"index"===this.bufferType?k.a.createIndex(e,35048,this.cpu):k.a.createVertex(e,35048,this.cpu)}}]),e}(),dn=r("BIYm"),pn=r("/esu");function vn(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return mn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mn(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function mn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var gn=function(){function e(t,r,n,i,o){Object(a.a)(this,e),this._vaoInvalidated=!0;var s=Object(pn.a)(r),u=Math.max(s.indicesPerRecord*s.multiplier*n,o+1),c=Math.max(s.verticesPerRecord*s.multiplier*n,i+1),l=t/Uint32Array.BYTES_PER_ELEMENT,h=new fn("index",u,1),f={geometry:new fn("vertex",c,l)};this.stride=t,this.strideInt=l,this.geometryType=r,this._buffers={index:h,vertex:f}}return Object(o.a)(e,[{key:"release",value:function(){this.isReleased||(this._pool.release(this),this._released=!0)}},{key:"destroy",value:function(){this._buffers.index.destroy(),this._buffers.vertex.geometry.destroy(),Object(I.a)(this._vao,(function(e){return e.dispose(!1)}))}},{key:"isReleased",get:function(){return this._released}},{key:"indexBufferSize",get:function(){return this._buffers.index.bufferSize}},{key:"vertexBufferSize",get:function(){return this._buffers.vertex.geometry.bufferSize}},{key:"displayList",get:function(){return Object(I.h)(this._displayList)&&(this._displayList=cn.from(this,this._records.getCursor())),this._displayList}},{key:"draw",value:function(e,t,r,n,i){this.upload(e);var a=this._getVAO(e,t,r),o=Uint32Array.BYTES_PER_ELEMENT*n;e.bindVAO(a),e.drawElements(4,i,5125,o),e.bindVAO(null)}},{key:"insert",value:function(e){if(!e.done){var t=e.vertexData,r=e.offset,n=t.records,i=t.indices,a=t.vertices,o=this._getInsertionInfo(dn.a.from(n,r)),s=o.vertFrom,u=o.vertCount,c=o.indexFrom,l=o.indexCount,h=o.recordCount,f=o.done;if(e.done=f,e.offset=h+r,0!==h){var d=this._buffers,p=d.index,v=d.vertex.geometry.insert(a,s,u,0),m=p.insert(i,c,l,v);this._addRecords(dn.a.from(n,r,h),m,v)}}}},{key:"free",value:function(e){for(var t=dn.a.from(e.records).getCursor();t.next();)this._freeId(t.id)}},{key:"freeIds",value:function(e){var t,r=vn(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this._freeId(n)}}catch(i){r.e(i)}finally{r.f()}}},{key:"upload",value:function(e){var t=this._buffers,r=t.index,n=t.vertex;r.upload(e),n.geometry.upload(e)}},{key:"has",value:function(e){if(!this._records)return!1;for(var t=this._records.getCursor();t.next();)if(t.id===e)return!0;return!1}},{key:"getViewOf",value:function(e){if(!this._records)return null;for(var t=this._records.getCursor();t.next();)if(t.id===e)return t;return null}},{key:"_getInsertionInfo",value:function(e){for(var t=e.getCursor(),r=this._buffers,n=r.index,i=r.vertex,a=n.maxAvailableSpace(),o=i.geometry.maxAvailableSpace(),s=0,u=null,c=0,l=null,h=0,f=!0;t.next();){null===l&&(l=t.vertexFrom,u=t.indexFrom);var d=h+t.vertexCount,p=c+t.indexCount;if(d>=o||p>=a){f=!1;break}s+=1,c=p,h=d}return{done:f,vertFrom:l,vertCount:h,indexFrom:u,indexCount:c,recordCount:s}}},{key:"_addRecords",value:function(e,t,r){for(var n=e.getCursor();n.next();)n.indexFrom+=t,n.vertexFrom+=r;this._records?(this._records.link(e),this._displayList=null):this._records=e}},{key:"_freeId",value:function(e){var t=this._records.getCursor(),r=this._buffers.index,n=this._buffers.vertex.geometry;if(t.lookup(e)){for(var i=t.indexFrom,a=t.indexCount,o=t.vertexFrom,s=t.vertexCount;t.next()&&t.id===e;)a+=t.indexCount,s+=t.vertexCount;r.free(i,a),n.free(o,s,!0),this._records.delete(e)}}},{key:"_getVAO",value:function(e,t,r){if(this._vaoInvalidated){var n=JSON.stringify(t)+JSON.stringify(Object(an.a)(r));n!==this._vaoHash&&(Object(I.a)(this._vao,(function(e){e.dispose(!1)})),this._vao=null,this._vaoHash=n),this._vaoInvalidated=!1}if(Object(I.h)(this._vao)){var i=this._buffers,a=i.index,o=i.vertex;if(Object(I.h)(o.geometry.gpu)||Object(I.h)(a.gpu))throw new Error("bad news");this._vao=new T.a(e,r,t,{geometry:o.geometry.gpu},a.gpu)}return this._vao}}],[{key:"createPooled",value:function(t,r,n,i,a,o,s){var u=Math.max(ke.d,Math.round(1.5*o)),c=Object(I.q)(t,(function(){return new e(r.stride,n,u,i,a)}));return c._buffers.index.clear(),c._buffers.vertex.geometry.clear(),c._records=null,c._displayList=null,c._vaoInvalidated=!0,c._pool=s,c._released=!1,c}}]),e}(),_n=function(){function e(){Object(a.a)(this,e),this._pools=new Map}return Object(o.a)(e,[{key:"acquire",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=dn.a.from(e.records,r),i=n.size();n.next();var a=n.vertexCount,o=n.indexCount,s=this._tryAcquire(e.stride,t,a,o);return gn.createPooled(s,e,t,a,o,i,this)}},{key:"release",value:function(e){e.isReleased||e.destroy()}},{key:"destroy",value:function(){this._pools.forEach((function(e){Object(I.i)(e)&&e.clear((function(e){return e.destroy()}))}))}},{key:"_tryAcquire",value:function(e,t,r,n){var i=e<<3|t,a=this._pools.get(i);if(Object(I.h)(a))return null;var o=a.dequeue();return Object(I.i)(o)&&o.vertexBufferSize>=r&&o.indexBufferSize>=n?o:null}}]),e}(),yn={shaders:{vertexShader:Object(re.a)("stencil/stencil.vert"),fragmentShader:Object(re.a)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])},bn=r("Q9Id"),wn=r("mIFe");function xn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function On(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xn(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function kn(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return jn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jn(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function jn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Cn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var Mn=function(e){Object(c.a)(n,e);var t,r=Cn(n);function n(e,t){var i;Object(a.a)(this,n),(i=r.call(this))._trash=new Set,i._clipData=new Float32Array(8),i._upperLeft=Object(O.a)(),i._upperRight=Object(O.a)(),i._lowerLeft=Object(O.a)(),i._lowerRight=Object(O.a)(),i._mat2=Object(w.a)(),i._clipRendererInitialized=!1,i._supersampleScreenshots=!0,i._pools={bufferData:new _n},i.renderRequested=!1,i.stage=Object(s.a)(i),i._stationary=!0;var o=t.canvas,u=void 0===o?document.createElement("canvas"):o,c=t.alpha,l=void 0===c||c,h=t.stencil,f=void 0===h||h,d=t.renderContext,_=void 0===d?"webgl":d,y=t.supersampleScreenshots,b=void 0===y||y,x=t.contextOptions,k=void 0===x?{}:x;i._canvas=u;var j,M=Object(R.b)(u,{alpha:l,antialias:!1,depth:!0,stencil:f},_);return i.context=new C.a(M,k),i.painter=new Gr(i.context,Object(s.a)(i)),Object(m.a)("esri-2d-profiler")&&(i._debugOutput=document.createElement("div"),i._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),e.appendChild(i._debugOutput)),i._renderParameters={drawPhase:0,state:i.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:i.context,painter:i.painter,timeline:t.timeline||new bn.a,renderingOptions:t.renderingOptions,requireFBO:!1,driverTestResult:(j=i.context,new rn(j)),profiler:new Qr(i.context,i._debugOutput),dataUploadCounter:0},i._taskHandle=Object(g.a)({render:function(e){return i.renderFrame(e)}}),i._taskHandle.pause(),i._supersampleScreenshots=b,i._lostWebGLContextHandle=Object(v.c)(u,"webglcontextlost",(function(){i.emit("webgl-error",{error:new p.a("webgl-context-lost")})})),u.setAttribute("style","width: 100%; height:100%; display:block;"),e.appendChild(u),i}return Object(o.a)(n,[{key:"destroy",value:function(){this.removeAllChildren(),this._emptyTrash(),this._taskHandle.remove(),this._taskHandle=null,this._boundFBO=null,this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null),this._clipVAO&&(this._clipVAO.dispose(),this._clipVAO=null,this._clipVBO=null),this._clipStencilProgram&&(this._clipStencilProgram.dispose(),this._clipStencilProgram=null),this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas),this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput),this.highlightOptions=null,this._pools.bufferData.destroy(),this.painter.dispose(),this.context.dispose(),this._canvas=null}},{key:"background",get:function(){return this._background},set:function(e){this._background=e,this.requestRender()}},{key:"highlightOptions",get:function(){return this._highlightOptions},set:function(e){var t=this;this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null),this._highlightOptions=e,this._highlightOptions&&(this._highlightOptionsHandle=Object(_.a)(this._highlightOptions,"version",(function(){t.painter.setHighlightOptions(e),t.requestRender()})))}},{key:"pools",get:function(){return this._pools}},{key:"renderingOptions",get:function(){return this._renderingOptions},set:function(e){this._renderingOptions=e,this.requestRender()}},{key:"state",get:function(){return this._state},set:function(e){this._state=e,this.requestRender()}},{key:"stationary",get:function(){return this._stationary},set:function(e){this._stationary!==e&&(this._stationary=e,this.requestRender())}},{key:"trashDisplayObject",value:function(e){this._trash.add(e),this.requestRender()}},{key:"untrashDisplayObject",value:function(e){return this._trash.delete(e)}},{key:"requestRender",value:function(){this._lastRenderRequestTime=performance.now(),this.renderRequested||(this.renderRequested=!0,this.emit("will-render"),this._taskHandle.resume())}},{key:"renderFrame",value:function(e){e.time-this._lastRenderRequestTime>=2e3&&this._taskHandle.pause(),this.renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=e.time,this._renderParameters.deltaTime=e.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash(),this.emit("post-render")}},{key:"renderChildren",value:function(e){var t,r=kn(this.children);try{for(r.s();!(t=r.n()).done;){t.value.beforeRender(e)}}catch(a){r.e(a)}finally{r.f()}this._renderChildren(this.children,e);var n,i=kn(this.children);try{for(i.s();!(n=i.n()).done;){n.value.afterRender(e)}}catch(a){i.e(a)}finally{i.f()}}},{key:"_renderChildren",value:function(e,t){var r=this.context;t.profiler.recordStart("drawLayers"),t.dataUploadCounter=0,this._beforeRenderChildren(t),t.drawPhase=F.c.MAP,this.painter.beforeRenderLayers(r,this.background);var n,i=kn(e);try{for(i.s();!(n=i.n()).done;){n.value.processRender(t)}}catch(h){i.e(h)}finally{i.f()}this.painter.renderLayers(r),t.drawPhase=F.c.HIGHLIGHT,this.painter.beforeRenderLayers(r);var a,o=kn(e);try{for(o.s();!(a=o.n()).done;){a.value.processRender(t)}}catch(h){o.e(h)}finally{o.f()}if(this.painter.renderLayers(r),this._isLabelDrawPhaseRequired(e)){t.drawPhase=F.c.LABEL,this.painter.beforeRenderLayers(r);var s,u=kn(e);try{for(u.s();!(s=u.n()).done;){s.value.processRender(t)}}catch(h){u.e(h)}finally{u.f()}this.painter.renderLayers(r)}if(Object(m.a)("esri-tiles-debug")){t.drawPhase=F.c.DEBUG,this.painter.beforeRenderLayers(r);var c,l=kn(e);try{for(l.s();!(c=l.n()).done;){c.value.processRender(t)}}catch(h){l.e(h)}finally{l.f()}this.painter.renderLayers(r)}t.profiler.recordEnd("drawLayers"),this._afterRenderChildren()}},{key:"_beforeRenderChildren",value:function(e){var t=this.context,r=e.state,n=e.pixelRatio;t.enforceState(),t.setClearDepth(1),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT);var i=r.size,a=r.rotation,o=Math.round(i[0]*n),s=Math.round(i[1]*n);if(this._boundFBO=t.getBoundFramebufferObject(),r.spatialReference&&(r.spatialReference._isWrappable?r.spatialReference._isWrappable():r.spatialReference.isWrappable)){var u=Object(y.d)(a),c=Math.abs(Math.cos(u)),l=Math.abs(Math.sin(u)),h=Math.round(o*c+s*l),f=Math.round(r.worldScreenWidth);if(h<=f)this._clipFrame=!1;else{this._clipFBO&&this._clipFBO.width===o&&this._clipFBO.height===s||(this._clipFBO=new j.a(t,{colorTarget:0,depthStencilTarget:3,width:o,height:s}));var d=(this.state.padding.left-this.state.padding.right)/2,p=(this.state.padding.bottom-this.state.padding.top)/2,v=.5*o,m=.5*s,g=1/o,_=1/s,w=f*n*.5,O=.5*(o*l+s*c),k=this._upperLeft,C=this._upperRight,M=this._lowerLeft,S=this._lowerRight;Object(x.m)(k,-w,-O),Object(x.m)(C,w,-O),Object(x.m)(M,-w,O),Object(x.m)(S,w,O),Object(b.d)(this._mat2),Object(b.h)(this._mat2,this._mat2,[v+d,m+p]),0!==a&&Object(b.f)(this._mat2,this._mat2,u),Object(x.n)(k,k,this._mat2),Object(x.n)(C,C,this._mat2),Object(x.n)(M,M,this._mat2),Object(x.n)(S,S,this._mat2);var T=this._clipData;T.set([2*M[0]*g-1,2*(s-M[1])*_-1,2*S[0]*g-1,2*(s-S[1])*_-1,2*k[0]*g-1,2*(s-k[1])*_-1,2*C[0]*g-1,2*(s-C[1])*_-1]),this._clipRendererInitialized||this._initializeClipRenderer(t),this._clipVBO.setData(T),this._boundFBO=t.getBoundFramebufferObject(),t.bindFramebuffer(this._clipFBO),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),t.setClearColor(0,0,0,0),t.setClearDepth(1),t.setClearStencil(0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT|t.gl.STENCIL_BUFFER_BIT),t.setDepthWriteEnabled(!1),this._clipFrame=!0}}else this._clipFrame=!1}},{key:"_afterRenderChildren",value:function(){var e=this.context;if(e.logIno(),this._clipFrame&&this._clipRendererInitialized){if(e.bindFramebuffer(this._boundFBO),this._boundFBO=null,e.bindVAO(this._clipVAO),e.useProgram(this._clipStencilProgram),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setStencilFunction(519,1,255),e.drawElements(4,6,5123,0),e.bindVAO(),e.setColorMask(!0,!0,!0,!0),null!=this.background){var t=this.background.color,r=t.r,n=t.g,i=t.b,a=t.a;e.setClearColor(a*r/255,a*n/255,a*i/255,a)}else e.setClearColor(0,0,0,0);e.clear(e.gl.COLOR_BUFFER_BIT),e.setBlendingEnabled(!0),e.setStencilFunction(514,1,255),this.painter.blitTexture(e,this._clipFBO.colorTexture,9728,1),e.setStencilTestEnabled(!1)}}},{key:"doRender",value:function(e){var t=this.context,r=e.state,i=e.pixelRatio;this._resizeCanvas(e),this.context.enforceState(),t.setViewport(0,0,i*r.size[0],i*r.size[1]),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),Object(u.a)(Object(h.a)(n.prototype),"doRender",this).call(this,e)}},{key:"takeScreenshot",value:(t=Object(i.a)(d.a.mark((function e(t,r){var n,i,a,o,s,u,c,l,h,f,p,v,m;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(wn.d)(t,this._supersampleScreenshots,this._state.padding),i=n.framebufferWidth,a=n.framebufferHeight,o=this.context,s=t.layers,u=this.children,c=On(On({},this._renderParameters),{},{drawPhase:null,globalOpacity:1,stationary:!0,state:this._renderParameters.state.clone(),pixelRatio:n.pixelRatio,time:Date.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1}),null!=t.rotation&&((l=c.state.viewpoint).rotation=t.rotation,c.state.viewpoint=l),s.length>0&&(u=[],s.forEach((function(e){var t=r.find((function(t){return t.layer.id===e.id}));t&&"container"in t&&t.container&&u.push(t.container)}))),h=new j.a(o,{colorTarget:0,depthStencilTarget:3,width:i,height:a}),f=o.getBoundFramebufferObject(),p=o.getViewport(),o.bindFramebuffer(h),o.setViewport(0,0,i,a),this._renderChildren(u,c),v=this._readbackScreenshot(n),o.bindFramebuffer(f),o.setViewport(p.x,p.y,p.width,p.height),this.requestRender(),m=this._ensureScreenshotEncodeCanvas(),e.abrupt("return",Object(wn.b)(v,t,m,{flipY:!0,premultipliedAlpha:!0}));case 11:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"_ensureScreenshotEncodeCanvas",value:function(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},{key:"_readbackScreenshot",value:function(e){var t=e.framebufferWidth,r=e.framebufferHeight,n=e.region,i=e.resample,a=this.context.gl;if(i){var o=Object(wn.a)(t,r,this._ensureScreenshotEncodeCanvas());a.readPixels(0,0,t,r,6408,5121,new Uint8Array(o.data.buffer));var s=Object(wn.a)(n.width,n.height,this._ensureScreenshotEncodeCanvas());return Object(wn.c)(o,s,!0,i.region.x,r-(i.region.y+i.region.height),i.region.width,i.region.height)}var u=Object(wn.a)(n.width,n.height,this._ensureScreenshotEncodeCanvas());return a.readPixels(n.x,r-(n.y+n.height),n.width,n.height,6408,5121,new Uint8Array(u.data.buffer)),u}},{key:"_resizeCanvas",value:function(e){var t=this._canvas,r=t.style,n=e.state.size,i=e.pixelRatio,a=n[0],o=n[1],s=Math.round(a*i),u=Math.round(o*i);t.width===s&&t.height===u||(t.width=s,t.height=u),r.width=a+"px",r.height=o+"px"}},{key:"_initializeClipRenderer",value:function(e){if(this._clipRendererInitialized)return!0;var t=yn.attributes,r=Object(M.a)(e,yn);if(!r)return!1;var n=k.a.createVertex(e,35040,32),i=new Uint16Array([0,1,2,2,1,3]),a=k.a.createIndex(e,35044,i),o=new T.a(e,t,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:n},a);return this._clipStencilProgram=r,this._clipVBO=n,this._clipVAO=o,this._clipRendererInitialized=!0,!0}},{key:"_emptyTrash",value:function(){for(;this._trash.size>0;){var e=Array.from(this._trash);this._trash.clear();for(var t=0,r=e;t<r.length;t++){r[t].processDetach()}}}},{key:"_isLabelDrawPhaseRequired",value:function(e){var t,r=!1,n=kn(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!(i instanceof P.a)){r=r||!1;break}if(i.hasLabels)return!0;r=r||this._isLabelDrawPhaseRequired(i.children)}}catch(a){n.e(a)}finally{n.f()}return r}}]),n}(P.a),Sn=r("dQW7"),Tn=r("hZBP"),Rn=r("FYmP"),Pn=r("miKF"),Fn=r("xAIp"),In=(r("wckI"),r("iaHD")),An=r("6J1V"),Dn=r("eAFH"),Bn=function(){function e(t,r){Object(a.a)(this,e),this.width=t,this.height=r;var n=Math.ceil(t/1),i=Math.ceil(r/1);this._cols=n,this._rows=i,this._cells=Dn.a.create(n*i)}return Object(o.a)(e,[{key:"insertMetrics",value:function(e){var t=this._hasCollision(e);return 0===t&&this._markMetrics(e),t}},{key:"getCellId",value:function(e,t){return e+t*this._cols}},{key:"has",value:function(e){return this._cells.has(e)}},{key:"hasRange",value:function(e,t){return this._cells.hasRange(e,t)}},{key:"set",value:function(e){this._cells.set(e)}},{key:"setRange",value:function(e,t){this._cells.setRange(e,t)}},{key:"_hasCollision",value:function(e){var t=e.id,r=0,n=0;e.save();do{var i=e.boundsCount;r+=i;for(var a=0;a<i;a++){var o=e.boundsComputedAnchorX(a),s=e.boundsComputedAnchorY(a),u=e.boundsWidth(a)+2,c=e.boundsHeight(a)+2;switch(this._collide(o,s,u,c)){case 2:return 2;case 1:n++}}}while(e.peekId()===t&&e.next());return e.restore(),r===n?1:0}},{key:"_collide",value:function(e,t,r,n){var i=e-r/2,a=e+r/2,o=t-n/2,s=t+n/2;if(a<0||s<0||i>this.width||o>this.height)return 1;for(var u=Object(An.e)(Math.floor(i/1),0,this._cols),c=Object(An.e)(Math.floor(o/1),0,this._rows),l=Object(An.e)(Math.ceil(a/1),0,this._cols),h=Object(An.e)(Math.ceil(s/1),0,this._rows),f=c;f<=h;f++)for(var d=u;d<=l;d++){var p=this.getCellId(d,f);if(this.has(p))return 2}return 0}},{key:"_mark",value:function(e,t,r,n){for(var i=e-r/2,a=e+r/2,o=t-n/2,s=t+n/2,u=Object(An.e)(Math.floor(i/1),0,this._cols),c=Object(An.e)(Math.floor(o/1),0,this._rows),l=Object(An.e)(Math.ceil(a/1),0,this._cols),h=Object(An.e)(Math.ceil(s/1),0,this._rows),f=c;f<=h;f++)for(var d=u;d<=l;d++){var p=this.getCellId(d,f);this.set(p)}return!1}},{key:"_markMetrics",value:function(e){var t=e.id;do{for(var r=e.boundsCount,n=0;n<r;n++){var i=e.boundsComputedAnchorX(n),a=e.boundsComputedAnchorY(n),o=e.boundsWidth(n)+2,s=e.boundsHeight(n)+2;this._mark(i,a,o,s)}}while(e.peekId()===t&&e.next())}}]),e}(),zn=r("MZ5C"),En=Math.PI;function Un(e,t){switch(t.transformationType){case"additive":return function(e,t){return e+(Ln(t.minSize,e)||t.minDataValue)}(e,t);case"constant":return function(e,t){var r=e.stops,n=r&&r.length&&r[0].size;return null==n&&(n=e.minSize),Ln(n,t)}(t,e);case"clamped-linear":return function(e,t){var r=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=Ln(t.minSize,e),i=Ln(t.maxSize,e);return e<=t.minDataValue?n:e>=t.maxDataValue?i:n+r*(i-n)}(e,t);case"proportional":return function(e,t){var r,n=e/t.minDataValue,i=Ln(t.minSize,e),a=Ln(t.maxSize,e);return r=n*i,Object(An.e)(r,i,a)}(e,t);case"stops":return function(e,t){var r=function(e,t){if(!t)return;var r=0,n=t.length-1;return t.some((function(t,i){return e<t?(n=i,!0):(r=i,!1)})),[r,n,(e-t[r])/(t[n]-t[r])]}(e,t.cache.ipData),n=Object(Ze.a)(r,3),i=n[0],a=n[1],o=n[2];if(i===a)return Ln(t.stops[i].size,e);var s=Ln(t.stops[i].size,e);return s+(Ln(t.stops[a].size,e)-s)*o}(e,t);case"real-world-size":return r=e,n=t,a=zn.a[n.valueUnit],o=Ln(n.minSize,r),s=Ln(n.maxSize,r),u=n.valueRepresentation,i="area"===u?2*Math.sqrt(r/En)/a:"radius"===u||"distance"===u?2*r/a:r/a,Object(An.e)(i,o,s);case"identity":return e;case"unknown":return null}var r,n,i,a,o,s,u}function Ln(e,t){return"number"==typeof e?e:Un(t,e)}function Vn(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Nn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Nn(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Hn(e,t){var r=[];e.forEachTile((function(e){return r.push(e)})),r.sort((function(e,t){return e.instanceId-t.instanceId})),r.forEach((function(e){Object(I.i)(e.labelMetrics)&&e.isReady&&t(e,e.labelMetrics.getCursor())}))}function qn(e){return function(t){return Object(we.c)(Un(t,e))}}function Wn(e,t){if(function(e){return"feature"===e.layer.type||"csv"===e.layer.type||"geojson"===e.layer.type||"ogc-feature"===e.layer.type||"stream"===e.layer.type||"subtype-group"===e.layer.type||"wfs"===e.layer.type}(t)){var r="subtype-group"===t.layer.type?t.layer.sublayers.items:[t.layer],n=t.layer.geometryType,i=!function(e){var t,r=Vn(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,i=n.labelingInfo||[];if(n.labelsVisible&&i.length&&i.some((function(e){return"none"===e.deconflictionStrategy})))return!0}}catch(a){r.e(a)}finally{r.f()}return!1}(r),a={};if("subtype-group"!==t.layer.type){if("heatmap"===t.layer.renderer.type)return;var o=function(e){var t="visualVariables"in e&&e.visualVariables;if(!t)return null;var r,n=Vn(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;if("size"===i.type)return qn(i)}}catch(a){n.e(a)}finally{n.f()}return null}(t.layer.renderer);a[0]=o}var s=t.tileRenderer;Object(I.h)(s)||e.push({tileRenderer:s,vvEvaluators:a,deconflictionEnabled:i,geometryType:n})}}var Gn=function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,[{key:"run",value:function(e,t,r){var n,i=[],a=Vn(e);try{for(a.s();!(n=a.n()).done;){Wn(i,n.value)}}catch(o){a.e(o)}finally{a.f()}this._transformMetrics(i,t),this._runCollision(i,t,r)}},{key:"_runCollision",value:function(e,t,r){var n,i=this,a=Object(Ze.a)(t.state.size,2),o=a[0],s=a[1],u=new Bn(o,s),c=Vn(e);try{var l=function(){var e=n.value,t=e.tileRenderer,a=e.deconflictionEnabled,o=t.featuresView.attributeView;if(!a)return{v:void Hn(t,(function(e,t){for(;t.nextId();)o.setLabelMinZoom(t.id,0)}))};i._prepare(t),i._collideVisible(u,t,r),i._collideInvisible(u,t)};for(c.s();!(n=c.n()).done;){var h=l();if("object"==typeof h)return h.v}}catch(f){c.e(f)}finally{c.f()}}},{key:"_isFiltered",value:function(e,t,r){var n=t.getFilterFlags(e),i=!r.hasFilter||!!(n&ke.h),a=!r.effect||r.effect.excludedLabelsVisible||!!(n&ke.g);return!(i&&a)}},{key:"_prepare",value:function(e){var t=this,r=e.featuresView.attributeView,n=new Set;Hn(e,(function(i,a){for(;a.nextId();)n.has(a.id)||(n.add(a.id),t._isFiltered(a.id,r,e.layerView)?r.setLabelMinZoom(a.id,254):0!==r.getLabelMinZoom(a.id)?r.setLabelMinZoom(a.id,255):r.setLabelMinZoom(a.id,0))}))}},{key:"_collideVisible",value:function(e,t,r){var n=t.featuresView.attributeView,i=new Set;Hn(t,(function(t,a){for(;a.nextId();)if(!i.has(a.id))if(t.key.level===r){if(0===n.getLabelMinZoom(a.id))switch(e.insertMetrics(a)){case 1:break;case 2:n.setLabelMinZoom(a.id,254),i.add(a.id);break;case 0:n.setLabelMinZoom(a.id,0),i.add(a.id)}}else n.setLabelMinZoom(a.id,254)}))}},{key:"_collideInvisible",value:function(e,t){var r=t.featuresView.attributeView,n=new Set;Hn(t,(function(t,i){for(;i.nextId();)if(!n.has(i.id)&&255===r.getLabelMinZoom(i.id))switch(e.insertMetrics(i)){case 1:break;case 2:r.setLabelMinZoom(i.id,255),n.add(i.id);break;case 0:r.setLabelMinZoom(i.id,0),n.add(i.id)}}))}},{key:"_transformMetrics",value:function(e,t){var r,n=Vn(e);try{var i=function(){var e=r.value,n=e.tileRenderer,i=e.geometryType,a=e.vvEvaluators;Hn(n,(function(e,r){var o=n.featuresView.attributeView,s=e.transforms.labelMat2d;s[4]=Math.round(s[4]),s[5]=Math.round(s[5]);for(var u=s[4],c=s[5],l="polyline"===i;r.next();){var h=r.boundsCount,f=r.anchorX,d=r.anchorY,p=0,v=0,m=a[0];if(Object(I.i)(m)){var g=m(o.getVVSize(r.id)),_=isNaN(g)||null==g||g===1/0?r.size:g;p=r.directionX*(_/2),v=r.directionY*(_/2)}for(var y=0;y<h;y++){var b=f,w=r.anchorY;if(l){var x=b+r.boundsCenterX(y)+p,O=w+r.boundsCenterY(y)+v;t.state.rotation?(x=s[0]*x+s[2]*O+s[4],O=s[1]*x+s[3]*O+s[5]):(x+=u,O+=c),r.setBoundsComputedAnchorX(y,Math.floor(x)),r.setBoundsComputedAnchorY(y,Math.floor(O))}else{t.state.rotation?(b=s[0]*f+s[2]*d+s[4],w=s[1]*f+s[3]*d+s[5]):(b+=u,w+=c);var k=b+r.boundsCenterX(y)+p,j=w+r.boundsCenterY(y)+v;r.setBoundsComputedAnchorX(y,k),r.setBoundsComputedAnchorY(y,j)}}}}))};for(n.s();!(r=n.n()).done;)i()}catch(a){n.e(a)}finally{n.f()}}}]),e}();function Zn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var Yn=ye.a.getLogger("esri.views.2d.layers.labels.LabelManager"),Kn=function(e){Object(c.a)(r,e);var t=Zn(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._applyVisibilityPassThrottled=Object(Pn.a)(n._applyVisibilityPass,32,Object(s.a)(n)),n.lastUpdateId=-1,n.updateRequested=!1,n.view=null,n}return Object(o.a)(r,[{key:"initialize",value:function(){this.collisionEngine=new Gn}},{key:"destroy",value:function(){this.collisionEngine=null,this._applyVisibilityPassThrottled.remove(),this._applyVisibilityPassThrottled=null}},{key:"updating",get:function(){return this.updateRequested}},{key:"update",value:function(e){this._applyVisibilityPassThrottled(e)}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}},{key:"processUpdate",value:function(e){this._set("updateParameters",e),this.updateRequested&&(this.updateRequested=!1,this.update(e))}},{key:"_applyVisibilityPass",value:function(e){try{var t=this.view.featuresTilingScheme.getClosestInfoForScale(e.state.scale).level;this.collisionEngine.run(this.view.allLayerViews.items,e,t)}catch(r){Yn.error(new p.a("mapview-labeling","Encountered an error during label decluttering",r))}}}]),r}(Object(Rn.b)(Tn.a));Object(Sn.a)([Object(Fn.b)()],Kn.prototype,"updateRequested",void 0),Object(Sn.a)([Object(Fn.b)({readOnly:!0})],Kn.prototype,"updateParameters",void 0),Object(Sn.a)([Object(Fn.b)()],Kn.prototype,"updating",null),Object(Sn.a)([Object(Fn.b)()],Kn.prototype,"view",void 0);var Xn=Kn=Object(Sn.a)([Object(In.a)("esri.views.2d.layers.labels.LabelManager")],Kn),Jn=r("KA0i"),$n=r("F0Fd"),Qn=r("VZ8p"),ei=r("OTJA"),ti=r("kBLL"),ri=r("7ycK");function ni(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var ii="esri-zoom-box__container",ai="esri-zoom-box__overlay",oi="esri-zoom-box__overlay-background",si="esri-zoom-box__outline",ui="Shift",ci="Ctrl",li=function(e){Object(c.a)(r,e);var t=ni(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._container=null,n._overlay=null,n._backgroundShape=null,n._boxShape=null,n._box={x:0,y:0,width:0,height:0},n._redraw=n._redraw.bind(Object(s.a)(n)),n}return Object(o.a)(r,[{key:"destroy",value:function(){this.view=null}},{key:"view",set:function(e){var t=this;this._handles&&this._handles.forEach((function(e){e.remove()})),this._handles=null,this._destroyOverlay(),this._set("view",e),e&&(e.on("drag",[ui],(function(e){return t._handleDrag(e,1)}),ri.b.INTERNAL),e.on("drag",[ui,ci],(function(e){return t._handleDrag(e,-1)}),ri.b.INTERNAL))}},{key:"_start",value:function(){this._createContainer(),this._createOverlay(),this.navigation.begin()}},{key:"_update",value:function(e,t,r,n){this._box.x=e,this._box.y=t,this._box.width=r,this._box.height=n,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}},{key:"_end",value:function(e,t,r,n,i){var a=this.view,o=a.toMap(Object(we.a)(e+.5*r,t+.5*n)),s=Math.max(r/a.width,n/a.height);-1===i&&(s=1/s),this._destroyOverlay(),this.navigation.end(),a.goTo({center:o,scale:a.scale*s})}},{key:"_updateBox",value:function(e,t,r,n){var i=this._boxShape;i.setAttributeNS(null,"x",""+e),i.setAttributeNS(null,"y",""+t),i.setAttributeNS(null,"width",""+r),i.setAttributeNS(null,"height",""+n),i.setAttributeNS(null,"class",si)}},{key:"_updateBackground",value:function(e,t,r,n){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(e,t,r,n,this.view.width,this.view.height))}},{key:"_createContainer",value:function(){var e=document.createElement("div");e.className=ii,this.view.root.appendChild(e),this._container=e}},{key:"_createOverlay",value:function(){var e=this.view.width,t=this.view.height,r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttributeNS(null,"d","M 0 0 L "+e+" 0 L "+e+" "+t+" L 0 "+t+" Z"),r.setAttributeNS(null,"class",oi);var n=document.createElementNS("http://www.w3.org/2000/svg","rect"),i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),i.setAttributeNS(null,"class",ai),i.appendChild(r),i.appendChild(n),this._container.appendChild(i),this._backgroundShape=r,this._boxShape=n,this._overlay=i}},{key:"_destroyOverlay",value:function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}},{key:"_toSVGPath",value:function(e,t,r,n,i,a){var o=e+r,s=t+n;return"M 0 0 L "+i+" 0 L "+i+" "+a+" L 0 "+a+" ZM "+e+" "+t+" L "+e+" "+s+" L "+o+" "+s+" L "+o+" "+t+" Z"}},{key:"_handleDrag",value:function(e,t){var r,n,i,a,o=e.x,s=e.y,u=e.origin.x,c=e.origin.y;switch(o>u?(r=u,i=o-u):(r=o,i=u-o),s>c?(n=c,a=s-c):(n=s,a=c-s),e.action){case"start":this._start();break;case"update":this._update(r,n,i,a);break;case"end":this._end(r,n,i,a,t)}e.stopPropagation()}},{key:"_redraw",value:function(){if(this._rafId&&(this._rafId=null,this._overlay)){var e=this._box,t=e.x,r=e.y,n=e.width,i=e.height;this._updateBox(t,r,n,i),this._updateBackground(t,r,n,i),this._rafId=requestAnimationFrame(this._redraw)}}}]),r}(Tn.a);Object(Sn.a)([Object(Fn.b)()],li.prototype,"navigation",void 0),Object(Sn.a)([Object(Fn.b)()],li.prototype,"view",null);var hi=li=Object(Sn.a)([Object(In.a)("esri.views.2d.navigation.ZoomBox")],li),fi=(r("ZTBZ"),r("KcHx")),di=r("4vgF"),pi=function(){function e(t){Object(a.a)(this,e),this.gain=t}return Object(o.a)(e,[{key:"update",value:function(e){if(this.hasLastValue){var t=this.computeDelta(e);this.updateDelta(t)}this.lastValue=e}},{key:"reset",value:function(){this.lastValue=void 0,this.filteredDelta=void 0}},{key:"hasLastValue",get:function(){return void 0!==this.lastValue}},{key:"hasFilteredDelta",get:function(){return void 0!==this.filteredDelta}},{key:"computeDelta",value:function(e){return e-this.lastValue}},{key:"updateDelta",value:function(e){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*e:this.filteredDelta=e}}]),e}(),vi=function(){function e(t,r,n){Object(a.a)(this,e),this._initialVelocity=t,this._stopVelocity=r,this._friction=n,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}return Object(o.a)(e,[{key:"duration",get:function(){return this._duration}},{key:"isFinished",value:function(e){return e>this.duration}},{key:"friction",get:function(){return this._friction}},{key:"value",value:function(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}},{key:"valueDelta",value:function(e,t){var r=this.value(e);return this.value(e+t)-r}},{key:"valueFromInitialVelocity",value:function(e,t){t=Math.min(t,this.duration);var r=1-this.friction;return e*(Math.pow(r,t)-1)/Math.log(r)}}]),e}();function mi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var gi=function(e){Object(c.a)(r,e);var t=mi(r);function r(e,n,i,o,s){var u;return Object(a.a)(this,r),(u=t.call(this,e,n,i)).sceneVelocity=o,u.direction=s,u}return Object(o.a)(r,[{key:"value",value:function(e){return Object(u.a)(Object(h.a)(r.prototype),"valueFromInitialVelocity",this).call(this,this.sceneVelocity,e)}}]),r}(vi),_i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.84;Object(a.a)(this,e),this.minimumInitialVelocity=t,this.stopVelocity=r,this.friction=n,this.enabled=!0,this.time=new pi(.6),this.screen=[new pi(.4),new pi(.4)],this.scene=[new pi(.6),new pi(.6),new pi(.6)],this.tmpDirection=Object(di.e)()}return Object(o.a)(e,[{key:"add",value:function(e,t,r){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(r)<.015)return;this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.scene[0].update(t[0]),this.scene[1].update(t[1]),this.scene[2].update(t[2]),this.time.update(r)}}},{key:"reset",value:function(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}},{key:"evaluateMomentum",value:function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,r=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}},{key:"createMomentum",value:function(e,t,r){Object(fi.s)(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var n=Object(fi.m)(this.tmpDirection);n>0&&Object(fi.b)(this.tmpDirection,this.tmpDirection,1/n);var i=n/this.time.filteredDelta;return new gi(e,t,r,i,this.tmpDirection)}}]),e}();function yi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var bi=function(e){Object(c.a)(r,e);var t=yi(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).animationTime=0,n.momentumEstimator=new _i(500,6,.92),n.momentum=null,n.tmpMomentum=Object(di.e)(),n.momentumFinished=!1,n.viewpoint=new Qn.a({targetGeometry:new ei.a,scale:0,rotation:0}),n.watch("momentumFinished",(function(e){e&&n.navigation.stop()})),n}return Object(o.a)(r,[{key:"begin",value:function(e,t){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(t),this.previousDrag=t}},{key:"update",value:function(e,t){this.addToEstimator(t);var r=t.center.x,n=t.center.y,i=this.previousDrag;r=i?i.center.x-r:-r,n=i?n-i.center.y:n,e.viewpoint=Object(ti.w)(this.viewpoint,e.viewpoint,[r||0,n||0]),this.previousDrag=t}},{key:"end",value:function(e,t){this.addToEstimator(t);var r=e.navigation.momentumEnabled;this.momentum=r?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(e),this.previousDrag=null,this.navigation.end()}},{key:"addToEstimator",value:function(e){var t=e.center.x,r=e.center.y,n=Object(we.b)(-t,r),i=Object(di.g)(-t,r,0);this.momentumEstimator.add(n,i,.001*e.timestamp)}},{key:"onAnimationUpdate",value:function(e){var t=this;this.navigation.animationManager.animateContinous(e.viewpoint,(function(r,n){t.momentumFinished=!t.momentum||t.momentum.isFinished(t.animationTime);var i=.001*n;if(!t.momentumFinished){var a=t.momentum.valueDelta(t.animationTime,i);Object(fi.b)(t.tmpMomentum,t.momentum.direction,a),Object(ti.w)(r,r,t.tmpMomentum),e.constraints.constrainByGeometry(r)}t.animationTime+=i}))}},{key:"stopMomentumNavigation",value:function(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}}]),r}(Tn.a);Object(Sn.a)([Object(Fn.b)()],bi.prototype,"momentumFinished",void 0),Object(Sn.a)([Object(Fn.b)()],bi.prototype,"viewpoint",void 0),Object(Sn.a)([Object(Fn.b)()],bi.prototype,"navigation",void 0);var wi=bi=Object(Sn.a)([Object(In.a)("esri.views.2d.navigation.actions.Pan")],bi),xi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;Object(a.a)(this,e),this.minimumInitialVelocity=t,this.stopVelocity=r,this.friction=n,this.maxVelocity=i,this.enabled=!0,this.value=new pi(.8),this.time=new pi(.3)}return Object(o.a)(e,[{key:"add",value:function(e,t){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta){var r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}},{key:"reset",value:function(){this.value.reset(),this.time.reset()}},{key:"evaluateMomentum",value:function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;var e=this.value.filteredDelta/this.time.filteredDelta;return e=Object(An.e)(e,-this.maxVelocity,this.maxVelocity),Math.abs(e)<this.minimumInitialVelocity?null:this.createMomentum(e,this.stopVelocity,this.friction)}},{key:"createMomentum",value:function(e,t,r){return new vi(e,t,r)}}]),e}();function Oi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var ki=function(e){Object(c.a)(r,e);var t=Oi(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;return Object(a.a)(this,r),t.call(this,e,n,i,o)}return Object(o.a)(r,[{key:"add",value:function(e,t){if(this.value.hasLastValue){for(var n=this.value.lastValue,i=e-n;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;e=n+i}Object(u.a)(Object(h.a)(r.prototype),"add",this).call(this,e,t)}}]),r}(xi);function ji(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var Ci=function(e){Object(c.a)(r,e);var t=ji(r);function r(e,n,i){return Object(a.a)(this,r),t.call(this,e,n,i)}return Object(o.a)(r,[{key:"value",value:function(e){var t=Object(u.a)(Object(h.a)(r.prototype),"value",this).call(this,e);return Math.exp(t)}},{key:"valueDelta",value:function(e,t){var n=Object(u.a)(Object(h.a)(r.prototype),"value",this).call(this,e),i=Object(u.a)(Object(h.a)(r.prototype),"value",this).call(this,e+t)-n;return Math.exp(i)}}]),r}(vi),Mi=function(e){Object(c.a)(r,e);var t=ji(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2.5,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;return Object(a.a)(this,r),t.call(this,e,n,i,o)}return Object(o.a)(r,[{key:"add",value:function(e,t){Object(u.a)(Object(h.a)(r.prototype),"add",this).call(this,Math.log(e),t)}},{key:"createMomentum",value:function(e,t,r){return new Ci(e,t,r)}}]),r}(xi);function Si(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var Ti=function(e){Object(c.a)(r,e);var t=Si(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._animationTime=0,n._momentumFinished=!1,n._rotationMomentumEstimator=new ki(.6,.15,.95),n._rotationDirection=1,n._zoomDirection=1,n._zoomMomentumEstimator=new Mi,n._zoomOnly=null,n.zoomMomentum=null,n.rotateMomentum=null,n.viewpoint=new Qn.a({targetGeometry:new ei.a,scale:0,rotation:0}),n.watch("_momentumFinished",(function(e){e&&n.navigation.stop()})),n}return Object(o.a)(r,[{key:"begin",value:function(e,t){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=t.angle,this._previousRadius=this._startRadius=t.radius,this._previousCenter=t.center,this._updateTimestamp=null,e.constraints.rotationEnabled&&this.addToRotateEstimator(0,t.timestamp),this.addToZoomEstimator(t,1)}},{key:"update",value:function(e,t){null===this._updateTimestamp&&(this._updateTimestamp=t.timestamp);var r=t.angle,n=t.radius,i=t.center,a=Math.abs(180*(r-this._startAngle)/Math.PI),o=Math.abs(n-this._startRadius),s=this._startRadius/n;if(this._previousRadius){var u=n/this._previousRadius,c=180*(r-this._previousAngle)/Math.PI;this._rotationDirection=c>=0?1:-1,this._zoomDirection=u>=1?1:-1,e.constraints.rotationEnabled?(null===this._zoomOnly&&t.timestamp-this._updateTimestamp>200&&(this._zoomOnly=o-a>0),null===this._zoomOnly||this._zoomOnly?c=0:this.addToRotateEstimator(r-this._startAngle,t.timestamp)):c=0,this.addToZoomEstimator(t,s),this.navigation.setViewpoint([i.x,i.y],1/u,c,[this._previousCenter.x-i.x,i.y-this._previousCenter.y])}this._previousAngle=r,this._previousRadius=n,this._previousCenter=i}},{key:"end",value:function(e){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(e),this.navigation.end()}},{key:"addToRotateEstimator",value:function(e,t){this._rotationMomentumEstimator.add(e,.001*t)}},{key:"addToZoomEstimator",value:function(e,t){this._zoomMomentumEstimator.add(t,.001*e.timestamp)}},{key:"canZoomIn",value:function(e){var t=e.scale,r=e.constraints.effectiveMaxScale;return 0===r||t>r}},{key:"canZoomOut",value:function(e){var t=e.scale,r=e.constraints.effectiveMinScale;return 0===r||t<r}},{key:"onAnimationUpdate",value:function(e){var t=this;this.navigation.animationManager.animateContinous(e.viewpoint,(function(r,n){var i=!t.canZoomIn(e)&&t._zoomDirection>1||!t.canZoomOut(e)&&t._zoomDirection<1,a=!t.rotateMomentum||t.rotateMomentum.isFinished(t._animationTime),o=i||!t.zoomMomentum||t.zoomMomentum.isFinished(t._animationTime),s=.001*n;if(t._momentumFinished=a&&o,!t._momentumFinished){var u=t.rotateMomentum?Math.abs(t.rotateMomentum.valueDelta(t._animationTime,s))*t._rotationDirection*180/Math.PI:0,c=t.zoomMomentum?Math.abs(t.zoomMomentum.valueDelta(t._animationTime,s)):1,l=Object(O.a)(),h=Object(O.a)();if(t._previousCenter){Object(x.m)(l,t._previousCenter.x,t._previousCenter.y),Object(ti.j)(h,e.size,e.padding),Object(x.i)(l,l,h);var f=e.constraints,d=e.scale,p=d*c;c<1&&!f.canZoomInTo(p)?(c=d/f.effectiveMaxScale,t.zoomMomentum=null,t.rotateMomentum=null):c>1&&!f.canZoomOutTo(p)&&(c=d/f.effectiveMinScale,t.zoomMomentum=null,t.rotateMomentum=null),Object(ti.t)(r,e.viewpoint,c,u,l,e.size),e.constraints.constrainByGeometry(r)}}t._animationTime+=s}))}},{key:"stopMomentumNavigation",value:function(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}}]),r}(Tn.a);Object(Sn.a)([Object(Fn.b)()],Ti.prototype,"_momentumFinished",void 0),Object(Sn.a)([Object(Fn.b)()],Ti.prototype,"viewpoint",void 0),Object(Sn.a)([Object(Fn.b)()],Ti.prototype,"navigation",void 0);var Ri=Ti=Object(Sn.a)([Object(In.a)("esri.views.2d.navigation.actions.Pinch")],Ti);function Pi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var Fi=Object(O.a)(),Ii=Object(O.a)(),Ai=function(e){Object(c.a)(r,e);var t=Pi(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._previousCenter=Object(O.a)(),n.viewpoint=new Qn.a({targetGeometry:new ei.a,scale:0,rotation:0}),n}return Object(o.a)(r,[{key:"begin",value:function(e,t){this.navigation.begin(),Object(x.m)(this._previousCenter,t.center.x,t.center.y)}},{key:"update",value:function(e,t){var r=e.state,n=r.size,i=r.padding;Object(x.m)(Fi,t.center.x,t.center.y),Object(ti.g)(Ii,n,i),e.viewpoint=Object(ti.r)(this.viewpoint,e.state.paddedViewState.viewpoint,Object(ti.b)(Ii,this._previousCenter,Fi)),Object(x.c)(this._previousCenter,Fi)}},{key:"end",value:function(){this.navigation.end()}}]),r}(Tn.a);Object(Sn.a)([Object(Fn.b)()],Ai.prototype,"viewpoint",void 0),Object(Sn.a)([Object(Fn.b)()],Ai.prototype,"navigation",void 0);var Di=Ai=Object(Sn.a)([Object(In.a)("esri.views.2d.actions.Rotate")],Ai);function Bi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var zi=new Qn.a({targetGeometry:new ei.a}),Ei=[0,0],Ui=function(e){Object(c.a)(l,e);var t,r,n,s,u=Bi(l);function l(e){var t;return Object(a.a)(this,l),(t=u.call(this,e))._endTimer=null,t.animationManager=null,t}return Object(o.a)(l,[{key:"initialize",value:function(){this.pan=new wi({navigation:this}),this.rotate=new Di({navigation:this}),this.pinch=new Ri({navigation:this}),this.zoomBox=new hi({view:this.view,navigation:this})}},{key:"destroy",value:function(){this.zoomBox.destroy(),this.zoomBox=null,this.animationManager=null}},{key:"begin",value:function(){this._set("interacting",!0)}},{key:"end",value:function(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}},{key:"zoom",value:(s=Object(i.a)(d.a.mark((function e(t){var r,n=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]?n[1]:this._getDefaultAnchor(),this.stop(),this.begin(),!this.view.constraints.snapToZoom||!this.view.constraints.effectiveLODs){e.next=3;break}return e.abrupt("return",t<1?this.zoomIn(r):this.zoomOut(r));case 3:this.setViewpoint(r,t,0,[0,0]);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"zoomIn",value:(n=Object(i.a)(d.a.mark((function e(t){var r,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.view,n=r.constraints.snapToNextScale(r.scale),e.abrupt("return",this._zoomToScale(n,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"zoomOut",value:(r=Object(i.a)(d.a.mark((function e(t){var r,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.view,n=r.constraints.snapToPreviousScale(r.scale),e.abrupt("return",this._zoomToScale(n,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setViewpoint",value:function(e,t,r,n){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,e,t,r,n),this.end()}},{key:"setViewpointImmediate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._getDefaultAnchor();this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,n,e,t,r)}},{key:"continousRotateClockwise",value:function(){var e=this.get("view.viewpoint");this.animationManager.animateContinous(e,(function(e){Object(ti.r)(e,e,-1)}))}},{key:"continousRotateCounterclockwise",value:function(){var e=this.get("view.viewpoint");this.animationManager.animateContinous(e,(function(e){Object(ti.r)(e,e,1)}))}},{key:"resetRotation",value:function(){this.view.rotation=0}},{key:"continousPanLeft",value:function(){this._continuousPan([-10,0])}},{key:"continousPanRight",value:function(){this._continuousPan([10,0])}},{key:"continousPanUp",value:function(){this._continuousPan([0,10])}},{key:"continousPanDown",value:function(){this._continuousPan([0,-10])}},{key:"stop",value:function(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}},{key:"_continuousPan",value:function(e){var t=this,r=this.get("view.viewpoint");this.animationManager.animateContinous(r,(function(r){Object(ti.w)(r,r,e),t.view.constraints.constrainByGeometry(r)}))}},{key:"_startTimer",value:function(e){var t=this;return null!==this._endTimer||(this._endTimer=setTimeout((function(){t._endTimer=null;var e=performance.now()-t._lastEventTimestamp;e<250?t._endTimer=t._startTimer(e):t._set("interacting",!1)}),e)),this._endTimer}},{key:"_getDefaultAnchor",value:function(){var e=this.view,t=e.size,r=e.padding,n=r.left,i=r.right,a=r.top,o=r.bottom;return Ei[0]=.5*(t[0]-i+n),Ei[1]=.5*(t[1]-o+a),Ei}},{key:"_zoomToScale",value:(t=Object(i.a)(d.a.mark((function e(t){var r,n,i,a,o,s,u,c,l,h=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=h.length>1&&void 0!==h[1]?h[1]:this._getDefaultAnchor(),n=this.view,i=n.constraints,a=n.scale,o=n.viewpoint,s=n.size,u=n.padding,c=i.canZoomInTo(t),l=i.canZoomOutTo(t),t<a&&!c||t>a&&!l){e.next=4;break}return e.abrupt("return",(Object(ti.p)(zi,o,t/a,0,r,s,u),i.constrainByGeometry(zi),n.goTo(zi,{animate:!0})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_scaleRotateTranslateViewpoint",value:function(e,t,r,n,i){var a=this.view,o=a.size,s=a.padding,u=a.constraints,c=a.scale,l=a.viewpoint,h=c*r,f=u.canZoomInTo(h),d=u.canZoomOutTo(h);return(r<1&&!f||r>1&&!d)&&(r=1),Object(ti.w)(l,l,i),Object(ti.p)(e,l,r,n,t,o,s),u.constrainByGeometry(e)}}]),l}(Tn.a);Object(Sn.a)([Object(Fn.b)()],Ui.prototype,"animationManager",void 0),Object(Sn.a)([Object(Fn.b)({type:Boolean,readOnly:!0})],Ui.prototype,"interacting",void 0),Object(Sn.a)([Object(Fn.b)()],Ui.prototype,"pan",void 0),Object(Sn.a)([Object(Fn.b)()],Ui.prototype,"pinch",void 0),Object(Sn.a)([Object(Fn.b)()],Ui.prototype,"rotate",void 0),Object(Sn.a)([Object(Fn.b)()],Ui.prototype,"view",void 0),Object(Sn.a)([Object(Fn.b)()],Ui.prototype,"zoomBox",void 0);var Li=Ui=Object(Sn.a)([Object(In.a)("esri.views.2d.navigation.MapViewNavigation")],Ui),Vi=r("UfAV"),Ni=r("z9dv"),Hi=r("PFYi"),qi={shaders:{vertexShader:Object(re.a)("magnifier/magnifier.vert"),fragmentShader:Object(re.a)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};var Wi=r("xgd+");function Gi(e){return Zi.apply(this,arguments)}function Zi(){return(Zi=Object(i.a)(d.a.mark((function e(t){var n,i,a,o,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.e(179).then(r.bind(null,"nQ11")),i=r.e(180).then(r.bind(null,"L+R8")),e.t0=Wi.a,e.next=5,n;case 5:return e.t1=e.sent.default,e.t2={signal:t},a=(0,e.t0)(e.t1,e.t2),e.t3=Wi.a,e.next=11,i;case 11:return e.t4=e.sent.default,e.t5={signal:t},o=(0,e.t3)(e.t4,e.t5),e.next=16,a;case 16:return e.t6=e.sent,e.next=19,o;case 19:return e.t7=e.sent,s={mask:e.t6,overlay:e.t7},e.abrupt("return",(Object(be.v)(t),s));case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(h.a)(e);if(t){var i=Object(h.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var Ki=function(e){Object(c.a)(r,e);var t=Yi(r);function r(){var e;return Object(a.a)(this,r),(e=t.call(this))._handles=new Vi.a,e._resourcePixelRatio=1,e.visible=!1,e}return Object(o.a)(r,[{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._disposeRenderResources(),this._resourcesTask&&(this._resourcesTask.abort(),this._resourcesTask=null)}},{key:"background",get:function(){return this._background},set:function(e){this._background=e,this.requestRender()}},{key:"magnifier",get:function(){return this._magnifier},set:function(e){var t=this;this._magnifier=e,this._handles.removeAll(),this._handles.add([Object(_.a)(e,"version",(function(){t.visible=e.visible&&Object(I.i)(e.position)&&e.size>0,t.requestRender()})),e.watch(["mask","overlay"],(function(){return t._reloadResources()})),e.watch("size",(function(){t._disposeRenderResources(),t.requestRender()}))])}},{key:"doRender",value:function(e){var t,r=e.context;if(this._resourcesTask){if(e.drawPhase===F.c.MAP&&this._canRender()){this._updateResources(e);var n=this._magnifier;if(!Object(I.h)(n.position)){var i=e.pixelRatio,a=n.size*i,o=1/n.factor,s=Math.ceil(o*a);this._readbackTexture.resize(s,s);var u=e.state.size,c=i*u[0],l=i*u[1],h=.5*s,f=.5*s,d=Object(An.e)(i*n.position.x,h,c-h-1),p=Object(An.e)(l-i*n.position.y,f,l-f-1);r.setBlendingEnabled(!0);var v=d-h,m=p-f,g=this._readbackTexture;r.bindTexture(g,0),r.gl.copyTexImage2D(g.descriptor.target,0,g.descriptor.pixelFormat,v,m,s,s,0);var _=null==(t=this.background)?void 0:t.color,y=_?[_.a*_.r/255,_.a*_.g/255,_.a*_.b/255,_.a]:[1,1,1,1],b=(d+n.offset.x*i)/c*2-1,w=(p-n.offset.y*i)/l*2-1,x=a/c*2,O=a/l*2,k=this._program;r.bindVAO(this._vertexArrayObject),r.bindTexture(this._overlayTexture,6),r.bindTexture(this._maskTexture,7),r.useProgram(k),k.setUniform4fv("u_background",y),k.setUniform1i("u_readbackTexture",0),k.setUniform1i("u_overlayTexture",6),k.setUniform1i("u_maskTexture",7),k.setUniform4f("u_drawPos",b,w,x,O),k.setUniform1i("u_maskEnabled",n.maskEnabled?1:0),k.setUniform1i("u_overlayEnabled",n.overlayEnabled?1:0),r.setStencilTestEnabled(!1),r.setColorMask(!0,!0,!0,!0),r.drawArrays(5,0,4),r.bindVAO()}}}else this._reloadResources()}},{key:"_canRender",value:function(){return this.mask&&this.overlay&&null!=this._magnifier}},{key:"_reloadResources",value:function(){var e=this;this._resourcesTask&&this._resourcesTask.abort();var t=Object(I.i)(this._magnifier)?this._magnifier.maskUrl:null,r=Object(I.i)(this._magnifier)?this._magnifier.overlayUrl:null;this._resourcesTask=Object(be.h)(function(){var n=Object(i.a)(d.a.mark((function n(i){var a,o,s,u,c,l,h;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=Object(I.h)(t)||Object(I.h)(r)?Gi(i):null,o=Object(I.i)(t)?Object(_e.default)(t,{responseType:"image",signal:i}).then((function(e){return e.data})):a.then((function(e){return e.mask})),s=Object(I.i)(r)?Object(_e.default)(r,{responseType:"image",signal:i}).then((function(e){return e.data})):a.then((function(e){return e.overlay})),n.next=5,Promise.all([o,s]);case 5:u=n.sent,c=Object(Ze.a)(u,2),l=c[0],h=c[1],e.mask=l,e.overlay=h,e._disposeRenderResources(),e.requestRender();case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"_disposeRenderResources",value:function(){this._readbackTexture=Object(I.e)(this._readbackTexture),this._overlayTexture=Object(I.e)(this._overlayTexture),this._maskTexture=Object(I.e)(this._maskTexture),this._vertexArrayObject=Object(I.e)(this._vertexArrayObject),this._program=Object(I.e)(this._program)}},{key:"_updateResources",value:function(e){if(e.pixelRatio!==this._resourcePixelRatio&&this._disposeRenderResources(),!this._readbackTexture){var t=e.context;this._resourcePixelRatio=e.pixelRatio;var r=Math.ceil(this._magnifier.size*e.pixelRatio);this._program=function(e){return Object(M.a)(e,qi)}(t);var n=new Uint16Array([0,1,0,0,1,1,1,0]),i=qi.attributes;this._vertexArrayObject=new T.a(t,i,{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:k.a.createVertex(t,35044,n)}),this.overlay.width=r,this.overlay.height=r,this._overlayTexture=new S.a(t,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,preMultiplyAlpha:!Object(Ni.x)(this.overlay.src)||!e.driverTestResult.svgAlwaysPremultipliesAlpha},this.overlay),this.mask.width=r,this.mask.height=r,this._maskTexture=new S.a(t,{target:3553,pixelFormat:6406,internalFormat:6406,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.mask);var a=1/this._magnifier.factor;this._readbackTexture=new S.a(t,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:Math.ceil(a*r),height:Math.ceil(a*r)})}}}]),r}(Hi.a)}}]);
//# sourceMappingURL=23-f1b7296ec0945d9c958a.js.map
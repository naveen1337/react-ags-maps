(window.webpackJsonp=window.webpackJsonp||[]).push([[125],{"3OBd":function(e,t,r){"use strict";r.r(t);var n=r("eijD"),a=r("mK0O"),i=r("hisu"),s=r("yBJb"),o=r("4Mpa"),l=r("CHlC"),u=r("kMo5"),c=r("P+uj"),f=r("NthX"),p=r.n(f),h=r("dQW7"),d=r("hKEQ"),m=r("S1zV"),b=r("Mp7X"),y=r("7im+"),v=r("d4jZ"),x=r("IH5m"),g=r("xAIp"),O=(r("J4Pc"),r("wckI")),j=r("TM+E"),w=r("vo12"),k=r("mp5+"),I=r("iaHD"),R=r("QZQ7"),S=r("9P7x"),T=r("xuB6"),C=(r("ZTBZ"),r("DGz/")),P=r("PVS0"),_=r("12QT"),M=r("/BCw"),F=r("NRoO"),D=r("rpQj"),B=r("0DVy"),E=r("eDEE"),z=r("/KFZ"),A=r("JKOu"),H=r("nd5+"),N=r("YHXj");function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var U=j.a.getLogger("esri.layers.mixins.ImageryTileMixin"),W=r("oTsO"),G=r("44so"),V=r("2eXi"),Y=r("wJzb"),X=r("SPOG"),K=r("A6/9"),Q=r("NSiF"),Z=r("d/mo"),$=r("aNYv"),ee=r("6CzD"),te=r("0n+b"),re=r("t4nU"),ne=r("Ufyo"),ae=r("KuRq"),ie=r("WBSb"),se=r("lWwP"),oe=r("OTJA");function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var fe=function(e){Object(l.a)(v,e);var t,r,a,o,u,c,f,h,d,m=ce(v);function v(){var e;return Object(i.a)(this,v),(e=m.apply(this,arguments)).rasterJobHandler=null,e.datasetName=null,e.datasetFormat=null,e.rasterInfo=null,e.ioConfig={sampling:"closest"},e}return Object(s.a)(v,[{key:"init",value:(d=Object(n.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(se.f)(),this.addResolvingPromise(t),e.next=4,this.when();case 4:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"normalizeCtorArgs",value:function(e){return e&&e.ioConfig&&(e=ue(ue({},e),{},{ioConfig:ue({resolution:null,bandIds:null,sampling:"closest",tileInfo:E.a.create()},e.ioConfig)})),e}},{key:"url",set:function(e){this._set("url",Object(M.h)(e,j.a.getLogger(this.declaredClass)))}},{key:"open",value:(h=Object(n.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new b.a("BaseRaster:open-not-implemented","open() is not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return h.apply(this,arguments)})},{key:"fetchTile",value:(f=Object(n.a)(p.a.mark((function e(t,r,n){var a,i,s,o,l,u=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:{},s=a.tileInfo,o=s.lodAt(t),l=this.getTileExtent({x:o.resolution,y:o.resolution},r,n,s.origin,s.spatialReference,s.size),e.abrupt("return",(null!=(i=a.multidimensionalDefinition)&&i.length&&Object(y.i)(this.rasterInfo.multidimensionalInfo)&&null==a.sliceId&&(a=ue(ue({},a),{},{sliceId:this.getSliceIndex(a.multidimensionalDefinition)||0})),this.fetchPixels(l,s.size[0],s.size[1],a)));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return f.apply(this,arguments)})},{key:"identify",value:(c=Object(n.a)(p.a.mark((function e(t){var r,n,a,i,s,o,l,u,c,f,h,d,m,b,v,x,g,O,j=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=j.length>1&&void 0!==j[1]?j[1]:{},n=this.rasterInfo,a=n.spatialReference,i=n.extent,s=r.datumTransformation,o=Object(se.h)(t,a,s),i.intersects(o)){e.next=5;break}return e.abrupt("return",{location:o,value:null});case 5:if(!Object(y.i)(this.rasterInfo.transform)){e.next=10;break}if(l=this.rasterInfo.transform.inverseTransform(o),this.rasterInfo.nativeExtent.intersects(l)){e.next=9;break}return e.abrupt("return",{location:l,value:null});case 9:o=l;case 10:if(u=0,!r.srcResolution){e.next=15;break}u=Object(se.k)(r.srcResolution,this.rasterInfo,this.ioConfig.sampling).pyramidLevel,e.next=20;break;case 15:return e.next=17,this.computeBestPyramidLevelForLocation(t,r);case 17:if(null!=(u=e.sent)){e.next=20;break}return e.abrupt("return",{location:o,value:null});case 20:if(null!==(c=this.identifyPixelLocation(o,u,null))){e.next=23;break}return e.abrupt("return",{location:o,value:null});case 23:return f=c.row,h=c.col,d=c.rowOffset,m=c.colOffset,b=Object(ne.d)(this.url,r.sliceId),v="".concat(u,"/").concat(f,"/").concat(h),x=Object(ne.c)(b,null,v),Object(y.i)(x)||(x=this.fetchRawTile(u,f,h,r),Object(ne.e)(b,null,v,x)),e.next=28,x;case 28:if((g=e.sent)&&g.pixels&&g.pixels.length>0){e.next=31;break}return e.abrupt("return",{location:o,value:null});case 31:return O=d*this.rasterInfo.storageInfo.blockHeight+m,e.abrupt("return",{location:o,value:!g.mask||g.mask[O]?g.pixels.map((function(e){return e[O]})):null,pyramidLevel:u});case 33:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"fetchPixels",value:(u=Object(n.a)(p.a.mark((function e(t,r,n){var a,i,s,o,l,u,c,f,h,d,m,b,v,x,g,O,j,w,k,I,R,S,T,C,P,_,M,F,D=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=D.length>3&&void 0!==D[3]?D[3]:{},t=Object(se.j)(t),i=Object(se.e)(t),s=this.rasterInfo.spatialReference,o=!t.spatialReference.equals(s),l=a.datumTransformation,u=new oe.a({x:(t.xmax-t.xmin)/r,y:(t.ymax-t.ymin)/n,spatialReference:t.spatialReference}),c=a.srcResolution||(o?Object(se.i)(u,s,t,l):u)){e.next=5;break}return e.abrupt("return",null);case 5:if(f=Object(se.k)(c,this.rasterInfo,this.ioConfig.sampling),h=f.pyramidLevel,d=f.pyramidResolution,!f.excessiveReading){e.next=8;break}return e.abrupt("return",null);case 8:if(m=this.rasterInfo.storageInfo,b=o?Object(se.g)(t,s,l):t,(v=Object(y.p)(this.rasterInfo.transform))&&(b=v.inverseTransform(b)),null!=b){e.next=13;break}return e.abrupt("return",null);case 13:if(x={x:Math.floor((b.xmin-m.origin.x)/d.x+.1),y:Math.floor((m.origin.y-b.ymax)/d.y+.1)},g=Math.ceil((b.xmax-b.xmin)/d.x-.1),O=Math.ceil((b.ymax-b.ymin)/d.y-.1),!(g/r>8||O/n>8||i>=2)){e.next=16;break}return e.abrupt("return",null);case 16:return e.next=18,this.fetchRawPixels(h,x,{width:g,height:O,wrapCount:i},a);case 18:if(j=e.sent){e.next=21;break}return e.abrupt("return",null);case 21:if(w=h>0?m.pyramidBlockWidth:m.blockWidth,k=h>0?m.pyramidBlockHeight:m.blockHeight,o||1!==j.pixelBlocks.length||w!==r||k!==n||c.x!==u.x||c.y!==u.y){e.next=24;break}return e.abrupt("return",{extent:t,srcExtent:b,pixelBlock:j.pixelBlocks[0]});case 24:if(I=Object(se.c)(t,j.extent,u,l,v,i>0),S=!a.requestRawData,T={rows:I.spacing[0],cols:I.spacing[1]},C=Object(y.p)(this._getRasterTileAlignmentInfo(h,j.extent.xmin)),P=j.pixelBlocks,_=j.mosaicSize,M=j.isPartiallyFilled,!this.rasterJobHandler){e.next=32;break}return e.next=29,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:P,srcMosaicSize:_,destDimension:S?{width:r,height:n}:null,coefs:S?I.coefficients:null,sampleSpacing:S?T:null,interpolation:a.interpolation,alignmentInfo:C},a);case 29:R=e.sent,e.next=34;break;case 32:F=Object(ie.j)(P,_,null,null,C),R=S?Object(ie.a)(F,{width:r,height:n},I.coefficients,T,a.interpolation):F;case 34:return e.abrupt("return",a.requestRawData?{srcExtent:b,pixelBlock:R,transformGrid:I,extent:t,isPartiallyFilled:M}:{srcExtent:b,extent:t,pixelBlock:R});case 35:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return u.apply(this,arguments)})},{key:"fetchRawPixels",value:(o=Object(n.a)(p.a.mark((function e(t,r,n,a){var i,s,o,l,u,c,f,h,d,m,b,v,x,g,O,j,w,k,I,R,S,T,C,P,_,M,F,D,B,E,z,A,N;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.rasterInfo.storageInfo,s=i.origin,o=i.blockBoundary,l=this.getBlockWidthHeight(t),u=l.blockWidth,c=l.blockHeight,f=r.x,h=r.y,d=n.width,m=n.height,b=n.wrapCount,v=Object(y.p)(this._getRasterTileAlignmentInfo(t,0)),a.buffer&&(f-=a.buffer.cols,h-=a.buffer.rows,d+=2*a.buffer.cols,m+=2*a.buffer.rows),x=Math.floor(f/u),g=Math.floor(h/c),O=Math.floor((f+d-1)/u),j=Math.floor((h+m-1)/c),w=o[t]){e.next=7;break}return e.abrupt("return",null);case 7:if(k=w.minRow,I=w.minCol,R=w.maxCol,S=w.maxRow,!(j<k||O<I||g>S||x>R)){e.next=10;break}return e.abrupt("return",null);case 10:for(T=[],P=!1,_=g;_<=j;_++)for(M=x;M<=O;M++)F=0===b||null==v||M<v.worldColumnCountFromOrigin?M:M%v.worldColumnCountFromOrigin-v.originColumnOffset,_>=k&&F>=I&&S>=_&&R>=F?(C=this._fetchRawTile(t,_,F,a),this.ioConfig.allowPartialFill&&(C=new Promise((function(e){C.then((function(t){return e(t)})).catch((function(){P=!0,e(null)}))}))),T.push(C)):T.push(null);if(0!==T.length){e.next=15;break}return e.abrupt("return",null);case 15:return e.next=17,Promise.all(T);case 17:return D=e.sent,B={height:(j-g+1)*c,width:(O-x+1)*u},E=this.rasterInfo.spatialReference,z=this.getPyramidPixelSize(t),A=z.x,N=z.y,e.abrupt("return",{extent:new H.a({xmin:s.x+x*u*A,xmax:s.x+(O+1)*u*A,ymin:s.y-(j+1)*c*N,ymax:s.y-g*c*N,spatialReference:E}),pixelBlocks:D,mosaicSize:B,isPartiallyFilled:P});case 24:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return o.apply(this,arguments)})},{key:"fetchRawTile",value:(a=Object(n.a)(p.a.mark((function e(t,r,n,a){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new b.a("BaseRaster:read-not-implemented","fetchRawTile() is not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,n){return a.apply(this,arguments)})},{key:"computeExtent",value:function(e){return Object(se.g)(this.rasterInfo.extent,e)}},{key:"decodePixelBlock",value:function(e,t){return!this.rasterJobHandler||t.useCanvas?Object(ae.a)(e,t):this.rasterJobHandler.decode({data:e,options:t})}},{key:"request",value:(r=Object(n.a)(p.a.mark((function e(t,r,n){var a,i,s,o,l,u,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.ioConfig.customFetchParameters,o=r.range,l=r.query,u=r.headers,n=null!=(a=null!=(i=n)?i:r.retryCount)?a:this.ioConfig.retryCount,c=o?{Range:"bytes=".concat(o.from,"-").concat(o.to)}:null,e.prev=3,e.next=6,Object(C.default)(t,ue(ue({},r),{},{query:ue(ue({},l),s),headers:ue(ue({},u),c)}));case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!(n>0)){e.next=13;break}return e.abrupt("return",(n--,this.request(t,r,n)));case 13:throw e.t0;case 14:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getSliceIndex",value:function(e){var t=this,r=this.rasterInfo.multidimensionalInfo;if(!Object(y.i)(r)||null==e||!e.length)return null;for(var n=0,a=e[0].variableName,i=function(i){var s=r.variables[i],o=s.dimensions;if(s.name!==a)return n+=o.map((function(e){return t._getDimensionValuesCount(e)})).reduce((function(e,t){return e+t})),"break";for(var l=o.map((function(e){return t._getDimensionValuesCount(e)})),u=o.length,c=function(r){var a=e.filter((function(e){return e.dimensionName===o[r].name}))[0];if(null==a)return{v:{v:null}};var i=Array.isArray(a.values[0])?a.values[0][0]:a.values[0],s=t._getIndexFromDimensions(i,o[r]);if(-1===s)return{v:{v:null}};l.shift(),n+=r===u-1?s:s*l.reduce((function(e,t){return e+t}))},f=0;f<u;f++){var p=c(f);if("object"==typeof p)return p.v}},s=0;s<r.variables.length;s++){var o=i(s);if("break"===o)break;if("object"==typeof o)return o.v}return n}},{key:"updateTileInfo",value:function(){var e=this.rasterInfo,t=e.storageInfo,r=e.spatialReference,n=e.extent,a=e.pixelSize;if(!t.tileInfo){for(var i=[],s=t.maximumPyramidLevel||0,o=Math.max(a.x,a.y),l=1/.0254*96*o,u=0;u<=s;u++)i.push({level:s-u,resolution:o,scale:l}),o*=2,l*=2;var c=new oe.a({x:n.xmin,y:n.ymax,spatialReference:r});t.tileInfo=new E.a({origin:c,size:[t.blockWidth,t.blockHeight],spatialReference:r,lods:i}),t.isVirtualTileInfo=!0}}},{key:"createRemoteDatasetStorageInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,n=arguments.length>3?arguments[3]:void 0,a=e.width,i=e.height,s=e.nativeExtent,o=e.pixelSize,l=e.spatialReference,u=new oe.a({x:s.xmin,y:s.ymax,spatialReference:l});null==n&&(n=Math.max(0,Math.round(Math.log(Math.max(a,i))/Math.LN2-8)));var c=this.computeBlockBoundary(s,512,512,{x:s.xmin,y:s.ymax},[o],n);e.storageInfo=new Z.a({blockWidth:t,blockHeight:r,pyramidBlockWidth:t,pyramidBlockHeight:r,origin:u,firstPyramidLevel:1,maximumPyramidLevel:n,blockBoundary:c})}},{key:"computeBestPyramidLevelForLocation",value:(t=Object(n.a)(p.a.mark((function e(t){var r=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>1&&void 0!==r[1]&&r[1],e.abrupt("return",0);case 2:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"computeBlockBoundary",value:function(e,t,r,n,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2;if(1===a.length&&i>0)for(var o=(a=Object(ee.a)(a))[0],l=o.x,u=o.y,c=0;c<i;c++)l*=s,u*=s,a.push({x:l,y:u});for(var f=[],p=n.x,h=n.y,d=0;d<a.length;d++){var m=a[d],b=m.x,y=m.y;f.push({minCol:Math.floor((e.xmin-p+.1*b)/t/b),maxCol:Math.floor((e.xmax-p-.1*b)/t/b),minRow:Math.floor((h-e.ymax+.1*y)/r/y),maxRow:Math.floor((h-e.ymin-.1*y)/r/y)})}return f}},{key:"getPyramidPixelSize",value:function(e){var t=this.rasterInfo.nativePixelSize,r=this.rasterInfo.storageInfo,n=r.pyramidResolutions,a=r.pyramidScalingFactor;if(0===e)return t;if(Object(y.i)(n)&&n.length)return n[e-1];var i=Math.pow(a,e);return{x:t.x*i,y:t.y*i}}},{key:"identifyPixelLocation",value:function(e,t,r){var n=this.rasterInfo,a=n.spatialReference,i=n.nativeExtent,s=this.rasterInfo.storageInfo,o=s.blockWidth,l=s.blockHeight,u=s.maximumPyramidLevel,c=s.origin,f=Object(se.h)(e,a,r);if(!i.intersects(f))return null;if(t<0||t>u)return null;var p=this.getPyramidPixelSize(t),h=p.x,d=p.y,m=(c.y-f.y)/d/l,b=(f.x-c.x)/h/o,y=Math.min(l-1,Math.floor((m-Math.floor(m))*l)),v=Math.min(o-1,Math.floor((b-Math.floor(b))*o));return{pyramidLevel:t,row:Math.floor(m),col:Math.floor(b),rowOffset:y,colOffset:v,srcLocation:f}}},{key:"getTileExtent",value:function(e,t,r,n,a,i){var s=Object($.a)(i,2),o=s[0],l=s[1],u=n.x+r*o*e.x,c=u+o*e.x,f=n.y-t*l*e.y,p=f-l*e.y;return new H.a({xmin:u,xmax:c,ymin:p,ymax:f,spatialReference:a})}},{key:"getBlockWidthHeight",value:function(e){return{blockWidth:e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,blockHeight:e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight}}},{key:"isBlockOutside",value:function(e,t,r){var n=this.rasterInfo.storageInfo.blockBoundary[e];return!n||n.maxRow<t||n.maxCol<r||n.minRow>t||n.minCol>r}},{key:"_fetchRawTile",value:function(e,t,r,n){var a=this.rasterInfo.storageInfo.blockBoundary[e];if(!a)return Promise.resolve(null);var i=a.minRow,s=a.minCol,o=a.maxCol,l=a.maxRow;if(t<i||r<s||t>l||r>o)return Promise.resolve(null);var u=Object(ne.d)(this.url,n.sliceId),c="".concat(e,"/").concat(t,"/").concat(r),f=Object(ne.c)(u,n.registryId,c);if(!Object(y.i)(f)){var p=Object(x.d)();f=this.fetchRawTile(e,t,r,ue(ue({},n),{},{signal:p.signal})),Object(ne.e)(u,n.registryId,c,f,p),f.catch((function(){Object(ne.b)(u,n.registryId,c)}))}return n.signal&&Object(x.q)(n,(function(){Object(ne.a)(u,n.registryId,c)})),f}},{key:"_getIndexFromDimensions",value:function(e,t){var r=t.extent,n=t.interval,a=t.unit,i=t.values;if(null!=i&&i.length)return Array.isArray(i[0])?i.findIndex((function(t){return t[0]<=e&&t[1]>=e})):i.indexOf(e);if(e>r[1])return-1;var s=r[0],o=-1;if("ISO8601"===a){var l;switch((null==(l=t.intervalUnit)?void 0:l.toLowerCase())||"seconds"){case"seconds":o=Math.round((e-s)/1e3/n);break;case"minutes":o=Math.round((e-s)/6e4/n);break;case"hours":o=Math.round((e-s)/36e5/n);break;case"days":o=Math.round((e-s)/864e5/n);break;case"years":o=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/n);break;case"decades":o=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/10/n)}return o}return Math.round((e-s)/n)}},{key:"_getDimensionValuesCount",value:function(e){var t=e.extent,r=e.interval,n=e.unit,a=e.values,i=(null==a?void 0:a.length)||0;if(i)return i;var s=t[0];if(0===i&&"ISO8601"===n){var o;switch((null==(o=e.intervalUnit)?void 0:o.toLowerCase())||"seconds"){case"seconds":i=Math.round((t[1]-t[0])/1e3/r);break;case"minutes":i=Math.round((t[1]-t[0])/6e4/r);break;case"hours":i=Math.round((t[1]-t[0])/36e5/r);break;case"days":i=Math.round((t[1]-t[0])/864e5/r);break;case"years":i=Math.round((new Date(t[1]).getUTCFullYear()-new Date(s).getUTCFullYear())/r);break;case"decades":i=Math.round((new Date(t[1]).getUTCFullYear()-new Date(s).getUTCFullYear())/10/r)}return i}return Math.round((t[1]-t[0])/r)}},{key:"_getRasterTileAlignmentInfo",value:function(e,t){return null==this._rasterTileAlighmentInfo&&(this._rasterTileAlighmentInfo=Object(se.d)(this.rasterInfo)),Object(y.i)(this._rasterTileAlighmentInfo.pyramidsInfo)?ue({startX:t,halfWorldWidth:this._rasterTileAlighmentInfo.halfWorldWidth,hasGCSSShiftTransform:this._rasterTileAlighmentInfo.hasGCSSShiftTransform},this._rasterTileAlighmentInfo.pyramidsInfo[e]):null}}]),v}(Object(re.b)(te.a));Object(h.a)([Object(g.b)()],fe.prototype,"_rasterTileAlighmentInfo",void 0),Object(h.a)([Object(g.b)(F.n)],fe.prototype,"url",null),Object(h.a)([Object(g.b)({type:String,json:{write:!0}})],fe.prototype,"datasetName",void 0),Object(h.a)([Object(g.b)({type:String,json:{write:!0}})],fe.prototype,"datasetFormat",void 0),Object(h.a)([Object(g.b)()],fe.prototype,"rasterInfo",void 0),Object(h.a)([Object(g.b)()],fe.prototype,"ioConfig",void 0),Object(h.a)([Object(g.b)()],fe.prototype,"sourceJSON",void 0);var pe=fe=Object(h.a)([Object(I.a)("esri.layers.support.rasterDatasets.BaseRaster")],fe),he=r("6zn5");function de(e){var t=e.fields,r=e.records,n=t.some((function(e){return"oid"===e.name.toLowerCase()}))?"OBJECTID":"OID",a=[{name:n,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map((function(e){return{name:e.name,type:"esriFieldType"+e.typeName,alias:e.name}}))),i=a.map((function(e){return e.name})),s=[],o=0,l=0;return r.forEach((function(e){var t={};for(t[n]=o++,l=1;l<i.length;l++)t[i[l]]=e[l-1];s.push({attributes:t})})),{displayFieldName:"",fields:a,features:s}}var me=function(){function e(){Object(i.a)(this,e)}return Object(s.a)(e,null,[{key:"supportedVersions",get:function(){return[5]}},{key:"parse",value:function(e){var t=new DataView(e),r=3&t.getUint8(0);if(3!==r)return{header:{version:r},recordSet:null};var n,a=t.getUint32(4,!0),i=t.getUint16(8,!0),s=t.getUint16(10,!0),o={version:r,recordCount:a,headerByteCount:i,recordByteCount:s},l=32,u=[],c=[];if(3===r){for(;13!==t.getUint8(l);)n=String.fromCharCode(t.getUint8(l+11)).trim(),u.push({name:Object(he.a)(new Uint8Array(e,l,11)),type:n,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(n)],length:t.getUint8(l+16)}),l+=32;if(l+=1,u.length>0)for(var f=function(){var r=[];32===t.getUint8(l)?(l+=1,u.forEach((function(t){if("C"===t.type)r.push(Object(he.a)(new Uint8Array(e,l,t.length)).trim());else if("N"===t.type)r.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,l,t.length)).trim(),10));else if("F"===t.type)r.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,l,t.length)).trim()));else if("D"===t.type){var n=String.fromCharCode.apply(null,new Uint8Array(e,l,t.length)).trim();r.push(new Date(parseInt(n.substring(0,4),10),parseInt(n.substring(4,6),10)-1,parseInt(n.substring(6,8),10)))}l+=t.length})),c.push(r)):l+=s};c.length<a&&e.byteLength-l>s;)f()}return{header:o,fields:u,records:c,recordSet:de({fields:u,records:c})}}}]),e}();function be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var ye=function(e){Object(l.a)(r,e);var t=be(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).affectsPixelSize=!1,e}return Object(s.a)(r,[{key:"forwardTransform",value:function(e){return e}},{key:"inverseTransform",value:function(e){return e}}]),r}(te.a);Object(h.a)([Object(g.b)()],ye.prototype,"affectsPixelSize",void 0),Object(h.a)([Object(g.b)({json:{write:!0}})],ye.prototype,"spatialReference",void 0);var ve=ye=Object(h.a)([Object(I.a)("esri.layers.support.rasterTransforms.BaseRasterTransform")],ye);function xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var ge=function(e){Object(l.a)(r,e);var t=xe(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="identity",e}return r}(ve);Object(h.a)([Object(w.a)({IdentityXform:"identity"})],ge.prototype,"type",void 0);var Oe=ge=Object(h.a)([Object(I.a)("esri.layers.support.rasterTransforms.IdentityTransform")],ge),je=r("jr4m");function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}function ke(e,t,r){var n=t.x,a=t.y;if(r<2)return{x:e[0]+n*e[2]+a*e[4],y:e[1]+n*e[3]+a*e[5]};if(2===r){var i=n*n,s=a*a,o=n*a;return{x:e[0]+n*e[2]+a*e[4]+i*e[6]+o*e[8]+s*e[10],y:e[1]+n*e[3]+a*e[5]+i*e[7]+o*e[9]+s*e[11]}}var l=n*n,u=a*a,c=n*a,f=l*n,p=l*a,h=n*u,d=a*u;return{x:e[0]+n*e[2]+a*e[4]+l*e[6]+c*e[8]+u*e[10]+f*e[12]+p*e[14]+h*e[16]+d*e[18],y:e[1]+n*e[3]+a*e[5]+l*e[7]+c*e[9]+u*e[11]+f*e[13]+p*e[15]+h*e[17]+d*e[19]}}function Ie(e,t,r){var n=t.xmin,a=t.ymin,i=t.xmax,s=t.ymax,o=t.spatialReference,l=[];if(r<2)l.push({x:n,y:s}),l.push({x:i,y:s}),l.push({x:n,y:a}),l.push({x:i,y:a});else{for(var u=10,c=0;c<u;c++)l.push({x:n,y:a+(s-a)*c/(u-1)}),l.push({x:i,y:a+(s-a)*c/(u-1)});u=8;for(var f=1;f<=u;f++)l.push({x:n+(i-n)*f/u,y:a}),l.push({x:n+(i-n)*f/u,y:s})}var p=(l=l.map((function(t){return ke(e,t,r)}))).map((function(e){return e.x})),h=l.map((function(e){return e.y}));return new H.a({xmin:Math.min.apply(null,p),xmax:Math.max.apply(null,p),ymin:Math.min.apply(null,h),ymax:Math.max.apply(null,h),spatialReference:o})}var Re=function(e){Object(l.a)(r,e);var t=we(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).polynomialOrder=1,e.type="polynomial",e}return Object(s.a)(r,[{key:"readForwardCoefficients",value:function(e,t){var r=t.coeffX,n=t.coeffY;if(null==r||!r.length||null==n||!n.length||r.length!==n.length)return null;for(var a=[],i=0;i<r.length;i++)a.push(r[i]),a.push(n[i]);return a}},{key:"writeForwardCoefficients",value:function(e,t,r){for(var n=[],a=[],i=0;i<(null==e?void 0:e.length);i++)i%2==0?n.push(e[i]):a.push(e[i]);t.coeffX=n,t.coeffY=a}},{key:"inverseCoefficients",get:function(){var e=this._get("inverseCoefficients"),t=this._get("forwardCoefficients");return!e&&t&&this.polynomialOrder<2&&(e=function(e){var t=Object($.a)(e,6),r=t[0],n=t[1],a=t[2],i=t[3],s=t[4],o=t[5],l=a*o-s*i,u=s*i-a*o;return[(s*n-r*o)/l,(a*n-r*i)/u,o/l,i/u,-s/l,-a/u]}(t)),e},set:function(e){this._set("inverseCoefficients",e)}},{key:"readInverseCoefficients",value:function(e,t){var r=t.inverseCoeffX,n=t.inverseCoeffY;if(null==r||!r.length||null==n||!n.length||r.length!==n.length)return null;for(var a=[],i=0;i<r.length;i++)a.push(r[i]),a.push(n[i]);return a}},{key:"writeInverseCoefficients",value:function(e,t,r){for(var n=[],a=[],i=0;i<(null==e?void 0:e.length);i++)i%2==0?n.push(e[i]):a.push(e[i]);t.inverseCoeffX=n,t.inverseCoeffY=a}},{key:"forwardTransform",value:function(e){if("point"===e.type){var t=ke(this.forwardCoefficients,e,this.polynomialOrder);return new oe.a({x:t.x,y:t.y,spatialReference:e.spatialReference})}return Ie(this.forwardCoefficients,e,this.polynomialOrder)}},{key:"inverseTransform",value:function(e){if("point"===e.type){var t=ke(this.inverseCoefficients,e,this.polynomialOrder);return new oe.a({x:t.x,y:t.y,spatialReference:e.spatialReference})}return Ie(this.inverseCoefficients,e,this.polynomialOrder)}}]),r}(ve);Object(h.a)([Object(g.b)({json:{write:!0}})],Re.prototype,"polynomialOrder",void 0),Object(h.a)([Object(g.b)()],Re.prototype,"forwardCoefficients",void 0),Object(h.a)([Object(k.a)("forwardCoefficients",["coeffX","coeffY"])],Re.prototype,"readForwardCoefficients",null),Object(h.a)([Object(je.a)("forwardCoefficients")],Re.prototype,"writeForwardCoefficients",null),Object(h.a)([Object(g.b)({json:{write:!0}})],Re.prototype,"inverseCoefficients",null),Object(h.a)([Object(k.a)("inverseCoefficients",["inverseCoeffX","inverseCoeffY"])],Re.prototype,"readInverseCoefficients",null),Object(h.a)([Object(je.a)("inverseCoefficients")],Re.prototype,"writeInverseCoefficients",null),Object(h.a)([Object(g.b)()],Re.prototype,"affectsPixelSize",void 0),Object(h.a)([Object(w.a)({PolynomialXform:"polynomial"})],Re.prototype,"type",void 0);var Se=Re=Object(h.a)([Object(I.a)("esri.layers.support.rasterTransforms.PolynomialTransform")],Re),Te={PolynomialXform:Se,IdentityXform:Oe},Ce=Object.keys(Te);var Pe=r("kJId");function _e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var Me=new Map;Me.set("int16","esriFieldTypeSmallInteger"),Me.set("int32","esriFieldTypeInteger"),Me.set("int64","esriFieldTypeInteger"),Me.set("float32","esriFieldTypeSingle"),Me.set("float64","esriFieldTypeDouble"),Me.set("text","esriFieldTypeString");var Fe=function(e){Object(l.a)(u,e);var t,r,a,o=_e(u);function u(){var e;return Object(i.a)(this,u),(e=o.apply(this,arguments)).storageInfo=null,e.datasetFormat="CRF",e}return Object(s.a)(u,[{key:"open",value:(a=Object(n.a)(p.a.mark((function e(t){var r,n,a,i,s,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return e.next=4,this.request(this.url+"/conf.json",{signal:null==t?void 0:t.signal});case 4:if(r=e.sent,n=r.data,this._validateHeader(n)){e.next=8;break}throw new b.a("cloudraster:open","Invalid or unsupported conf.json.");case 8:if(this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),a=this._parseHeader(n),i=a.storageInfo,"thematic"!==(s=a.rasterInfo).dataType){e.next=15;break}return e.next=13,this._fetchAuxiliaryInformation();case 13:o=e.sent,s.attributeTable=o;case 15:this._set("storageInfo",i),this._set("rasterInfo",s),this.ioConfig.retryCount=this.ioConfig.retryCount||0;case 16:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"fetchRawTile",value:(r=Object(n.a)(p.a.mark((function e(t,r,n){var a,i,s,o,l,u,c,f,h=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=h.length>3&&void 0!==h[3]?h[3]:{},!((i=this.rasterInfo.storageInfo.maximumPyramidLevel-t)<0)){e.next=4;break}return e.abrupt("return",null);case 4:return s=this._buildCacheFilePath(i,r,n,a.multidimensionalDefinition),o=this._getIndexRecordFromBundle(r,n),e.next=8,this.request(s,{range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer",signal:a.signal});case 8:if(l=e.sent){e.next=11;break}return e.abrupt("return",null);case 11:if(u=new Uint8Array(l.data),0!==(c=this._getTileEndAndContentType(u,o)).recordSize){e.next=14;break}return e.abrupt("return",null);case 14:return e.next=16,this.request(s,{range:{from:c.position,to:c.position+c.recordSize},responseType:"array-buffer",signal:a.signal});case 16:return f=e.sent,e.abrupt("return",f?this.decodePixelBlock(f.data,{width:this.rasterInfo.storageInfo.tileInfo.size[0],height:this.rasterInfo.storageInfo.tileInfo.size[1],planes:null,pixelType:null}):null);case 18:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"_validateHeader",value:function(e){return e&&"RasterInfo"===e.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some((function(t){return!e[t]}))}},{key:"_parseHeader",value:function(e){var t,r,n=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][e.pixelType],a=e.bandCount,i=e.histograms,s=e.colormap,o=e.blockWidth,l=e.blockHeight,u=e.firstPyramidLevel,c=e.maximumPyramidLevel,f=e.statistics&&e.statistics.map((function(e){return{min:e.min,max:e.max,avg:e.mean,stddev:e.standardDeviation,median:e.median,mode:e.mode}})),p=e.extent.spatialReference,h=null==(t=e.geodataXform)?void 0:t.spatialReference,d=new N.a(null!=p&&p.wkid||null!=p&&p.wkt?p:h),m=new H.a({xmin:e.extent.xmin,ymin:e.extent.ymin,xmax:e.extent.xmax,ymax:e.extent.ymax,spatialReference:d}),b=new oe.a({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:d}),y=Math.round((m.xmax-m.xmin)/b.x),v=Math.round((m.ymax-m.ymin)/b.y),x=this._parseTransform(e.geodataXform),g=x?m:null;x&&(m=x.forwardTransform(m),b.x=(m.xmax-m.xmin)/y,b.y=(m.ymax-m.ymin)/v);var O,j,w,k,I=null!=(r=e.properties)?r:{},R=e.format.toLowerCase().replace("cache/",""),S=new oe.a(e.origin.x,e.origin.y,d);if(s&&s.colors)for(O=[],j=0;j<s.colors.length;j++)w=s.colors[j],k=s.values?s.values[j]:j,O.push([k,255&w,w<<16>>>24,w<<8>>>24,w>>>24]);var T=e.LODInfos,C=[];for(j=0;j<T.levels.length;j++)C.push({level:T.levels[j],resolution:T.resolutions[j],scale:96/.0254*T.resolutions[j]});var P=new E.a({dpi:96,lods:C,format:R,origin:S,size:[o,l],spatialReference:d}),_={recordSize:8,packetSize:e.packetSize,headerSize:e.packetSize*e.packetSize*8+64},M=[{maxCol:Math.ceil(y/o)-1,maxRow:Math.ceil(v/l)-1,minCol:0,minRow:0}],F=2;if(c>0)for(j=0;j<c;j++)M.push({maxCol:Math.ceil(y/F/o)-1,maxRow:Math.ceil(v/F/l)-1,minCol:0,minRow:0}),F*=2;var D=e.mdInfo;return{storageInfo:_,rasterInfo:new Q.a({width:y,height:v,pixelType:n,bandCount:a,extent:m,nativeExtent:g,transform:x,spatialReference:d,pixelSize:b,keyProperties:I,statistics:f,histograms:i,multidimensionalInfo:D,colormap:O,storageInfo:new Z.a({blockWidth:o,blockHeight:l,pyramidBlockWidth:o,pyramidBlockHeight:l,origin:S,tileInfo:P,firstPyramidLevel:u,maximumPyramidLevel:c,blockBoundary:M})})}}},{key:"_parseTransform",value:function(e){var t,r;if(!function(e){var t=null==e?void 0:e.type;return!e||Ce.includes(t)}(e))throw new b.a("cloudraster:open","the data contains unsupported geodata transform types");var n=function(e){if(!(null==e?void 0:e.type))return null;var t=Te[null==e?void 0:e.type];if(t){var r=new t;return r.read(e),r}return null}(e);if("identity"===n.type)return null;if("polynomial"!==n.type||null==(t=n.forwardCoefficients)||!t.length||null==(r=n.inverseCoefficients)||!r.length)throw new b.a("cloudraster:open","the data contains unsupported geodata transforms - both forward and inverse coefficients are required currently");return n}},{key:"_fetchAuxiliaryInformation",value:(t=Object(n.a)(p.a.mark((function e(t){var r,n,a,i,s,o,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.request(this.url+"/conf.vat.json",{signal:t}).then((function(e){return e.data})).catch((function(){return null})),n=this.request(this.url+"/conf.vat.dbf",{responseType:"array-buffer",signal:t}).then((function(e){return e.data})).catch((function(){return null})),e.next=4,Promise.all([r,n]);case 4:return(a=e.sent)[0]&&(s=a[0].fields,o=a[0].values,s&&o&&(s=s.map((function(e){return{type:"OID"===e.name?"esriFieldTypeOID":Me.get(e.type),name:e.name,alias:e.alias||e.name}})),l=o.map((function(e){return{attributes:e}})),s&&o&&(i={fields:s,features:l}))),!i&&a[1]&&(i=me.parse(a[1]).recordSet),e.abrupt("return",Pe.default.fromJSON(i));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_buildCacheFilePath",value:function(e,t,r,n){var a=this.storageInfo.packetSize,i=Math.floor(t/a)*a,s=Math.floor(r/a)*a,o="R"+this._toHexString4(i)+"C"+this._toHexString4(s),l="L";l+=e>=10?e.toString():"0"+e.toString();var u=this.rasterInfo.multidimensionalInfo,c=null==n?void 0:n[0];if(!Object(y.i)(u)||!c)return"".concat(this.url,"/_alllayers/").concat(l,"/").concat(o,".bundle");for(var f=u.variables.filter((function(e){return e.name===c.variableName}))[0].dimensions[0].values.indexOf(c.values[0]).toString(16),p=4-f.length,h=0;h<p;h++)f="0"+f;return f="S"+f,"".concat(this.url,"/_alllayers/").concat(c.variableName,"/").concat(f,"/").concat(l,"/").concat(o,".bundle")}},{key:"_getIndexRecordFromBundle",value:function(e,t){var r=this.storageInfo.packetSize,n=r*(e%r)+t%r;if(n<0)throw"Invalid level / row / col";return 20+n*this.storageInfo.recordSize+44}},{key:"_getTileEndAndContentType",value:function(e,t){var r,n=e.subarray(t,t+8),a=0;for(r=0;r<5;r++)a|=(255&n[r])<<8*r;var i=0xffffffffff&a;for(a=0,r=5;r<8;r++)a|=(255&n[r])<<8*(r-5);return{position:i,recordSize:0xffffffffff&a}}},{key:"_toHexString4",value:function(e){var t=e.toString(16);if(4!==t.length)for(var r=4-t.length;r-- >0;)t="0"+t;return t}}]),u}(pe);Object(h.a)([Object(g.b)({readOnly:!0})],Fe.prototype,"storageInfo",void 0),Object(h.a)([Object(g.b)({type:String,json:{write:!0}})],Fe.prototype,"datasetFormat",void 0);var De=Fe=Object(h.a)([Object(I.a)("esri.layers.support.rasterDatasets.CloudRaster")],Fe);function Be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var Ee=function(e){Object(l.a)(o,e);var t,r,a=Be(o);function o(){var e;return Object(i.a)(this,o),(e=a.apply(this,arguments)).datasetFormat="MEMORY",e}return Object(s.a)(o,[{key:"open",value:(r=Object(n.a)(p.a.mark((function e(t){var r,n,a,i,s,o,l,u,c,f,h,d,m,b,y,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return n=this.data,a=n.pixelBlock,i=n.statistics,s=n.histograms,o=n.name,l=n.keyProperties,u=n.nativeExtent,c=n.transform,f=a.width,h=a.height,d=a.pixelType,m=this.data.extent||new H.a({xmin:-.5,ymin:.5,xmax:f-.5,ymax:h-.5,spatialReference:new N.a({wkid:3857})}),b=null!=(r=this.data.isPseudoSpatialReference)?r:!this.data.extent,y={x:m.width/f,y:m.height/h},v=new Q.a({width:f,height:h,pixelType:d,extent:m,nativeExtent:u,transform:c,pixelSize:y,spatialReference:m.spatialReference,bandCount:3,keyProperties:l||{},statistics:i,isPseudoSpatialReference:b,histograms:s}),this.createRemoteDatasetStorageInfo(v,512,512),this._set("rasterInfo",v),this.updateTileInfo(),e.next=8,this._buildInMemoryRaster(a,{width:512,height:512},t);case 8:this.datasetName=o,this.url="/InMemory/"+o;case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fetchRawTile",value:function(e,t,r){var n=this._pixelBlockTiles.get("".concat(e,"/").concat(t,"/").concat(r));return Promise.resolve(n)}},{key:"_buildInMemoryRaster",value:(t=Object(n.a)(p.a.mark((function e(t,r,n){var a,i,s,o,l,u,c,f;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.rasterInfo.storageInfo.maximumPyramidLevel,i=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:t,tileSize:r,maximumPyramidLevel:a},n):Promise.resolve(Object(ie.n)(t,r,a)),s=Object(y.i)(this.rasterInfo.statistics),o=Object(y.i)(this.rasterInfo.histograms),l=s&&o?Promise.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:t},n):Promise.resolve(Object(ie.g)(t)),e.next=7,Object(x.j)([i,l]);case 7:if((u=e.sent)[0].value||!u[1].value){e.next=10;break}throw new b.a("inmemory-raster:open","failed to build in memory raster");case 10:this._pixelBlockTiles=u[0].value,s||(this.rasterInfo.statistics=null==(c=u[1].value)?void 0:c.statistics),o&&(this.rasterInfo.histograms=null==(f=u[1].value)?void 0:f.histograms);case 12:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})}]),o}(pe);Object(h.a)([Object(g.b)({type:String,json:{write:!0}})],Ee.prototype,"datasetFormat",void 0),Object(h.a)([Object(g.b)()],Ee.prototype,"data",void 0);var ze=Ee=Object(h.a)([Object(I.a)("esri.layers.support.rasterDatasets.InMemoryRaster")],Ee);function Ae(e,t){if(!e||!t)return[];var r=t;t.indexOf("/")>-1?(r=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var n=[];if(t){for(var a=Ae(e,r),i=0;i<a.length;i++)Ae(a[i],t).forEach((function(e){return n.push(e)}));return n}var s=e.getElementsByTagNameNS("*",r);if(!s||0===s.length)return[];for(var o=0;o<s.length;o++)n.push(s[o]||s.item[o]);return n}function He(e,t){if(!e||!t)return null;var r=t;t.indexOf("/")>-1?(r=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var n=Ae(e,r);return n.length>0?t?He(n[0],t):n[0]:null}function Ne(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=r?He(e,r):e;return n?(t=n.textContent||n.nodeValue)?t.trim():null:null}function Je(e,t){return function(e,t){for(var r,n=Ae(e,t),a=[],i=0;i<n.length;i++)(r=n[i].textContent||n[i].nodeValue)&&(""!==(r=r.trim())&&a.push(r));return a}(e,t).map((function(e){return Number(e)}))}function Le(e,t){var r=Ne(e,t);return Number(r)}function qe(e,t){var r,n=null==e||null==(r=e.nodeName)?void 0:r.toLowerCase(),a=t.toLowerCase();return n.slice(n.lastIndexOf(":")+1)===a}function Ue(e,t){if(!e||!t)return null;for(var r=[],n=0;n<e.length;n++)r.push(e[n]),r.push(t[n]);return r}function We(e){if(!e)return null;var t=Number(e);if(!isNaN(t)&&0!==t)return new N.a({wkid:t});if((e=String(e)).startsWith("COMPD_CS")){if(!e.includes("VERTCS")||!e.includes("GEOGCS")&&!e.startsWith("PROJCS"))return null;var r=e.indexOf("VERTCS"),n=e.indexOf("PROJCS"),a=n>-1?n:e.indexOf("GEOGCS");if(-1===a)return null;var i=e.slice(a,e.lastIndexOf("]",r)+1).trim(),s=e.slice(a,e.lastIndexOf("]")).trim();t=Ge(i);var o=new N.a(t?{wkid:t}:{wkt:i}),l=Ge(s);return l&&(o.vcsWkid=l),o}return e.startsWith("GEOGCS")||e.startsWith("PROJCS")?(t=Ge(e),new N.a(0!==t?{wkid:t}:{wkt:e})):null}function Ge(e){var t=e.replace(/\]/g,"[").replace(/\"/g,"").split("[").map((function(e){return e.trim()})).filter((function(e){return""!==e})),r=t[t.length-1].split(",");if("EPSG"===r[0]&&e.endsWith('"]]')){var n=Number(r[1]);if(!isNaN(n)&&0!==n)return n}return 0}function Ve(e){var t;if("pamdataset"!==(null==e||null==(t=e.documentElement.tagName)?void 0:t.toLowerCase()))return{};var r={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};e.documentElement.childNodes.forEach((function(e){if(1===e.nodeType)if(qe(e,"SRS")){if(!r.spatialReference){var t=Ne(e);r.spatialReference=We(t)}}else if(qe(e,"Metadata"))if("xml:ESRI"===e.getAttribute("domain")){var n=function(e){var t,r=He(e,"GeodataXform"),n=We(Le(r,"SpatialReference/WKID")||Ne(r,"SpatialReference/WKT"));if("typens:PolynomialXform"!==r.getAttribute("xsi:type"))return{spatialReference:n,transform:null};var a=null!=(t=Le(r,"PolynomialOrder"))?t:1,i=Je(r,"CoeffX/Double"),s=Je(r,"CoeffY/Double"),o=Je(r,"InverseCoeffX/Double"),l=Je(r,"InverseCoeffY/Double"),u=Ue(i,s),c=Ue(o,l);return{spatialReference:n,transform:new Se({spatialReference:n,polynomialOrder:a,forwardCoefficients:u,inverseCoefficients:c})}}(e),a=n.spatialReference,i=n.transform;r.transform=i,r.spatialReference||(r.spatialReference=a)}else Ae(e,"MDI").forEach((function(e){return r.metadata[e.getAttribute("key")]=Ne(e)}));else if(qe(e,"PAMRasterBand")){var s=function(e){var t,r,n,a,i,s=Le(e,"NoDataValue"),o=He(e,"Histograms/HistItem"),l=Le(o,"HistMin"),u=Le(o,"HistMax"),c=Le(o,"BucketCount"),f=null==(t=Ne(o,"HistCounts"))?void 0:t.split("|").map((function(e){return Number(e)}));Ae(e,"Metadata/MDI").forEach((function(e){var t,s=Number(null!=(t=e.textContent)?t:e.nodeValue);switch(e.getAttribute("key").toUpperCase()){case"STATISTICS_MINIMUM":r=s;break;case"STATISTICS_MAXIMUM":n=s;break;case"STATISTICS_MEAN":a=s;break;case"STATISTICS_STDDEV":i=s}}));var p=Le(e,"Metadata/SourceBandIndex");return{noDataValue:s,histogram:null!=f&&f.length&&null!=r&&null!=n?{min:l,max:u,size:c||f.length,counts:f}:null,sourceBandIndex:p,statistics:null!=r&&null!=n?{min:r,max:n,avg:a,stddev:i}:null}}(e);null!=s.sourceBandIndex&&null==r.rasterBands[s.sourceBandIndex]?r.rasterBands[s.sourceBandIndex]=s:r.rasterBands.push(s)}}));var n=r.rasterBands;if(n){var a=!!n[0].statistics;r.statistics=a?n.map((function(e){return e.statistics})):null;var i=!!n[0].histogram;r.histograms=i?n.map((function(e){return e.histogram})):null}return r}function Ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var Xe=function(e){Object(l.a)(u,e);var t,r,a,o=Ye(u);function u(){return Object(i.a)(this,u),o.apply(this,arguments)}return Object(s.a)(u,[{key:"open",value:(a=Object(n.a)(p.a.mark((function e(t){var r,n,a,i,s,o,l,u,c,f,h,d,m;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return e.next=4,this._fetchData(t);case 4:return r=e.sent,e.next=7,this._fetchAuxiliaryData(t);case 7:return n=e.sent,a=n.spatialReference,i=n.statistics,s=n.histograms,o=n.transform,(l=!a)&&(a=new N.a({wkid:3857})),null!=s&&s.length&&null==i&&(i=Object(ie.f)(s)),u=r.width,c=r.height,f=new H.a({xmin:-.5,ymin:.5-c,xmax:u-.5,ymax:.5,spatialReference:a}),h=o?o.forwardTransform(f):f,o&&((d=o.forwardCoefficients)&&0===d[1]&&0===d[2]&&(o=null,f=h)),m=new ze({data:{extent:h,nativeExtent:f,transform:o,pixelBlock:r,statistics:i,histograms:s,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:l}}),e.next=22,m.open();case 22:this._set("rasterInfo",m.rasterInfo),this._inMemoryRaster=m;case 24:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"fetchRawTile",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._inMemoryRaster.fetchRawTile(e,t,r,n)}},{key:"_fetchData",value:(r=Object(n.a)(p.a.mark((function e(t){var r,n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request(this.url,{responseType:"array-buffer",signal:null==t?void 0:t.signal});case 2:if(r=e.sent,n=r.data,"JPG"===(a=Object(ae.b)(n).toUpperCase())||"PNG"===a||"GIF"===a||"BMP"===a){e.next=7;break}throw new b.a("image-aux-raster:open","the data is not a supported format");case 7:return this._set("datasetFormat",a),e.next=10,this.decodePixelBlock(n,{format:"jpg",width:1,height:1,useCanvas:!0});case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_fetchAuxiliaryData",value:(t=Object(n.a)(p.a.mark((function e(t){var r,n,a,i,s,o,l,u,c,f,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(y.p)(null==t?void 0:t.signal),i=null!=(r=this.ioConfig.skipExtensions)?r:[],s=i.indexOf("aux.xml")>-1?null:this.request(this.url+".aux.xml",{responseType:"xml",signal:a}),o=this.datasetFormat,l="JPG"===o?"jgw":"PNG"===o?"pgw":"BMP"===o?"bpw":null,u=i.indexOf(l)>-1?null:this.request(this.url.slice(0,this.url.lastIndexOf("."))+"."+l,{responseType:"text",signal:a}),e.next=8,Object(x.j)([s,u]);case 8:if(c=e.sent,null==a||!a.aborted){e.next=11;break}throw Object(x.e)();case 11:return(f=Ve(null==(n=c[0].value)?void 0:n.data)).transform||(h=c[1].value?c[1].value.data.split("\n").slice(0,6).map((function(e){return Number(e)})):null,f.transform=6===(null==h?void 0:h.length)?new Se({forwardCoefficients:[h[4],h[5],h[0],-h[1],h[2],-h[3]]}):null),e.abrupt("return",f);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),u}(pe);Object(h.a)([Object(g.b)({type:String,json:{write:!0}})],Xe.prototype,"datasetFormat",void 0);var Ke=Xe=Object(h.a)([Object(I.a)("esri.layers.support.rasterDatasets.ImageAuxRaster")],Xe),Qe=r("z9dv"),Ze=r("/L0V"),$e=r("7f4O");function et(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var tt=function(e){Object(l.a)(r,e);var t=et(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="gcs-shift",e.tolerance=1e-8,e}return Object(s.a)(r,[{key:"forwardTransform",value:function(e){return"point"===(e=e.clone()).type?(e.x>180+this.tolerance&&(e.x-=360),e):(e.xmin>=180-this.tolerance?(e.xmax-=360,e.xmin-=360):e.xmax>180+this.tolerance&&(e.xmin=-180,e.xmax=180),e)}},{key:"inverseTransform",value:function(e){return"point"===(e=e.clone()).type?(e.x<-this.tolerance&&(e.x+=360),e):(e.xmin<-this.tolerance&&(e.xmin+=360,e.xmax+=360),e)}}]),r}(ve);Object(h.a)([Object(w.a)({GCSShiftXform:"gcs-shift"})],tt.prototype,"type",void 0),Object(h.a)([Object(g.b)()],tt.prototype,"tolerance",void 0);var rt=tt=Object(h.a)([Object(I.a)("esri.layers.support.rasterTransforms.GCSShiftTransform")],tt);function nt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var at=function(e){Object(l.a)(h,e);var t,r,a,o,u,c,f=nt(h);function h(){var e;return Object(i.a)(this,h),(e=f.apply(this,arguments))._levelOffset=0,e._slices=null,e._tilemapCache=null,e.datasetFormat="RasterTileServer",e}return Object(s.a)(h,[{key:"open",value:(c=Object(n.a)(p.a.mark((function e(t){var r,n,a,i,s,o,l,u,c,f,h,d,m,v,x,g,O,j,w,k,I,R;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:if(r=t&&t.signal,!this.sourceJSON){e.next=7;break}e.t0={data:this.sourceJSON},e.next=10;break;case 7:return e.next=9,this.request(this.url,{query:{f:"json"},signal:r});case 9:e.t0=e.sent;case 10:if((n=e.t0).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),a=n.data,this.sourceJSON=a,a){e.next=15;break}throw new b.a("imageserverraster:open","cannot initialize tiled image service, missing service info");case 15:if(a.tileInfo){e.next=17;break}throw new b.a("imageserverraster:open","use ImageryLayer to open non-tiled image services");case 17:return this._fixScaleInServiceInfo(),i=["jpg","jpeg","png","png8","png24","png32","mixed"],this.tileType=a.cacheType,null==this.tileType&&(i.indexOf(a.tileInfo.format.toLowerCase())>-1?this.tileType="Map":"lerc"===a.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster"),this.datasetName=a.name.slice(a.name.indexOf("/")+1),e.next=22,this._fetchRasterInfo({signal:r});case 22:if(s=e.sent,Object(y.i)(s)){e.next=25;break}throw new b.a("image-server-raster:open","cannot initialize image service");case 25:o="Map"===this.tileType?Object(Ze.a)(a.tileInfo,a):E.a.fromJSON(a.tileInfo),l=s.extent,u=s.pixelSize,c=.5/s.width*u.x,d=o.lodAt(Math.max.apply(null,o.lods.map((function(e){return e.level})))),"Map"!==this.tileType&&0!==a.maxScale&&("Raster"===this.tileType?(f=o.lods.filter((function(e){return e.resolution===u.x}))[0])||(f=o.lods[o.lods.length-1]):(f=o.lods.filter((function(e){return Math.abs(e.scale-a.maxScale)<c}))[0])||(f=o.lods.filter((function(e){return e.scale>a.maxScale})).sort((function(e,t){return e.scale>t.scale?1:-1}))[0]),u.x=u.y=f.resolution,s.width=Math.ceil((l.xmax-l.xmin)/u.x-.1),s.height=Math.ceil((l.ymax-l.ymin)/u.y-.1)),f||(f=d),m=o.lodAt(Math.min.apply(null,o.lods.map((function(e){return e.level})))),"Map"===this.tileType?this._levelOffset=o.lods[0].level:0!==a.minScale&&"Elevation"===this.tileType&&(h=o.lods.filter((function(e){return Math.abs(e.scale-a.minScale)<c}))[0],this._levelOffset=h.level-m.level),h||(h=m),v=Math.max(u.x,u.y),(Math.abs(u.x-u.y)>c||!o.lods.some((function(e){return Math.abs(e.resolution-v)<c})))&&(u.x=u.y=f.resolution,s.width=Math.ceil((l.xmax-l.xmin)/u.x-.1),s.height=Math.ceil((l.ymax-l.ymin)/u.y-.1)),x=f.level-h.level,g=Object($.a)(o.size,2),O=g[0],j=g[1],w=[],o.lods.forEach((function(e){e.level>=h.level&&e.level<=f.level&&w.push({x:e.resolution,y:e.resolution})})),w.sort((function(e,t){return e.x-t.x})),k=this.computeBlockBoundary(l,O,j,o.origin,w,x),I=w.length>1?w.slice(1):null,s.storageInfo=new Z.a({blockWidth:o.size[0],blockHeight:o.size[1],pyramidBlockWidth:o.size[0],pyramidBlockHeight:o.size[1],pyramidResolutions:I,compression:o.format,origin:o.origin,firstPyramidLevel:1,maximumPyramidLevel:x,tileInfo:o,blockBoundary:k}),this._fixGCSShift(s),this._set("rasterInfo",s),a.capabilities.toLowerCase().indexOf("tilemap")>-1&&(R={tileInfo:s.storageInfo.tileInfo,parsedUrl:Object(Qe.K)(this.url),url:this.url,tileServers:[],type:"tile"},this._tilemapCache=new $e.a({layer:R}));case 37:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"fetchRawTile",value:(u=Object(n.a)(p.a.mark((function e(t,r,n){var a,i,s,o,l,u,c,f,h,d,m,b,y,v,x,g,O,j,w,k,I,R,S,T,C,P=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=P.length>3&&void 0!==P[3]?P[3]:{},i=this.rasterInfo,s=i.storageInfo,o=i.extent,l=s.maximumPyramidLevel-t+this._levelOffset,u="".concat(this.url,"/tile/").concat(l,"/").concat(r,"/").concat(n),c=this._slices?{sliceId:a.sliceId||0}:null,e.next=9,this.request(u,{query:c,responseType:"array-buffer",signal:a.signal});case 9:if(f=e.sent,h=f.data){e.next=13;break}return e.abrupt("return",null);case 13:return e.next=15,this.decodePixelBlock(h,{width:s.tileInfo.size[0],height:s.tileInfo.size[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType});case 15:if(d=e.sent,m=s.blockBoundary[t],!("jpg"!==s.compression||n>m.minCol&&n<m.maxCol&&r>m.minRow&&r<m.maxRow)){e.next=19;break}return e.abrupt("return",d);case 19:return b=s.origin,y=s.blockWidth,v=s.blockHeight,x=this.getPyramidPixelSize(t),g=x.x,O=x.y,j=Math.round((o.xmin-b.x)/g)%y,w=Math.round((o.xmax-b.x)/g)%y,k=Math.round((b.y-o.ymax)/O)%v,I=Math.round((b.y-o.ymin)/O)%v,R=n===m.minCol?j:0,S=r===m.minRow?k:0,T=n===m.maxCol?w:y,C=r===m.maxRow?I:v,e.abrupt("return",(Object(ie.m)(d,{x:R,y:S},{width:T-R,height:C-S}),d));case 21:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return u.apply(this,arguments)})},{key:"getSliceIndex",value:function(e){if(null==e||!e.length||!this._slices)return null;for(var t=e,r=0;r<this._slices.length;r++){var n=this._slices[r].multidimensionalDefinition;if(n.length===t.length&&!n.some((function(e){var r=t.filter((function(t){return e.variableName===t.variableName&&t.dimensionName===e.dimensionName}))[0];return!r||(Array.isArray(e.values[0])?e.values[0][0]:e.values[0])!==(Array.isArray(r.values[0])?r.values[0][0]:r.values[0])})))return r}return null}},{key:"fetchVariableStatisticsHistograms",value:(o=Object(n.a)(p.a.mark((function e(t,r){var n,a,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.request(this.url+"/statistics",{query:{variable:t,f:"json"},signal:r}).then((function(e){var t;return null==(t=e.data)?void 0:t.statistics})),a=this.request(this.url+"/histograms",{query:{variable:t,f:"json"},signal:r}).then((function(e){var t;return null==(t=e.data)?void 0:t.histograms})),e.next=4,Promise.all([n,a]);case 4:return i=e.sent,e.abrupt("return",(i[0]&&i[0].forEach((function(e){e.avg=e.mean,e.stddev=e.standardDeviation})),{statistics:i[0]||null,histograms:i[1]||null}));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"computeBestPyramidLevelForLocation",value:(a=Object(n.a)(p.a.mark((function e(t){var r,n,a,i,s,o,l=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>1&&void 0!==l[1]?l[1]:{},this._tilemapCache){e.next=3;break}return e.abrupt("return",0);case 3:if(null!==(n=this.identifyPixelLocation(t,0,Object(y.p)(r.datumTransformation)))){e.next=6;break}return e.abrupt("return",null);case 6:a=0,i=this.rasterInfo.storageInfo.maximumPyramidLevel,s=i-a+this._levelOffset,o=n.srcLocation;case 10:if(!(s>=0)){e.next=25;break}return e.prev=11,e.next=14,this._tilemapCache.fetchAvailability(s,n.row,n.col,r);case 14:if(e.t0=e.sent,"available"!==e.t0){e.next=17;break}return e.abrupt("break",25);case 17:e.next=21;break;case 19:e.prev=19,e.t1=e.catch(11);case 21:if(s--,a++,null!==(n=this.identifyPixelLocation(o,a,Object(y.p)(r.datumTransformation)))){e.next=23;break}return e.abrupt("return",null);case 23:e.next=10;break;case 25:return e.abrupt("return",-1===s||null==n?null:a);case 26:case"end":return e.stop()}}),e,this,[[11,19]])}))),function(e){return a.apply(this,arguments)})},{key:"_fetchRasterInfo",value:(r=Object(n.a)(p.a.mark((function e(t){var r,n,a,i,s,o,l,u,c,f,h,d,m=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.sourceJSON,n=Math.ceil((r.extent.xmax-r.extent.xmin)/r.pixelSizeX-.1),a=Math.ceil((r.extent.ymax-r.extent.ymin)/r.pixelSizeY-.1),i=N.a.fromJSON(r.spatialReference||r.extent.spatialReference),"Map"!==this.tileType){e.next=3;break}return e.abrupt("return",new Q.a({width:n,height:a,bandCount:3,extent:H.a.fromJSON(r.extent),spatialReference:i,pixelSize:new oe.a({x:r.pixelSizeX,y:r.pixelSizeY,spatialReference:i}),pixelType:"u8",statistics:null,keyProperties:{DataType:"processed"}}));case 3:return s=t.slice,o=t.signal,l=!!r.hasRasterAttributeTable&&this.request(this.url+"/rasterAttributeTable",{query:{slice:s,f:"json"},signal:o}).then((function(e){return Pe.default.fromJSON(e.data)})).catch((function(){return null})),u=!!r.hasColormap&&this.request(this.url+"/colormap",{query:{slice:s,f:"json"},signal:o}).then((function(e){var t;return null==(t=e.data)?void 0:t.colormap})),c=!!r.hasHistograms&&this.request(this.url+"/histograms",{query:{slice:s,f:"json"},signal:o}).then((function(e){var t;return null==(t=e.data)?void 0:t.histograms})),f=this.request(this.url+"/keyProperties",{query:{f:"json"},signal:o}).then((function(e){return e.data})).catch((function(){})),h=!!r.hasMultidimensions&&this._fetchMultidimensionalInfo(),d=!!r.hasMultidimensions&&this.request(this.url+"/slices",{query:{f:"json"},signal:o}).then((function(e){return e.data&&e.data.slices})).catch((function(){})),e.abrupt("return",Promise.all([l,u,c,f,h,d]).then((function(e){var t=null;if(r.minValues&&r.minValues.length===r.bandCount){t=[];for(var s=0;s<r.minValues.length;s++)t.push({min:r.minValues[s],max:r.maxValues[s],avg:r.meanValues[s],stddev:r.stdvValues[s]})}return m._slices=e[5]||null,new Q.a({width:n,height:a,bandCount:r.bandCount,extent:H.a.fromJSON(r.extent),spatialReference:i,pixelSize:new oe.a({x:r.pixelSizeX,y:r.pixelSizeY,spatialReference:i}),pixelType:r.pixelType.toLowerCase(),statistics:t,attributeTable:e[0]||null,colormap:e[1]||null,histograms:e[2]||null,keyProperties:e[3]||{},multidimensionalInfo:e[4]||null})})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_fetchMultidimensionalInfo",value:(t=Object(n.a)(p.a.mark((function e(t){var r,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request(this.url+"/multidimensionalInfo",{query:{f:"json"},signal:t}).then((function(e){var t;return null==(t=e.data)?void 0:t.multidimensionalInfo}));case 2:return n=e.sent,e.abrupt("return",(null!=(r=n.variables)&&r.length&&n.variables.forEach((function(e){var t;null!=(t=e.statistics)&&t.length&&e.statistics.forEach((function(e){e.avg=e.mean,e.stddev=e.standardDeviation}))})),n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_fixScaleInServiceInfo",value:function(){var e=this.sourceJSON;e.minScale&&e.minScale<0&&(e.minScale=0),e.maxScale&&e.maxScale<0&&(e.maxScale=0)}},{key:"_fixGCSShift",value:function(e){var t=e.extent,r=e.spatialReference;0===t.xmin&&360===t.xmax&&r.wkid&&r.isGeographic&&(e.nativeExtent=e.extent,e.transform=new rt,e.extent=e.transform.forwardTransform(t))}}]),h}(pe);Object(h.a)([Object(g.b)({type:String,json:{write:!0}})],at.prototype,"datasetFormat",void 0),Object(h.a)([Object(g.b)()],at.prototype,"tileType",void 0);var it=at=Object(h.a)([Object(I.a)("esri.layers.support.rasterDatasets.ImageServerRaster")],at),st=r("sE9J"),ot=r("HYzH");function lt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var ut=new Map;ut.set("Int8","s8"),ut.set("UInt8","u8"),ut.set("Int16","s16"),ut.set("UInt16","u16"),ut.set("Int32","s32"),ut.set("UInt32","u32"),ut.set("Float32","f32"),ut.set("Float64","f32"),ut.set("Double64","f32");var ct=new Map;ct.set("lerc",".lrc"),ct.set("none",".til"),ct.set("deflate",".pzp"),ct.set("jpeg",".jzp");var ft=function(e){Object(l.a)(u,e);var t,r,a,o=lt(u);function u(){var e;return Object(i.a)(this,u),(e=o.apply(this,arguments))._files=null,e._storageIndex=null,e.datasetFormat="MRF",e}return Object(s.a)(u,[{key:"open",value:(a=Object(n.a)(p.a.mark((function e(t){var r,n,a,i,s,o,l,u,c,f,h,d,m,b,v,x,g,O,j,w,k,I,R,S;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),n=t?Object(y.p)(t.signal):null,e.next=6,this.request(this.url,{responseType:"xml",signal:n});case 6:if(a=e.sent,i=this._parseHeader(a.data),s=i.rasterInfo,o=i.files,-1!==(null==(r=this.ioConfig.skipExtensions)?void 0:r.indexOf("aux.xml"))){e.next=15;break}return e.next=13,this._fetchAuxiliaryData(t);case 13:null!=(l=e.sent)&&(s.statistics=null!=(u=l.statistics)?u:s.statistics,s.histograms=l.histograms,l.histograms&&!Object(y.i)(s.statistics)&&(s.statistics=Object(ie.f)(l.histograms)));case 15:return this._set("rasterInfo",s),this._files=o,e.next=18,this.request(o.index,{responseType:"array-buffer",signal:n});case 18:for(c=e.sent,this._storageIndex=this._parseIndex(c.data),d=0,m=-1,b=this.rasterInfo.storageInfo,v=b.blockWidth,x=b.blockHeight,g=b.compression,O=this.rasterInfo.storageInfo.pyramidScalingFactor,j=this.rasterInfo,w=j.width,k=j.height,I=j.bandCount,R=[],S="none"===g?1:I;d<this._storageIndex.length;)m++,f=Math.ceil(w/v/Math.pow(O,m)),h=Math.ceil(k/x/Math.pow(O,m)),d+=f*h*S*4,R.push({maxRow:h,maxCol:f,minCol:0,minRow:0});this.rasterInfo.storageInfo.blockBoundary=R,m>0&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=m),this.updateTileInfo();case 24:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"fetchRawTile",value:(r=Object(n.a)(p.a.mark((function e(t,r,n){var a,i,s,o,l,u,c,f,h,d,m,b,y,v,x,g,O,j,w,k,I,R,S,T,C,P,_,M,F=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=F.length>3&&void 0!==F[3]?F[3]:{},i=this.rasterInfo.storageInfo,s=i.blockWidth,o=i.blockHeight,l=i.blockBoundary,u=i.compression,!(!(c=l[t])||c.maxRow<r||c.maxCol<n||c.minRow>r||c.minCol>n)){e.next=4;break}return e.abrupt("return",null);case 4:if(f=this.rasterInfo,h=f.bandCount,d=f.pixelType,m=this._getTileLocation(t,r,n),b=m.ranges,y=m.actualTileWidth,v=m.actualTileHeight,b&&0!==b.length){e.next=7;break}return e.abrupt("return",null);case 7:if(0!==b[0].from||0!==b[0].to){e.next=10;break}return x=new Uint8Array(s*o),e.abrupt("return",new st.a({width:s,height:o,pixels:null,mask:x,validPixelCount:0}));case 10:for(g=this.ioConfig.bandIds,O="none"===u?1:h,j=[],w=0,w=0;w<O;w++)(!g||g.indexOf[w]>-1)&&j.push(this.request(this._files.data,{range:{from:b[w].from,to:b[w].to},responseType:"array-buffer",signal:a.signal}));return e.next=15,Promise.all(j);case 15:for(k=e.sent,I=k.map((function(e){return e.data.byteLength})).reduce((function(e,t){return e+t})),R=new Uint8Array(I),S=0,w=0;w<O;w++)R.set(new Uint8Array(k[w].data),S),S+=k[w].data.byteLength;return T="lerc"===this.rasterInfo.storageInfo.compression?"lerc":"bip",e.next=23,this.decodePixelBlock(R.buffer,{width:s,height:o,format:T,pixelType:d});case 23:if(C=e.sent,P=0,_=0,y!==s||v!==o)if(M=C.mask)for(w=0;w<o;w++)if(_=w*s,w<v)for(P=y;P<s;P++)M[_+P]=0;else for(P=0;P<s;P++)M[_+P]=0;else for(M=new Uint8Array(s*o),C.mask=M,w=0;w<v;w++)for(_=w*s,P=0;P<y;P++)M[_+P]=1;return e.abrupt("return",C);case 27:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"_parseIndex",value:function(e){if(e.byteLength%16>0)throw"invalid array buffer must be multiples of 16";var t,r,n,a,i,s;if(ot.a){for(r=new Uint8Array(e),a=new ArrayBuffer(e.byteLength),n=new Uint8Array(a),i=0;i<e.byteLength/4;i++)for(s=0;s<4;s++)n[4*i+s]=r[4*i+3-s];t=new Uint32Array(a)}else t=new Uint32Array(e);return t}},{key:"_getTileLocation",value:function(e,t,r){var n,a,i,s=this.rasterInfo.storageInfo,o=s.blockWidth,l=s.blockHeight,u=s.pyramidScalingFactor,c=s.compression,f=this.rasterInfo,p=f.width,h=f.height,d=f.bandCount,m="none"===c?1:d,b=0,y=0;for(i=0;i<e;i++)y=Math.pow(u,i),b+=(n=Math.ceil(p/o/y))*(a=Math.ceil(h/l/y));y=Math.pow(u,e),n=Math.ceil(p/o/y),a=Math.ceil(h/l/y),b+=t*n+r,b*=4*m;for(var v=this._storageIndex.subarray(b,b+4*m),x=0,g=0,O=[],j=0;j<m;j++)g=(x=v[4*j+0]*Math.pow(2,32)+v[4*j+1])+v[4*j+2]*Math.pow(2,32)+v[4*j+3],O.push({from:x,to:g});return{ranges:O,actualTileWidth:r<n-1?o:Math.ceil(p/y)-o*(n-1),actualTileHeight:t<a-1?l:Math.ceil(h/y)-l*(a-1)}}},{key:"_parseHeader",value:function(e){var t=He(e,"MRF_META/Raster");if(!t)throw new b.a("mrf:open","not a valid MRF format");var r=He(t,"Size"),n=parseInt(r.getAttribute("x"),10),a=parseInt(r.getAttribute("y"),10),i=parseInt(r.getAttribute("c"),10),s=(Ne(t,"Compression")||"none").toLowerCase();if(!s||-1===["none","lerc"].indexOf(s))throw new b.a("mrf:open","currently does not support compression "+s);var o=Ne(t,"DataType")||"UInt8",l=ut.get(o);if(null==l)throw new b.a("mrf:open","currently does not support pixel type "+o);var u,c,f=He(t,"PageSize"),p=parseInt(f.getAttribute("x"),10),h=parseInt(f.getAttribute("y"),10),d=He(t,"DataValues");if(d&&(null!=(c=d.getAttribute("NoData"))&&(u=c.trim().split(" ").map((function(e){return parseFloat(e)})))),He(e,"MRF_META/CachedSource"))throw new b.a("mrf:open","currently does not support MRF referencing other data files");var m=He(e,"MRF_META/GeoTags"),y=He(m,"BoundingBox");if(null==y)throw new b.a("mrf:open","missing node MRF_META/GeoTags/BoundingBox");var v,x=parseFloat(y.getAttribute("minx")),g=parseFloat(y.getAttribute("miny")),O=parseFloat(y.getAttribute("maxx")),j=parseFloat(y.getAttribute("maxy")),w=Ne(m,"Projection")||"",k=Ne(e,"datafile"),I=Ne(e,"IndexFile");if("LOCAL_CS[]"!==w)if(w.toLowerCase().startsWith("epsg:")){var R=Number(w.slice(5));isNaN(R)||0===R||(v=new N.a({wkid:R}))}else v=We(w);var S=new H.a(x,g,O,j);S.spatialReference=v;var T=He(e,"MRF_META/Rsets"),C=parseInt(T&&T.getAttribute("scale")||"2",10),P=new Z.a({origin:new oe.a({x:S.xmin,y:S.ymax,spatialReference:v}),blockWidth:p,blockHeight:h,pyramidBlockWidth:p,pyramidBlockHeight:h,compression:s,pyramidScalingFactor:C}),_=new oe.a({x:(O-x)/n,y:(j-g)/a,spatialReference:v});return{rasterInfo:new Q.a({width:n,height:a,extent:S,spatialReference:v,bandCount:i,pixelType:l,pixelSize:_,noDataValue:u,storageInfo:P}),files:{mrf:this.url,index:I||this.url.replace(".mrf",".idx"),data:k||this.url.replace(".mrf",ct.get(s))}}}},{key:"_fetchAuxiliaryData",value:(t=Object(n.a)(p.a.mark((function e(t){var r,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request(this.url+".aux.xml",{responseType:"xml",signal:null==t?void 0:t.signal});case 3:return r=e.sent,n=r.data,e.abrupt("return",Ve(n));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return t.apply(this,arguments)})}]),u}(pe);Object(h.a)([Object(g.b)()],ft.prototype,"_files",void 0),Object(h.a)([Object(g.b)()],ft.prototype,"_storageIndex",void 0),Object(h.a)([Object(g.b)({type:String,json:{write:!0}})],ft.prototype,"datasetFormat",void 0);var pt=ft=Object(h.a)([Object(I.a)("esri.layers.support.rasterIO.MRFRaster")],ft),ht=r("lYc8"),dt=r("wSxL");function mt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function bt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function yt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}var vt=function(e,t){var r=e.get(t);return r&&r.values},xt=function(e,t){var r=e.get(t);return r&&r.values[0]},gt=function(e){Object(l.a)(f,e);var t,r,a,o,u,c=yt(f);function f(){var e;return Object(i.a)(this,f),(e=c.apply(this,arguments))._files=null,e._headerInfo=null,e._bufferSize=1048576,e.datasetFormat="TIFF",e}return Object(s.a)(f,[{key:"open",value:(u=Object(n.a)(p.a.mark((function e(t){var r,n,a,i,s,o,l,u,c,f,h,d,m,v,x,g,O,j,w,k,I,R,S,T,C,P,_,M,F,D,B,E,z,A,J,L,q,U;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return i=t?Object(y.p)(t.signal):null,e.next=5,this.request(this.url,{range:{from:0,to:this._bufferSize},responseType:"array-buffer",signal:i});case 5:if(s=e.sent,o=s.data){e.next=9;break}throw new b.a("tiffraster:open","failed to open url "+this.url);case 9:return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),l=Object(ht.h)(o),u=l.littleEndian,c=l.firstIFD,f=l.isBigTiff,h=[],e.next=13,this.readIFDs(h,o,u,c,0,f?8:4,i);case 13:if(d=Object(ht.f)(h),m=d.width,v=d.height,x=d.tileWidth,g=d.tileHeight,O=d.planes,j=d.pixelType,w=d.compression,k=d.firstPyramidLevel,I=d.maximumPyramidLevel,R=d.pyramidBlockWidth,S=d.pyramidBlockHeight,T=d.tileBoundary,C=d.affine,P=d.metadata,_=(null==(r=d.extent.spatialReference)?void 0:r.wkt)||(null==(n=d.extent.spatialReference)?void 0:n.wkid),M=We(_),F=!1,null==M&&(F=!0,M=new N.a({wkid:3857})),D=new H.a(bt(bt({},d.extent),{},{spatialReference:M})),B=new oe.a(D?{x:D.xmin,y:D.ymax,spatialReference:M}:{x:0,y:0}),E=new Z.a({blockWidth:x,blockHeight:g,pyramidBlockWidth:R,pyramidBlockHeight:S,compression:w,origin:B,firstPyramidLevel:k,maximumPyramidLevel:I,blockBoundary:T}),z=new oe.a({x:(D.xmax-D.xmin)/m,y:(D.ymax-D.ymin)/v,spatialReference:M}),A=P?{BandProperties:P.bandProperties,DataType:P.dataType}:{},J=new Q.a({width:m,height:v,bandCount:O,pixelType:j,compression:w,pixelSize:z,storageInfo:E,spatialReference:M,isPseudoSpatialReference:F,keyProperties:A,extent:D,statistics:P?P.statistics:null}),null!=C&&C.length&&(J.nativeExtent=new H.a({xmin:-.5,ymin:.5-v,xmax:m-.5,ymax:.5,spatialReference:M}),J.transform=new Se({polynomialOrder:1,forwardCoefficients:[C[2]+C[0]/2,C[5]-C[3]/2,C[0],C[3],-C[1],-C[4]]}),J.extent=J.transform.forwardTransform(J.nativeExtent),J.pixelSize=new oe.a({x:(D.xmax-D.xmin)/m,y:(D.ymax-D.ymin)/v,spatialReference:M}),E.origin.x=-.5,E.origin.y=.5),null!=(a=this.ioConfig.skipExtensions)&&a.includes("aux.xml")){e.next=22;break}return e.next=20,this._fetchAuxiliaryData(t);case 20:null!=(L=e.sent)&&(J.statistics=null!=(q=L.statistics)?q:J.statistics,J.histograms=L.histograms,L.histograms&&!Object(y.i)(J.statistics)&&(J.statistics=Object(ie.f)(L.histograms)),L.transform&&!C&&(J.transform=L.transform,J.nativeExtent=J.extent,U=J.transform.forwardTransform(J.nativeExtent),J.pixelSize=new oe.a({x:(U.xmax-U.xmin)/m,y:(U.ymax-U.ymin)/v,spatialReference:M}),J.extent=U),J.spatialReference||(J.spatialReference=L.spatialReference));case 22:if(this._set("rasterInfo",J),this._headerInfo=bt({littleEndian:u,isBigTiff:f,ifds:h},d),this._headerInfo.isSupported){e.next=24;break}throw new b.a("tiffraster:open","this tiff is not supported: "+this._headerInfo.message);case 24:this.updateTileInfo();case 25:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"fetchRawTile",value:(o=Object(n.a)(p.a.mark((function e(t,r,n){var a,i,s,o,l,u,c,f,h,d,m,b,y,v,x,g,O,j,w,k,I,R,S,T,C,P=this,_=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=_.length>3&&void 0!==_[3]?_[3]:{},null!=(i=this._headerInfo)&&i.isSupported&&!this.isBlockOutside(t,r,n)){e.next=3;break}return e.abrupt("return",null);case 3:if(s=this.getTileLocation(t,r,n)){e.next=6;break}return e.abrupt("return",null);case 6:return o=s.ranges,l=s.actualTileWidth,u=s.actualTileHeight,c=s.ifd,f=o.map((function(e){return P.request(P.url,{range:e,responseType:"array-buffer",signal:a.signal})})),e.next=13,Promise.all(f);case 13:if(h=e.sent,d=h.map((function(e){return e.data.byteLength})).reduce((function(e,t){return e+t})),m=1===h.length?h[0].data:new ArrayBuffer(d),b=[0],y=[0],h.length>1)for(v=new Uint8Array(m),x=0,g=0;x<h.length;x++)O=h[x].data,v.set(new Uint8Array(O),g),b[x]=g,g+=O.byteLength,y[x]=O.byteLength;return j=this.getBlockWidthHeight(t),w=j.blockWidth,k=j.blockHeight,e.next=24,this.decodePixelBlock(m,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:c,offsets:b,sizes:y},width:w,height:k,planes:null,pixelType:null});case 24:if(I=e.sent,l!==w||u!==k)if(C=I.mask)for(R=0;R<k;R++)if(T=R*w,R<u)for(S=l;S<w;S++)C[T+S]=0;else for(S=0;S<w;S++)C[T+S]=0;else for(C=new Uint8Array(w*k),I.mask=C,R=0;R<u;R++)for(T=R*w,S=0;S<l;S++)C[T+S]=1;return e.abrupt("return",I);case 27:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return o.apply(this,arguments)})},{key:"readIFDs",value:(a=Object(n.a)(p.a.mark((function e(t,r,n,a,i){var s,o,l,u=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=u.length>5&&void 0!==u[5]?u[5]:4,o=u.length>6?u[6]:void 0,a){e.next=4;break}return e.abrupt("return",null);case 4:if(!(a>=r.byteLength||a<0)){e.next=10;break}return e.next=7,this.request(this.url,{range:{from:a+i,to:a+i+this._bufferSize},responseType:"array-buffer",signal:o});case 7:r=e.sent.data,i=a+i,a=0;case 10:return e.next=12,this.readIFD(r,n,a,i,dt.a.TIFF_TAGS,s,o);case 12:if(l=e.sent,t.push(l.ifd),l.nextIFD){e.next=15;break}return e.abrupt("return",null);case 15:return e.next=17,this.readIFDs(t,r,n,l.nextIFD-i,i,s,o);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,i){return a.apply(this,arguments)})},{key:"readIFD",value:(r=Object(n.a)(p.a.mark((function e(t,r,n,a){var i,s,o,l,u,c,f,h,d,m,b,y,v,x,g=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=g.length>4&&void 0!==g[4]?g[4]:dt.a.TIFF_TAGS,s=g.length>5&&void 0!==g[5]?g[5]:4,o=g.length>6?g[6]:void 0,t){e.next=5;break}return e.abrupt("return",null);case 5:if(!(l=Object(ht.c)(t,r,n,a,i,s)).success){e.next=25;break}if(u=[],l.ifd.forEach((function(e){e.values||u.push(e)})),!(u.length>0)){e.next=16;break}if(c=u.map((function(e){return e.offlineOffsetSize})),f=Math.min.apply(null,c.map((function(e){return e[0]}))),!(Math.min.apply(null,c.map((function(e){return e[0]+e[1]})))-f<=this._bufferSize)){e.next=16;break}return e.next=13,this.request(this.url,{range:{from:f,to:f+this._bufferSize},responseType:"array-buffer",signal:o});case 13:h=e.sent,d=h.data,t=d,a=f,u.forEach((function(e){return Object(ht.d)(t,r,e,a)}));case 16:if(!l.ifd.has("GEOKEYDIRECTORY")){e.next=24;break}if(m=l.ifd.get("GEOKEYDIRECTORY"),!((b=m.values)&&b.length>4)){e.next=24;break}return y=b[0]+"."+b[1]+"."+b[2],e.next=22,this.readIFD(t,r,m.valueOffset+6-a,a,dt.a.GEO_KEYS,2,o);case 22:v=e.sent,m.data=v.ifd,m.data&&m.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[y]});case 24:return e.abrupt("return",l);case 25:if(!l.requiredBufferSize||l.requiredBufferSize===t.byteLength){e.next=30;break}return e.next=28,this.request(this.url,{range:{from:a,to:a+l.requiredBufferSize+4},responseType:"array-buffer",signal:o});case 28:return x=e.sent,e.abrupt("return",(t=x.data).byteLength<l.requiredBufferSize?null:this.readIFD(t,r,0,a,dt.a.TIFF_TAGS,4,o));case 30:case"end":return e.stop()}}),e,this)}))),function(e,t,n,a){return r.apply(this,arguments)})},{key:"getTileLocation",value:function(e,t,r){var n=this.rasterInfo.storageInfo,a=n.firstPyramidLevel,i=n.blockBoundary,s=0===e?0:e-(a-1),o=this._headerInfo.ifds[s];if(!o)return null;var l=Object(ht.g)(o,this._headerInfo),u=vt(o,"TILEOFFSETS");if(void 0===u)return null;var c=vt(o,"TILEBYTECOUNTS"),f=i[s],p=f.minRow,h=f.minCol,d=f.maxRow,m=f.maxCol;if(t>d||r>m||t<p||r<h)return null;var b=xt(o,"IMAGEWIDTH"),y=xt(o,"IMAGELENGTH"),v=xt(o,"TILEWIDTH"),x=xt(o,"TILELENGTH"),g=l?this.rasterInfo.bandCount:1,O=g*t*(m+1)+r,j=[{from:u[O],to:u[O+g-1]+c[O+g-1]-1}];if(l){for(var w=!0,k=0;k<g;k++)if(u[O+k]+c[O+k]!==u[O+k+1]){w=!1;break}if(!w)for(var I=0;I<g;I++)j[I]={from:u[O+I],to:u[O+I]+c[O+I]-1}}var R=u[O],S=c[O];return null==R||null==S?null:{ranges:j,ifd:o,actualTileWidth:r===m?b%v:v,actualTileHeight:t===d?y%x:x}}},{key:"_fetchAuxiliaryData",value:(t=Object(n.a)(p.a.mark((function e(t){var r,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request(this.url+".aux.xml",{responseType:"xml",signal:null==t?void 0:t.signal});case 3:return r=e.sent,n=r.data,e.abrupt("return",Ve(n));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return t.apply(this,arguments)})}]),f}(pe);Object(h.a)([Object(g.b)()],gt.prototype,"_files",void 0),Object(h.a)([Object(g.b)()],gt.prototype,"_headerInfo",void 0),Object(h.a)([Object(g.b)()],gt.prototype,"_bufferSize",void 0),Object(h.a)([Object(g.b)({type:String,json:{write:!0}})],gt.prototype,"datasetFormat",void 0);var Ot=gt=Object(h.a)([Object(I.a)("esri.layers.support.rasterDatasets.TIFFRaster")],gt),jt=new Map;jt.set("CRF",{desc:"Cloud Raster Format",constructor:De}),jt.set("MRF",{desc:"Meta Raster Format",constructor:pt}),jt.set("TIFF",{desc:"GeoTIFF",constructor:Ot}),jt.set("RasterTileServer",{desc:"Raster Tile Server",constructor:it}),jt.set("JPG",{desc:"JPG Raster Format",constructor:Ke}),jt.set("PNG",{desc:"PNG Raster Format",constructor:Ke}),jt.set("GIF",{desc:"GIF Raster Format",constructor:Ke}),jt.set("BMP",{desc:"BMP Raster Format",constructor:Ke});var wt=function(){function e(){Object(i.a)(this,e)}var t;return Object(s.a)(e,null,[{key:"supportedFormats",get:function(){var e=new Set;return jt.forEach((function(t,r){return e.add(r)})),e}},{key:"open",value:(t=Object(n.a)(p.a.mark((function e(t){var r,n,a,i,s,o,l,u,c,f;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.url,n=t.ioConfig,a=t.sourceJSON,null==(i=t.datasetFormat)&&r.lastIndexOf(".")&&(i=r.slice(r.lastIndexOf(".")+1).toUpperCase()),"OVR"===i||"TIF"===i?i="TIFF":"JPG"!==i&&"JPEG"!==i&&"JFIF"!==i||(i="JPG"),r.toLowerCase().indexOf("/imageserver")>-1&&-1===r.toLowerCase().indexOf("/wcsserver")&&(i="RasterTileServer"),s={url:r,sourceJSON:a,datasetFormat:i,ioConfig:n||{bandIds:null,sampling:null}},!this.supportedFormats.has(i)){e.next=10;break}return o=jt.get(i).constructor,l=new o(s),e.next=9,l.open({signal:t.signal});case 9:return e.abrupt("return",l);case 10:if(!i){e.next=12;break}throw new b.a("rasterfactory:open","not a supported format "+i);case 12:return u=Array.from(jt.keys()),c=0,f=function e(){return(i=u[c++])?(o=jt.get(i).constructor,(l=new o(s)).open({signal:t.signal}).then((function(){return l})).catch((function(){return e()}))):null},e.abrupt("return",f());case 16:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"register",value:function(e,t,r){jt.has(e.toUpperCase())||jt.set(e.toUpperCase(),{desc:t,constructor:r})}}]),e}(),kt=r("lMmC");function It(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Rt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?It(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):It(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function St(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(c.a)(e);if(t){var a=Object(c.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(u.a)(this,r)}}function Tt(){return{enabled:!this.loaded||"RasterTileServer"===this.raster.datasetFormat&&"Raster"===this.raster.tileType}}var Ct,Pt,_t=function(e){Object(l.a)(a,e);var t,r=St(a);function a(){var e;Object(i.a)(this,a);for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return(e=r.call.apply(r,[this].concat(n))).bandIds=null,e.interpolation=null,e.legendEnabled=!0,e.isReference=null,e.listMode="show",e.sourceJSON=null,e.version=null,e.title=null,e.type="imagery-tile",e.operationalLayerType="ArcGISTiledImageServiceLayer",e.popupEnabled=!0,e.popupTemplate=null,e.fields=null,e}return Object(s.a)(a,[{key:"normalizeCtorArgs",value:function(e,t){return"string"==typeof e?Rt({url:e},t):e}},{key:"load",value:function(e){var t=this,r=Object(y.i)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},e).catch(x.u).then((function(){return t._openRaster(r)}))),Promise.resolve(this)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"rasterFields",get:function(){var e,t,r=[new X.a({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})],n=null==(e=this.rasterInfo)||null==(t=e.attributeTable)?void 0:t.fields;if(n){var a=n.filter((function(e){return"oid"!==e.type&&"value"!==e.name.toLowerCase()})).map((function(e){var t=e.clone();return t.name="Raster."+e.name,t}));r=r.concat(a)}return r}},{key:"renderer",set:function(e){this._set("renderer",e),this.updateRenderer()}},{key:"readRenderer",value:function(e,t,r){var n=t&&t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer,a=Object(m.b)(n,r)||void 0;if(null!=a)return a}},{key:"createPopupTemplate",value:function(e){return Object(kt.a)({fields:this.rasterFields,title:this.title},e)}},{key:"write",value:function(e,t){var r=this.raster;if(this.loaded?"RasterTileServer"===r.datasetFormat&&("Raster"===r.tileType||"Map"===r.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))return Object(o.a)(Object(c.a)(a.prototype),"write",this).call(this,e,t);if(t&&t.messages){var n="".concat(t.origin,"/").concat(t.layerContainerType||"operational-layers");t.messages.push(new b.a("layer:unsupported","Layers (".concat(this.title,", ").concat(this.id,") of type '").concat(this.declaredClass,"' are not supported in the context of '").concat(n,"'"),{layer:this}))}return null}},{key:"_openRaster",value:(t=Object(n.a)(p.a.mark((function e(t){var r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.raster){e.next=8;break}if(e.t0=this.raster.rasterInfo,e.t0){e.next=5;break}return e.next=5,this.raster.open();case 5:this.url=this.raster.url,e.next=11;break;case 8:return e.next=10,wt.open({url:this.url,sourceJSON:this.sourceJSON,ioConfig:Rt(Rt({sampling:"closest"},this.ioConfig),{},{customFetchParameters:this.customParameters}),signal:t});case 10:this.raster=e.sent;case 11:if(this.raster.rasterInfo){e.next=14;break}throw new b.a("imagery-tile-layer:load","cannot load resources on "+this.url);case 14:this.sourceJSON=this.sourceJSON||this.raster.sourceJSON,null!=this.sourceJSON&&(this._set("version",this.sourceJSON.currentVersion),this._set("copyright",this.sourceJSON.copyrightText)),null==this.title&&(this.title=this.raster.datasetName),"Map"===this.raster.tileType&&(this.popupEnabled=!1),this._configDefaultSettings(),this.watch("customParameters",(function(e){return r.raster.ioConfig.customFetchParameters=e}));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(Object(S.a)(Object(Y.a)(Object(V.a)(Object(W.a)(Object(G.a)(Object(T.a)((Ct=Object(v.a)(R.a),Pt=function(e){Object(l.a)(c,e);var t,r,a,o,u=q(c);function c(){var e;return Object(i.a)(this,c),(e=u.apply(this,arguments))._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},e.bandIds=null,e.copyright=null,e.fullExtent=null,e.interpolation="nearest",e.raster=null,e.rasterInfo=null,e.sourceJSON=null,e.spatialReference=null,e.tileInfo=null,e.symbolizer=null,e}return Object(s.a)(c,[{key:"multidimensionalDefinition",set:function(e){this.raster&&(this._sliceId=this.raster.getSliceIndex(e)),this._set("multidimensionalDefinition",e)}},{key:"url",set:function(e){this._set("url",Object(M.h)(e,U))}},{key:"renderer",set:function(e){this._set("renderer",e),this.updateRenderer()}},{key:"updateRenderer",value:(o=Object(n.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loaded){e.next=2;break}return e.abrupt("return");case 2:if(JSON.stringify(this._cachedRendererJson)!==JSON.stringify(this.renderer)){e.next=4;break}return e.abrupt("return");case 4:if(t=this._rasterJobHandler.instance,e.t0=t,!e.t0){e.next=12;break}return this.symbolizer.rendererJSON=Object(z.e)(this.renderer.toJSON()),this.symbolizer.bind(),e.next=11,t.updateSymbolizer(this.symbolizer);case 11:this._cachedRendererJson=this.renderer.toJSON();case 12:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"applyRenderer",value:(a=Object(n.a)(p.a.mark((function e(t,r){var n,a,i,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t&&t.pixelBlock)&&n.pixels&&n.pixels.length>0){e.next=3;break}return e.abrupt("return",null);case 3:if(this.updateRenderer(),i=this._rasterJobHandler.instance,s=this.bandIds,!i){e.next=11;break}return e.next=8,i.symbolize(L(L({},t),{},{simpleStretchParams:r,bandIds:s}));case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=this.symbolizer.symbolize(L(L({},t),{},{simpleStretchParams:r,bandIds:s}));case 12:return a=e.t0,e.abrupt("return",a);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"getTileUrl",value:function(e,t,r){return"RasterTileServer"===this.raster.datasetFormat?"".concat(this.url,"/tile/").concat(e,"/").concat(t,"/").concat(r):""}},{key:"getCompatibleTileInfo",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.loaded)return null;if(r&&e.equals(this.spatialReference))return this.tileInfo;var n=Object(_.d)(e);return E.a.create({size:256,spatialReference:e,origin:n?{x:n.origin[0],y:n.origin[1]}:{x:t.xmin,y:t.ymax}})}},{key:"getCompatibleFullExtent",value:function(e){return this.loaded?(this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(e)||(this._compatibleFullExtent=this.raster.computeExtent(e)),this._compatibleFullExtent):null}},{key:"fetchTile",value:(r=Object(n.a)(p.a.mark((function e(t,r,n){var a,i,s,o,l=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=l.length>3&&void 0!==l[3]?l[3]:{}).requestAsImageElement){e.next=4;break}return i=this.getTileUrl(t,r,n),e.abrupt("return",Object(C.default)(i,{responseType:"image",query:L({sliceId:this._sliceId,_ts:a.timestamp},this.raster.ioConfig.customFetchParameters),signal:a.signal}).then((function(e){return e.data})));case 4:return e.next=6,this._initJobHandler();case 6:return s="raster-shaded-relief"===this.renderer.type?{cols:1,rows:1}:null,this.multidimensionalDefinition&&(o=this._sliceId,a=L({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:o,buffer:s},a)),e.abrupt("return",this.raster.fetchTile(t,r,n,a));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"fetchPixels",value:(t=Object(n.a)(p.a.mark((function e(t,r,n,a){var i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initJobHandler();case 2:if(!this.multidimensionalDefinition){e.next=5;break}i=this._sliceId,a=L({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:i},a);case 5:return e.abrupt("return",this.raster.fetchPixels(t,r,n,a));case 6:case"end":return e.stop()}}),e,this)}))),function(e,r,n,a){return t.apply(this,arguments)})},{key:"identify",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.multidimensionalDefinition&&!t.multidimensionalDefinition&&(t=L(L({},t),{},{multidimensionalDefinition:this.multidimensionalDefinition})),this.raster.identify(e,t)}},{key:"increaseRasterJobHandlerUsage",value:function(){this._rasterJobHandler.refCount++}},{key:"decreaseRasterJobHandlerUsage",value:function(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()}},{key:"hasStandardTime",value:function(){var e,t=this.rasterInfo.multidimensionalInfo;if(!Object(y.i)(t)||"standard-time"!==this.rasterInfo.dataType)return!1;var r=null==(e=this.multidimensionalDefinition[0])?void 0:e.variableName;return t.variables.some((function(e){return e.name===r&&e.dimensions.some((function(e){return"StdTime"===e.name}))}))}},{key:"getStandardTimeValue",value:function(e){return new Date(24*(e-25569)*3600*1e3).toString()}},{key:"_configDefaultSettings",value:function(){this._configDefaultInterpolation(),this._configDefaultSlice(),this._configDefaultRenderer()}},{key:"_initJobHandler",value:function(){var e=this;if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;var t=new B.a;return this._rasterJobHandler.connectionPromise=t.initialize().then((function(){e._rasterJobHandler.instance=t,e.raster.rasterJobHandler=t,e.renderer&&e.updateRenderer()})).catch((function(){return null})),this._rasterJobHandler.connectionPromise}},{key:"_shutdownJobHandler",value:function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null}},{key:"_configDefaultInterpolation",value:function(){if(null==this.interpolation){var e,t=Object(z.c)(this.rasterInfo,this.raster.tileType,null==(e=this.sourceJSON)?void 0:e.defaultResamplingMethod);this._set("interpolation",t)}}},{key:"_configDefaultSlice",value:function(){var e=this.raster.rasterInfo.multidimensionalInfo;if(Object(y.i)(e)){if(!this.multidimensionalDefinition){var t=e.variables[0],r=[];t.dimensions.forEach((function(e){r.push(new D.a({variableName:t.name,dimensionName:e.name,values:e.hasRegularIntervals?e.extent[0]:e.values[0],isSlice:!0}))})),this.multidimensionalDefinition=r}this._sliceId=this.raster.getSliceIndex(this.multidimensionalDefinition)}}},{key:"_configDefaultRenderer",value:function(){var e,t,r=this.raster.rasterInfo;this.bandIds||(this.bandIds=Object(z.b)(r)),this.renderer||(this.renderer=Object(z.a)(r,{bandIds:this.bandIds,variableName:null==(e=this.multidimensionalDefinition)||null==(t=e[0])?void 0:t.variableName})),this.symbolizer?(this.symbolizer.rendererJSON=Object(z.e)(this.renderer.toJSON()),this.symbolizer.rasterInfo=r):this.symbolizer=new A.a({rendererJSON:this.renderer.toJSON(),rasterInfo:r}),this.symbolizer.bind()||U.warn("imagery-tile-mixin","The given renderer is not supported by the layer.")}}]),c}(Ct),Object(h.a)([Object(g.b)()],Pt.prototype,"_cachedRendererJson",void 0),Object(h.a)([Object(g.b)()],Pt.prototype,"_sliceId",void 0),Object(h.a)([Object(g.b)()],Pt.prototype,"_compatibleFullExtent",void 0),Object(h.a)([Object(g.b)()],Pt.prototype,"_rasterJobHandler",void 0),Object(h.a)([Object(g.b)()],Pt.prototype,"bandIds",void 0),Object(h.a)([Object(g.b)()],Pt.prototype,"copyright",void 0),Object(h.a)([Object(g.b)({type:H.a}),Object(P.a)("rasterInfo.extent")],Pt.prototype,"fullExtent",void 0),Object(h.a)([Object(g.b)()],Pt.prototype,"interpolation",void 0),Object(h.a)([Object(g.b)()],Pt.prototype,"ioConfig",void 0),Object(h.a)([Object(g.b)({type:[D.a]})],Pt.prototype,"multidimensionalDefinition",null),Object(h.a)([Object(g.b)()],Pt.prototype,"raster",void 0),Object(h.a)([Object(g.b)({readOnly:!0}),Object(P.a)("raster.rasterInfo")],Pt.prototype,"rasterInfo",void 0),Object(h.a)([Object(g.b)()],Pt.prototype,"sourceJSON",void 0),Object(h.a)([Object(g.b)({type:N.a}),Object(P.a)("rasterInfo.spatialReference")],Pt.prototype,"spatialReference",void 0),Object(h.a)([Object(g.b)({type:E.a}),Object(P.a)("rasterInfo.storageInfo.tileInfo")],Pt.prototype,"tileInfo",void 0),Object(h.a)([Object(g.b)(F.n)],Pt.prototype,"url",null),Object(h.a)([Object(g.b)({types:m.a})],Pt.prototype,"renderer",null),Object(h.a)([Object(g.b)()],Pt.prototype,"symbolizer",void 0),Pt=Object(h.a)([Object(I.a)("esri.layers.ImageryTileMixin")],Pt),Pt))))))));Object(h.a)([Object(g.b)({type:[O.a],json:{write:{overridePolicy:Tt}}})],_t.prototype,"bandIds",void 0),Object(h.a)([Object(g.b)({json:{write:{overridePolicy:Tt}}}),Object(w.a)(K.a)],_t.prototype,"interpolation",void 0),Object(h.a)([Object(g.b)({json:{write:!0}})],_t.prototype,"multidimensionalDefinition",void 0),Object(h.a)([Object(g.b)(F.e)],_t.prototype,"legendEnabled",void 0),Object(h.a)([Object(g.b)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],_t.prototype,"isReference",void 0),Object(h.a)([Object(g.b)({type:["show","hide"]})],_t.prototype,"listMode",void 0),Object(h.a)([Object(g.b)()],_t.prototype,"sourceJSON",void 0),Object(h.a)([Object(g.b)({readOnly:!0})],_t.prototype,"version",void 0),Object(h.a)([Object(g.b)()],_t.prototype,"title",void 0),Object(h.a)([Object(g.b)({readOnly:!0,json:{read:!1}})],_t.prototype,"type",void 0),Object(h.a)([Object(g.b)({type:["ArcGISTiledImageServiceLayer"]})],_t.prototype,"operationalLayerType",void 0),Object(h.a)([Object(g.b)({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",overridePolicy:Tt,writer:function(e,t,r){t[r]=!e}}}})],_t.prototype,"popupEnabled",void 0),Object(h.a)([Object(g.b)({type:d.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:Tt}}})],_t.prototype,"popupTemplate",void 0),Object(h.a)([Object(g.b)({readOnly:!0})],_t.prototype,"defaultPopupTemplate",null),Object(h.a)([Object(g.b)({readOnly:!0,type:[X.a]})],_t.prototype,"fields",void 0),Object(h.a)([Object(g.b)({readOnly:!0,type:[X.a]})],_t.prototype,"rasterFields",null),Object(h.a)([Object(g.b)({types:m.a,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:Tt},origins:{"web-scene":{types:m.c,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:function(e){return{enabled:e&&"vector-field"!==e.type}}}}}}})],_t.prototype,"renderer",null),Object(h.a)([Object(k.a)("renderer")],_t.prototype,"readRenderer",null);var Mt=_t=Object(h.a)([Object(I.a)("esri.layers.ImageryTileLayer")],_t);t.default=Mt}}]);
//# sourceMappingURL=125-855e181256083282e1dd.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{"3i+6":function(e,t,n){"use strict";n.r(t),n.d(t,"csvLatitudeFieldNames",(function(){return B})),n.d(t,"csvLongitudeFieldNames",(function(){return Z}));var r=n("aNYv"),i=n("eijD"),a=n("yBJb"),l=n("hisu"),u=n("NthX"),o=n.n(u),s=(n("ZTBZ"),n("DGz/")),c=n("Mp7X"),f=n("J4Pc"),d=n("JqcG"),y=n("z9dv"),p=n("B9Yk"),v=n("0rLw"),m=n("12QT"),h=n("3p7a"),g=n("JBec"),b=n("4zgH"),x=n("Lk2+"),F=n("pjVo"),I=n("Lc5R");function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){u=!0,a=e},f:function(){try{l||null==n.return||n.return()}finally{if(u)throw a}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var N=o.a.mark(D),_=o.a.mark(q),T=/^\s*"([\S\s]*)"\s*$/,j=/""/g,O=[","," ",";","|","\t"];function E(e,t){for(var n={},r=e.length,i=0;i<r;i++)n[e[i]]=t[i];return n}function D(e,t,n){var r,i,a;return o.a.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:r=0;case 1:if(!(r<=e.length)){l.next=10;break}if(i=e.indexOf(t,r),a=e.substring(r,i>-1?i:void 0),r+=a.length+t.length,l.t0=n&&!a.trim(),l.t0){l.next=8;break}return l.next=8,a;case 8:l.next=1;break;case 10:case"end":return l.stop()}}),N)}function S(e){var t=e.includes("\r\n")?"\r\n":"\n";return D(e,t,!0)}function q(e,t,n){var r,i,a,l,u,s,c,f,d,y;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:r="",i="",a=0,l=[];case 1:if(u=e.next(),s=u.value,!u.done){o.next=4;break}return o.abrupt("return");case 4:c=D(s,n,!1);case 5:if(f=c.next(),d=f.value,!f.done){o.next=8;break}return o.abrupt("break",24);case 8:if(r+=i+d,i="",(a+=C(d))%2!=0){o.next=21;break}if(!(a>0)){o.next=17;break}if(y=T.exec(r)){o.next=14;break}return l=[],r="",a=0,o.abrupt("continue",31);case 14:l.push(y[1].replace(j,'"')),o.next=18;break;case 17:l.push(r);case 18:r="",a=0,o.next=22;break;case 21:i=n;case 22:o.next=5;break;case 24:if(0!==a){o.next=30;break}return o.next=27,E(t,l);case 27:l=[],o.next=31;break;case 30:i="\n";case 31:o.next=1;break;case 33:case"end":return o.stop()}}),_)}function C(e){var t=0,n=0;for(n=e.indexOf('"',n);n>=0;)t++,n=e.indexOf('"',n+1);return t}var A=n("YwDY"),V=n("nyn0"),L=n("YHXj");function P(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){u=!0,a=e},f:function(){try{l||null==n.return||n.return()}finally{if(u)throw a}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var G,M,Q,Y,J=Object(A.d)("esriGeometryPoint"),$=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"],B=["lat","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point-y"],Z=["lon","lng","long","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point-x"],z=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,U=["csv"],X=[0,0],H=function e(t,n){Object(l.a)(this,e),this.x=t,this.y=n},W=(G=Object(d.a)(),M=new RegExp("^"+G.regexp+"$"),Q=new RegExp("["+G.group+"\\s\\xa0]","g"),Y=G.factor,function(e){var t=M.exec(e);if(G.factor=Y,!t)return NaN;var n=t[1];if(!t[1]){if(!t[2])return NaN;n=t[2],G.factor*=-1}return+(n=n.replace(Q,"").replace(G.decimal,"."))*G.factor}),K="isInteger"in Number?Number.isInteger:function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},ee=function(){function e(){Object(l.a)(this,e),this._fieldsIndex=null,this._queryEngine=null}var t,n,u,d;return Object(a.a)(e,[{key:"destroy",value:function(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy(),this._queryEngine=null,this._fieldsIndex=null}},{key:"load",value:(d=Object(i.a)(o.a.mark((function e(t){var n,i,a,l,u,s,c,f,d=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:{},e.next=3,Promise.all([this._fetch(t.url,n),this._checkProjection(n&&t.parsing&&t.parsing.spatialReference)]);case 3:return i=e.sent,a=Object(r.a)(i,1),l=a[0],u=this._parse(l,t),this._queryEngine=this._createQueryEngine(l,u),u.layerDefinition.extent=this._queryEngine.fullExtent,u.layerDefinition.timeInfo&&(s=this._queryEngine.timeExtent,c=s.start,f=s.end,u.layerDefinition.timeInfo.timeExtent=[c,f]),e.abrupt("return",u);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"applyEdits",value:(u=Object(i.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new c.a("csv-source:editing-not-supported","applyEdits() is not supported on CSVLayer");case 1:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)})},{key:"queryFeatures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._queryEngine.executeQuery(e,t.signal)}},{key:"queryFeatureCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._queryEngine.executeQueryForCount(e,t.signal)}},{key:"queryObjectIds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._queryEngine.executeQueryForIds(e,t.signal)}},{key:"queryExtent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._queryEngine.executeQueryForExtent(e,t.signal)}},{key:"querySnapping",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._queryEngine.executeQueryForSnapping(e,t.signal)}},{key:"_fetch",value:(n=Object(i.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new c.a("csv-source:invalid-source","url not defined");case 2:return r=Object(y.K)(t),e.next=5,Object(s.default)(r.path,{query:r.query,responseType:"text",signal:n.signal});case 5:return e.abrupt("return",e.sent.data);case 6:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"_parse",value:function(e,t){var n=t.parsing||{},r={columnDelimiter:n.columnDelimiter,layerDefinition:null,locationInfo:{latitudeFieldName:n.latitudeField,longitudeFieldName:n.longitudeField}},i=S(e),a=i.next().value;if(!a)throw new c.a("csv","CSV is empty",{csv:e});if(a=a.trim(),!n.columnDelimiter){var l=function(e){var t,n=e.trim(),r=0,i="",a=w(O);try{for(a.s();!(t=a.n()).done;){var l=t.value,u=n.split(l).length;u>r&&(r=u,i=l)}}catch(o){a.e(o)}finally{a.f()}return""===i?null:i}(a);if(!l)throw new c.a("csv-source:invalid-delimiter","Unable to detect the delimiter from CSV");r.columnDelimiter=l}var u=a.split(r.columnDelimiter),o=r.layerDefinition={name:Object(y.k)(t.url,U)||"csv",drawingInfo:J,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:n.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:n.spatialReference||{wkid:102100}}};if(!n.latitudeField||!n.longitudeField){var s=this._inferLocationInfo(u);if(!n.longitudeField&&!s.longitudeFieldName||!n.latitudeField&&!s.latitudeFieldName)throw new c.a("csv","Unable to identify latitudeField and/or longitudeField from CSV");r.locationInfo={longitudeFieldName:n.longitudeField||s.longitudeFieldName,latitudeFieldName:n.latitudeField||s.latitudeFieldName}}var f=this._inferFields(i,r.columnDelimiter,u,r.locationInfo);if(n.fields&&n.fields.length){var d,p=new Map,v=P(n.fields);try{for(v.s();!(d=v.n()).done;){var m=d.value;p.set(m.name.toLowerCase(),m)}}catch(j){v.e(j)}finally{v.f()}var h,g=P(f);try{for(g.s();!(h=g.n()).done;){var b=h.value,x=p.get(b.name.toLowerCase());if(x){var F=b.name;Object.assign(b,x),b.name=F}}}catch(j){g.e(j)}finally{g.f()}}if(o.fields=f,!o.fields.some((function(e){return"esriFieldTypeOID"===e.type&&(o.objectIdField=e.name,!0)}))){var I={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1};o.objectIdField=I.name,o.fields.unshift(I)}if(this._fieldsIndex=new V.a(o.fields),o.timeInfo){var k=o.timeInfo;if(k.startTimeField){var N=this._fieldsIndex.get(k.startTimeField);N?(k.startTimeField=N.name,N.type="esriFieldTypeDate"):k.startTimeField=null}if(k.endTimeField){var _=this._fieldsIndex.get(k.endTimeField);_?(k.endTimeField=_.name,_.type="esriFieldTypeDate"):k.endTimeField=null}if(k.trackIdField){var T=this._fieldsIndex.get(k.trackIdField);k.trackIdField=T?T.name:null}k.startTimeField||k.endTimeField||(o.timeInfo=null)}return r}},{key:"_inferLocationInfo",value:function(e){var t=null,n=null,r=function(t){return e.find((function(e){return e.toLowerCase()===t}))};return Z.some((function(e){return!!(t=r(e))})),B.some((function(e){return!!(n=r(e))})),{longitudeFieldName:t,latitudeFieldName:n}}},{key:"_inferFields",value:function(e,t,n,r){var i=this,a=[],l=q(e,n,t),u=[];e:for(;u.length<10;){var o=l.next(),s=o.value;if(o.done)break e;u.push(s)}var c,f=P(n);try{var d=function(){var e=c.value;if(e===r.longitudeFieldName||e===r.latitudeFieldName)a.push({name:e,type:"esriFieldTypeDouble",alias:e});else{var t=u.map((function(t){return t[e]})),n=i._inferFieldType(t),l={name:e,type:null,alias:e};switch(n){case"integer":l.type="esriFieldTypeInteger";break;case"double":l.type="esriFieldTypeDouble";break;case"date":l.type="esriFieldTypeDate",l.length=36;break;default:l.type="esriFieldTypeString",l.length=255}a.push(l)}};for(f.s();!(c=f.n()).done;)d()}catch(y){f.e(y)}finally{f.f()}return a}},{key:"_inferFieldType",value:function(e){var t=this;if(!e.length)return"string";var n=/[^+-.,0-9]/;return e.map((function(e){var r=!1;if(""!==e){if(n.test(e))r=!0;else{var i=W(e);if(!isNaN(i))return/[.,]/.test(e)||!K(i)||i>214783647||i<-214783648?"double":"integer";if(-1===e.indexOf("E"))r=!0;else{if(i=Number(e),!isNaN(i))return"double";if(-1===e.indexOf(","))r=!0;else{if(e=e.replace(",","."),i=Number(e),!isNaN(i))return"double";r=!0}}}if(r){if(!/^[-]?\d*[.,]?\d*$/.test(e)){var a=new Date(e);return t._isValidDate(a,e)?"date":"string"}return"string"}return"string"}})).reduce((function(e,t){return void 0===e||e===t?t:"string"===e||"string"===t?"string":"double"===e||"double"===t?"double":void 0}))}},{key:"_isValidDate",value:function(e,t){if(!e||"[object Date]"!==Object.prototype.toString.call(e)||isNaN(e.getTime()))return!1;var n=!0;if(Object(f.a)("chrome")&&/\d+\W*$/.test(t)){var r=t.match(/[a-zA-Z]{2,}/);if(r){for(var i=!1,a=0;!i&&a<=r.length;)i=!z.test(r[a]),a++;n=!i}}return n}},{key:"_createQueryEngine",value:function(e,t){var n,i=t.locationInfo,a=i.latitudeFieldName,l=i.longitudeFieldName,u=t.layerDefinition,o=u.objectIdField,s=u.fields,c=u.extent,f=u.timeInfo,d=[],y=[],F=new Set,w=new Set,k=[],N=P(s);try{for(N.s();!(n=N.n()).done;){var _=n.value,T=_.name,j=_.type;"esriFieldTypeDate"===j?F.add(T):$.indexOf(j)>-1&&w.add(T),T!==o&&k.push(T)}}catch(le){N.e(le)}finally{N.f()}var O=0,E=S(e);E.next();var D=q(E,k,t.columnDelimiter);e:for(;;){var C=D.next(),A=C.value;if(C.done)break e;var V=this._parseCoordinateValue(A[a]),R=this._parseCoordinateValue(A[l]);if(null!=R&&null!=V&&!isNaN(V)&&!isNaN(R)){for(var G in A[a]=V,A[l]=R,A)if(G!==a&&G!==l)if(F.has(G)){var M=new Date(A[G]);A[G]=this._isValidDate(M,A[G])?M.getTime():null}else if(w.has(G)){var Q=W(A[G]);isNaN(Q)?A[G]=null:A[G]=Q}A[o]=O,O++,d.push(new H(R,V)),y.push(A)}}if(!Object(m.c)({wkid:4326},c.spatialReference))if(Object(m.n)(c.spatialReference)){var Y,J=P(d);try{for(J.s();!(Y=J.n()).done;){var B=Y.value,Z=Object(h.c)(B.x,B.y,X),z=Object(r.a)(Z,2);B.x=z[0],B.y=z[1]}}catch(le){J.e(le)}finally{J.f()}}else d=Object(p.k)(v.a,d,L.a.WGS84,c.spatialReference,null);for(var U=new x.a({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1}),K=new I.a({fields:t.layerDefinition.fields,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:f,objectIdField:o,spatialReference:c.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:U}),ee=[],te=0;te<d.length;te++){var ne=d[te],re=ne.x,ie=ne.y,ae=y[te];ae[o]=te+1,ee.push(new g.a(new b.a([],[re,ie]),ae,null,ae[o]))}return U.addMany(ee),K}},{key:"_parseCoordinateValue",value:function(e){if(null==e||""===e)return null;var t=W(e);return(isNaN(t)||Math.abs(t)>181)&&(t=parseFloat(e)),t}},{key:"_checkProjection",value:(t=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(F.a)(m.a,t);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new c.a("csv-layer","Projection not supported");case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return t.apply(this,arguments)})}]),e}();t.default=ee}}]);
//# sourceMappingURL=143-c7faf6d877d0bd5d1109.js.map